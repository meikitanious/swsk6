import{S as Nt,i as Kt,s as Lt,e as $t,b as ge,f as Te,t as ye,h as ne,L as _t,M as br,N as Mr,o as Gt,j as cr,O as hr,P as ot,Q as vr,C as it,k as le,a as me,l as ue,m as ce,c as Ee,R as Et,T as vt,F as ae,H as nt,I as st,J as at,U as Ft,V as ht,n as ee,B as Ve,A as wr,g as gr,d as pr,W as Fr,X as kr,q as je,r as ze,D as ut,p as Yt,w as qe,x as et,y as tt,z as rt}from"../../chunks/index-a41dc320.js";import{c as Br}from"../../chunks/_commonjsHelpers-456b4ed0.js";function Xt(a){return a!==null&&typeof a=="object"&&"constructor"in a&&a.constructor===Object}function Wt(a={},m={}){Object.keys(m).forEach(E=>{typeof a[E]>"u"?a[E]=m[E]:Xt(m[E])&&Xt(a[E])&&Object.keys(m[E]).length>0&&Wt(a[E],m[E])})}const mr={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Pe(){const a=typeof document<"u"?document:{};return Wt(a,mr),a}const Ur={document:mr,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(a){return typeof setTimeout>"u"?(a(),null):setTimeout(a,0)},cancelAnimationFrame(a){typeof setTimeout>"u"||clearTimeout(a)}};function Se(){const a=typeof window<"u"?window:{};return Wt(a,Ur),a}function Nr(a){const m=a.__proto__;Object.defineProperty(a,"__proto__",{get(){return m},set(E){m.__proto__=E}})}class $e extends Array{constructor(m){typeof m=="number"?super(m):(super(...m||[]),Nr(this))}}function pt(a=[]){const m=[];return a.forEach(E=>{Array.isArray(E)?m.push(...pt(E)):m.push(E)}),m}function Er(a,m){return Array.prototype.filter.call(a,m)}function Kr(a){const m=[];for(let E=0;E<a.length;E+=1)m.indexOf(a[E])===-1&&m.push(a[E]);return m}function Gr(a,m){if(typeof a!="string")return[a];const E=[],L=m.querySelectorAll(a);for(let w=0;w<L.length;w+=1)E.push(L[w]);return E}function te(a,m){const E=Se(),L=Pe();let w=[];if(!m&&a instanceof $e)return a;if(!a)return new $e(w);if(typeof a=="string"){const U=a.trim();if(U.indexOf("<")>=0&&U.indexOf(">")>=0){let G="div";U.indexOf("<li")===0&&(G="ul"),U.indexOf("<tr")===0&&(G="tbody"),(U.indexOf("<td")===0||U.indexOf("<th")===0)&&(G="tr"),U.indexOf("<tbody")===0&&(G="table"),U.indexOf("<option")===0&&(G="select");const B=L.createElement(G);B.innerHTML=U;for(let u=0;u<B.childNodes.length;u+=1)w.push(B.childNodes[u])}else w=Gr(a.trim(),m||L)}else if(a.nodeType||a===E||a===L)w.push(a);else if(Array.isArray(a)){if(a instanceof $e)return a;w=a}return new $e(Kr(w))}te.fn=$e.prototype;function Wr(...a){const m=pt(a.map(E=>E.split(" ")));return this.forEach(E=>{E.classList.add(...m)}),this}function Hr(...a){const m=pt(a.map(E=>E.split(" ")));return this.forEach(E=>{E.classList.remove(...m)}),this}function Vr(...a){const m=pt(a.map(E=>E.split(" ")));this.forEach(E=>{m.forEach(L=>{E.classList.toggle(L)})})}function jr(...a){const m=pt(a.map(E=>E.split(" ")));return Er(this,E=>m.filter(L=>E.classList.contains(L)).length>0).length>0}function zr(a,m){if(arguments.length===1&&typeof a=="string")return this[0]?this[0].getAttribute(a):void 0;for(let E=0;E<this.length;E+=1)if(arguments.length===2)this[E].setAttribute(a,m);else for(const L in a)this[E][L]=a[L],this[E].setAttribute(L,a[L]);return this}function $r(a){for(let m=0;m<this.length;m+=1)this[m].removeAttribute(a);return this}function Yr(a){for(let m=0;m<this.length;m+=1)this[m].style.transform=a;return this}function Xr(a){for(let m=0;m<this.length;m+=1)this[m].style.transitionDuration=typeof a!="string"?`${a}ms`:a;return this}function Qr(...a){let[m,E,L,w]=a;typeof a[1]=="function"&&([m,L,w]=a,E=void 0),w||(w=!1);function U(M){const I=M.target;if(!I)return;const b=M.target.dom7EventData||[];if(b.indexOf(M)<0&&b.unshift(M),te(I).is(E))L.apply(I,b);else{const C=te(I).parents();for(let F=0;F<C.length;F+=1)te(C[F]).is(E)&&L.apply(C[F],b)}}function G(M){const I=M&&M.target?M.target.dom7EventData||[]:[];I.indexOf(M)<0&&I.unshift(M),L.apply(this,I)}const B=m.split(" ");let u;for(let M=0;M<this.length;M+=1){const I=this[M];if(E)for(u=0;u<B.length;u+=1){const b=B[u];I.dom7LiveListeners||(I.dom7LiveListeners={}),I.dom7LiveListeners[b]||(I.dom7LiveListeners[b]=[]),I.dom7LiveListeners[b].push({listener:L,proxyListener:U}),I.addEventListener(b,U,w)}else for(u=0;u<B.length;u+=1){const b=B[u];I.dom7Listeners||(I.dom7Listeners={}),I.dom7Listeners[b]||(I.dom7Listeners[b]=[]),I.dom7Listeners[b].push({listener:L,proxyListener:G}),I.addEventListener(b,G,w)}}return this}function Zr(...a){let[m,E,L,w]=a;typeof a[1]=="function"&&([m,L,w]=a,E=void 0),w||(w=!1);const U=m.split(" ");for(let G=0;G<U.length;G+=1){const B=U[G];for(let u=0;u<this.length;u+=1){const M=this[u];let I;if(!E&&M.dom7Listeners?I=M.dom7Listeners[B]:E&&M.dom7LiveListeners&&(I=M.dom7LiveListeners[B]),I&&I.length)for(let b=I.length-1;b>=0;b-=1){const C=I[b];L&&C.listener===L||L&&C.listener&&C.listener.dom7proxy&&C.listener.dom7proxy===L?(M.removeEventListener(B,C.proxyListener,w),I.splice(b,1)):L||(M.removeEventListener(B,C.proxyListener,w),I.splice(b,1))}}}return this}function Jr(...a){const m=Se(),E=a[0].split(" "),L=a[1];for(let w=0;w<E.length;w+=1){const U=E[w];for(let G=0;G<this.length;G+=1){const B=this[G];if(m.CustomEvent){const u=new m.CustomEvent(U,{detail:L,bubbles:!0,cancelable:!0});B.dom7EventData=a.filter((M,I)=>I>0),B.dispatchEvent(u),B.dom7EventData=[],delete B.dom7EventData}}}return this}function qr(a){const m=this;function E(L){L.target===this&&(a.call(this,L),m.off("transitionend",E))}return a&&m.on("transitionend",E),this}function ei(a){if(this.length>0){if(a){const m=this.styles();return this[0].offsetWidth+parseFloat(m.getPropertyValue("margin-right"))+parseFloat(m.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null}function ti(a){if(this.length>0){if(a){const m=this.styles();return this[0].offsetHeight+parseFloat(m.getPropertyValue("margin-top"))+parseFloat(m.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null}function ri(){if(this.length>0){const a=Se(),m=Pe(),E=this[0],L=E.getBoundingClientRect(),w=m.body,U=E.clientTop||w.clientTop||0,G=E.clientLeft||w.clientLeft||0,B=E===a?a.scrollY:E.scrollTop,u=E===a?a.scrollX:E.scrollLeft;return{top:L.top+B-U,left:L.left+u-G}}return null}function ii(){const a=Se();return this[0]?a.getComputedStyle(this[0],null):{}}function ni(a,m){const E=Se();let L;if(arguments.length===1)if(typeof a=="string"){if(this[0])return E.getComputedStyle(this[0],null).getPropertyValue(a)}else{for(L=0;L<this.length;L+=1)for(const w in a)this[L].style[w]=a[w];return this}if(arguments.length===2&&typeof a=="string"){for(L=0;L<this.length;L+=1)this[L].style[a]=m;return this}return this}function si(a){return a?(this.forEach((m,E)=>{a.apply(m,[m,E])}),this):this}function ai(a){const m=Er(this,a);return te(m)}function oi(a){if(typeof a>"u")return this[0]?this[0].innerHTML:null;for(let m=0;m<this.length;m+=1)this[m].innerHTML=a;return this}function li(a){if(typeof a>"u")return this[0]?this[0].textContent.trim():null;for(let m=0;m<this.length;m+=1)this[m].textContent=a;return this}function ui(a){const m=Se(),E=Pe(),L=this[0];let w,U;if(!L||typeof a>"u")return!1;if(typeof a=="string"){if(L.matches)return L.matches(a);if(L.webkitMatchesSelector)return L.webkitMatchesSelector(a);if(L.msMatchesSelector)return L.msMatchesSelector(a);for(w=te(a),U=0;U<w.length;U+=1)if(w[U]===L)return!0;return!1}if(a===E)return L===E;if(a===m)return L===m;if(a.nodeType||a instanceof $e){for(w=a.nodeType?[a]:a,U=0;U<w.length;U+=1)if(w[U]===L)return!0;return!1}return!1}function fi(){let a=this[0],m;if(a){for(m=0;(a=a.previousSibling)!==null;)a.nodeType===1&&(m+=1);return m}}function di(a){if(typeof a>"u")return this;const m=this.length;if(a>m-1)return te([]);if(a<0){const E=m+a;return E<0?te([]):te([this[E]])}return te([this[a]])}function ci(...a){let m;const E=Pe();for(let L=0;L<a.length;L+=1){m=a[L];for(let w=0;w<this.length;w+=1)if(typeof m=="string"){const U=E.createElement("div");for(U.innerHTML=m;U.firstChild;)this[w].appendChild(U.firstChild)}else if(m instanceof $e)for(let U=0;U<m.length;U+=1)this[w].appendChild(m[U]);else this[w].appendChild(m)}return this}function hi(a){const m=Pe();let E,L;for(E=0;E<this.length;E+=1)if(typeof a=="string"){const w=m.createElement("div");for(w.innerHTML=a,L=w.childNodes.length-1;L>=0;L-=1)this[E].insertBefore(w.childNodes[L],this[E].childNodes[0])}else if(a instanceof $e)for(L=0;L<a.length;L+=1)this[E].insertBefore(a[L],this[E].childNodes[0]);else this[E].insertBefore(a,this[E].childNodes[0]);return this}function vi(a){return this.length>0?a?this[0].nextElementSibling&&te(this[0].nextElementSibling).is(a)?te([this[0].nextElementSibling]):te([]):this[0].nextElementSibling?te([this[0].nextElementSibling]):te([]):te([])}function gi(a){const m=[];let E=this[0];if(!E)return te([]);for(;E.nextElementSibling;){const L=E.nextElementSibling;a?te(L).is(a)&&m.push(L):m.push(L),E=L}return te(m)}function pi(a){if(this.length>0){const m=this[0];return a?m.previousElementSibling&&te(m.previousElementSibling).is(a)?te([m.previousElementSibling]):te([]):m.previousElementSibling?te([m.previousElementSibling]):te([])}return te([])}function mi(a){const m=[];let E=this[0];if(!E)return te([]);for(;E.previousElementSibling;){const L=E.previousElementSibling;a?te(L).is(a)&&m.push(L):m.push(L),E=L}return te(m)}function Ei(a){const m=[];for(let E=0;E<this.length;E+=1)this[E].parentNode!==null&&(a?te(this[E].parentNode).is(a)&&m.push(this[E].parentNode):m.push(this[E].parentNode));return te(m)}function Ti(a){const m=[];for(let E=0;E<this.length;E+=1){let L=this[E].parentNode;for(;L;)a?te(L).is(a)&&m.push(L):m.push(L),L=L.parentNode}return te(m)}function yi(a){let m=this;return typeof a>"u"?te([]):(m.is(a)||(m=m.parents(a).eq(0)),m)}function _i(a){const m=[];for(let E=0;E<this.length;E+=1){const L=this[E].querySelectorAll(a);for(let w=0;w<L.length;w+=1)m.push(L[w])}return te(m)}function Si(a){const m=[];for(let E=0;E<this.length;E+=1){const L=this[E].children;for(let w=0;w<L.length;w+=1)(!a||te(L[w]).is(a))&&m.push(L[w])}return te(m)}function xi(){for(let a=0;a<this.length;a+=1)this[a].parentNode&&this[a].parentNode.removeChild(this[a]);return this}const Qt={addClass:Wr,removeClass:Hr,hasClass:jr,toggleClass:Vr,attr:zr,removeAttr:$r,transform:Yr,transition:Xr,on:Qr,off:Zr,trigger:Jr,transitionEnd:qr,outerWidth:ei,outerHeight:ti,styles:ii,offset:ri,css:ni,each:si,html:oi,text:li,is:ui,index:fi,eq:di,append:ci,prepend:hi,next:vi,nextAll:gi,prev:pi,prevAll:mi,parent:Ei,parents:Ti,closest:yi,find:_i,children:Si,filter:ai,remove:xi};Object.keys(Qt).forEach(a=>{Object.defineProperty(te.fn,a,{value:Qt[a],writable:!0})});function Li(a){const m=a;Object.keys(m).forEach(E=>{try{m[E]=null}catch{}try{delete m[E]}catch{}})}function St(a,m=0){return setTimeout(a,m)}function gt(){return Date.now()}function Di(a){const m=Se();let E;return m.getComputedStyle&&(E=m.getComputedStyle(a,null)),!E&&a.currentStyle&&(E=a.currentStyle),E||(E=a.style),E}function Ai(a,m="x"){const E=Se();let L,w,U;const G=Di(a);return E.WebKitCSSMatrix?(w=G.transform||G.webkitTransform,w.split(",").length>6&&(w=w.split(", ").map(B=>B.replace(",",".")).join(", ")),U=new E.WebKitCSSMatrix(w==="none"?"":w)):(U=G.MozTransform||G.OTransform||G.MsTransform||G.msTransform||G.transform||G.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),L=U.toString().split(",")),m==="x"&&(E.WebKitCSSMatrix?w=U.m41:L.length===16?w=parseFloat(L[12]):w=parseFloat(L[4])),m==="y"&&(E.WebKitCSSMatrix?w=U.m42:L.length===16?w=parseFloat(L[13]):w=parseFloat(L[5])),w||0}function Tt(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"}function Ii(a){return typeof window<"u"&&typeof window.HTMLElement<"u"?a instanceof HTMLElement:a&&(a.nodeType===1||a.nodeType===11)}function ke(...a){const m=Object(a[0]),E=["__proto__","constructor","prototype"];for(let L=1;L<a.length;L+=1){const w=a[L];if(w!=null&&!Ii(w)){const U=Object.keys(Object(w)).filter(G=>E.indexOf(G)<0);for(let G=0,B=U.length;G<B;G+=1){const u=U[G],M=Object.getOwnPropertyDescriptor(w,u);M!==void 0&&M.enumerable&&(Tt(m[u])&&Tt(w[u])?w[u].__swiper__?m[u]=w[u]:ke(m[u],w[u]):!Tt(m[u])&&Tt(w[u])?(m[u]={},w[u].__swiper__?m[u]=w[u]:ke(m[u],w[u])):m[u]=w[u])}}}return m}function yt(a,m,E){a.style.setProperty(m,E)}function Tr({swiper:a,targetPosition:m,side:E}){const L=Se(),w=-a.translate;let U=null,G;const B=a.params.speed;a.wrapperEl.style.scrollSnapType="none",L.cancelAnimationFrame(a.cssModeFrameID);const u=m>w?"next":"prev",M=(b,C)=>u==="next"&&b>=C||u==="prev"&&b<=C,I=()=>{G=new Date().getTime(),U===null&&(U=G);const b=Math.max(Math.min((G-U)/B,1),0),C=.5-Math.cos(b*Math.PI)/2;let F=w+C*(m-w);if(M(F,m)&&(F=m),a.wrapperEl.scrollTo({[E]:F}),M(F,m)){a.wrapperEl.style.overflow="hidden",a.wrapperEl.style.scrollSnapType="",setTimeout(()=>{a.wrapperEl.style.overflow="",a.wrapperEl.scrollTo({[E]:F})}),L.cancelAnimationFrame(a.cssModeFrameID);return}a.cssModeFrameID=L.requestAnimationFrame(I)};I()}let Ct;function Pi(){const a=Se(),m=Pe();return{smoothScroll:m.documentElement&&"scrollBehavior"in m.documentElement.style,touch:!!("ontouchstart"in a||a.DocumentTouch&&m instanceof a.DocumentTouch),passiveListener:function(){let L=!1;try{const w=Object.defineProperty({},"passive",{get(){L=!0}});a.addEventListener("testPassiveListener",null,w)}catch{}return L}(),gestures:function(){return"ongesturestart"in a}()}}function yr(){return Ct||(Ct=Pi()),Ct}let Ot;function Ci({userAgent:a}={}){const m=yr(),E=Se(),L=E.navigator.platform,w=a||E.navigator.userAgent,U={ios:!1,android:!1},G=E.screen.width,B=E.screen.height,u=w.match(/(Android);?[\s\/]+([\d.]+)?/);let M=w.match(/(iPad).*OS\s([\d_]+)/);const I=w.match(/(iPod)(.*OS\s([\d_]+))?/),b=!M&&w.match(/(iPhone\sOS|iOS)\s([\d_]+)/),C=L==="Win32";let F=L==="MacIntel";const R=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!M&&F&&m.touch&&R.indexOf(`${G}x${B}`)>=0&&(M=w.match(/(Version)\/([\d.]+)/),M||(M=[0,1,"13_0_0"]),F=!1),u&&!C&&(U.os="android",U.android=!0),(M||b||I)&&(U.os="ios",U.ios=!0),U}function Oi(a={}){return Ot||(Ot=Ci(a)),Ot}let Rt;function Ri(){const a=Se();function m(){const E=a.navigator.userAgent.toLowerCase();return E.indexOf("safari")>=0&&E.indexOf("chrome")<0&&E.indexOf("android")<0}return{isSafari:m(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(a.navigator.userAgent)}}function bi(){return Rt||(Rt=Ri()),Rt}function Mi({swiper:a,on:m,emit:E}){const L=Se();let w=null,U=null;const G=()=>{!a||a.destroyed||!a.initialized||(E("beforeResize"),E("resize"))},B=()=>{!a||a.destroyed||!a.initialized||(w=new ResizeObserver(I=>{U=L.requestAnimationFrame(()=>{const{width:b,height:C}=a;let F=b,R=C;I.forEach(({contentBoxSize:P,contentRect:D,target:T})=>{T&&T!==a.el||(F=D?D.width:(P[0]||P).inlineSize,R=D?D.height:(P[0]||P).blockSize)}),(F!==b||R!==C)&&G()})}),w.observe(a.el))},u=()=>{U&&L.cancelAnimationFrame(U),w&&w.unobserve&&a.el&&(w.unobserve(a.el),w=null)},M=()=>{!a||a.destroyed||!a.initialized||E("orientationchange")};m("init",()=>{if(a.params.resizeObserver&&typeof L.ResizeObserver<"u"){B();return}L.addEventListener("resize",G),L.addEventListener("orientationchange",M)}),m("destroy",()=>{u(),L.removeEventListener("resize",G),L.removeEventListener("orientationchange",M)})}function wi({swiper:a,extendParams:m,on:E,emit:L}){const w=[],U=Se(),G=(M,I={})=>{const b=U.MutationObserver||U.WebkitMutationObserver,C=new b(F=>{if(F.length===1){L("observerUpdate",F[0]);return}const R=function(){L("observerUpdate",F[0])};U.requestAnimationFrame?U.requestAnimationFrame(R):U.setTimeout(R,0)});C.observe(M,{attributes:typeof I.attributes>"u"?!0:I.attributes,childList:typeof I.childList>"u"?!0:I.childList,characterData:typeof I.characterData>"u"?!0:I.characterData}),w.push(C)},B=()=>{if(!!a.params.observer){if(a.params.observeParents){const M=a.$el.parents();for(let I=0;I<M.length;I+=1)G(M[I])}G(a.$el[0],{childList:a.params.observeSlideChildren}),G(a.$wrapperEl[0],{attributes:!1})}},u=()=>{w.forEach(M=>{M.disconnect()}),w.splice(0,w.length)};m({observer:!1,observeParents:!1,observeSlideChildren:!1}),E("init",B),E("destroy",u)}const Fi={on(a,m,E){const L=this;if(!L.eventsListeners||L.destroyed||typeof m!="function")return L;const w=E?"unshift":"push";return a.split(" ").forEach(U=>{L.eventsListeners[U]||(L.eventsListeners[U]=[]),L.eventsListeners[U][w](m)}),L},once(a,m,E){const L=this;if(!L.eventsListeners||L.destroyed||typeof m!="function")return L;function w(...U){L.off(a,w),w.__emitterProxy&&delete w.__emitterProxy,m.apply(L,U)}return w.__emitterProxy=m,L.on(a,w,E)},onAny(a,m){const E=this;if(!E.eventsListeners||E.destroyed||typeof a!="function")return E;const L=m?"unshift":"push";return E.eventsAnyListeners.indexOf(a)<0&&E.eventsAnyListeners[L](a),E},offAny(a){const m=this;if(!m.eventsListeners||m.destroyed||!m.eventsAnyListeners)return m;const E=m.eventsAnyListeners.indexOf(a);return E>=0&&m.eventsAnyListeners.splice(E,1),m},off(a,m){const E=this;return!E.eventsListeners||E.destroyed||!E.eventsListeners||a.split(" ").forEach(L=>{typeof m>"u"?E.eventsListeners[L]=[]:E.eventsListeners[L]&&E.eventsListeners[L].forEach((w,U)=>{(w===m||w.__emitterProxy&&w.__emitterProxy===m)&&E.eventsListeners[L].splice(U,1)})}),E},emit(...a){const m=this;if(!m.eventsListeners||m.destroyed||!m.eventsListeners)return m;let E,L,w;return typeof a[0]=="string"||Array.isArray(a[0])?(E=a[0],L=a.slice(1,a.length),w=m):(E=a[0].events,L=a[0].data,w=a[0].context||m),L.unshift(w),(Array.isArray(E)?E:E.split(" ")).forEach(G=>{m.eventsAnyListeners&&m.eventsAnyListeners.length&&m.eventsAnyListeners.forEach(B=>{B.apply(w,[G,...L])}),m.eventsListeners&&m.eventsListeners[G]&&m.eventsListeners[G].forEach(B=>{B.apply(w,L)})}),m}};function ki(){const a=this;let m,E;const L=a.$el;typeof a.params.width<"u"&&a.params.width!==null?m=a.params.width:m=L[0].clientWidth,typeof a.params.height<"u"&&a.params.height!==null?E=a.params.height:E=L[0].clientHeight,!(m===0&&a.isHorizontal()||E===0&&a.isVertical())&&(m=m-parseInt(L.css("padding-left")||0,10)-parseInt(L.css("padding-right")||0,10),E=E-parseInt(L.css("padding-top")||0,10)-parseInt(L.css("padding-bottom")||0,10),Number.isNaN(m)&&(m=0),Number.isNaN(E)&&(E=0),Object.assign(a,{width:m,height:E,size:a.isHorizontal()?m:E}))}function Bi(){const a=this;function m(f){return a.isHorizontal()?f:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[f]}function E(f,e){return parseFloat(f.getPropertyValue(m(e))||0)}const L=a.params,{$wrapperEl:w,size:U,rtlTranslate:G,wrongRTL:B}=a,u=a.virtual&&L.virtual.enabled,M=u?a.virtual.slides.length:a.slides.length,I=w.children(`.${a.params.slideClass}`),b=u?a.virtual.slides.length:I.length;let C=[];const F=[],R=[];let P=L.slidesOffsetBefore;typeof P=="function"&&(P=L.slidesOffsetBefore.call(a));let D=L.slidesOffsetAfter;typeof D=="function"&&(D=L.slidesOffsetAfter.call(a));const T=a.snapGrid.length,S=a.slidesGrid.length;let A=L.spaceBetween,x=-P,y=0,l=0;if(typeof U>"u")return;typeof A=="string"&&A.indexOf("%")>=0&&(A=parseFloat(A.replace("%",""))/100*U),a.virtualSize=-A,G?I.css({marginLeft:"",marginBottom:"",marginTop:""}):I.css({marginRight:"",marginBottom:"",marginTop:""}),L.centeredSlides&&L.cssMode&&(yt(a.wrapperEl,"--swiper-centered-offset-before",""),yt(a.wrapperEl,"--swiper-centered-offset-after",""));const n=L.grid&&L.grid.rows>1&&a.grid;n&&a.grid.initSlides(b);let r;const c=L.slidesPerView==="auto"&&L.breakpoints&&Object.keys(L.breakpoints).filter(f=>typeof L.breakpoints[f].slidesPerView<"u").length>0;for(let f=0;f<b;f+=1){r=0;const e=I.eq(f);if(n&&a.grid.updateSlide(f,e,b,m),e.css("display")!=="none"){if(L.slidesPerView==="auto"){c&&(I[f].style[m("width")]="");const t=getComputedStyle(e[0]),i=e[0].style.transform,v=e[0].style.webkitTransform;if(i&&(e[0].style.transform="none"),v&&(e[0].style.webkitTransform="none"),L.roundLengths)r=a.isHorizontal()?e.outerWidth(!0):e.outerHeight(!0);else{const d=E(t,"width"),p=E(t,"padding-left"),s=E(t,"padding-right"),g=E(t,"margin-left"),h=E(t,"margin-right"),o=t.getPropertyValue("box-sizing");if(o&&o==="border-box")r=d+g+h;else{const{clientWidth:_,offsetWidth:O}=e[0];r=d+p+s+g+h+(O-_)}}i&&(e[0].style.transform=i),v&&(e[0].style.webkitTransform=v),L.roundLengths&&(r=Math.floor(r))}else r=(U-(L.slidesPerView-1)*A)/L.slidesPerView,L.roundLengths&&(r=Math.floor(r)),I[f]&&(I[f].style[m("width")]=`${r}px`);I[f]&&(I[f].swiperSlideSize=r),R.push(r),L.centeredSlides?(x=x+r/2+y/2+A,y===0&&f!==0&&(x=x-U/2-A),f===0&&(x=x-U/2-A),Math.abs(x)<1/1e3&&(x=0),L.roundLengths&&(x=Math.floor(x)),l%L.slidesPerGroup===0&&C.push(x),F.push(x)):(L.roundLengths&&(x=Math.floor(x)),(l-Math.min(a.params.slidesPerGroupSkip,l))%a.params.slidesPerGroup===0&&C.push(x),F.push(x),x=x+r+A),a.virtualSize+=r+A,y=r,l+=1}}if(a.virtualSize=Math.max(a.virtualSize,U)+D,G&&B&&(L.effect==="slide"||L.effect==="coverflow")&&w.css({width:`${a.virtualSize+L.spaceBetween}px`}),L.setWrapperSize&&w.css({[m("width")]:`${a.virtualSize+L.spaceBetween}px`}),n&&a.grid.updateWrapperSize(r,C,m),!L.centeredSlides){const f=[];for(let e=0;e<C.length;e+=1){let t=C[e];L.roundLengths&&(t=Math.floor(t)),C[e]<=a.virtualSize-U&&f.push(t)}C=f,Math.floor(a.virtualSize-U)-Math.floor(C[C.length-1])>1&&C.push(a.virtualSize-U)}if(C.length===0&&(C=[0]),L.spaceBetween!==0){const f=a.isHorizontal()&&G?"marginLeft":m("marginRight");I.filter((e,t)=>L.cssMode?t!==I.length-1:!0).css({[f]:`${A}px`})}if(L.centeredSlides&&L.centeredSlidesBounds){let f=0;R.forEach(t=>{f+=t+(L.spaceBetween?L.spaceBetween:0)}),f-=L.spaceBetween;const e=f-U;C=C.map(t=>t<0?-P:t>e?e+D:t)}if(L.centerInsufficientSlides){let f=0;if(R.forEach(e=>{f+=e+(L.spaceBetween?L.spaceBetween:0)}),f-=L.spaceBetween,f<U){const e=(U-f)/2;C.forEach((t,i)=>{C[i]=t-e}),F.forEach((t,i)=>{F[i]=t+e})}}if(Object.assign(a,{slides:I,snapGrid:C,slidesGrid:F,slidesSizesGrid:R}),L.centeredSlides&&L.cssMode&&!L.centeredSlidesBounds){yt(a.wrapperEl,"--swiper-centered-offset-before",`${-C[0]}px`),yt(a.wrapperEl,"--swiper-centered-offset-after",`${a.size/2-R[R.length-1]/2}px`);const f=-a.snapGrid[0],e=-a.slidesGrid[0];a.snapGrid=a.snapGrid.map(t=>t+f),a.slidesGrid=a.slidesGrid.map(t=>t+e)}if(b!==M&&a.emit("slidesLengthChange"),C.length!==T&&(a.params.watchOverflow&&a.checkOverflow(),a.emit("snapGridLengthChange")),F.length!==S&&a.emit("slidesGridLengthChange"),L.watchSlidesProgress&&a.updateSlidesOffset(),!u&&!L.cssMode&&(L.effect==="slide"||L.effect==="fade")){const f=`${L.containerModifierClass}backface-hidden`,e=a.$el.hasClass(f);b<=L.maxBackfaceHiddenSlides?e||a.$el.addClass(f):e&&a.$el.removeClass(f)}}function Ui(a){const m=this,E=[],L=m.virtual&&m.params.virtual.enabled;let w=0,U;typeof a=="number"?m.setTransition(a):a===!0&&m.setTransition(m.params.speed);const G=B=>L?m.slides.filter(u=>parseInt(u.getAttribute("data-swiper-slide-index"),10)===B)[0]:m.slides.eq(B)[0];if(m.params.slidesPerView!=="auto"&&m.params.slidesPerView>1)if(m.params.centeredSlides)(m.visibleSlides||te([])).each(B=>{E.push(B)});else for(U=0;U<Math.ceil(m.params.slidesPerView);U+=1){const B=m.activeIndex+U;if(B>m.slides.length&&!L)break;E.push(G(B))}else E.push(G(m.activeIndex));for(U=0;U<E.length;U+=1)if(typeof E[U]<"u"){const B=E[U].offsetHeight;w=B>w?B:w}(w||w===0)&&m.$wrapperEl.css("height",`${w}px`)}function Ni(){const a=this,m=a.slides;for(let E=0;E<m.length;E+=1)m[E].swiperSlideOffset=a.isHorizontal()?m[E].offsetLeft:m[E].offsetTop}function Ki(a=this&&this.translate||0){const m=this,E=m.params,{slides:L,rtlTranslate:w,snapGrid:U}=m;if(L.length===0)return;typeof L[0].swiperSlideOffset>"u"&&m.updateSlidesOffset();let G=-a;w&&(G=a),L.removeClass(E.slideVisibleClass),m.visibleSlidesIndexes=[],m.visibleSlides=[];for(let B=0;B<L.length;B+=1){const u=L[B];let M=u.swiperSlideOffset;E.cssMode&&E.centeredSlides&&(M-=L[0].swiperSlideOffset);const I=(G+(E.centeredSlides?m.minTranslate():0)-M)/(u.swiperSlideSize+E.spaceBetween),b=(G-U[0]+(E.centeredSlides?m.minTranslate():0)-M)/(u.swiperSlideSize+E.spaceBetween),C=-(G-M),F=C+m.slidesSizesGrid[B];(C>=0&&C<m.size-1||F>1&&F<=m.size||C<=0&&F>=m.size)&&(m.visibleSlides.push(u),m.visibleSlidesIndexes.push(B),L.eq(B).addClass(E.slideVisibleClass)),u.progress=w?-I:I,u.originalProgress=w?-b:b}m.visibleSlides=te(m.visibleSlides)}function Gi(a){const m=this;if(typeof a>"u"){const M=m.rtlTranslate?-1:1;a=m&&m.translate&&m.translate*M||0}const E=m.params,L=m.maxTranslate()-m.minTranslate();let{progress:w,isBeginning:U,isEnd:G}=m;const B=U,u=G;L===0?(w=0,U=!0,G=!0):(w=(a-m.minTranslate())/L,U=w<=0,G=w>=1),Object.assign(m,{progress:w,isBeginning:U,isEnd:G}),(E.watchSlidesProgress||E.centeredSlides&&E.autoHeight)&&m.updateSlidesProgress(a),U&&!B&&m.emit("reachBeginning toEdge"),G&&!u&&m.emit("reachEnd toEdge"),(B&&!U||u&&!G)&&m.emit("fromEdge"),m.emit("progress",w)}function Wi(){const a=this,{slides:m,params:E,$wrapperEl:L,activeIndex:w,realIndex:U}=a,G=a.virtual&&E.virtual.enabled;m.removeClass(`${E.slideActiveClass} ${E.slideNextClass} ${E.slidePrevClass} ${E.slideDuplicateActiveClass} ${E.slideDuplicateNextClass} ${E.slideDuplicatePrevClass}`);let B;G?B=a.$wrapperEl.find(`.${E.slideClass}[data-swiper-slide-index="${w}"]`):B=m.eq(w),B.addClass(E.slideActiveClass),E.loop&&(B.hasClass(E.slideDuplicateClass)?L.children(`.${E.slideClass}:not(.${E.slideDuplicateClass})[data-swiper-slide-index="${U}"]`).addClass(E.slideDuplicateActiveClass):L.children(`.${E.slideClass}.${E.slideDuplicateClass}[data-swiper-slide-index="${U}"]`).addClass(E.slideDuplicateActiveClass));let u=B.nextAll(`.${E.slideClass}`).eq(0).addClass(E.slideNextClass);E.loop&&u.length===0&&(u=m.eq(0),u.addClass(E.slideNextClass));let M=B.prevAll(`.${E.slideClass}`).eq(0).addClass(E.slidePrevClass);E.loop&&M.length===0&&(M=m.eq(-1),M.addClass(E.slidePrevClass)),E.loop&&(u.hasClass(E.slideDuplicateClass)?L.children(`.${E.slideClass}:not(.${E.slideDuplicateClass})[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicateNextClass):L.children(`.${E.slideClass}.${E.slideDuplicateClass}[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicateNextClass),M.hasClass(E.slideDuplicateClass)?L.children(`.${E.slideClass}:not(.${E.slideDuplicateClass})[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicatePrevClass):L.children(`.${E.slideClass}.${E.slideDuplicateClass}[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicatePrevClass)),a.emitSlidesClasses()}function Hi(a){const m=this,E=m.rtlTranslate?m.translate:-m.translate,{slidesGrid:L,snapGrid:w,params:U,activeIndex:G,realIndex:B,snapIndex:u}=m;let M=a,I;if(typeof M>"u"){for(let C=0;C<L.length;C+=1)typeof L[C+1]<"u"?E>=L[C]&&E<L[C+1]-(L[C+1]-L[C])/2?M=C:E>=L[C]&&E<L[C+1]&&(M=C+1):E>=L[C]&&(M=C);U.normalizeSlideIndex&&(M<0||typeof M>"u")&&(M=0)}if(w.indexOf(E)>=0)I=w.indexOf(E);else{const C=Math.min(U.slidesPerGroupSkip,M);I=C+Math.floor((M-C)/U.slidesPerGroup)}if(I>=w.length&&(I=w.length-1),M===G){I!==u&&(m.snapIndex=I,m.emit("snapIndexChange"));return}const b=parseInt(m.slides.eq(M).attr("data-swiper-slide-index")||M,10);Object.assign(m,{snapIndex:I,realIndex:b,previousIndex:G,activeIndex:M}),m.emit("activeIndexChange"),m.emit("snapIndexChange"),B!==b&&m.emit("realIndexChange"),(m.initialized||m.params.runCallbacksOnInit)&&m.emit("slideChange")}function Vi(a){const m=this,E=m.params,L=te(a).closest(`.${E.slideClass}`)[0];let w=!1,U;if(L){for(let G=0;G<m.slides.length;G+=1)if(m.slides[G]===L){w=!0,U=G;break}}if(L&&w)m.clickedSlide=L,m.virtual&&m.params.virtual.enabled?m.clickedIndex=parseInt(te(L).attr("data-swiper-slide-index"),10):m.clickedIndex=U;else{m.clickedSlide=void 0,m.clickedIndex=void 0;return}E.slideToClickedSlide&&m.clickedIndex!==void 0&&m.clickedIndex!==m.activeIndex&&m.slideToClickedSlide()}const ji={updateSize:ki,updateSlides:Bi,updateAutoHeight:Ui,updateSlidesOffset:Ni,updateSlidesProgress:Ki,updateProgress:Gi,updateSlidesClasses:Wi,updateActiveIndex:Hi,updateClickedSlide:Vi};function zi(a=this.isHorizontal()?"x":"y"){const m=this,{params:E,rtlTranslate:L,translate:w,$wrapperEl:U}=m;if(E.virtualTranslate)return L?-w:w;if(E.cssMode)return w;let G=Ai(U[0],a);return L&&(G=-G),G||0}function $i(a,m){const E=this,{rtlTranslate:L,params:w,$wrapperEl:U,wrapperEl:G,progress:B}=E;let u=0,M=0;const I=0;E.isHorizontal()?u=L?-a:a:M=a,w.roundLengths&&(u=Math.floor(u),M=Math.floor(M)),w.cssMode?G[E.isHorizontal()?"scrollLeft":"scrollTop"]=E.isHorizontal()?-u:-M:w.virtualTranslate||U.transform(`translate3d(${u}px, ${M}px, ${I}px)`),E.previousTranslate=E.translate,E.translate=E.isHorizontal()?u:M;let b;const C=E.maxTranslate()-E.minTranslate();C===0?b=0:b=(a-E.minTranslate())/C,b!==B&&E.updateProgress(a),E.emit("setTranslate",E.translate,m)}function Yi(){return-this.snapGrid[0]}function Xi(){return-this.snapGrid[this.snapGrid.length-1]}function Qi(a=0,m=this.params.speed,E=!0,L=!0,w){const U=this,{params:G,wrapperEl:B}=U;if(U.animating&&G.preventInteractionOnTransition)return!1;const u=U.minTranslate(),M=U.maxTranslate();let I;if(L&&a>u?I=u:L&&a<M?I=M:I=a,U.updateProgress(I),G.cssMode){const b=U.isHorizontal();if(m===0)B[b?"scrollLeft":"scrollTop"]=-I;else{if(!U.support.smoothScroll)return Tr({swiper:U,targetPosition:-I,side:b?"left":"top"}),!0;B.scrollTo({[b?"left":"top"]:-I,behavior:"smooth"})}return!0}return m===0?(U.setTransition(0),U.setTranslate(I),E&&(U.emit("beforeTransitionStart",m,w),U.emit("transitionEnd"))):(U.setTransition(m),U.setTranslate(I),E&&(U.emit("beforeTransitionStart",m,w),U.emit("transitionStart")),U.animating||(U.animating=!0,U.onTranslateToWrapperTransitionEnd||(U.onTranslateToWrapperTransitionEnd=function(C){!U||U.destroyed||C.target===this&&(U.$wrapperEl[0].removeEventListener("transitionend",U.onTranslateToWrapperTransitionEnd),U.$wrapperEl[0].removeEventListener("webkitTransitionEnd",U.onTranslateToWrapperTransitionEnd),U.onTranslateToWrapperTransitionEnd=null,delete U.onTranslateToWrapperTransitionEnd,E&&U.emit("transitionEnd"))}),U.$wrapperEl[0].addEventListener("transitionend",U.onTranslateToWrapperTransitionEnd),U.$wrapperEl[0].addEventListener("webkitTransitionEnd",U.onTranslateToWrapperTransitionEnd))),!0}const Zi={getTranslate:zi,setTranslate:$i,minTranslate:Yi,maxTranslate:Xi,translateTo:Qi};function Ji(a,m){const E=this;E.params.cssMode||E.$wrapperEl.transition(a),E.emit("setTransition",a,m)}function _r({swiper:a,runCallbacks:m,direction:E,step:L}){const{activeIndex:w,previousIndex:U}=a;let G=E;if(G||(w>U?G="next":w<U?G="prev":G="reset"),a.emit(`transition${L}`),m&&w!==U){if(G==="reset"){a.emit(`slideResetTransition${L}`);return}a.emit(`slideChangeTransition${L}`),G==="next"?a.emit(`slideNextTransition${L}`):a.emit(`slidePrevTransition${L}`)}}function qi(a=!0,m){const E=this,{params:L}=E;L.cssMode||(L.autoHeight&&E.updateAutoHeight(),_r({swiper:E,runCallbacks:a,direction:m,step:"Start"}))}function en(a=!0,m){const E=this,{params:L}=E;E.animating=!1,!L.cssMode&&(E.setTransition(0),_r({swiper:E,runCallbacks:a,direction:m,step:"End"}))}const tn={setTransition:Ji,transitionStart:qi,transitionEnd:en};function rn(a=0,m=this.params.speed,E=!0,L,w){if(typeof a!="number"&&typeof a!="string")throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof a}] given.`);if(typeof a=="string"){const A=parseInt(a,10);if(!isFinite(A))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${a}] given.`);a=A}const U=this;let G=a;G<0&&(G=0);const{params:B,snapGrid:u,slidesGrid:M,previousIndex:I,activeIndex:b,rtlTranslate:C,wrapperEl:F,enabled:R}=U;if(U.animating&&B.preventInteractionOnTransition||!R&&!L&&!w)return!1;const P=Math.min(U.params.slidesPerGroupSkip,G);let D=P+Math.floor((G-P)/U.params.slidesPerGroup);D>=u.length&&(D=u.length-1);const T=-u[D];if(B.normalizeSlideIndex)for(let A=0;A<M.length;A+=1){const x=-Math.floor(T*100),y=Math.floor(M[A]*100),l=Math.floor(M[A+1]*100);typeof M[A+1]<"u"?x>=y&&x<l-(l-y)/2?G=A:x>=y&&x<l&&(G=A+1):x>=y&&(G=A)}if(U.initialized&&G!==b&&(!U.allowSlideNext&&T<U.translate&&T<U.minTranslate()||!U.allowSlidePrev&&T>U.translate&&T>U.maxTranslate()&&(b||0)!==G))return!1;G!==(I||0)&&E&&U.emit("beforeSlideChangeStart"),U.updateProgress(T);let S;if(G>b?S="next":G<b?S="prev":S="reset",C&&-T===U.translate||!C&&T===U.translate)return U.updateActiveIndex(G),B.autoHeight&&U.updateAutoHeight(),U.updateSlidesClasses(),B.effect!=="slide"&&U.setTranslate(T),S!=="reset"&&(U.transitionStart(E,S),U.transitionEnd(E,S)),!1;if(B.cssMode){const A=U.isHorizontal(),x=C?T:-T;if(m===0){const y=U.virtual&&U.params.virtual.enabled;y&&(U.wrapperEl.style.scrollSnapType="none",U._immediateVirtual=!0),F[A?"scrollLeft":"scrollTop"]=x,y&&requestAnimationFrame(()=>{U.wrapperEl.style.scrollSnapType="",U._swiperImmediateVirtual=!1})}else{if(!U.support.smoothScroll)return Tr({swiper:U,targetPosition:x,side:A?"left":"top"}),!0;F.scrollTo({[A?"left":"top"]:x,behavior:"smooth"})}return!0}return U.setTransition(m),U.setTranslate(T),U.updateActiveIndex(G),U.updateSlidesClasses(),U.emit("beforeTransitionStart",m,L),U.transitionStart(E,S),m===0?U.transitionEnd(E,S):U.animating||(U.animating=!0,U.onSlideToWrapperTransitionEnd||(U.onSlideToWrapperTransitionEnd=function(x){!U||U.destroyed||x.target===this&&(U.$wrapperEl[0].removeEventListener("transitionend",U.onSlideToWrapperTransitionEnd),U.$wrapperEl[0].removeEventListener("webkitTransitionEnd",U.onSlideToWrapperTransitionEnd),U.onSlideToWrapperTransitionEnd=null,delete U.onSlideToWrapperTransitionEnd,U.transitionEnd(E,S))}),U.$wrapperEl[0].addEventListener("transitionend",U.onSlideToWrapperTransitionEnd),U.$wrapperEl[0].addEventListener("webkitTransitionEnd",U.onSlideToWrapperTransitionEnd)),!0}function nn(a=0,m=this.params.speed,E=!0,L){if(typeof a=="string"){const G=parseInt(a,10);if(!isFinite(G))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${a}] given.`);a=G}const w=this;let U=a;return w.params.loop&&(U+=w.loopedSlides),w.slideTo(U,m,E,L)}function sn(a=this.params.speed,m=!0,E){const L=this,{animating:w,enabled:U,params:G}=L;if(!U)return L;let B=G.slidesPerGroup;G.slidesPerView==="auto"&&G.slidesPerGroup===1&&G.slidesPerGroupAuto&&(B=Math.max(L.slidesPerViewDynamic("current",!0),1));const u=L.activeIndex<G.slidesPerGroupSkip?1:B;if(G.loop){if(w&&G.loopPreventsSlide)return!1;L.loopFix(),L._clientLeft=L.$wrapperEl[0].clientLeft}return G.rewind&&L.isEnd?L.slideTo(0,a,m,E):L.slideTo(L.activeIndex+u,a,m,E)}function an(a=this.params.speed,m=!0,E){const L=this,{params:w,animating:U,snapGrid:G,slidesGrid:B,rtlTranslate:u,enabled:M}=L;if(!M)return L;if(w.loop){if(U&&w.loopPreventsSlide)return!1;L.loopFix(),L._clientLeft=L.$wrapperEl[0].clientLeft}const I=u?L.translate:-L.translate;function b(D){return D<0?-Math.floor(Math.abs(D)):Math.floor(D)}const C=b(I),F=G.map(D=>b(D));let R=G[F.indexOf(C)-1];if(typeof R>"u"&&w.cssMode){let D;G.forEach((T,S)=>{C>=T&&(D=S)}),typeof D<"u"&&(R=G[D>0?D-1:D])}let P=0;if(typeof R<"u"&&(P=B.indexOf(R),P<0&&(P=L.activeIndex-1),w.slidesPerView==="auto"&&w.slidesPerGroup===1&&w.slidesPerGroupAuto&&(P=P-L.slidesPerViewDynamic("previous",!0)+1,P=Math.max(P,0))),w.rewind&&L.isBeginning){const D=L.params.virtual&&L.params.virtual.enabled&&L.virtual?L.virtual.slides.length-1:L.slides.length-1;return L.slideTo(D,a,m,E)}return L.slideTo(P,a,m,E)}function on(a=this.params.speed,m=!0,E){const L=this;return L.slideTo(L.activeIndex,a,m,E)}function ln(a=this.params.speed,m=!0,E,L=.5){const w=this;let U=w.activeIndex;const G=Math.min(w.params.slidesPerGroupSkip,U),B=G+Math.floor((U-G)/w.params.slidesPerGroup),u=w.rtlTranslate?w.translate:-w.translate;if(u>=w.snapGrid[B]){const M=w.snapGrid[B],I=w.snapGrid[B+1];u-M>(I-M)*L&&(U+=w.params.slidesPerGroup)}else{const M=w.snapGrid[B-1],I=w.snapGrid[B];u-M<=(I-M)*L&&(U-=w.params.slidesPerGroup)}return U=Math.max(U,0),U=Math.min(U,w.slidesGrid.length-1),w.slideTo(U,a,m,E)}function un(){const a=this,{params:m,$wrapperEl:E}=a,L=m.slidesPerView==="auto"?a.slidesPerViewDynamic():m.slidesPerView;let w=a.clickedIndex,U;if(m.loop){if(a.animating)return;U=parseInt(te(a.clickedSlide).attr("data-swiper-slide-index"),10),m.centeredSlides?w<a.loopedSlides-L/2||w>a.slides.length-a.loopedSlides+L/2?(a.loopFix(),w=E.children(`.${m.slideClass}[data-swiper-slide-index="${U}"]:not(.${m.slideDuplicateClass})`).eq(0).index(),St(()=>{a.slideTo(w)})):a.slideTo(w):w>a.slides.length-L?(a.loopFix(),w=E.children(`.${m.slideClass}[data-swiper-slide-index="${U}"]:not(.${m.slideDuplicateClass})`).eq(0).index(),St(()=>{a.slideTo(w)})):a.slideTo(w)}else a.slideTo(w)}const fn={slideTo:rn,slideToLoop:nn,slideNext:sn,slidePrev:an,slideReset:on,slideToClosest:ln,slideToClickedSlide:un};function dn(){const a=this,m=Pe(),{params:E,$wrapperEl:L}=a,w=L.children().length>0?te(L.children()[0].parentNode):L;w.children(`.${E.slideClass}.${E.slideDuplicateClass}`).remove();let U=w.children(`.${E.slideClass}`);if(E.loopFillGroupWithBlank){const u=E.slidesPerGroup-U.length%E.slidesPerGroup;if(u!==E.slidesPerGroup){for(let M=0;M<u;M+=1){const I=te(m.createElement("div")).addClass(`${E.slideClass} ${E.slideBlankClass}`);w.append(I)}U=w.children(`.${E.slideClass}`)}}E.slidesPerView==="auto"&&!E.loopedSlides&&(E.loopedSlides=U.length),a.loopedSlides=Math.ceil(parseFloat(E.loopedSlides||E.slidesPerView,10)),a.loopedSlides+=E.loopAdditionalSlides,a.loopedSlides>U.length&&a.params.loopedSlidesLimit&&(a.loopedSlides=U.length);const G=[],B=[];U.each((u,M)=>{te(u).attr("data-swiper-slide-index",M)});for(let u=0;u<a.loopedSlides;u+=1){const M=u-Math.floor(u/U.length)*U.length;B.push(U.eq(M)[0]),G.unshift(U.eq(U.length-M-1)[0])}for(let u=0;u<B.length;u+=1)w.append(te(B[u].cloneNode(!0)).addClass(E.slideDuplicateClass));for(let u=G.length-1;u>=0;u-=1)w.prepend(te(G[u].cloneNode(!0)).addClass(E.slideDuplicateClass))}function cn(){const a=this;a.emit("beforeLoopFix");const{activeIndex:m,slides:E,loopedSlides:L,allowSlidePrev:w,allowSlideNext:U,snapGrid:G,rtlTranslate:B}=a;let u;a.allowSlidePrev=!0,a.allowSlideNext=!0;const I=-G[m]-a.getTranslate();m<L?(u=E.length-L*3+m,u+=L,a.slideTo(u,0,!1,!0)&&I!==0&&a.setTranslate((B?-a.translate:a.translate)-I)):m>=E.length-L&&(u=-E.length+m+L,u+=L,a.slideTo(u,0,!1,!0)&&I!==0&&a.setTranslate((B?-a.translate:a.translate)-I)),a.allowSlidePrev=w,a.allowSlideNext=U,a.emit("loopFix")}function hn(){const a=this,{$wrapperEl:m,params:E,slides:L}=a;m.children(`.${E.slideClass}.${E.slideDuplicateClass},.${E.slideClass}.${E.slideBlankClass}`).remove(),L.removeAttr("data-swiper-slide-index")}const vn={loopCreate:dn,loopFix:cn,loopDestroy:hn};function gn(a){const m=this;if(m.support.touch||!m.params.simulateTouch||m.params.watchOverflow&&m.isLocked||m.params.cssMode)return;const E=m.params.touchEventsTarget==="container"?m.el:m.wrapperEl;E.style.cursor="move",E.style.cursor=a?"grabbing":"grab"}function pn(){const a=this;a.support.touch||a.params.watchOverflow&&a.isLocked||a.params.cssMode||(a[a.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="")}const mn={setGrabCursor:gn,unsetGrabCursor:pn};function En(a,m=this){function E(L){if(!L||L===Pe()||L===Se())return null;L.assignedSlot&&(L=L.assignedSlot);const w=L.closest(a);return!w&&!L.getRootNode?null:w||E(L.getRootNode().host)}return E(m)}function Tn(a){const m=this,E=Pe(),L=Se(),w=m.touchEventsData,{params:U,touches:G,enabled:B}=m;if(!B||m.animating&&U.preventInteractionOnTransition)return;!m.animating&&U.cssMode&&U.loop&&m.loopFix();let u=a;u.originalEvent&&(u=u.originalEvent);let M=te(u.target);if(U.touchEventsTarget==="wrapper"&&!M.closest(m.wrapperEl).length||(w.isTouchEvent=u.type==="touchstart",!w.isTouchEvent&&"which"in u&&u.which===3)||!w.isTouchEvent&&"button"in u&&u.button>0||w.isTouched&&w.isMoved)return;const I=!!U.noSwipingClass&&U.noSwipingClass!=="",b=a.composedPath?a.composedPath():a.path;I&&u.target&&u.target.shadowRoot&&b&&(M=te(b[0]));const C=U.noSwipingSelector?U.noSwipingSelector:`.${U.noSwipingClass}`,F=!!(u.target&&u.target.shadowRoot);if(U.noSwiping&&(F?En(C,M[0]):M.closest(C)[0])){m.allowClick=!0;return}if(U.swipeHandler&&!M.closest(U.swipeHandler)[0])return;G.currentX=u.type==="touchstart"?u.targetTouches[0].pageX:u.pageX,G.currentY=u.type==="touchstart"?u.targetTouches[0].pageY:u.pageY;const R=G.currentX,P=G.currentY,D=U.edgeSwipeDetection||U.iOSEdgeSwipeDetection,T=U.edgeSwipeThreshold||U.iOSEdgeSwipeThreshold;if(D&&(R<=T||R>=L.innerWidth-T))if(D==="prevent")a.preventDefault();else return;if(Object.assign(w,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),G.startX=R,G.startY=P,w.touchStartTime=gt(),m.allowClick=!0,m.updateSize(),m.swipeDirection=void 0,U.threshold>0&&(w.allowThresholdMove=!1),u.type!=="touchstart"){let S=!0;M.is(w.focusableElements)&&(S=!1,M[0].nodeName==="SELECT"&&(w.isTouched=!1)),E.activeElement&&te(E.activeElement).is(w.focusableElements)&&E.activeElement!==M[0]&&E.activeElement.blur();const A=S&&m.allowTouchMove&&U.touchStartPreventDefault;(U.touchStartForcePreventDefault||A)&&!M[0].isContentEditable&&u.preventDefault()}m.params.freeMode&&m.params.freeMode.enabled&&m.freeMode&&m.animating&&!U.cssMode&&m.freeMode.onTouchStart(),m.emit("touchStart",u)}function yn(a){const m=Pe(),E=this,L=E.touchEventsData,{params:w,touches:U,rtlTranslate:G,enabled:B}=E;if(!B)return;let u=a;if(u.originalEvent&&(u=u.originalEvent),!L.isTouched){L.startMoving&&L.isScrolling&&E.emit("touchMoveOpposite",u);return}if(L.isTouchEvent&&u.type!=="touchmove")return;const M=u.type==="touchmove"&&u.targetTouches&&(u.targetTouches[0]||u.changedTouches[0]),I=u.type==="touchmove"?M.pageX:u.pageX,b=u.type==="touchmove"?M.pageY:u.pageY;if(u.preventedByNestedSwiper){U.startX=I,U.startY=b;return}if(!E.allowTouchMove){te(u.target).is(L.focusableElements)||(E.allowClick=!1),L.isTouched&&(Object.assign(U,{startX:I,startY:b,currentX:I,currentY:b}),L.touchStartTime=gt());return}if(L.isTouchEvent&&w.touchReleaseOnEdges&&!w.loop){if(E.isVertical()){if(b<U.startY&&E.translate<=E.maxTranslate()||b>U.startY&&E.translate>=E.minTranslate()){L.isTouched=!1,L.isMoved=!1;return}}else if(I<U.startX&&E.translate<=E.maxTranslate()||I>U.startX&&E.translate>=E.minTranslate())return}if(L.isTouchEvent&&m.activeElement&&u.target===m.activeElement&&te(u.target).is(L.focusableElements)){L.isMoved=!0,E.allowClick=!1;return}if(L.allowTouchCallbacks&&E.emit("touchMove",u),u.targetTouches&&u.targetTouches.length>1)return;U.currentX=I,U.currentY=b;const C=U.currentX-U.startX,F=U.currentY-U.startY;if(E.params.threshold&&Math.sqrt(C**2+F**2)<E.params.threshold)return;if(typeof L.isScrolling>"u"){let T;E.isHorizontal()&&U.currentY===U.startY||E.isVertical()&&U.currentX===U.startX?L.isScrolling=!1:C*C+F*F>=25&&(T=Math.atan2(Math.abs(F),Math.abs(C))*180/Math.PI,L.isScrolling=E.isHorizontal()?T>w.touchAngle:90-T>w.touchAngle)}if(L.isScrolling&&E.emit("touchMoveOpposite",u),typeof L.startMoving>"u"&&(U.currentX!==U.startX||U.currentY!==U.startY)&&(L.startMoving=!0),L.isScrolling){L.isTouched=!1;return}if(!L.startMoving)return;E.allowClick=!1,!w.cssMode&&u.cancelable&&u.preventDefault(),w.touchMoveStopPropagation&&!w.nested&&u.stopPropagation(),L.isMoved||(w.loop&&!w.cssMode&&E.loopFix(),L.startTranslate=E.getTranslate(),E.setTransition(0),E.animating&&E.$wrapperEl.trigger("webkitTransitionEnd transitionend"),L.allowMomentumBounce=!1,w.grabCursor&&(E.allowSlideNext===!0||E.allowSlidePrev===!0)&&E.setGrabCursor(!0),E.emit("sliderFirstMove",u)),E.emit("sliderMove",u),L.isMoved=!0;let R=E.isHorizontal()?C:F;U.diff=R,R*=w.touchRatio,G&&(R=-R),E.swipeDirection=R>0?"prev":"next",L.currentTranslate=R+L.startTranslate;let P=!0,D=w.resistanceRatio;if(w.touchReleaseOnEdges&&(D=0),R>0&&L.currentTranslate>E.minTranslate()?(P=!1,w.resistance&&(L.currentTranslate=E.minTranslate()-1+(-E.minTranslate()+L.startTranslate+R)**D)):R<0&&L.currentTranslate<E.maxTranslate()&&(P=!1,w.resistance&&(L.currentTranslate=E.maxTranslate()+1-(E.maxTranslate()-L.startTranslate-R)**D)),P&&(u.preventedByNestedSwiper=!0),!E.allowSlideNext&&E.swipeDirection==="next"&&L.currentTranslate<L.startTranslate&&(L.currentTranslate=L.startTranslate),!E.allowSlidePrev&&E.swipeDirection==="prev"&&L.currentTranslate>L.startTranslate&&(L.currentTranslate=L.startTranslate),!E.allowSlidePrev&&!E.allowSlideNext&&(L.currentTranslate=L.startTranslate),w.threshold>0)if(Math.abs(R)>w.threshold||L.allowThresholdMove){if(!L.allowThresholdMove){L.allowThresholdMove=!0,U.startX=U.currentX,U.startY=U.currentY,L.currentTranslate=L.startTranslate,U.diff=E.isHorizontal()?U.currentX-U.startX:U.currentY-U.startY;return}}else{L.currentTranslate=L.startTranslate;return}!w.followFinger||w.cssMode||((w.freeMode&&w.freeMode.enabled&&E.freeMode||w.watchSlidesProgress)&&(E.updateActiveIndex(),E.updateSlidesClasses()),E.params.freeMode&&w.freeMode.enabled&&E.freeMode&&E.freeMode.onTouchMove(),E.updateProgress(L.currentTranslate),E.setTranslate(L.currentTranslate))}function _n(a){const m=this,E=m.touchEventsData,{params:L,touches:w,rtlTranslate:U,slidesGrid:G,enabled:B}=m;if(!B)return;let u=a;if(u.originalEvent&&(u=u.originalEvent),E.allowTouchCallbacks&&m.emit("touchEnd",u),E.allowTouchCallbacks=!1,!E.isTouched){E.isMoved&&L.grabCursor&&m.setGrabCursor(!1),E.isMoved=!1,E.startMoving=!1;return}L.grabCursor&&E.isMoved&&E.isTouched&&(m.allowSlideNext===!0||m.allowSlidePrev===!0)&&m.setGrabCursor(!1);const M=gt(),I=M-E.touchStartTime;if(m.allowClick){const S=u.path||u.composedPath&&u.composedPath();m.updateClickedSlide(S&&S[0]||u.target),m.emit("tap click",u),I<300&&M-E.lastClickTime<300&&m.emit("doubleTap doubleClick",u)}if(E.lastClickTime=gt(),St(()=>{m.destroyed||(m.allowClick=!0)}),!E.isTouched||!E.isMoved||!m.swipeDirection||w.diff===0||E.currentTranslate===E.startTranslate){E.isTouched=!1,E.isMoved=!1,E.startMoving=!1;return}E.isTouched=!1,E.isMoved=!1,E.startMoving=!1;let b;if(L.followFinger?b=U?m.translate:-m.translate:b=-E.currentTranslate,L.cssMode)return;if(m.params.freeMode&&L.freeMode.enabled){m.freeMode.onTouchEnd({currentPos:b});return}let C=0,F=m.slidesSizesGrid[0];for(let S=0;S<G.length;S+=S<L.slidesPerGroupSkip?1:L.slidesPerGroup){const A=S<L.slidesPerGroupSkip-1?1:L.slidesPerGroup;typeof G[S+A]<"u"?b>=G[S]&&b<G[S+A]&&(C=S,F=G[S+A]-G[S]):b>=G[S]&&(C=S,F=G[G.length-1]-G[G.length-2])}let R=null,P=null;L.rewind&&(m.isBeginning?P=m.params.virtual&&m.params.virtual.enabled&&m.virtual?m.virtual.slides.length-1:m.slides.length-1:m.isEnd&&(R=0));const D=(b-G[C])/F,T=C<L.slidesPerGroupSkip-1?1:L.slidesPerGroup;if(I>L.longSwipesMs){if(!L.longSwipes){m.slideTo(m.activeIndex);return}m.swipeDirection==="next"&&(D>=L.longSwipesRatio?m.slideTo(L.rewind&&m.isEnd?R:C+T):m.slideTo(C)),m.swipeDirection==="prev"&&(D>1-L.longSwipesRatio?m.slideTo(C+T):P!==null&&D<0&&Math.abs(D)>L.longSwipesRatio?m.slideTo(P):m.slideTo(C))}else{if(!L.shortSwipes){m.slideTo(m.activeIndex);return}m.navigation&&(u.target===m.navigation.nextEl||u.target===m.navigation.prevEl)?u.target===m.navigation.nextEl?m.slideTo(C+T):m.slideTo(C):(m.swipeDirection==="next"&&m.slideTo(R!==null?R:C+T),m.swipeDirection==="prev"&&m.slideTo(P!==null?P:C))}}function Zt(){const a=this,{params:m,el:E}=a;if(E&&E.offsetWidth===0)return;m.breakpoints&&a.setBreakpoint();const{allowSlideNext:L,allowSlidePrev:w,snapGrid:U}=a;a.allowSlideNext=!0,a.allowSlidePrev=!0,a.updateSize(),a.updateSlides(),a.updateSlidesClasses(),(m.slidesPerView==="auto"||m.slidesPerView>1)&&a.isEnd&&!a.isBeginning&&!a.params.centeredSlides?a.slideTo(a.slides.length-1,0,!1,!0):a.slideTo(a.activeIndex,0,!1,!0),a.autoplay&&a.autoplay.running&&a.autoplay.paused&&a.autoplay.run(),a.allowSlidePrev=w,a.allowSlideNext=L,a.params.watchOverflow&&U!==a.snapGrid&&a.checkOverflow()}function Sn(a){const m=this;!m.enabled||m.allowClick||(m.params.preventClicks&&a.preventDefault(),m.params.preventClicksPropagation&&m.animating&&(a.stopPropagation(),a.stopImmediatePropagation()))}function xn(){const a=this,{wrapperEl:m,rtlTranslate:E,enabled:L}=a;if(!L)return;a.previousTranslate=a.translate,a.isHorizontal()?a.translate=-m.scrollLeft:a.translate=-m.scrollTop,a.translate===0&&(a.translate=0),a.updateActiveIndex(),a.updateSlidesClasses();let w;const U=a.maxTranslate()-a.minTranslate();U===0?w=0:w=(a.translate-a.minTranslate())/U,w!==a.progress&&a.updateProgress(E?-a.translate:a.translate),a.emit("setTranslate",a.translate,!1)}let Jt=!1;function Ln(){}const Sr=(a,m)=>{const E=Pe(),{params:L,touchEvents:w,el:U,wrapperEl:G,device:B,support:u}=a,M=!!L.nested,I=m==="on"?"addEventListener":"removeEventListener",b=m;if(!u.touch)U[I](w.start,a.onTouchStart,!1),E[I](w.move,a.onTouchMove,M),E[I](w.end,a.onTouchEnd,!1);else{const C=w.start==="touchstart"&&u.passiveListener&&L.passiveListeners?{passive:!0,capture:!1}:!1;U[I](w.start,a.onTouchStart,C),U[I](w.move,a.onTouchMove,u.passiveListener?{passive:!1,capture:M}:M),U[I](w.end,a.onTouchEnd,C),w.cancel&&U[I](w.cancel,a.onTouchEnd,C)}(L.preventClicks||L.preventClicksPropagation)&&U[I]("click",a.onClick,!0),L.cssMode&&G[I]("scroll",a.onScroll),L.updateOnWindowResize?a[b](B.ios||B.android?"resize orientationchange observerUpdate":"resize observerUpdate",Zt,!0):a[b]("observerUpdate",Zt,!0)};function Dn(){const a=this,m=Pe(),{params:E,support:L}=a;a.onTouchStart=Tn.bind(a),a.onTouchMove=yn.bind(a),a.onTouchEnd=_n.bind(a),E.cssMode&&(a.onScroll=xn.bind(a)),a.onClick=Sn.bind(a),L.touch&&!Jt&&(m.addEventListener("touchstart",Ln),Jt=!0),Sr(a,"on")}function An(){Sr(this,"off")}const In={attachEvents:Dn,detachEvents:An},qt=(a,m)=>a.grid&&m.grid&&m.grid.rows>1;function Pn(){const a=this,{activeIndex:m,initialized:E,loopedSlides:L=0,params:w,$el:U}=a,G=w.breakpoints;if(!G||G&&Object.keys(G).length===0)return;const B=a.getBreakpoint(G,a.params.breakpointsBase,a.el);if(!B||a.currentBreakpoint===B)return;const M=(B in G?G[B]:void 0)||a.originalParams,I=qt(a,w),b=qt(a,M),C=w.enabled;I&&!b?(U.removeClass(`${w.containerModifierClass}grid ${w.containerModifierClass}grid-column`),a.emitContainerClasses()):!I&&b&&(U.addClass(`${w.containerModifierClass}grid`),(M.grid.fill&&M.grid.fill==="column"||!M.grid.fill&&w.grid.fill==="column")&&U.addClass(`${w.containerModifierClass}grid-column`),a.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach(D=>{const T=w[D]&&w[D].enabled,S=M[D]&&M[D].enabled;T&&!S&&a[D].disable(),!T&&S&&a[D].enable()});const F=M.direction&&M.direction!==w.direction,R=w.loop&&(M.slidesPerView!==w.slidesPerView||F);F&&E&&a.changeDirection(),ke(a.params,M);const P=a.params.enabled;Object.assign(a,{allowTouchMove:a.params.allowTouchMove,allowSlideNext:a.params.allowSlideNext,allowSlidePrev:a.params.allowSlidePrev}),C&&!P?a.disable():!C&&P&&a.enable(),a.currentBreakpoint=B,a.emit("_beforeBreakpoint",M),R&&E&&(a.loopDestroy(),a.loopCreate(),a.updateSlides(),a.slideTo(m-L+a.loopedSlides,0,!1)),a.emit("breakpoint",M)}function Cn(a,m="window",E){if(!a||m==="container"&&!E)return;let L=!1;const w=Se(),U=m==="window"?w.innerHeight:E.clientHeight,G=Object.keys(a).map(B=>{if(typeof B=="string"&&B.indexOf("@")===0){const u=parseFloat(B.substr(1));return{value:U*u,point:B}}return{value:B,point:B}});G.sort((B,u)=>parseInt(B.value,10)-parseInt(u.value,10));for(let B=0;B<G.length;B+=1){const{point:u,value:M}=G[B];m==="window"?w.matchMedia(`(min-width: ${M}px)`).matches&&(L=u):M<=E.clientWidth&&(L=u)}return L||"max"}const On={setBreakpoint:Pn,getBreakpoint:Cn};function Rn(a,m){const E=[];return a.forEach(L=>{typeof L=="object"?Object.keys(L).forEach(w=>{L[w]&&E.push(m+w)}):typeof L=="string"&&E.push(m+L)}),E}function bn(){const a=this,{classNames:m,params:E,rtl:L,$el:w,device:U,support:G}=a,B=Rn(["initialized",E.direction,{"pointer-events":!G.touch},{"free-mode":a.params.freeMode&&E.freeMode.enabled},{autoheight:E.autoHeight},{rtl:L},{grid:E.grid&&E.grid.rows>1},{"grid-column":E.grid&&E.grid.rows>1&&E.grid.fill==="column"},{android:U.android},{ios:U.ios},{"css-mode":E.cssMode},{centered:E.cssMode&&E.centeredSlides},{"watch-progress":E.watchSlidesProgress}],E.containerModifierClass);m.push(...B),w.addClass([...m].join(" ")),a.emitContainerClasses()}function Mn(){const a=this,{$el:m,classNames:E}=a;m.removeClass(E.join(" ")),a.emitContainerClasses()}const wn={addClasses:bn,removeClasses:Mn};function Fn(a,m,E,L,w,U){const G=Se();let B;function u(){U&&U()}!te(a).parent("picture")[0]&&(!a.complete||!w)&&m?(B=new G.Image,B.onload=u,B.onerror=u,L&&(B.sizes=L),E&&(B.srcset=E),m&&(B.src=m)):u()}function kn(){const a=this;a.imagesToLoad=a.$el.find("img");function m(){typeof a>"u"||a===null||!a||a.destroyed||(a.imagesLoaded!==void 0&&(a.imagesLoaded+=1),a.imagesLoaded===a.imagesToLoad.length&&(a.params.updateOnImagesReady&&a.update(),a.emit("imagesReady")))}for(let E=0;E<a.imagesToLoad.length;E+=1){const L=a.imagesToLoad[E];a.loadImage(L,L.currentSrc||L.getAttribute("src"),L.srcset||L.getAttribute("srcset"),L.sizes||L.getAttribute("sizes"),!0,m)}}const Bn={loadImage:Fn,preloadImages:kn};function Un(){const a=this,{isLocked:m,params:E}=a,{slidesOffsetBefore:L}=E;if(L){const w=a.slides.length-1,U=a.slidesGrid[w]+a.slidesSizesGrid[w]+L*2;a.isLocked=a.size>U}else a.isLocked=a.snapGrid.length===1;E.allowSlideNext===!0&&(a.allowSlideNext=!a.isLocked),E.allowSlidePrev===!0&&(a.allowSlidePrev=!a.isLocked),m&&m!==a.isLocked&&(a.isEnd=!1),m!==a.isLocked&&a.emit(a.isLocked?"lock":"unlock")}const Nn={checkOverflow:Un},er={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopedSlidesLimit:!0,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function Kn(a,m){return function(L={}){const w=Object.keys(L)[0],U=L[w];if(typeof U!="object"||U===null){ke(m,L);return}if(["navigation","pagination","scrollbar"].indexOf(w)>=0&&a[w]===!0&&(a[w]={auto:!0}),!(w in a&&"enabled"in U)){ke(m,L);return}a[w]===!0&&(a[w]={enabled:!0}),typeof a[w]=="object"&&!("enabled"in a[w])&&(a[w].enabled=!0),a[w]||(a[w]={enabled:!1}),ke(m,L)}}const bt={eventsEmitter:Fi,update:ji,translate:Zi,transition:tn,slide:fn,loop:vn,grabCursor:mn,events:In,breakpoints:On,checkOverflow:Nn,classes:wn,images:Bn},Mt={};class Re{constructor(...m){let E,L;if(m.length===1&&m[0].constructor&&Object.prototype.toString.call(m[0]).slice(8,-1)==="Object"?L=m[0]:[E,L]=m,L||(L={}),L=ke({},L),E&&!L.el&&(L.el=E),L.el&&te(L.el).length>1){const B=[];return te(L.el).each(u=>{const M=ke({},L,{el:u});B.push(new Re(M))}),B}const w=this;w.__swiper__=!0,w.support=yr(),w.device=Oi({userAgent:L.userAgent}),w.browser=bi(),w.eventsListeners={},w.eventsAnyListeners=[],w.modules=[...w.__modules__],L.modules&&Array.isArray(L.modules)&&w.modules.push(...L.modules);const U={};w.modules.forEach(B=>{B({swiper:w,extendParams:Kn(L,U),on:w.on.bind(w),once:w.once.bind(w),off:w.off.bind(w),emit:w.emit.bind(w)})});const G=ke({},er,U);return w.params=ke({},G,Mt,L),w.originalParams=ke({},w.params),w.passedParams=ke({},L),w.params&&w.params.on&&Object.keys(w.params.on).forEach(B=>{w.on(B,w.params.on[B])}),w.params&&w.params.onAny&&w.onAny(w.params.onAny),w.$=te,Object.assign(w,{enabled:w.params.enabled,el:E,classNames:[],slides:te(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return w.params.direction==="horizontal"},isVertical(){return w.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:w.params.allowSlideNext,allowSlidePrev:w.params.allowSlidePrev,touchEvents:function(){const u=["touchstart","touchmove","touchend","touchcancel"],M=["pointerdown","pointermove","pointerup"];return w.touchEventsTouch={start:u[0],move:u[1],end:u[2],cancel:u[3]},w.touchEventsDesktop={start:M[0],move:M[1],end:M[2]},w.support.touch||!w.params.simulateTouch?w.touchEventsTouch:w.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:w.params.focusableElements,lastClickTime:gt(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:w.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),w.emit("_swiper"),w.params.init&&w.init(),w}enable(){const m=this;m.enabled||(m.enabled=!0,m.params.grabCursor&&m.setGrabCursor(),m.emit("enable"))}disable(){const m=this;!m.enabled||(m.enabled=!1,m.params.grabCursor&&m.unsetGrabCursor(),m.emit("disable"))}setProgress(m,E){const L=this;m=Math.min(Math.max(m,0),1);const w=L.minTranslate(),G=(L.maxTranslate()-w)*m+w;L.translateTo(G,typeof E>"u"?0:E),L.updateActiveIndex(),L.updateSlidesClasses()}emitContainerClasses(){const m=this;if(!m.params._emitClasses||!m.el)return;const E=m.el.className.split(" ").filter(L=>L.indexOf("swiper")===0||L.indexOf(m.params.containerModifierClass)===0);m.emit("_containerClasses",E.join(" "))}getSlideClasses(m){const E=this;return E.destroyed?"":m.className.split(" ").filter(L=>L.indexOf("swiper-slide")===0||L.indexOf(E.params.slideClass)===0).join(" ")}emitSlidesClasses(){const m=this;if(!m.params._emitClasses||!m.el)return;const E=[];m.slides.each(L=>{const w=m.getSlideClasses(L);E.push({slideEl:L,classNames:w}),m.emit("_slideClass",L,w)}),m.emit("_slideClasses",E)}slidesPerViewDynamic(m="current",E=!1){const L=this,{params:w,slides:U,slidesGrid:G,slidesSizesGrid:B,size:u,activeIndex:M}=L;let I=1;if(w.centeredSlides){let b=U[M].swiperSlideSize,C;for(let F=M+1;F<U.length;F+=1)U[F]&&!C&&(b+=U[F].swiperSlideSize,I+=1,b>u&&(C=!0));for(let F=M-1;F>=0;F-=1)U[F]&&!C&&(b+=U[F].swiperSlideSize,I+=1,b>u&&(C=!0))}else if(m==="current")for(let b=M+1;b<U.length;b+=1)(E?G[b]+B[b]-G[M]<u:G[b]-G[M]<u)&&(I+=1);else for(let b=M-1;b>=0;b-=1)G[M]-G[b]<u&&(I+=1);return I}update(){const m=this;if(!m||m.destroyed)return;const{snapGrid:E,params:L}=m;L.breakpoints&&m.setBreakpoint(),m.updateSize(),m.updateSlides(),m.updateProgress(),m.updateSlidesClasses();function w(){const G=m.rtlTranslate?m.translate*-1:m.translate,B=Math.min(Math.max(G,m.maxTranslate()),m.minTranslate());m.setTranslate(B),m.updateActiveIndex(),m.updateSlidesClasses()}let U;m.params.freeMode&&m.params.freeMode.enabled?(w(),m.params.autoHeight&&m.updateAutoHeight()):((m.params.slidesPerView==="auto"||m.params.slidesPerView>1)&&m.isEnd&&!m.params.centeredSlides?U=m.slideTo(m.slides.length-1,0,!1,!0):U=m.slideTo(m.activeIndex,0,!1,!0),U||w()),L.watchOverflow&&E!==m.snapGrid&&m.checkOverflow(),m.emit("update")}changeDirection(m,E=!0){const L=this,w=L.params.direction;return m||(m=w==="horizontal"?"vertical":"horizontal"),m===w||m!=="horizontal"&&m!=="vertical"||(L.$el.removeClass(`${L.params.containerModifierClass}${w}`).addClass(`${L.params.containerModifierClass}${m}`),L.emitContainerClasses(),L.params.direction=m,L.slides.each(U=>{m==="vertical"?U.style.width="":U.style.height=""}),L.emit("changeDirection"),E&&L.update()),L}changeLanguageDirection(m){const E=this;E.rtl&&m==="rtl"||!E.rtl&&m==="ltr"||(E.rtl=m==="rtl",E.rtlTranslate=E.params.direction==="horizontal"&&E.rtl,E.rtl?(E.$el.addClass(`${E.params.containerModifierClass}rtl`),E.el.dir="rtl"):(E.$el.removeClass(`${E.params.containerModifierClass}rtl`),E.el.dir="ltr"),E.update())}mount(m){const E=this;if(E.mounted)return!0;const L=te(m||E.params.el);if(m=L[0],!m)return!1;m.swiper=E;const w=()=>`.${(E.params.wrapperClass||"").trim().split(" ").join(".")}`;let G=(()=>{if(m&&m.shadowRoot&&m.shadowRoot.querySelector){const B=te(m.shadowRoot.querySelector(w()));return B.children=u=>L.children(u),B}return L.children?L.children(w()):te(L).children(w())})();if(G.length===0&&E.params.createElements){const u=Pe().createElement("div");G=te(u),u.className=E.params.wrapperClass,L.append(u),L.children(`.${E.params.slideClass}`).each(M=>{G.append(M)})}return Object.assign(E,{$el:L,el:m,$wrapperEl:G,wrapperEl:G[0],mounted:!0,rtl:m.dir.toLowerCase()==="rtl"||L.css("direction")==="rtl",rtlTranslate:E.params.direction==="horizontal"&&(m.dir.toLowerCase()==="rtl"||L.css("direction")==="rtl"),wrongRTL:G.css("display")==="-webkit-box"}),!0}init(m){const E=this;return E.initialized||E.mount(m)===!1||(E.emit("beforeInit"),E.params.breakpoints&&E.setBreakpoint(),E.addClasses(),E.params.loop&&E.loopCreate(),E.updateSize(),E.updateSlides(),E.params.watchOverflow&&E.checkOverflow(),E.params.grabCursor&&E.enabled&&E.setGrabCursor(),E.params.preloadImages&&E.preloadImages(),E.params.loop?E.slideTo(E.params.initialSlide+E.loopedSlides,0,E.params.runCallbacksOnInit,!1,!0):E.slideTo(E.params.initialSlide,0,E.params.runCallbacksOnInit,!1,!0),E.attachEvents(),E.initialized=!0,E.emit("init"),E.emit("afterInit")),E}destroy(m=!0,E=!0){const L=this,{params:w,$el:U,$wrapperEl:G,slides:B}=L;return typeof L.params>"u"||L.destroyed||(L.emit("beforeDestroy"),L.initialized=!1,L.detachEvents(),w.loop&&L.loopDestroy(),E&&(L.removeClasses(),U.removeAttr("style"),G.removeAttr("style"),B&&B.length&&B.removeClass([w.slideVisibleClass,w.slideActiveClass,w.slideNextClass,w.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),L.emit("destroy"),Object.keys(L.eventsListeners).forEach(u=>{L.off(u)}),m!==!1&&(L.$el[0].swiper=null,Li(L)),L.destroyed=!0),null}static extendDefaults(m){ke(Mt,m)}static get extendedDefaults(){return Mt}static get defaults(){return er}static installModule(m){Re.prototype.__modules__||(Re.prototype.__modules__=[]);const E=Re.prototype.__modules__;typeof m=="function"&&E.indexOf(m)<0&&E.push(m)}static use(m){return Array.isArray(m)?(m.forEach(E=>Re.installModule(E)),Re):(Re.installModule(m),Re)}}Object.keys(bt).forEach(a=>{Object.keys(bt[a]).forEach(m=>{Re.prototype[m]=bt[a][m]})});Re.use([Mi,wi]);function Gn({swiper:a,extendParams:m,on:E,emit:L}){let w;a.autoplay={running:!1,paused:!1},m({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!0,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});function U(){if(!a.size){a.autoplay.running=!1,a.autoplay.paused=!1;return}const P=a.slides.eq(a.activeIndex);let D=a.params.autoplay.delay;P.attr("data-swiper-autoplay")&&(D=P.attr("data-swiper-autoplay")||a.params.autoplay.delay),clearTimeout(w),w=St(()=>{let T;a.params.autoplay.reverseDirection?a.params.loop?(a.loopFix(),T=a.slidePrev(a.params.speed,!0,!0),L("autoplay")):a.isBeginning?a.params.autoplay.stopOnLastSlide?B():(T=a.slideTo(a.slides.length-1,a.params.speed,!0,!0),L("autoplay")):(T=a.slidePrev(a.params.speed,!0,!0),L("autoplay")):a.params.loop?(a.loopFix(),T=a.slideNext(a.params.speed,!0,!0),L("autoplay")):a.isEnd?a.params.autoplay.stopOnLastSlide?B():(T=a.slideTo(0,a.params.speed,!0,!0),L("autoplay")):(T=a.slideNext(a.params.speed,!0,!0),L("autoplay")),(a.params.cssMode&&a.autoplay.running||T===!1)&&U()},D)}function G(){return typeof w<"u"||a.autoplay.running?!1:(a.autoplay.running=!0,L("autoplayStart"),U(),!0)}function B(){return!a.autoplay.running||typeof w>"u"?!1:(w&&(clearTimeout(w),w=void 0),a.autoplay.running=!1,L("autoplayStop"),!0)}function u(P){!a.autoplay.running||a.autoplay.paused||(w&&clearTimeout(w),a.autoplay.paused=!0,P===0||!a.params.autoplay.waitForTransition?(a.autoplay.paused=!1,U()):["transitionend","webkitTransitionEnd"].forEach(D=>{a.$wrapperEl[0].addEventListener(D,I)}))}function M(){const P=Pe();P.visibilityState==="hidden"&&a.autoplay.running&&u(),P.visibilityState==="visible"&&a.autoplay.paused&&(U(),a.autoplay.paused=!1)}function I(P){!a||a.destroyed||!a.$wrapperEl||P.target===a.$wrapperEl[0]&&(["transitionend","webkitTransitionEnd"].forEach(D=>{a.$wrapperEl[0].removeEventListener(D,I)}),a.autoplay.paused=!1,a.autoplay.running?U():B())}function b(){a.params.autoplay.disableOnInteraction?B():(L("autoplayPause"),u()),["transitionend","webkitTransitionEnd"].forEach(P=>{a.$wrapperEl[0].removeEventListener(P,I)})}function C(){a.params.autoplay.disableOnInteraction||(a.autoplay.paused=!1,L("autoplayResume"),U())}function F(){a.params.autoplay.pauseOnMouseEnter&&(a.$el.on("mouseenter",b),a.$el.on("mouseleave",C))}function R(){a.$el.off("mouseenter",b),a.$el.off("mouseleave",C)}E("init",()=>{a.params.autoplay.enabled&&(G(),Pe().addEventListener("visibilitychange",M),F())}),E("beforeTransitionStart",(P,D,T)=>{a.autoplay.running&&(T||!a.params.autoplay.disableOnInteraction?a.autoplay.pause(D):B())}),E("sliderFirstMove",()=>{a.autoplay.running&&(a.params.autoplay.disableOnInteraction?B():u())}),E("touchEnd",()=>{a.params.cssMode&&a.autoplay.paused&&!a.params.autoplay.disableOnInteraction&&U()}),E("destroy",()=>{R(),a.autoplay.running&&B(),Pe().removeEventListener("visibilitychange",M)}),Object.assign(a.autoplay,{pause:u,run:U,start:G,stop:B})}function lt(a){return typeof a=="object"&&a!==null&&a.constructor&&Object.prototype.toString.call(a).slice(8,-1)==="Object"}function Ye(a,m){const E=["__proto__","constructor","prototype"];Object.keys(m).filter(L=>E.indexOf(L)<0).forEach(L=>{typeof a[L]>"u"?a[L]=m[L]:lt(m[L])&&lt(a[L])&&Object.keys(m[L]).length>0?m[L].__swiper__?a[L]=m[L]:Ye(a[L],m[L]):a[L]=m[L]})}function kt(a={}){return a.navigation&&typeof a.navigation.nextEl>"u"&&typeof a.navigation.prevEl>"u"}function Bt(a={}){return a.pagination&&typeof a.pagination.el>"u"}function Ut(a={}){return a.scrollbar&&typeof a.scrollbar.el>"u"}function xt(a=""){const m=a.split(" ").map(L=>L.trim()).filter(L=>!!L),E=[];return m.forEach(L=>{E.indexOf(L)<0&&E.push(L)}),E.join(" ")}const xr=["modules","init","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopedSlidesLimit","_loopFillGroupWithBlank","loopPreventsSlide","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom"];function Wn(a={},m=!0){const E={on:{}},L={},w={};Ye(E,Re.defaults),Ye(E,Re.extendedDefaults),E._emitClasses=!0,E.init=!1;const U={},G=xr.map(u=>u.replace(/_/,"")),B=Object.assign({},a);return Object.keys(B).forEach(u=>{typeof a[u]>"u"||(G.indexOf(u)>=0?lt(a[u])?(E[u]={},w[u]={},Ye(E[u],a[u]),Ye(w[u],a[u])):(E[u]=a[u],w[u]=a[u]):u.search(/on[A-Z]/)===0&&typeof a[u]=="function"?m?L[`${u[2].toLowerCase()}${u.substr(3)}`]=a[u]:E.on[`${u[2].toLowerCase()}${u.substr(3)}`]=a[u]:U[u]=a[u])}),["navigation","pagination","scrollbar"].forEach(u=>{E[u]===!0&&(E[u]={}),E[u]===!1&&delete E[u]}),{params:E,passedParams:w,rest:U,events:L}}function Hn({el:a,nextEl:m,prevEl:E,paginationEl:L,scrollbarEl:w,swiper:U},G){kt(G)&&m&&E&&(U.params.navigation.nextEl=m,U.originalParams.navigation.nextEl=m,U.params.navigation.prevEl=E,U.originalParams.navigation.prevEl=E),Bt(G)&&L&&(U.params.pagination.el=L,U.originalParams.pagination.el=L),Ut(G)&&w&&(U.params.scrollbar.el=w,U.originalParams.scrollbar.el=w),U.init(a)}function Vn(a,m,E,L,w){const U=[];if(!m)return U;const G=u=>{U.indexOf(u)<0&&U.push(u)};if(E&&L){const u=L.map(w),M=E.map(w);u.join("")!==M.join("")&&G("children"),L.length!==E.length&&G("children")}return xr.filter(u=>u[0]==="_").map(u=>u.replace(/_/,"")).forEach(u=>{if(u in a&&u in m)if(lt(a[u])&&lt(m[u])){const M=Object.keys(a[u]),I=Object.keys(m[u]);M.length!==I.length?G(u):(M.forEach(b=>{a[u][b]!==m[u][b]&&G(u)}),I.forEach(b=>{a[u][b]!==m[u][b]&&G(u)}))}else a[u]!==m[u]&&G(u)}),U}function jn({swiper:a,slides:m,passedParams:E,changedParams:L,nextEl:w,prevEl:U,scrollbarEl:G,paginationEl:B}){const u=L.filter(y=>y!=="children"&&y!=="direction"),{params:M,pagination:I,navigation:b,scrollbar:C,virtual:F,thumbs:R}=a;let P,D,T,S,A;L.includes("thumbs")&&E.thumbs&&E.thumbs.swiper&&M.thumbs&&!M.thumbs.swiper&&(P=!0),L.includes("controller")&&E.controller&&E.controller.control&&M.controller&&!M.controller.control&&(D=!0),L.includes("pagination")&&E.pagination&&(E.pagination.el||B)&&(M.pagination||M.pagination===!1)&&I&&!I.el&&(T=!0),L.includes("scrollbar")&&E.scrollbar&&(E.scrollbar.el||G)&&(M.scrollbar||M.scrollbar===!1)&&C&&!C.el&&(S=!0),L.includes("navigation")&&E.navigation&&(E.navigation.prevEl||U)&&(E.navigation.nextEl||w)&&(M.navigation||M.navigation===!1)&&b&&!b.prevEl&&!b.nextEl&&(A=!0);const x=y=>{!a[y]||(a[y].destroy(),y==="navigation"?(M[y].prevEl=void 0,M[y].nextEl=void 0,a[y].prevEl=void 0,a[y].nextEl=void 0):(M[y].el=void 0,a[y].el=void 0))};u.forEach(y=>{if(lt(M[y])&&lt(E[y]))Ye(M[y],E[y]);else{const l=E[y];(l===!0||l===!1)&&(y==="navigation"||y==="pagination"||y==="scrollbar")?l===!1&&x(y):M[y]=E[y]}}),u.includes("controller")&&!D&&a.controller&&a.controller.control&&M.controller&&M.controller.control&&(a.controller.control=M.controller.control),L.includes("children")&&m&&F&&M.virtual.enabled?(F.slides=m,F.update(!0)):L.includes("children")&&a.lazy&&a.params.lazy.enabled&&a.lazy.load(),P&&R.init()&&R.update(!0),D&&(a.controller.control=M.controller.control),T&&(B&&(M.pagination.el=B),I.init(),I.render(),I.update()),S&&(G&&(M.scrollbar.el=G),C.init(),C.updateSize(),C.setTranslate()),A&&(w&&(M.navigation.nextEl=w),U&&(M.navigation.prevEl=U),b.init(),b.update()),L.includes("allowSlideNext")&&(a.allowSlideNext=E.allowSlideNext),L.includes("allowSlidePrev")&&(a.allowSlidePrev=E.allowSlidePrev),L.includes("direction")&&a.changeDirection(E.direction,!1),a.update()}const zn=a=>({virtualData:a&2048}),tr=a=>({virtualData:a[11]}),$n=a=>({virtualData:a&2048}),rr=a=>({virtualData:a[11]}),Yn=a=>({virtualData:a&2048}),ir=a=>({virtualData:a[11]}),Xn=a=>({virtualData:a&2048}),nr=a=>({virtualData:a[11]}),Qn=a=>({virtualData:a&2048}),sr=a=>({virtualData:a[11]});function ar(a){let m,E,L;return{c(){m=le("div"),E=me(),L=le("div"),this.h()},l(w){m=ue(w,"DIV",{class:!0}),ce(m).forEach(ne),E=Ee(w),L=ue(w,"DIV",{class:!0}),ce(L).forEach(ne),this.h()},h(){ee(m,"class","swiper-button-prev"),ee(L,"class","swiper-button-next")},m(w,U){ge(w,m,U),a[15](m),ge(w,E,U),ge(w,L,U),a[16](L)},p:Ve,d(w){w&&ne(m),a[15](null),w&&ne(E),w&&ne(L),a[16](null)}}}function or(a){let m;return{c(){m=le("div"),this.h()},l(E){m=ue(E,"DIV",{class:!0}),ce(m).forEach(ne),this.h()},h(){ee(m,"class","swiper-scrollbar")},m(E,L){ge(E,m,L),a[17](m)},p:Ve,d(E){E&&ne(m),a[17](null)}}}function lr(a){let m;return{c(){m=le("div"),this.h()},l(E){m=ue(E,"DIV",{class:!0}),ce(m).forEach(ne),this.h()},h(){ee(m,"class","swiper-pagination")},m(E,L){ge(E,m,L),a[18](m)},p:Ve,d(E){E&&ne(m),a[18](null)}}}function wt(a){let m,E,L,w,U,G,B=kt(a[4]),u,M=Ut(a[4]),I,b=Bt(a[4]),C,F,R;const P=a[14]["container-start"],D=it(P,a,a[13],sr),T=a[14]["wrapper-start"],S=it(T,a,a[13],nr),A=a[14].default,x=it(A,a,a[13],ir),y=a[14]["wrapper-end"],l=it(y,a,a[13],rr);let n=[{class:"swiper-wrapper"}],r={};for(let p=0;p<n.length;p+=1)r=ot(r,n[p]);let c=B&&ar(a),f=M&&or(a),e=b&&lr(a);const t=a[14]["container-end"],i=it(t,a,a[13],tr);let v=[{class:F=xt(`${a[3]}${a[0]?` ${a[0]}`:""}`)},a[5]],d={};for(let p=0;p<v.length;p+=1)d=ot(d,v[p]);return{c(){m=le(a[1]),D&&D.c(),E=me(),L=le(a[2]),S&&S.c(),w=me(),x&&x.c(),U=me(),l&&l.c(),G=me(),c&&c.c(),u=me(),f&&f.c(),I=me(),e&&e.c(),C=me(),i&&i.c(),this.h()},l(p){m=ue(p,(a[1]||"null").toUpperCase(),{class:!0});var s=ce(m);D&&D.l(s),E=Ee(s),L=ue(s,(a[2]||"null").toUpperCase(),{class:!0});var g=ce(L);S&&S.l(g),w=Ee(g),x&&x.l(g),U=Ee(g),l&&l.l(g),g.forEach(ne),G=Ee(s),c&&c.l(s),u=Ee(s),f&&f.l(s),I=Ee(s),e&&e.l(s),C=Ee(s),i&&i.l(s),s.forEach(ne),this.h()},h(){/-/.test(a[2])?Et(L,r):vt(L,r),/-/.test(a[1])?Et(m,d):vt(m,d)},m(p,s){ge(p,m,s),D&&D.m(m,null),ae(m,E),ae(m,L),S&&S.m(L,null),ae(L,w),x&&x.m(L,null),ae(L,U),l&&l.m(L,null),ae(m,G),c&&c.m(m,null),ae(m,u),f&&f.m(m,null),ae(m,I),e&&e.m(m,null),ae(m,C),i&&i.m(m,null),a[19](m),R=!0},p(p,s){D&&D.p&&(!R||s&10240)&&nt(D,P,p,p[13],R?at(P,p[13],s,Qn):st(p[13]),sr),S&&S.p&&(!R||s&10240)&&nt(S,T,p,p[13],R?at(T,p[13],s,Xn):st(p[13]),nr),x&&x.p&&(!R||s&10240)&&nt(x,A,p,p[13],R?at(A,p[13],s,Yn):st(p[13]),ir),l&&l.p&&(!R||s&10240)&&nt(l,y,p,p[13],R?at(y,p[13],s,$n):st(p[13]),rr),r=Ft(n,[{class:"swiper-wrapper"}]),/-/.test(p[2])?Et(L,r):vt(L,r),s&16&&(B=kt(p[4])),B?c?c.p(p,s):(c=ar(p),c.c(),c.m(m,u)):c&&(c.d(1),c=null),s&16&&(M=Ut(p[4])),M?f?f.p(p,s):(f=or(p),f.c(),f.m(m,I)):f&&(f.d(1),f=null),s&16&&(b=Bt(p[4])),b?e?e.p(p,s):(e=lr(p),e.c(),e.m(m,C)):e&&(e.d(1),e=null),i&&i.p&&(!R||s&10240)&&nt(i,t,p,p[13],R?at(t,p[13],s,zn):st(p[13]),tr),d=Ft(v,[(!R||s&9&&F!==(F=xt(`${p[3]}${p[0]?` ${p[0]}`:""}`)))&&{class:F},s&32&&p[5]]),/-/.test(p[1])?Et(m,d):vt(m,d)},i(p){R||(Te(D,p),Te(S,p),Te(x,p),Te(l,p),Te(i,p),R=!0)},o(p){ye(D,p),ye(S,p),ye(x,p),ye(l,p),ye(i,p),R=!1},d(p){p&&ne(m),D&&D.d(p),S&&S.d(p),x&&x.d(p),l&&l.d(p),c&&c.d(),f&&f.d(),e&&e.d(),i&&i.d(p),a[19](null)}}}function Zn(a){let m=a[1],E,L,w=a[1]&&wt(a);return{c(){w&&w.c(),E=$t()},l(U){w&&w.l(U),E=$t()},m(U,G){w&&w.m(U,G),ge(U,E,G),L=!0},p(U,[G]){U[1]?m?Lt(m,U[1])?(w.d(1),w=wt(U),w.c(),w.m(E.parentNode,E)):w.p(U,G):(w=wt(U),w.c(),w.m(E.parentNode,E)):m&&(w.d(1),w=null),m=U[1]},i(U){L||(Te(w),L=!0)},o(U){ye(w),L=!1},d(U){U&&ne(E),w&&w.d(U)}}}function Jn(a,m,E){const L=["class","tag","wrapperTag","swiper"];let w=_t(m,L),{$$slots:U={},$$scope:G}=m;const B=br();let{class:u=void 0}=m,{tag:M="div"}=m,{wrapperTag:I="div"}=m,b="swiper",C=!1,F=null,R=null,P,D,T,S,A=null,x=null,y=null,l=null,n=null,r={slides:[]};function c(){return F}const f=g=>{E(11,r=g),wr().then(()=>{F.$wrapperEl.children(".swiper-slide").each(h=>{h.onSwiper&&h.onSwiper(F)}),F.updateSlides(),F.updateProgress(),F.updateSlidesClasses(),F.lazy&&F.params.lazy.enabled&&F.lazy.load()})},e=()=>{P=Wn(w),E(4,D=P.params),T=P.passedParams,E(5,S=P.rest)};e(),R=T;const t=()=>{C=!0};if(D.onAny=(g,...h)=>{B(g,h)},Object.assign(D.on,{_beforeBreakpoint:t,_containerClasses(g,h){E(3,b=h)}}),F=new Re(D),Mr("swiper",F),F.virtual&&F.params.virtual.enabled){const g={cache:!1,renderExternal:h=>{f(h),D.virtual&&D.virtual.renderExternal&&D.virtual.renderExternal(h)},renderExternalUpdate:!1};Ye(F.params.virtual,g),Ye(F.originalParams.virtual,g)}Gt(()=>{!A||(Hn({el:A,nextEl:y,prevEl:x,paginationEl:n,scrollbarEl:l,swiper:F},D),B("swiper",[F]),!D.virtual&&F.slides.each(g=>{g.onSwiper&&g.onSwiper(F)}))}),cr(()=>{if(!F)return;e();const g=Vn(T,R);(g.length||C)&&F&&!F.destroyed&&jn({swiper:F,passedParams:T,changedParams:g,nextEl:y,prevEl:x,scrollbarEl:l,paginationEl:n}),C=!1,R=T}),hr(()=>{typeof window<"u"&&F&&!F.destroyed&&F.destroy(!0,!1)});function i(g){ht[g?"unshift":"push"](()=>{x=g,E(7,x)})}function v(g){ht[g?"unshift":"push"](()=>{y=g,E(8,y)})}function d(g){ht[g?"unshift":"push"](()=>{l=g,E(9,l)})}function p(g){ht[g?"unshift":"push"](()=>{n=g,E(10,n)})}function s(g){ht[g?"unshift":"push"](()=>{A=g,E(6,A)})}return a.$$set=g=>{m=ot(ot({},m),vr(g)),E(29,w=_t(m,L)),"class"in g&&E(0,u=g.class),"tag"in g&&E(1,M=g.tag),"wrapperTag"in g&&E(2,I=g.wrapperTag),"$$scope"in g&&E(13,G=g.$$scope)},[u,M,I,b,D,S,A,x,y,l,n,r,c,G,U,i,v,d,p,s]}class qn extends Nt{constructor(m){super(),Kt(this,m,Jn,Zn,Lt,{class:0,tag:1,wrapperTag:2,swiper:12})}get swiper(){return this.$$.ctx[12]}}const es=a=>({data:a&32}),ur=a=>({data:a[5]}),ts=a=>({data:a&32}),fr=a=>({data:a[5]});function rs(a){let m;const E=a[8].default,L=it(E,a,a[7],ur);return{c(){L&&L.c()},l(w){L&&L.l(w)},m(w,U){L&&L.m(w,U),m=!0},p(w,U){L&&L.p&&(!m||U&160)&&nt(L,E,w,w[7],m?at(E,w[7],U,es):st(w[7]),ur)},i(w){m||(Te(L,w),m=!0)},o(w){ye(L,w),m=!1},d(w){L&&L.d(w)}}}function is(a){let m,E,L;const w=a[8].default,U=it(w,a,a[7],fr);return{c(){m=le("div"),U&&U.c(),this.h()},l(G){m=ue(G,"DIV",{class:!0,"data-swiper-zoom":!0});var B=ce(m);U&&U.l(B),B.forEach(ne),this.h()},h(){ee(m,"class","swiper-zoom-container"),ee(m,"data-swiper-zoom",E=typeof a[0]=="number"?a[0]:void 0)},m(G,B){ge(G,m,B),U&&U.m(m,null),L=!0},p(G,B){U&&U.p&&(!L||B&160)&&nt(U,w,G,G[7],L?at(w,G[7],B,ts):st(G[7]),fr),(!L||B&1&&E!==(E=typeof G[0]=="number"?G[0]:void 0))&&ee(m,"data-swiper-zoom",E)},i(G){L||(Te(U,G),L=!0)},o(G){ye(U,G),L=!1},d(G){G&&ne(m),U&&U.d(G)}}}function ns(a){let m,E,L,w,U;const G=[is,rs],B=[];function u(b,C){return b[0]?0:1}E=u(a),L=B[E]=G[E](a);let M=[{class:w=xt(`${a[3]}${a[2]?` ${a[2]}`:""}`)},{"data-swiper-slide-index":a[1]},a[6]],I={};for(let b=0;b<M.length;b+=1)I=ot(I,M[b]);return{c(){m=le("div"),L.c(),this.h()},l(b){m=ue(b,"DIV",{class:!0,"data-swiper-slide-index":!0});var C=ce(m);L.l(C),C.forEach(ne),this.h()},h(){vt(m,I)},m(b,C){ge(b,m,C),B[E].m(m,null),a[9](m),U=!0},p(b,[C]){let F=E;E=u(b),E===F?B[E].p(b,C):(gr(),ye(B[F],1,1,()=>{B[F]=null}),pr(),L=B[E],L?L.p(b,C):(L=B[E]=G[E](b),L.c()),Te(L,1),L.m(m,null)),vt(m,I=Ft(M,[(!U||C&12&&w!==(w=xt(`${b[3]}${b[2]?` ${b[2]}`:""}`)))&&{class:w},(!U||C&2)&&{"data-swiper-slide-index":b[1]},C&64&&b[6]]))},i(b){U||(Te(L),U=!0)},o(b){ye(L),U=!1},d(b){b&&ne(m),B[E].d(),a[9](null)}}}function ss(a,m,E){let L;const w=["zoom","virtualIndex","class"];let U=_t(m,w),{$$slots:G={},$$scope:B}=m,{zoom:u=void 0}=m,{virtualIndex:M=void 0}=m,{class:I=void 0}=m,b=null,C="swiper-slide",F=Fr("swiper"),R=!1;const P=(A,x,y)=>{x===b&&E(3,C=y)},D=()=>{!F||R||(F.on("_slideClass",P),R=!0)},T=()=>{!F||(F.off("_slideClass",P),R=!1)};Gt(()=>{typeof M>"u"||(E(4,b.onSwiper=A=>{F=A,D()},b),D())}),cr(()=>{if(!(!b||!F)){if(F.destroyed){C!=="swiper-slide"&&E(3,C="swiper-slide");return}D()}}),kr(()=>{D()}),hr(()=>{!F||T()});function S(A){ht[A?"unshift":"push"](()=>{b=A,E(4,b)})}return a.$$set=A=>{m=ot(ot({},m),vr(A)),E(6,U=_t(m,w)),"zoom"in A&&E(0,u=A.zoom),"virtualIndex"in A&&E(1,M=A.virtualIndex),"class"in A&&E(2,I=A.class),"$$scope"in A&&E(7,B=A.$$scope)},a.$$.update=()=>{a.$$.dirty&8&&E(5,L={isActive:C.indexOf("swiper-slide-active")>=0||C.indexOf("swiper-slide-duplicate-active")>=0,isVisible:C.indexOf("swiper-slide-visible")>=0,isDuplicate:C.indexOf("swiper-slide-duplicate")>=0,isPrev:C.indexOf("swiper-slide-prev")>=0||C.indexOf("swiper-slide-duplicate-prev")>=0,isNext:C.indexOf("swiper-slide-next")>=0||C.indexOf("swiper-slide-duplicate-next")>=0})},[u,M,I,C,b,L,U,B,G,S]}class ct extends Nt{constructor(m){super(),Kt(this,m,ss,ns,Lt,{zoom:0,virtualIndex:1,class:2})}}var as={exports:{}};(function(a,m){typeof window<"u"&&function(L,w){a.exports=w()}(Br,()=>(()=>{var E={"./src/config.ts":(G,B,u)=>{u.r(B),u.d(B,{enableStreamingMode:()=>p,hlsDefaultConfig:()=>i,mergeConfig:()=>d});var M=u("./src/controller/abr-controller.ts"),I=u("./src/controller/audio-stream-controller.ts"),b=u("./src/controller/audio-track-controller.ts"),C=u("./src/controller/subtitle-stream-controller.ts"),F=u("./src/controller/subtitle-track-controller.ts"),R=u("./src/controller/buffer-controller.ts"),P=u("./src/controller/timeline-controller.ts"),D=u("./src/controller/cap-level-controller.ts"),T=u("./src/controller/fps-controller.ts"),S=u("./src/controller/eme-controller.ts"),A=u("./src/controller/cmcd-controller.ts"),x=u("./src/utils/xhr-loader.ts"),y=u("./src/utils/fetch-loader.ts"),l=u("./src/utils/cues.ts"),n=u("./src/utils/mediakeys-helper.ts"),r=u("./src/utils/logger.ts");function c(){return c=Object.assign?Object.assign.bind():function(s){for(var g=1;g<arguments.length;g++){var h=arguments[g];for(var o in h)Object.prototype.hasOwnProperty.call(h,o)&&(s[o]=h[o])}return s},c.apply(this,arguments)}function f(s,g){var h=Object.keys(s);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(s);g&&(o=o.filter(function(_){return Object.getOwnPropertyDescriptor(s,_).enumerable})),h.push.apply(h,o)}return h}function e(s){for(var g=1;g<arguments.length;g++){var h=arguments[g]!=null?arguments[g]:{};g%2?f(Object(h),!0).forEach(function(o){t(s,o,h[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(h)):f(Object(h)).forEach(function(o){Object.defineProperty(s,o,Object.getOwnPropertyDescriptor(h,o))})}return s}function t(s,g,h){return g in s?Object.defineProperty(s,g,{value:h,enumerable:!0,configurable:!0,writable:!0}):s[g]=h,s}var i=e(e({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:x.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:R.default,capLevelController:D.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:n.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},v()),{},{subtitleStreamController:C.SubtitleStreamController,subtitleTrackController:F.default,timelineController:P.TimelineController,audioStreamController:I.default,audioTrackController:b.default,emeController:S.default,cmcdController:A.default});function v(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function d(s,g){if((g.liveSyncDurationCount||g.liveMaxLatencyDurationCount)&&(g.liveSyncDuration||g.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(g.liveMaxLatencyDurationCount!==void 0&&(g.liveSyncDurationCount===void 0||g.liveMaxLatencyDurationCount<=g.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(g.liveMaxLatencyDuration!==void 0&&(g.liveSyncDuration===void 0||g.liveMaxLatencyDuration<=g.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return c({},s,g)}function p(s){var g=s.loader;if(g!==y.default&&g!==x.default)r.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1;else{var h=(0,y.fetchSupported)();h&&(s.loader=y.default,s.progressive=!0,s.enableSoftwareAES=!0,r.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>S});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/ewma-bandwidth-estimator.ts"),b=u("./src/events.ts"),C=u("./src/errors.ts"),F=u("./src/types/loader.ts"),R=u("./src/utils/logger.ts");function P(A,x){for(var y=0;y<x.length;y++){var l=x[y];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(A,l.key,l)}}function D(A,x,y){return x&&P(A.prototype,x),y&&P(A,y),Object.defineProperty(A,"prototype",{writable:!1}),A}var T=function(){function A(y){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=y;var l=y.config;this.bwEstimator=new I.default(l.abrEwmaSlowVoD,l.abrEwmaFastVoD,l.abrEwmaDefaultEstimate),this.registerListeners()}var x=A.prototype;return x.registerListeners=function(){var l=this.hls;l.on(b.Events.FRAG_LOADING,this.onFragLoading,this),l.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(b.Events.ERROR,this.onError,this)},x.unregisterListeners=function(){var l=this.hls;l.off(b.Events.FRAG_LOADING,this.onFragLoading,this),l.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(b.Events.ERROR,this.onError,this)},x.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},x.onFragLoading=function(l,n){var r=n.frag;if(r.type===F.PlaylistLevelType.MAIN&&!this.timer){var c;this.fragCurrent=r,this.partCurrent=(c=n.part)!=null?c:null,this.timer=self.setInterval(this.onCheck,100)}},x.onLevelLoaded=function(l,n){var r=this.hls.config;n.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},x._abandonRulesCheck=function(){var l=this.fragCurrent,n=this.partCurrent,r=this.hls,c=r.autoLevelEnabled;r.config;var f=r.media;if(!(!l||!f)){var e=n?n.stats:l.stats,t=n?n.duration:l.duration;if(e.aborted||e.loaded&&e.loaded===e.total||l.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!c||f.paused||!f.playbackRate||!f.readyState)){var i=r.mainForwardBufferInfo;if(i!==null){var v=performance.now()-e.loading.start,d=Math.abs(f.playbackRate);if(!(v<=500*t/d)){var p=e.loaded&&e.loading.first,s=this.bwEstimator.getEstimate(),g=r.levels,h=r.minAutoLevel,o=g[l.level],_=e.total||Math.max(e.loaded,Math.round(t*o.maxBitrate/8)),O=p?e.loaded*1e3/v:0,k=O?(_-e.loaded)/O:_*8/s,K=i.len/d;if(!(k<=K)){var N=Number.POSITIVE_INFINITY,W;for(W=l.level-1;W>h;W--){var H=g[W].maxBitrate;if(N=O?t*H/(8*.8*O):t*H/s,N<K)break}N>=k||(R.logger.warn("Fragment "+l.sn+(n?" part "+n.index:"")+" of level "+l.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+W+`
      Current BW estimate: `+((0,M.isFiniteNumber)(s)?(s/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+k.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+K.toFixed(3)+" s"),r.nextLoadLevel=W,p&&this.bwEstimator.sample(v,e.loaded),this.clearTimer(),l.loader&&(this.fragCurrent=this.partCurrent=null,l.loader.abort()),r.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:n,stats:e}))}}}}}},x.onFragLoaded=function(l,n){var r=n.frag,c=n.part;if(r.type===F.PlaylistLevelType.MAIN&&(0,M.isFiniteNumber)(r.sn)){var f=c?c.stats:r.stats,e=c?c.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var t=this.hls.levels[r.level],i=(t.loaded?t.loaded.bytes:0)+f.loaded,v=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:i,duration:v},t.realBitrate=Math.round(8*i/v)}if(r.bitrateTest){var d={stats:f,frag:r,part:c,id:r.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,d)}}},x.onFragBuffered=function(l,n){var r=n.frag,c=n.part,f=c?c.stats:r.stats;if(!f.aborted&&!(r.type!==F.PlaylistLevelType.MAIN||r.sn==="initSegment")){var e=f.parsing.end-f.loading.start;this.bwEstimator.sample(e,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}},x.onError=function(l,n){switch(n.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},x.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},x.getNextABRAutoLevel=function(){var l=this.fragCurrent,n=this.partCurrent,r=this.hls,c=r.maxAutoLevel,f=r.config,e=r.minAutoLevel,t=r.media,i=n?n.duration:l?l.duration:0;t&&t.currentTime;var v=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,p=r.mainForwardBufferInfo,s=(p?p.len:0)/v,g=this.findBestLevel(d,e,c,s,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(g>=0)return g;R.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var h=i?Math.min(i,f.maxStarvationDelay):f.maxStarvationDelay,o=f.abrBandWidthFactor,_=f.abrBandWidthUpFactor;if(!s){var O=this.bitrateTestDelay;if(O){var k=i?Math.min(i,f.maxLoadingDelay):f.maxLoadingDelay;h=k-O,R.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),o=_=1}}return g=this.findBestLevel(d,e,c,s+h,o,_),Math.max(g,0)},x.findBestLevel=function(l,n,r,c,f,e){for(var t,i=this.fragCurrent,v=this.partCurrent,d=this.lastLoadedFragLevel,p=this.hls.levels,s=p[d],g=!!(s!=null&&(t=s.details)!==null&&t!==void 0&&t.live),h=s==null?void 0:s.codecSet,o=v?v.duration:i?i.duration:0,_=r;_>=n;_--){var O=p[_];if(!(!O||h&&O.codecSet!==h)){var k=O.details,K=(v?k==null?void 0:k.partTarget:k==null?void 0:k.averagetargetduration)||o,N=void 0;_<=d?N=f*l:N=e*l;var W=p[_].maxBitrate,H=W*K/N;if(R.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+_+"/"+Math.round(N)+"/"+W+"/"+K+"/"+c+"/"+H),N>W&&(H===0||!(0,M.isFiniteNumber)(H)||g&&!this.bitrateTestDelay||H<c))return _}}return-1},D(A,[{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,n=this.bwEstimator;if(l!==-1&&!n.canEstimate())return l;var r=this.getNextABRAutoLevel();return l!==-1&&this.hls.levels[r].loadError?l:(l!==-1&&(r=Math.min(l,r)),r)},set:function(l){this._nextAutoLevel=l}}]),A}();const S=T},"./src/controller/audio-stream-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>t});var M=u("./src/polyfills/number.ts"),I=u("./src/controller/base-stream-controller.ts"),b=u("./src/events.ts"),C=u("./src/utils/buffer-helper.ts"),F=u("./src/controller/fragment-tracker.ts"),R=u("./src/types/level.ts"),P=u("./src/types/loader.ts"),D=u("./src/loader/fragment.ts"),T=u("./src/demux/chunk-cache.ts"),S=u("./src/demux/transmuxer-interface.ts"),A=u("./src/types/transmuxer.ts"),x=u("./src/controller/fragment-finders.ts"),y=u("./src/utils/discontinuities.ts"),l=u("./src/errors.ts");function n(){return n=Object.assign?Object.assign.bind():function(i){for(var v=1;v<arguments.length;v++){var d=arguments[v];for(var p in d)Object.prototype.hasOwnProperty.call(d,p)&&(i[p]=d[p])}return i},n.apply(this,arguments)}function r(i,v){i.prototype=Object.create(v.prototype),i.prototype.constructor=i,c(i,v)}function c(i,v){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(p,s){return p.__proto__=s,p},c(i,v)}var f=100,e=function(i){r(v,i);function v(p,s){var g;return g=i.call(this,p,s,"[audio-stream-controller]")||this,g.videoBuffer=null,g.videoTrackCC=-1,g.waitingVideoCC=-1,g.audioSwitch=!1,g.trackId=-1,g.waitingData=null,g.mainDetails=null,g.bufferFlushed=!1,g.cachedTrackLoadedData=null,g._registerListeners(),g}var d=v.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var s=this.hls;s.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(b.Events.ERROR,this.onError,this),s.on(b.Events.BUFFER_RESET,this.onBufferReset,this),s.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d._unregisterListeners=function(){var s=this.hls;s.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(b.Events.ERROR,this.onError,this),s.off(b.Events.BUFFER_RESET,this.onBufferReset,this),s.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d.onInitPtsFound=function(s,g){var h=g.frag,o=g.id,_=g.initPTS;if(o==="main"){var O=h.cc;this.initPTS[h.cc]=_,this.log("InitPTS for cc: "+O+" found from main: "+_),this.videoTrackCC=O,this.state===I.State.WAITING_INIT_PTS&&this.tick()}},d.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=I.State.STOPPED;return}var g=this.lastCurrentTime;this.stopLoad(),this.setInterval(f),this.fragLoadError=0,g>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+g.toFixed(3)),s=g,this.state=I.State.IDLE):(this.loadedmetadata=!1,this.state=I.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},d.doTick=function(){switch(this.state){case I.State.IDLE:this.doTickIdle();break;case I.State.WAITING_TRACK:{var s,g=this.levels,h=this.trackId,o=g==null||(s=g[h])===null||s===void 0?void 0:s.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=I.State.WAITING_INIT_PTS}break}case I.State.FRAG_LOADING_WAITING_RETRY:{var _,O=performance.now(),k=this.retryDate;(!k||O>=k||(_=this.media)!==null&&_!==void 0&&_.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=I.State.IDLE);break}case I.State.WAITING_INIT_PTS:{var K=this.waitingData;if(K){var N=K.frag,W=K.part,H=K.cache,V=K.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=I.State.FRAG_LOADING;var j=H.flush(),z={frag:N,part:W,payload:j,networkDetails:null};this._handleFragmentLoadProgress(z),V&&i.prototype._handleFragmentLoadComplete.call(this,z)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var $=this.getLoadPosition(),Y=C.BufferHelper.bufferInfo(this.mediaBuffer,$,this.config.maxBufferHole),X=(0,x.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,N);X<0&&(this.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=I.State.IDLE}}this.onTickEnd()},d.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=I.State.IDLE)},d.resetLoadingState=function(){this.clearWaitingFragment(),i.prototype.resetLoadingState.call(this)},d.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var g=this.mediaBuffer?this.mediaBuffer:s,h=g.buffered;!this.loadedmetadata&&h.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},d.doTickIdle=function(){var s,g,h=this.hls,o=this.levels,_=this.media,O=this.trackId,k=h.config;if(!(!o||!o[O])&&!(!_&&(this.startFragRequested||!k.startFragPrefetch))){var K=o[O],N=K.details;if(!N||N.live&&this.levelLastLoaded!==O||this.waitForCdnTuneIn(N)){this.state=I.State.WAITING_TRACK;return}var W=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&W&&(this.bufferFlushed=!1,this.afterBufferFlushed(W,D.ElementaryStreamTypes.AUDIO,P.PlaylistLevelType.AUDIO));var H=this.getFwdBufferInfo(W,P.PlaylistLevelType.AUDIO);if(H!==null){var V=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,P.PlaylistLevelType.MAIN),j=H.len,z=this.getMaxBufferLength(V==null?void 0:V.len),$=this.audioSwitch;if(!(j>=z&&!$)){if(!$&&this._streamEnded(H,N)){h.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=I.State.ENDED;return}var Y=N.fragments,X=Y[0].start,Q=H.end;if($&&_){var q=this.getLoadPosition();Q=q,N.PTSKnown&&q<X&&(H.end>X||H.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),_.currentTime=X+.05)}if(!(V&&Q>V.end+N.targetduration)&&!((!V||!V.len)&&H.len)){var J=this.getNextFragment(Q,N);if(!J){this.bufferFlushed=!0;return}((s=J.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((g=J.decryptdata)!==null&&g!==void 0&&g.key)?this.loadKey(J,N):this.loadFragment(J,N,Q)}}}}},d.getMaxBufferLength=function(s){var g=i.prototype.getMaxBufferLength.call(this);return s?Math.max(g,s):g},d.onMediaDetaching=function(){this.videoBuffer=null,i.prototype.onMediaDetaching.call(this)},d.onAudioTracksUpdated=function(s,g){var h=g.audioTracks;this.resetTransmuxer(),this.levels=h.map(function(o){return new R.Level(o)})},d.onAudioTrackSwitching=function(s,g){var h=!!g.url;this.trackId=g.id;var o=this.fragCurrent;o!=null&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),h?this.setInterval(f):this.resetTransmuxer(),h?(this.audioSwitch=!0,this.state=I.State.IDLE):this.state=I.State.STOPPED,this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},d.onLevelLoaded=function(s,g){this.mainDetails=g.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},d.onAudioTrackLoaded=function(s,g){var h;if(this.mainDetails==null){this.cachedTrackLoadedData=g;return}var o=this.levels,_=g.details,O=g.id;if(!o){this.warn("Audio tracks were reset while loading level "+O);return}this.log("Track "+O+" loaded ["+_.startSN+","+_.endSN+"],duration:"+_.totalduration);var k=o[O],K=0;if(_.live||(h=k.details)!==null&&h!==void 0&&h.live){var N=this.mainDetails;if(_.fragments[0]||(_.deltaUpdateFailed=!0),_.deltaUpdateFailed||!N)return;!k.details&&_.hasProgramDateTime&&N.hasProgramDateTime?((0,y.alignMediaPlaylistByPDT)(_,N),K=_.fragments[0].start):K=this.alignPlaylists(_,k.details)}k.details=_,this.levelLastLoaded=O,!this.startFragRequested&&(this.mainDetails||!_.live)&&this.setStartPosition(k.details,K),this.state===I.State.WAITING_TRACK&&!this.waitForCdnTuneIn(_)&&(this.state=I.State.IDLE),this.tick()},d._handleFragmentLoadProgress=function(s){var g,h=s.frag,o=s.part,_=s.payload,O=this.config,k=this.trackId,K=this.levels;if(!K){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered");return}var N=K[k];console.assert(N,"Audio track is defined on fragment load progress");var W=N.details;console.assert(W,"Audio track details are defined on fragment load progress");var H=O.defaultAudioCodec||N.audioCodec||"mp4a.40.2",V=this.transmuxer;V||(V=this.transmuxer=new S.default(this.hls,P.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var j=this.initPTS[h.cc],z=(g=h.initSegment)===null||g===void 0?void 0:g.data;if(j!==void 0){var $=!1,Y=o?o.index:-1,X=Y!==-1,Q=new A.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,_.byteLength,Y,X);V.push(_,z,H,"",h,o,W.totalduration,$,Q,j)}else{this.log("Unknown video PTS for cc "+h.cc+", waiting for video PTS before demuxing audio frag "+h.sn+" of ["+W.startSN+" ,"+W.endSN+"],track "+k);var q=this.waitingData=this.waitingData||{frag:h,part:o,cache:new T.default,complete:!1},J=q.cache;J.push(new Uint8Array(_)),this.waitingVideoCC=this.videoTrackCC,this.state=I.State.WAITING_INIT_PTS}},d._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}i.prototype._handleFragmentLoadComplete.call(this,s)},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(s,g){var h=g.tracks.audio;h&&(this.mediaBuffer=h.buffer||null),g.tracks.video&&(this.videoBuffer=g.tracks.video.buffer||null)},d.onFragBuffered=function(s,g){var h=g.frag,o=g.part;if(h.type===P.PlaylistLevelType.AUDIO){if(this.fragContextChanged(h)){this.warn("Fragment "+h.sn+(o?" p: "+o.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}h.sn!=="initSegment"&&(this.fragPrevious=h,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(h,o)}},d.onError=function(s,g){switch(g.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(P.PlaylistLevelType.AUDIO,g);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==I.State.ERROR&&this.state!==I.State.STOPPED&&(this.state=g.fatal?I.State.ERROR:I.State.IDLE,this.warn(g.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(g.parent==="audio"&&(this.state===I.State.PARSING||this.state===I.State.PARSED)){var h=!0,o=this.getFwdBufferInfo(this.mediaBuffer,P.PlaylistLevelType.AUDIO);o&&o.len>.5&&(h=!this.reduceMaxBufferLength(o.len)),h&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},d.onBufferFlushed=function(s,g){var h=g.type;h===D.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},d._handleTransmuxComplete=function(s){var g,h="audio",o=this.hls,_=s.remuxResult,O=s.chunkMeta,k=this.getCurrentContext(O);if(!k){this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(O.level);return}var K=k.frag,N=k.part,W=k.level.details,H=_.audio,V=_.text,j=_.id3,z=_.initSegment;if(!(this.fragContextChanged(K)||!W)){if(this.state=I.State.PARSING,this.audioSwitch&&H&&this.completeAudioSwitch(),z!=null&&z.tracks&&(this._bufferInitSegment(z.tracks,K,O),o.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:K,id:h,tracks:z.tracks})),H){var $=H.startPTS,Y=H.endPTS,X=H.startDTS,Q=H.endDTS;N&&(N.elementaryStreams[D.ElementaryStreamTypes.AUDIO]={startPTS:$,endPTS:Y,startDTS:X,endDTS:Q}),K.setElementaryStreamInfo(D.ElementaryStreamTypes.AUDIO,$,Y,X,Q),this.bufferFragmentData(H,K,N,O)}if(j!=null&&(g=j.samples)!==null&&g!==void 0&&g.length){var q=n({id:h,frag:K,details:W},j);o.trigger(b.Events.FRAG_PARSING_METADATA,q)}if(V){var J=n({id:h,frag:K,details:W},V);o.trigger(b.Events.FRAG_PARSING_USERDATA,J)}}},d._bufferInitSegment=function(s,g,h){if(this.state===I.State.PARSING){s.video&&delete s.video;var o=s.audio;if(!!o){o.levelCodec=o.codec,o.id="audio",this.log("Init audio buffer, container:"+o.container+", codecs[parsed]=["+o.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,s);var _=o.initSegment;if(_!=null&&_.byteLength){var O={type:"audio",frag:g,part:null,chunkMeta:h,parent:g.type,data:_};this.hls.trigger(b.Events.BUFFER_APPENDING,O)}this.tick()}}},d.loadFragment=function(s,g,h){var o=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||o===F.FragmentState.NOT_LOADED||o===F.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):g.live&&!(0,M.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=I.State.WAITING_INIT_PTS):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,s,g,h)))},d.completeAudioSwitch=function(){var s=this.hls,g=this.media,h=this.trackId;g&&(this.log("Switching audio track : flushing all audio"),i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:h})},v}(I.default);const t=e},"./src/controller/audio-track-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>S});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/controller/base-playlist-controller.ts"),C=u("./src/types/loader.ts");function F(A,x){for(var y=0;y<x.length;y++){var l=x[y];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(A,l.key,l)}}function R(A,x,y){return x&&F(A.prototype,x),y&&F(A,y),Object.defineProperty(A,"prototype",{writable:!1}),A}function P(A,x){A.prototype=Object.create(x.prototype),A.prototype.constructor=A,D(A,x)}function D(A,x){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,n){return l.__proto__=n,l},D(A,x)}var T=function(A){P(x,A);function x(l){var n;return n=A.call(this,l,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var y=x.prototype;return y.registerListeners=function(){var n=this.hls;n.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(M.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){var n=this.hls;n.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(M.Events.ERROR,this.onError,this)},y.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,A.prototype.destroy.call(this)},y.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},y.onManifestParsed=function(n,r){this.tracks=r.audioTracks||[]},y.onAudioTrackLoaded=function(n,r){var c=r.id,f=r.details,e=this.tracksInGroup[c];if(!e){this.warn("Invalid audio track id "+c);return}var t=e.details;e.details=r.details,this.log("audioTrack "+c+" loaded ["+f.startSN+"-"+f.endSN+"]"),c===this.trackId&&(this.retryCount=0,this.playlistLoaded(c,r,t))},y.onLevelLoading=function(n,r){this.switchLevel(r.level)},y.onLevelSwitching=function(n,r){this.switchLevel(r.level)},y.switchLevel=function(n){var r=this.hls.levels[n];if(!!(r!=null&&r.audioGroupIds)){var c=r.audioGroupIds[r.urlId];if(this.groupId!==c){this.groupId=c;var f=this.tracks.filter(function(t){return!c||t.groupId===c});this.selectDefaultTrack&&!f.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=f;var e={audioTracks:f};this.log("Updating audio tracks, "+f.length+' track(s) found in "'+c+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,e),this.selectInitialTrack()}}},y.onError=function(n,r){A.prototype.onError.call(this,n,r),!(r.fatal||!r.context)&&r.context.type===C.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},y.setAudioTrack=function(n){var r=this.tracksInGroup;if(n<0||n>=r.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var c=r[this.trackId];this.log("Now switching to audio-track index "+n);var f=r[n],e=f.id,t=f.groupId,i=t===void 0?"":t,v=f.name,d=f.type,p=f.url;if(this.trackId=n,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:e,groupId:i,name:v,type:d,url:p}),!(f.details&&!f.details.live)){var s=this.switchParams(f.url,c==null?void 0:c.details);this.loadPlaylist(s)}},y.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var r=this.trackName,c=this.findTrackId(r)||this.findTrackId();c!==-1?this.setAudioTrack(c):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},y.findTrackId=function(n){for(var r=this.tracksInGroup,c=0;c<r.length;c++){var f=r[c];if((!this.selectDefaultTrack||f.default)&&(!n||n===f.name))return f.id}return-1},y.loadPlaylist=function(n){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var c=r.id,f=r.groupId,e=r.url;if(n)try{e=n.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+c),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:e,id:c,groupId:f,deliveryDirectives:n||null})}},R(x,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),x}(b.default);const S=T},"./src/controller/base-playlist-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>R});var M=u("./src/polyfills/number.ts"),I=u("./src/types/level.ts"),b=u("./src/controller/level-helper.ts"),C=u("./src/utils/logger.ts"),F=u("./src/errors.ts"),R=function(){function P(T,S){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=C.logger.log.bind(C.logger,S+":"),this.warn=C.logger.warn.bind(C.logger,S+":"),this.hls=T}var D=P.prototype;return D.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},D.onError=function(S,A){A.fatal&&A.type===F.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},D.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},D.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},D.stopLoad=function(){this.canLoad=!1,this.clearTimer()},D.switchParams=function(S,A){var x=A==null?void 0:A.renditionReports;if(x)for(var y=0;y<x.length;y++){var l=x[y],n=""+l.URI;if(n===S.slice(-n.length)){var r=parseInt(l["LAST-MSN"]),c=parseInt(l["LAST-PART"]);if(A&&this.hls.config.lowLatencyMode){var f=Math.min(A.age-A.partTarget,A.targetduration);c!==void 0&&f>A.partTarget&&(c+=1)}if((0,M.isFiniteNumber)(r))return new I.HlsUrlParameters(r,(0,M.isFiniteNumber)(c)?c:void 0,I.HlsSkip.No)}}},D.loadPlaylist=function(S){},D.shouldLoadTrack=function(S){return this.canLoad&&S&&!!S.url&&(!S.details||S.details.live)},D.playlistLoaded=function(S,A,x){var y=this,l=A.details,n=A.stats,r=n.loading.end?Math.max(0,self.performance.now()-n.loading.end):0;if(l.advancedDateTime=Date.now()-r,l.live||x!=null&&x.live){if(l.reloaded(x),x&&this.log("live playlist "+S+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),x&&l.fragments.length>0&&(0,b.mergeDetails)(x,l),!this.canLoad||!l.live)return;var c,f=void 0,e=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var t=this.hls.config.lowLatencyMode,i=l.lastPartSn,v=l.endSN,d=l.lastPartIndex,p=d!==-1,s=i===v,g=t?0:d;p?(f=s?v+1:i,e=s?g:d+1):f=v+1;var h=l.age,o=h+l.ageHeader,_=Math.min(o-l.partTarget,l.targetduration*1.5);if(_>0){if(x&&_>x.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+x.tuneInGoal+" to: "+_+" with playlist age: "+l.age),_=0;else{var O=Math.floor(_/l.targetduration);if(f+=O,e!==void 0){var k=Math.round(_%l.targetduration/l.partTarget);e+=k}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+h.toFixed(2)+"s goal: "+_+" skip sn "+O+" to part "+e)}l.tuneInGoal=_}if(c=this.getDeliveryDirectives(l,A.deliveryDirectives,f,e),t||!s){this.loadPlaylist(c);return}}else c=this.getDeliveryDirectives(l,A.deliveryDirectives,f,e);var K=(0,b.computeReloadInterval)(l,n);f!==void 0&&l.canBlockReload&&(K-=l.partTarget||1),this.log("reload live playlist "+S+" in "+Math.round(K)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(c)},K)}else this.clearTimer()},D.getDeliveryDirectives=function(S,A,x,y){var l=(0,I.getSkipValue)(S,x);return A!=null&&A.skip&&S.deltaUpdateFailed&&(x=A.msn,y=A.part,l=I.HlsSkip.No),new I.HlsUrlParameters(x,y,l)},D.retryLoadingOrFail=function(S){var A=this,x=this.hls.config,y=this.retryCount<x.levelLoadingMaxRetry;if(y){var l;if(this.retryCount++,S.details.indexOf("LoadTimeOut")>-1&&(l=S.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+S.details+'"'),this.loadPlaylist();else{var n=Math.min(Math.pow(2,this.retryCount)*x.levelLoadingRetryDelay,x.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return A.loadPlaylist()},n),this.warn("retry playlist loading #"+this.retryCount+" in "+n+' ms after "'+S.details+'"')}}else this.warn('cannot recover from error "'+S.details+'"'),this.clearTimer(),S.fatal=!0;return y},P}()},"./src/controller/base-stream-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{State:()=>v,default:()=>d});var M=u("./src/polyfills/number.ts"),I=u("./src/task-loop.ts"),b=u("./src/controller/fragment-tracker.ts"),C=u("./src/utils/buffer-helper.ts"),F=u("./src/utils/logger.ts"),R=u("./src/events.ts"),P=u("./src/errors.ts"),D=u("./src/types/transmuxer.ts"),T=u("./src/utils/mp4-tools.ts"),S=u("./src/utils/discontinuities.ts"),A=u("./src/controller/fragment-finders.ts"),x=u("./src/controller/level-helper.ts"),y=u("./src/loader/fragment-loader.ts"),l=u("./src/crypt/decrypter.ts"),n=u("./src/utils/time-ranges.ts"),r=u("./src/types/loader.ts");function c(p,s){for(var g=0;g<s.length;g++){var h=s[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(p,h.key,h)}}function f(p,s,g){return s&&c(p.prototype,s),g&&c(p,g),Object.defineProperty(p,"prototype",{writable:!1}),p}function e(p){if(p===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return p}function t(p,s){p.prototype=Object.create(s.prototype),p.prototype.constructor=p,i(p,s)}function i(p,s){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,o){return h.__proto__=o,h},i(p,s)}var v={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},d=function(p){t(s,p);function s(h,o,_){var O;return O=p.call(this)||this,O.hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=v.STOPPED,O.media=null,O.mediaBuffer=null,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=_,O.log=F.logger.log.bind(F.logger,_+":"),O.warn=F.logger.warn.bind(F.logger,_+":"),O.hls=h,O.fragmentLoader=new y.default(h.config),O.fragmentTracker=o,O.config=h.config,O.decrypter=new l.default(h,h.config),h.on(R.Events.KEY_LOADED,O.onKeyLoaded,e(O)),h.on(R.Events.LEVEL_SWITCHING,O.onLevelSwitching,e(O)),O}var g=s.prototype;return g.doTick=function(){this.onTickEnd()},g.onTickEnd=function(){},g.startLoad=function(o){},g.stopLoad=function(){this.fragmentLoader.abort();var o=this.fragCurrent;o&&this.fragmentTracker.removeFragment(o),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=v.STOPPED},g._streamEnded=function(o,_){var O=this.fragCurrent,k=this.fragmentTracker;if(!_.live&&O&&this.media&&O.sn>=_.endSN&&!o.nextStart){var K=_.partList;if(K!=null&&K.length){var N=K[K.length-1],W=C.BufferHelper.isBuffered(this.media,N.start+N.duration/2);return W}var H=k.getState(O);return H===b.FragmentState.PARTIAL||H===b.FragmentState.OK}return!1},g.onMediaAttached=function(o,_){var O=this.media=this.mediaBuffer=_.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var k=this.config;this.levels&&k.autoStartLoad&&this.state===v.STOPPED&&this.startLoad(k.startPosition)},g.onMediaDetaching=function(){var o=this.media;o!=null&&o.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),o&&this.onvseeking&&this.onvended&&(o.removeEventListener("seeking",this.onvseeking),o.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},g.onMediaSeeking=function(){var o=this.config,_=this.fragCurrent,O=this.media,k=this.mediaBuffer,K=this.state,N=O?O.currentTime:0,W=C.BufferHelper.bufferInfo(k||O,N,o.maxBufferHole);if(this.log("media seeking to "+((0,M.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+K),K===v.ENDED)this.resetLoadingState();else if(_&&!W.len){var H=o.maxFragLookUpTolerance,V=_.start-H,j=_.start+_.duration+H,z=N>j;(N<V||z)&&(z&&_.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),_.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=N),!this.loadedmetadata&&!W.len&&(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},g.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},g.onKeyLoaded=function(o,_){if(!(this.state!==v.KEY_LOADING||_.frag!==this.fragCurrent||!this.levels)){this.state=v.IDLE;var O=this.levels[_.frag.level].details;O&&this.loadFragment(_.frag,O,_.frag.start)}},g.onLevelSwitching=function(o,_){this.fragLoadError=0},g.onHandlerDestroying=function(){this.stopLoad(),p.prototype.onHandlerDestroying.call(this)},g.onHandlerDestroyed=function(){this.state=v.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,p.prototype.onHandlerDestroyed.call(this)},g.loadKey=function(o,_){this.log("Loading key for "+o.sn+" of ["+_.startSN+"-"+_.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+o.level),this.state=v.KEY_LOADING,this.fragCurrent=o,this.hls.trigger(R.Events.KEY_LOADING,{frag:o})},g.loadFragment=function(o,_,O){this._loadFragForPlayback(o,_,O)},g._loadFragForPlayback=function(o,_,O){var k=this,K=function(W){if(k.fragContextChanged(o)){k.warn("Fragment "+o.sn+(W.part?" p: "+W.part.index:"")+" of level "+o.level+" was dropped during download."),k.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,k._handleFragmentLoadProgress(W)};this._doFragLoad(o,_,O,K).then(function(N){if(!!N){k.fragLoadError=0;var W=k.state;if(k.fragContextChanged(o)){(W===v.FRAG_LOADING||!k.fragCurrent&&W===v.PARSING)&&(k.fragmentTracker.removeFragment(o),k.state=v.IDLE);return}"payload"in N&&(k.log("Loaded fragment "+o.sn+" of level "+o.level),k.hls.trigger(R.Events.FRAG_LOADED,N)),k._handleFragmentLoadComplete(N)}}).catch(function(N){k.state===v.STOPPED||k.state===v.ERROR||(k.warn(N),k.resetFragmentLoading(o))})},g.flushMainBuffer=function(o,_,O){if(O===void 0&&(O=null),!!(o-_)){var k={startOffset:o,endOffset:_,type:O};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,k)}},g._loadInitSegment=function(o){var _=this;this._doFragLoad(o).then(function(O){if(!O||_.fragContextChanged(o)||!_.levels)throw new Error("init load aborted");return O}).then(function(O){var k=_.hls,K=O.payload,N=o.decryptdata;if(K&&K.byteLength>0&&N&&N.key&&N.iv&&N.method==="AES-128"){var W=self.performance.now();return _.decrypter.webCryptoDecrypt(new Uint8Array(K),N.key.buffer,N.iv.buffer).then(function(H){var V=self.performance.now();return k.trigger(R.Events.FRAG_DECRYPTED,{frag:o,payload:H,stats:{tstart:W,tdecrypt:V}}),O.payload=H,O})}return O}).then(function(O){var k=_.fragCurrent,K=_.hls,N=_.levels;if(!N)throw new Error("init load aborted, missing levels");var W=N[o.level].details;console.assert(W,"Level details are defined when init segment is loaded");var H=o.stats;_.state=v.IDLE,_.fragLoadError=0,o.data=new Uint8Array(O.payload),H.parsing.start=H.buffering.start=self.performance.now(),H.parsing.end=H.buffering.end=self.performance.now(),O.frag===k&&K.trigger(R.Events.FRAG_BUFFERED,{stats:H,frag:k,part:null,id:o.type}),_.tick()}).catch(function(O){_.state===v.STOPPED||_.state===v.ERROR||(_.warn(O),_.resetFragmentLoading(o))})},g.fragContextChanged=function(o){var _=this.fragCurrent;return!o||!_||o.level!==_.level||o.sn!==_.sn||o.urlId!==_.urlId},g.fragBufferedComplete=function(o,_){var O,k,K=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+o.type+" sn: "+o.sn+(_?" part: "+_.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+o.level+" "+(K?n.default.toString(C.BufferHelper.getBuffered(K)):"(detached)")),this.state=v.IDLE,K&&(!this.loadedmetadata&&K.buffered.length&&((O=this.fragCurrent)===null||O===void 0?void 0:O.sn)===((k=this.fragPrevious)===null||k===void 0?void 0:k.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},g.seekToStartPos=function(){},g._handleFragmentLoadComplete=function(o){var _=this.transmuxer;if(!!_){var O=o.frag,k=o.part,K=o.partsLoaded,N=!K||K.length===0||K.some(function(H){return!H}),W=new D.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,k?k.index:-1,!N);_.flush(W)}},g._handleFragmentLoadProgress=function(o){},g._doFragLoad=function(o,_,O,k){var K=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(o.start,O||0),this.config.lowLatencyMode&&_){var N=_.partList;if(N&&k){O>o.end&&_.fragmentHint&&(o=_.fragmentHint);var W=this.getNextPart(N,o,O);if(W>-1){var H=N[W];return this.log("Loading part sn: "+o.sn+" p: "+H.index+" cc: "+o.cc+" of playlist ["+_.startSN+"-"+_.endSN+"] parts [0-"+W+"-"+(N.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+o.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=H.start+H.duration,this.state=v.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:o,part:N[W],targetBufferTime:O}),this.doFragPartsLoad(o,N,W,k).catch(function(V){return K.handleFragLoadError(V)})}else if(!o.url||this.loadedEndOfParts(N,O))return Promise.resolve(null)}}return this.log("Loading fragment "+o.sn+" cc: "+o.cc+" "+(_?"of ["+_.startSN+"-"+_.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+o.level+", target: "+parseFloat(O.toFixed(3))),(0,M.isFiniteNumber)(o.sn)&&!this.bitrateTest&&(this.nextLoadPosition=o.start+o.duration),this.state=v.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:o,targetBufferTime:O}),this.fragmentLoader.load(o,k).catch(function(V){return K.handleFragLoadError(V)})},g.doFragPartsLoad=function(o,_,O,k){var K=this;return new Promise(function(N,W){var H=[],V=function j(z){var $=_[z];K.fragmentLoader.loadPart(o,$,k).then(function(Y){H[$.index]=Y;var X=Y.part;K.hls.trigger(R.Events.FRAG_LOADED,Y);var Q=_[z+1];if(Q&&Q.fragment===o)j(z+1);else return N({frag:o,part:X,partsLoaded:H})}).catch(W)};V(O)})},g.handleFragLoadError=function(o){var _=o.data;return _&&_.details===P.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(_.frag,_.part):this.hls.trigger(R.Events.ERROR,_),null},g._handleTransmuxerFlush=function(o){var _=this.getCurrentContext(o);if(!_||this.state!==v.PARSING){this.fragCurrent||(this.state=v.IDLE);return}var O=_.frag,k=_.part,K=_.level,N=self.performance.now();O.stats.parsing.end=N,k&&(k.stats.parsing.end=N),this.updateLevelTiming(O,k,K,o.partial)},g.getCurrentContext=function(o){var _=this.levels,O=o.level,k=o.sn,K=o.part;if(!_||!_[O])return this.warn("Levels object was unset while buffering fragment "+k+" of level "+O+". The current chunk will not be buffered."),null;var N=_[O],W=K>-1?(0,x.getPartWith)(N,k,K):null,H=W?W.fragment:(0,x.getFragmentWithSN)(N,k,this.fragCurrent);return H?{frag:H,part:W,level:N}:null},g.bufferFragmentData=function(o,_,O,k){if(!(!o||this.state!==v.PARSING)){var K=o.data1,N=o.data2,W=K;if(K&&N&&(W=(0,T.appendUint8Array)(K,N)),!(!W||!W.length)){var H={type:o.type,frag:_,part:O,chunkMeta:k,parent:_.type,data:W};this.hls.trigger(R.Events.BUFFER_APPENDING,H),o.dropped&&o.independent&&!O&&this.flushBufferGap(_)}}},g.flushBufferGap=function(o){var _=this.media;if(!!_){if(!C.BufferHelper.isBuffered(_,_.currentTime)){this.flushMainBuffer(0,o.start);return}var O=_.currentTime,k=C.BufferHelper.bufferInfo(_,O,0),K=o.duration,N=Math.min(this.config.maxFragLookUpTolerance*2,K*.25),W=Math.max(Math.min(o.start-N,k.end-N),O+N);o.start-W>N&&this.flushMainBuffer(W,o.start)}},g.getFwdBufferInfo=function(o,_){var O=this.config,k=this.getLoadPosition();if(!(0,M.isFiniteNumber)(k))return null;var K=C.BufferHelper.bufferInfo(o,k,O.maxBufferHole);if(K.len===0&&K.nextStart!==void 0){var N=this.fragmentTracker.getBufferedFrag(k,_);if(N&&K.nextStart<N.end)return C.BufferHelper.bufferInfo(o,k,Math.max(K.nextStart,O.maxBufferHole))}return K},g.getMaxBufferLength=function(o){var _=this.config,O;return o?O=Math.max(8*_.maxBufferSize/o,_.maxBufferLength):O=_.maxBufferLength,Math.min(O,_.maxMaxBufferLength)},g.reduceMaxBufferLength=function(o){var _=this.config,O=o||_.maxBufferLength;return _.maxMaxBufferLength>=O?(_.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+_.maxMaxBufferLength+"s"),!0):!1},g.getNextFragment=function(o,_){var O=_.fragments,k=O.length;if(!k)return null;var K=this.config,N=O[0].start,W;if(_.live){var H=K.initialLiveManifestSize;if(k<H)return this.warn("Not enough fragments to start playback (have: "+k+", need: "+H+")"),null;!_.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(W=this.getInitialLiveFragment(_,O),this.startPosition=W?this.hls.liveSyncPosition||W.start:o)}else o<=N&&(W=O[0]);if(!W){var V=K.lowLatencyMode?_.partEnd:_.fragmentEnd;W=this.getFragmentAtPosition(o,V,_)}return this.mapToInitFragWhenRequired(W)},g.mapToInitFragWhenRequired=function(o){return o!=null&&o.initSegment&&!(o!=null&&o.initSegment.data)&&!this.bitrateTest?o.initSegment:o},g.getNextPart=function(o,_,O){for(var k=-1,K=!1,N=!0,W=0,H=o.length;W<H;W++){var V=o[W];if(N=N&&!V.independent,k>-1&&O<V.start)break;var j=V.loaded;!j&&(K||V.independent||N)&&V.fragment===_&&(k=W),K=j}return k},g.loadedEndOfParts=function(o,_){var O=o[o.length-1];return O&&_>O.start&&O.loaded},g.getInitialLiveFragment=function(o,_){var O=this.fragPrevious,k=null;if(O){if(o.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),k=(0,A.findFragmentByPDT)(_,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!k){var K=O.sn+1;if(K>=o.startSN&&K<=o.endSN){var N=_[K-o.startSN];O.cc===N.cc&&(k=N,this.log("Live playlist, switching playlist, load frag with next SN: "+k.sn))}k||(k=(0,A.findFragWithCC)(_,O.cc),k&&this.log("Live playlist, switching playlist, load frag with same CC: "+k.sn))}}else{var W=this.hls.liveSyncPosition;W!==null&&(k=this.getFragmentAtPosition(W,this.bitrateTest?o.fragmentEnd:o.edge,o))}return k},g.getFragmentAtPosition=function(o,_,O){var k=this.config,K=this.fragPrevious,N=O.fragments,W=O.endSN,H=O.fragmentHint,V=k.maxFragLookUpTolerance,j=!!(k.lowLatencyMode&&O.partList&&H);j&&H&&!this.bitrateTest&&(N=N.concat(H),W=H.sn);var z;if(o<_){var $=o>_-V?0:V;z=(0,A.findFragmentByPTS)(K,N,o,$)}else z=N[N.length-1];if(z){var Y=z.sn-O.startSN;if(this.fragmentTracker.getState(z)===b.FragmentState.OK&&(K=z),K&&z.sn===K.sn&&!j){var X=K&&z.level===K.level;if(X){var Q=N[Y+1];z.sn<W&&this.fragmentTracker.getState(Q)!==b.FragmentState.OK?(this.log("SN "+z.sn+" just loaded, load next one: "+Q.sn),z=Q):z=null}}}return z},g.synchronizeToLiveEdge=function(o){var _=this.config,O=this.media;if(!!O){var k=this.hls.liveSyncPosition,K=O.currentTime,N=o.fragments[0].start,W=o.edge,H=K>=N-_.maxFragLookUpTolerance&&K<=W;if(k!==null&&O.duration>k&&(K<k||!H)){var V=_.liveMaxLatencyDuration!==void 0?_.liveMaxLatencyDuration:_.liveMaxLatencyDurationCount*o.targetduration;(!H&&O.readyState<4||K<W-V)&&(this.loadedmetadata||(this.nextLoadPosition=k),O.readyState&&(this.warn("Playback: "+K.toFixed(3)+" is located too far from the end of live sliding playlist: "+W+", reset currentTime to : "+k.toFixed(3)),O.currentTime=k))}}},g.alignPlaylists=function(o,_){var O=this.levels,k=this.levelLastLoaded,K=this.fragPrevious,N=k!==null?O[k]:null,W=o.fragments.length;if(!W)return this.warn("No fragments in live playlist"),0;var H=o.fragments[0].start,V=!_,j=o.alignedSliding&&(0,M.isFiniteNumber)(H);if(V||!j&&!H){(0,S.alignStream)(K,N,o);var z=o.fragments[0].start;return this.log("Live playlist sliding: "+z.toFixed(2)+" start-sn: "+(_?_.startSN:"na")+"->"+o.startSN+" prev-sn: "+(K?K.sn:"na")+" fragments: "+W),z}return H},g.waitForCdnTuneIn=function(o){var _=3;return o.live&&o.canBlockReload&&o.partTarget&&o.tuneInGoal>Math.max(o.partHoldBack,o.partTarget*_)},g.setStartPosition=function(o,_){var O=this.startPosition;if(O<_&&(O=-1),O===-1||this.lastCurrentTime===-1){var k=o.startTimeOffset;(0,M.isFiniteNumber)(k)?(O=_+k,k<0&&(O+=o.totalduration),O=Math.min(Math.max(_,O),_+o.totalduration),this.log("Start time offset "+k+" found in playlist, adjust startPosition to "+O),this.startPosition=O):o.live?O=this.hls.liveSyncPosition||_:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},g.getLoadPosition=function(){var o=this.media,_=0;return this.loadedmetadata&&o?_=o.currentTime:this.nextLoadPosition&&(_=this.nextLoadPosition),_},g.handleFragLoadAborted=function(o,_){this.transmuxer&&o.sn!=="initSegment"&&o.stats.aborted&&(this.warn("Fragment "+o.sn+(_?" part"+_.index:"")+" of level "+o.level+" was aborted"),this.resetFragmentLoading(o))},g.resetFragmentLoading=function(o){(!this.fragCurrent||!this.fragContextChanged(o)&&this.state!==v.FRAG_LOADING_WAITING_RETRY)&&(this.state=v.IDLE)},g.onFragmentOrKeyLoadError=function(o,_){if(!_.fatal){var O=_.frag;if(!(!O||O.type!==o)){var k=this.fragCurrent;console.assert(k&&O.sn===k.sn&&O.level===k.level&&O.urlId===k.urlId,"Frag load error must match current frag to retry");var K=this.config;if(this.fragLoadError+1<=K.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var N=Math.min(Math.pow(2,this.fragLoadError)*K.fragLoadingRetryDelay,K.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+o+" "+O.level+" failed to load, retrying in "+N+"ms"),this.retryDate=self.performance.now()+N,this.fragLoadError++,this.state=v.FRAG_LOADING_WAITING_RETRY}else _.levelRetry?(o===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=v.IDLE):(F.logger.error(_.details+" reaches max retry, redispatch as fatal ..."),_.fatal=!0,this.hls.stopLoad(),this.state=v.ERROR)}}},g.afterBufferFlushed=function(o,_,O){if(!!o){var k=C.BufferHelper.getBuffered(o);this.fragmentTracker.detectEvictedFragments(_,k,O),this.state===v.ENDED&&this.resetLoadingState()}},g.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=v.IDLE},g.resetStartWhenNotLoaded=function(o){if(!this.loadedmetadata){this.startFragRequested=!1;var _=this.levels?this.levels[o].details:null;_!=null&&_.live?(this.startPosition=-1,this.setStartPosition(_,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},g.updateLevelTiming=function(o,_,O,k){var K=this,N=O.details;console.assert(!!N,"level.details must be defined");var W=Object.keys(o.elementaryStreams).reduce(function(H,V){var j=o.elementaryStreams[V];if(j){var z=j.endPTS-j.startPTS;if(z<=0)return K.warn("Could not parse fragment "+o.sn+" "+V+" duration reliably ("+z+")"),H||!1;var $=k?0:(0,x.updateFragPTSDTS)(N,o,j.startPTS,j.endPTS,j.startDTS,j.endDTS);return K.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:N,level:O,drift:$,type:V,frag:o,start:j.startPTS,end:j.endPTS}),!0}return H},!1);W||(this.warn("Found no media in fragment "+o.sn+" of level "+O.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=v.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:o,part:_})},g.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(s,[{key:"state",get:function(){return this._state},set:function(o){var _=this._state;_!==o&&(this._state=o,this.log(_+"->"+o))}}]),s}(I.default)},"./src/controller/buffer-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>A});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/utils/logger.ts"),C=u("./src/errors.ts"),F=u("./src/utils/buffer-helper.ts"),R=u("./src/utils/mediasource-helper.ts"),P=u("./src/loader/fragment.ts"),D=u("./src/controller/buffer-operation-queue.ts"),T=(0,R.getMediaSource)(),S=/([ha]vc.)(?:\.[^.,]+)+/,A=function(){function x(l){var n=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=n.hls,c=n.media,f=n.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),c&&(n.updateMediaElementDuration(),r.trigger(I.Events.MEDIA_ATTACHED,{media:c})),f&&f.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var y=x.prototype;return y.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},y.destroy=function(){this.unregisterListeners(),this.details=null},y.registerListeners=function(){var n=this.hls;n.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(I.Events.BUFFER_RESET,this.onBufferReset,this),n.on(I.Events.BUFFER_APPENDING,this.onBufferAppending,this),n.on(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.on(I.Events.BUFFER_EOS,this.onBufferEos,this),n.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),n.on(I.Events.FRAG_PARSED,this.onFragParsed,this),n.on(I.Events.FRAG_CHANGED,this.onFragChanged,this)},y.unregisterListeners=function(){var n=this.hls;n.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(I.Events.BUFFER_RESET,this.onBufferReset,this),n.off(I.Events.BUFFER_APPENDING,this.onBufferAppending,this),n.off(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.off(I.Events.BUFFER_EOS,this.onBufferEos,this),n.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),n.off(I.Events.FRAG_PARSED,this.onFragParsed,this),n.off(I.Events.FRAG_CHANGED,this.onFragChanged,this)},y._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new D.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},y.onManifestParsed=function(n,r){var c=2;(r.audio&&!r.video||!r.altAudio)&&(c=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=c,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},y.onMediaAttaching=function(n,r){var c=this.media=r.media;if(c&&T){var f=this.mediaSource=new T;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),c.src=self.URL.createObjectURL(f),this._objectUrl=c.src}},y.onMediaDetaching=function(){var n=this.media,r=this.mediaSource,c=this._objectUrl;if(r){if(b.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(f){b.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),n&&(c&&self.URL.revokeObjectURL(c),n.src===c?(n.removeAttribute("src"),n.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(I.Events.MEDIA_DETACHED,void 0)},y.onBufferReset=function(){var n=this;this.getSourceBufferTypes().forEach(function(r){var c=n.sourceBuffer[r];try{c&&(n.removeBufferListeners(r),n.mediaSource&&n.mediaSource.removeSourceBuffer(c),n.sourceBuffer[r]=void 0)}catch(f){b.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",f)}}),this._initSourceBuffer()},y.onBufferCodecs=function(n,r){var c=this,f=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(e){if(f){var t=c.tracks[e];if(t&&typeof t.buffer.changeType=="function"){var i=r[e],v=i.id,d=i.codec,p=i.levelCodec,s=i.container,g=i.metadata,h=(t.levelCodec||t.codec).replace(S,"$1"),o=(p||d).replace(S,"$1");if(h!==o){var _=s+";codecs="+(p||d);c.appendChangeType(e,_),b.logger.log("[buffer-controller]: switching codec "+h+" to "+o),c.tracks[e]={buffer:t.buffer,codec:d,container:s,levelCodec:p,metadata:g,id:v}}}}else c.pendingTracks[e]=r[e]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},y.appendChangeType=function(n,r){var c=this,f=this.operationQueue,e={execute:function(){var i=c.sourceBuffer[n];i&&(b.logger.log("[buffer-controller]: changing "+n+" sourceBuffer type to "+r),i.changeType(r)),f.shiftAndExecuteNext(n)},onStart:function(){},onComplete:function(){},onError:function(i){b.logger.warn("[buffer-controller]: Failed to change "+n+" SourceBuffer type",i)}};f.append(e,n)},y.onBufferAppending=function(n,r){var c=this,f=this.hls,e=this.operationQueue,t=this.tracks,i=r.data,v=r.type,d=r.frag,p=r.part,s=r.chunkMeta,g=s.buffering[v],h=self.performance.now();g.start=h;var o=d.stats.buffering,_=p?p.stats.buffering:null;o.start===0&&(o.start=h),_&&_.start===0&&(_.start=h);var O=t.audio,k=v==="audio"&&s.id===1&&(O==null?void 0:O.container)==="audio/mpeg",K={execute:function(){if(g.executeStart=self.performance.now(),k){var W=c.sourceBuffer[v];if(W){var H=d.start-W.timestampOffset;Math.abs(H)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+d.start+" (delta: "+H+") sn: "+d.sn+")"),W.timestampOffset=d.start)}}c.appendExecutor(i,v)},onStart:function(){},onComplete:function(){var W=self.performance.now();g.executeEnd=g.end=W,o.first===0&&(o.first=W),_&&_.first===0&&(_.first=W);var H=c.sourceBuffer,V={};for(var j in H)V[j]=F.BufferHelper.getBuffered(H[j]);c.appendError=0,c.hls.trigger(I.Events.BUFFER_APPENDED,{type:v,frag:d,part:p,chunkMeta:s,parent:d.type,timeRanges:V})},onError:function(W){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+v+" SourceBuffer",W);var H={type:C.ErrorTypes.MEDIA_ERROR,parent:d.type,details:C.ErrorDetails.BUFFER_APPEND_ERROR,err:W,fatal:!1};W.code===DOMException.QUOTA_EXCEEDED_ERR?H.details=C.ErrorDetails.BUFFER_FULL_ERROR:(c.appendError++,H.details=C.ErrorDetails.BUFFER_APPEND_ERROR,c.appendError>f.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),H.fatal=!0,f.stopLoad())),f.trigger(I.Events.ERROR,H)}};e.append(K,v)},y.onBufferFlushing=function(n,r){var c=this,f=this.operationQueue,e=function(i){return{execute:c.removeExecutor.bind(c,i,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){c.hls.trigger(I.Events.BUFFER_FLUSHED,{type:i})},onError:function(d){b.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",d)}}};r.type?f.append(e(r.type),r.type):this.getSourceBufferTypes().forEach(function(t){f.append(e(t),t)})},y.onFragParsed=function(n,r){var c=this,f=r.frag,e=r.part,t=[],i=e?e.elementaryStreams:f.elementaryStreams;i[P.ElementaryStreamTypes.AUDIOVIDEO]?t.push("audiovideo"):(i[P.ElementaryStreamTypes.AUDIO]&&t.push("audio"),i[P.ElementaryStreamTypes.VIDEO]&&t.push("video"));var v=function(){var p=self.performance.now();f.stats.buffering.end=p,e&&(e.stats.buffering.end=p);var s=e?e.stats:f.stats;c.hls.trigger(I.Events.FRAG_BUFFERED,{frag:f,part:e,stats:s,id:f.type})};t.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(v,t)},y.onFragChanged=function(n,r){this.flushBackBuffer()},y.onBufferEos=function(n,r){var c=this,f=this.getSourceBufferTypes().reduce(function(e,t){var i=c.sourceBuffer[t];return(!r.type||r.type===t)&&i&&!i.ended&&(i.ended=!0,b.logger.log("[buffer-controller]: "+t+" sourceBuffer now EOS")),e&&!!(!i||i.ended)},!0);f&&this.blockBuffers(function(){var e=c.mediaSource;!e||e.readyState!=="open"||e.endOfStream()})},y.onLevelUpdated=function(n,r){var c=r.details;!c.fragments.length||(this.details=c,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},y.flushBackBuffer=function(){var n=this.hls,r=this.details,c=this.media,f=this.sourceBuffer;if(!(!c||r===null)){var e=this.getSourceBufferTypes();if(!!e.length){var t=r.live&&n.config.liveBackBufferLength!==null?n.config.liveBackBufferLength:n.config.backBufferLength;if(!(!(0,M.isFiniteNumber)(t)||t<0)){var i=c.currentTime,v=r.levelTargetDuration,d=Math.max(t,v),p=Math.floor(i/v)*v-d;e.forEach(function(s){var g=f[s];if(g){var h=F.BufferHelper.getBuffered(g);h.length>0&&p>h.start(0)&&(n.trigger(I.Events.BACK_BUFFER_REACHED,{bufferEnd:p}),r.live&&n.trigger(I.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:p}),n.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:p,type:s}))}})}}}},y.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var n=this.details,r=this.hls,c=this.media,f=this.mediaSource,e=n.fragments[0].start+n.totalduration,t=c.duration,i=(0,M.isFiniteNumber)(f.duration)?f.duration:0;n.live&&r.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(n)):(e>i&&e>t||!(0,M.isFiniteNumber)(t))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+e.toFixed(3)),f.duration=e)}},y.updateSeekableRange=function(n){var r=this.mediaSource,c=n.fragments,f=c.length;if(f&&n.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var e=Math.max(0,c[0].start),t=Math.max(e,e+n.totalduration);r.setLiveSeekableRange(e,t)}},y.checkPendingTracks=function(){var n=this.bufferCodecEventsExpected,r=this.operationQueue,c=this.pendingTracks,f=Object.keys(c).length;if(f&&!n||f===2){this.createSourceBuffers(c),this.pendingTracks={};var e=this.getSourceBufferTypes();if(e.length===0){this.hls.trigger(I.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}e.forEach(function(t){r.executeNext(t)})}},y.createSourceBuffers=function(n){var r=this.sourceBuffer,c=this.mediaSource;if(!c)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var e in n)if(!r[e]){var t=n[e];if(!t)throw Error("source buffer exists for track "+e+", however track does not");var i=t.levelCodec||t.codec,v=t.container+";codecs="+i;b.logger.log("[buffer-controller]: creating sourceBuffer("+v+")");try{var d=r[e]=c.addSourceBuffer(v),p=e;this.addBufferListener(p,"updatestart",this._onSBUpdateStart),this.addBufferListener(p,"updateend",this._onSBUpdateEnd),this.addBufferListener(p,"error",this._onSBUpdateError),this.tracks[e]={buffer:d,codec:i,container:t.container,levelCodec:t.levelCodec,metadata:t.metadata,id:t.id},f++}catch(s){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+s.message),this.hls.trigger(I.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,mimeType:v})}}f&&this.hls.trigger(I.Events.BUFFER_CREATED,{tracks:this.tracks})},y._onSBUpdateStart=function(n){var r=this.operationQueue,c=r.current(n);c.onStart()},y._onSBUpdateEnd=function(n){var r=this.operationQueue,c=r.current(n);c.onComplete(),r.shiftAndExecuteNext(n)},y._onSBUpdateError=function(n,r){b.logger.error("[buffer-controller]: "+n+" SourceBuffer error",r),this.hls.trigger(I.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var c=this.operationQueue.current(n);c&&c.onError(r)},y.removeExecutor=function(n,r,c){var f=this.media,e=this.mediaSource,t=this.operationQueue,i=this.sourceBuffer,v=i[n];if(!f||!e||!v){b.logger.warn("[buffer-controller]: Attempting to remove from the "+n+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(n);return}var d=(0,M.isFiniteNumber)(f.duration)?f.duration:1/0,p=(0,M.isFiniteNumber)(e.duration)?e.duration:1/0,s=Math.max(0,r),g=Math.min(c,d,p);g>s?(b.logger.log("[buffer-controller]: Removing ["+s+","+g+"] from the "+n+" SourceBuffer"),console.assert(!v.updating,n+" sourceBuffer must not be updating"),v.remove(s,g)):t.shiftAndExecuteNext(n)},y.appendExecutor=function(n,r){var c=this.operationQueue,f=this.sourceBuffer,e=f[r];if(!e){b.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),c.shiftAndExecuteNext(r);return}e.ended=!1,console.assert(!e.updating,r+" sourceBuffer must not be updating"),e.appendBuffer(n)},y.blockBuffers=function(n,r){var c=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(n);return}var f=this.operationQueue,e=r.map(function(t){return f.appendBlocker(t)});Promise.all(e).then(function(){n(),r.forEach(function(t){var i=c.sourceBuffer[t];(!i||!i.updating)&&f.shiftAndExecuteNext(t)})})},y.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},y.addBufferListener=function(n,r,c){var f=this.sourceBuffer[n];if(!!f){var e=c.bind(this,n);this.listeners[n].push({event:r,listener:e}),f.addEventListener(r,e)}},y.removeBufferListeners=function(n){var r=this.sourceBuffer[n];!r||this.listeners[n].forEach(function(c){r.removeEventListener(c.event,c.listener)})},x}()},"./src/controller/buffer-operation-queue.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>I});var M=u("./src/utils/logger.ts"),I=function(){function b(F){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=F}var C=b.prototype;return C.append=function(R,P){var D=this.queues[P];D.push(R),D.length===1&&this.buffers[P]&&this.executeNext(P)},C.insertAbort=function(R,P){var D=this.queues[P];D.unshift(R),this.executeNext(P)},C.appendBlocker=function(R){var P,D=new Promise(function(S){P=S}),T={execute:P,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(T,R),D},C.executeNext=function(R){var P=this.buffers,D=this.queues,T=P[R],S=D[R];if(S.length){var A=S[0];try{A.execute()}catch(x){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),A.onError(x),(!T||!T.updating)&&(S.shift(),this.executeNext(R))}}},C.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},C.current=function(R){return this.queues[R][0]},b}()},"./src/controller/cap-level-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>F});var M=u("./src/events.ts");function I(R,P){for(var D=0;D<P.length;D++){var T=P[D];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function b(R,P,D){return P&&I(R.prototype,P),D&&I(R,D),Object.defineProperty(R,"prototype",{writable:!1}),R}var C=function(){function R(D){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=D,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var P=R.prototype;return P.setStreamController=function(T){this.streamController=T},P.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},P.registerListeners=function(){var T=this.hls;T.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.unregisterListener=function(){var T=this.hls;T.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},P.onFpsDropLevelCapping=function(T,S){R.isLevelAllowed(S.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(S.droppedLevel)},P.onMediaAttaching=function(T,S){this.media=S.media instanceof HTMLVideoElement?S.media:null},P.onManifestParsed=function(T,S){var A=this.hls;this.restrictedLevels=[],this.firstLevel=S.firstLevel,A.config.capLevelToPlayerSize&&S.video&&this.startCapping()},P.onBufferCodecs=function(T,S){var A=this.hls;A.config.capLevelToPlayerSize&&S.video&&this.startCapping()},P.onMediaDetaching=function(){this.stopCapping()},P.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var T=this.hls.levels;if(T.length){var S=this.hls;S.autoLevelCapping=this.getMaxLevel(T.length-1),S.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=S.autoLevelCapping}}},P.getMaxLevel=function(T){var S=this,A=this.hls.levels;if(!A.length)return-1;var x=A.filter(function(y,l){return R.isLevelAllowed(l,S.restrictedLevels)&&l<=T});return this.clientRect=null,R.getMaxLevelByMediaSize(x,this.mediaWidth,this.mediaHeight)},P.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},P.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},P.getDimensions=function(){if(this.clientRect)return this.clientRect;var T=this.media,S={width:0,height:0};if(T){var A=T.getBoundingClientRect();S.width=A.width,S.height=A.height,!S.width&&!S.height&&(S.width=A.right-A.left||T.width||0,S.height=A.bottom-A.top||T.height||0)}return this.clientRect=S,S},R.isLevelAllowed=function(T,S){return S===void 0&&(S=[]),S.indexOf(T)===-1},R.getMaxLevelByMediaSize=function(T,S,A){if(!T||!T.length)return-1;for(var x=function(c,f){return f?c.width!==f.width||c.height!==f.height:!0},y=T.length-1,l=0;l<T.length;l+=1){var n=T[l];if((n.width>=S||n.height>=A)&&x(n,T[l+1])){y=l;break}}return y},b(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var T=1;if(!this.hls.config.ignoreDevicePixelRatio)try{T=self.devicePixelRatio}catch{}return T}}]),R}();const F=C},"./src/controller/cmcd-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>A});var M=u("./src/events.ts"),I=u("./src/types/cmcd.ts"),b=u("./src/utils/buffer-helper.ts"),C=u("./src/utils/logger.ts");function F(x,y){for(var l=0;l<y.length;l++){var n=y[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(x,n.key,n)}}function R(x,y,l){return y&&F(x.prototype,y),l&&F(x,l),Object.defineProperty(x,"prototype",{writable:!1}),x}function P(x,y){var l=typeof Symbol<"u"&&x[Symbol.iterator]||x["@@iterator"];if(l)return(l=l.call(x)).next.bind(l);if(Array.isArray(x)||(l=D(x))||y&&x&&typeof x.length=="number"){l&&(x=l);var n=0;return function(){return n>=x.length?{done:!0}:{done:!1,value:x[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D(x,y){if(!!x){if(typeof x=="string")return T(x,y);var l=Object.prototype.toString.call(x).slice(8,-1);if(l==="Object"&&x.constructor&&(l=x.constructor.name),l==="Map"||l==="Set")return Array.from(x);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return T(x,y)}}function T(x,y){(y==null||y>x.length)&&(y=x.length);for(var l=0,n=new Array(y);l<y;l++)n[l]=x[l];return n}function S(){return S=Object.assign?Object.assign.bind():function(x){for(var y=1;y<arguments.length;y++){var l=arguments[y];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(x[n]=l[n])}return x},S.apply(this,arguments)}var A=function(){function x(l){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(f){try{n.apply(f,{ot:I.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(e){C.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(f){try{var e=f.frag,t=n.hls.levels[e.level],i=n.getObjectType(e),v={d:e.duration*1e3,ot:i};(i===I.CMCDObjectType.VIDEO||i===I.CMCDObjectType.AUDIO||i==I.CMCDObjectType.MUXED)&&(v.br=t.bitrate/1e3,v.tb=n.getTopBandwidth(i)/1e3,v.bl=n.getBufferLength(i)),n.apply(f,v)}catch(d){C.logger.warn("Could not generate segment CMCD data.",d)}},this.hls=l;var r=this.config=l.config,c=r.cmcd;c!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=c.sessionId||x.uuid(),this.cid=c.contentId,this.useHeaders=c.useHeaders===!0,this.registerListeners())}var y=x.prototype;return y.registerListeners=function(){var n=this.hls;n.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},y.unregisterListeners=function(){var n=this.hls;n.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},y.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},y.onMediaAttached=function(n,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},y.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},y.onBufferCreated=function(n,r){var c,f;this.audioBuffer=(c=r.tracks.audio)===null||c===void 0?void 0:c.buffer,this.videoBuffer=(f=r.tracks.video)===null||f===void 0?void 0:f.buffer},y.createData=function(){var n;return{v:I.CMCDVersion,sf:I.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(n=this.media)===null||n===void 0?void 0:n.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},y.apply=function(n,r){r===void 0&&(r={}),S(r,this.createData());var c=r.ot===I.CMCDObjectType.INIT||r.ot===I.CMCDObjectType.VIDEO||r.ot===I.CMCDObjectType.MUXED;if(this.starved&&c&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering),this.useHeaders){var f=x.toHeaders(r);if(!Object.keys(f).length)return;n.headers||(n.headers={}),S(n.headers,f)}else{var e=x.toQuery(r);if(!e)return;n.url=x.appendQueryToUri(n.url,e)}},y.getObjectType=function(n){var r=n.type;if(r==="subtitle")return I.CMCDObjectType.TIMED_TEXT;if(n.sn==="initSegment")return I.CMCDObjectType.INIT;if(r==="audio")return I.CMCDObjectType.AUDIO;if(r==="main")return this.hls.audioTracks.length?I.CMCDObjectType.VIDEO:I.CMCDObjectType.MUXED},y.getTopBandwidth=function(n){var r=0,c,f=this.hls;if(n===I.CMCDObjectType.AUDIO)c=f.audioTracks;else{var e=f.maxAutoLevel,t=e>-1?e+1:f.levels.length;c=f.levels.slice(0,t)}for(var i=P(c),v;!(v=i()).done;){var d=v.value;d.bitrate>r&&(r=d.bitrate)}return r>0?r:NaN},y.getBufferLength=function(n){var r=this.hls.media,c=n===I.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!c||!r)return NaN;var f=b.BufferHelper.bufferInfo(c,r.currentTime,this.config.maxBufferHole);return f.len*1e3},y.createPlaylistLoader=function(){var n=this.config.pLoader,r=this.applyPlaylistData,c=n||this.config.loader;return function(){function f(t){this.loader=void 0,this.loader=new c(t)}var e=f.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(i,v,d){r(i),this.loader.load(i,v,d)},R(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},y.createFragmentLoader=function(){var n=this.config.fLoader,r=this.applyFragmentData,c=n||this.config.loader;return function(){function f(t){this.loader=void 0,this.loader=new c(t)}var e=f.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(i,v,d){r(i),this.loader.load(i,v,d)},R(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},x.uuid=function(){var n=URL.createObjectURL(new Blob),r=n.toString();return URL.revokeObjectURL(n),r.slice(r.lastIndexOf("/")+1)},x.serialize=function(n){for(var r=[],c=function(k){return!Number.isNaN(k)&&k!=null&&k!==""&&k!==!1},f=function(k){return Math.round(k)},e=function(k){return f(k/100)*100},t=function(k){return encodeURIComponent(k)},i={br:f,d:f,bl:e,dl:e,mtp:e,nor:t,rtp:e,tb:f},v=Object.keys(n||{}).sort(),d=P(v),p;!(p=d()).done;){var s=p.value,g=n[s];if(!!c(g)&&!(s==="v"&&g===1)&&!(s=="pr"&&g===1)){var h=i[s];h&&(g=h(g));var o=typeof g,_=void 0;s==="ot"||s==="sf"||s==="st"?_=s+"="+g:o==="boolean"?_=s:o==="number"?_=s+"="+g:_=s+"="+JSON.stringify(g),r.push(_)}}return r.join(",")},x.toHeaders=function(n){for(var r=Object.keys(n),c={},f=["Object","Request","Session","Status"],e=[{},{},{},{}],t={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,v=r;i<v.length;i++){var d=v[i],p=t[d]!=null?t[d]:1;e[p][d]=n[d]}for(var s=0;s<e.length;s++){var g=x.serialize(e[s]);g&&(c["CMCD-"+f[s]]=g)}return c},x.toQuery=function(n){return"CMCD="+encodeURIComponent(x.serialize(n))},x.appendQueryToUri=function(n,r){if(!r)return n;var c=n.includes("?")?"&":"?";return""+n+c+r},x}()},"./src/controller/eme-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>A});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/utils/logger.ts"),C=u("./src/utils/mediakeys-helper.ts");function F(x,y){for(var l=0;l<y.length;l++){var n=y[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(x,n.key,n)}}function R(x,y,l){return y&&F(x.prototype,y),l&&F(x,l),Object.defineProperty(x,"prototype",{writable:!1}),x}var P=3,D=function(y,l,n){var r={audioCapabilities:[],videoCapabilities:[]};return y.forEach(function(c){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+c+'"',robustness:n.audioRobustness||""})}),l.forEach(function(c){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+c+'"',robustness:n.videoRobustness||""})}),[r]},T=function(y,l,n,r){switch(y){case C.KeySystems.WIDEVINE:return D(l,n,r);default:throw new Error("Unknown key-system: "+y)}},S=function(){function x(l){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=l,this._config=l.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var y=x.prototype;return y.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},y._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},y._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},y.getLicenseServerUrl=function(n){switch(n){case C.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},y._attemptKeySystemAccess=function(n,r,c){var f=this,e=T(n,r,c,this._drmSystemOptions);b.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(n,e);this.mediaKeysPromise=t.then(function(i){return f._onMediaKeySystemAccessObtained(n,i)}),t.catch(function(i){b.logger.error('Failed to obtain key-system "'+n+'" access:',i)})},y._onMediaKeySystemAccessObtained=function(n,r){var c=this;b.logger.log('Access for key-system "'+n+'" obtained');var f={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:r,mediaKeySystemDomain:n};this._mediaKeysList.push(f);var e=Promise.resolve().then(function(){return r.createMediaKeys()}).then(function(t){return f.mediaKeys=t,b.logger.log('Media-keys created for key-system "'+n+'"'),c._onMediaKeysCreated(),t});return e.catch(function(t){b.logger.error("Failed to create media-keys:",t)}),e},y._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(r){r.mediaKeysSession||(r.mediaKeysSession=r.mediaKeys.createSession(),n._onNewMediaKeySession(r.mediaKeysSession))})},y._onNewMediaKeySession=function(n){var r=this;b.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(c){r._onKeySessionMessage(n,c.message)},!1)},y._onKeySessionMessage=function(n,r){b.logger.log("Got EME message event, creating license request"),this._requestLicense(r,function(c){b.logger.log("Received license data (length: "+(c&&c.byteLength)+"), updating key-session"),n.update(c).catch(function(f){b.logger.warn("Updating key-session failed: "+f)})})},y.onMediaEncrypted=function(n){var r=this;if(b.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var c=function(e){!r._media||(r._attemptSetMediaKeys(e),r._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(c).catch(c)},y._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var r=this._mediaKeysList[0];if(!r||!r.mediaKeys){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}b.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(r.mediaKeys),this._hasSetMediaKeys=!0}},y._generateRequestWithPreferredKeySession=function(n,r){var c=this,f=this._mediaKeysList[0];if(!f){b.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(f.mediaKeysSessionInitialized){b.logger.warn("Key-Session already initialized but requested again");return}var e=f.mediaKeysSession;if(!e){b.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!r){b.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}b.logger.log('Generating key-session request for "'+n+'" init data type'),f.mediaKeysSessionInitialized=!0,e.generateRequest(n,r).then(function(){b.logger.debug("Key-session generation succeeded")}).catch(function(t){b.logger.error("Error generating key-session request:",t),c.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},y._createLicenseXhr=function(n,r,c){var f=new XMLHttpRequest;f.responseType="arraybuffer",f.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,f,n,r,c);var e=this._licenseXhrSetup;if(e)try{e.call(this.hls,f,n),e=void 0}catch(t){b.logger.error(t)}try{f.readyState||f.open("POST",n,!0),e&&e.call(this.hls,f,n)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return f},y._onLicenseRequestReadyStageChange=function(n,r,c,f){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,b.logger.log("License request succeeded");var e=n.response,t=this._licenseResponseCallback;if(t)try{e=t.call(this.hls,n,r)}catch(v){b.logger.error(v)}f(e)}else{if(b.logger.error("License Request XHR failed ("+r+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>P){this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var i=P-this._requestLicenseFailureCount+1;b.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(c,f)}break}},y._generateLicenseRequestChallenge=function(n,r){switch(n.mediaKeySystemDomain){case C.KeySystems.WIDEVINE:return r}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},y._requestLicense=function(n,r){b.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c){b.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var f=this.getLicenseServerUrl(c.mediaKeySystemDomain),e=this._createLicenseXhr(f,n,r);b.logger.log("Sending license request to URL: "+f);var t=this._generateLicenseRequestChallenge(c,n);e.send(t)}catch(i){b.logger.error("Failure requesting DRM license: "+i),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},y.onMediaAttached=function(n,r){if(!!this._emeEnabled){var c=r.media;this._media=c,c.addEventListener("encrypted",this._onMediaEncrypted)}},y.onMediaDetached=function(){var n=this._media,r=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(r.map(function(c){if(c.mediaKeysSession)return c.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},y.onManifestParsed=function(n,r){if(!!this._emeEnabled){var c=r.levels.map(function(e){return e.audioCodec}).filter(function(e){return!!e}),f=r.levels.map(function(e){return e.videoCodec}).filter(function(e){return!!e});this._attemptKeySystemAccess(C.KeySystems.WIDEVINE,c,f)}},R(x,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),x}();const A=S},"./src/controller/fps-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>C});var M=u("./src/events.ts"),I=u("./src/utils/logger.ts"),b=function(){function F(P){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=P,this.registerListeners()}var R=F.prototype;return R.setStreamController=function(D){this.streamController=D},R.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(D,T){var S=this.hls.config;if(S.capLevelOnFPSDrop){var A=T.media instanceof self.HTMLVideoElement?T.media:null;this.media=A,A&&typeof A.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(D,T,S){var A=performance.now();if(T){if(this.lastTime){var x=A-this.lastTime,y=S-this.lastDroppedFrames,l=T-this.lastDecodedFrames,n=1e3*y/x,r=this.hls;if(r.trigger(M.Events.FPS_DROP,{currentDropped:y,currentDecoded:l,totalDroppedFrames:S}),n>0&&y>r.config.fpsDroppedMonitoringThreshold*l){var c=r.currentLevel;I.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(r.autoLevelCapping===-1||r.autoLevelCapping>=c)&&(c=c-1,r.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:r.currentLevel}),r.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=A,this.lastDroppedFrames=S,this.lastDecodedFrames=T}},R.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var T=D.getVideoPlaybackQuality();this.checkFPS(D,T.totalVideoFrames,T.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},F}();const C=b},"./src/controller/fragment-finders.ts":(G,B,u)=>{u.r(B),u.d(B,{findFragWithCC:()=>P,findFragmentByPDT:()=>b,findFragmentByPTS:()=>C,fragmentWithinToleranceTest:()=>F,pdtWithinToleranceTest:()=>R});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/binary-search.ts");function b(D,T,S){if(T===null||!Array.isArray(D)||!D.length||!(0,M.isFiniteNumber)(T))return null;var A=D[0].programDateTime;if(T<(A||0))return null;var x=D[D.length-1].endProgramDateTime;if(T>=(x||0))return null;S=S||0;for(var y=0;y<D.length;++y){var l=D[y];if(R(T,S,l))return l}return null}function C(D,T,S,A){S===void 0&&(S=0),A===void 0&&(A=0);var x=null;if(D?x=T[D.sn-T[0].sn+1]||null:S===0&&T[0].start===0&&(x=T[0]),x&&F(S,A,x)===0)return x;var y=I.default.search(T,F.bind(null,S,A));return y||x}function F(D,T,S){D===void 0&&(D=0),T===void 0&&(T=0);var A=Math.min(T,S.duration+(S.deltaPTS?S.deltaPTS:0));return S.start+S.duration-A<=D?1:S.start-A>D&&S.start?-1:0}function R(D,T,S){var A=Math.min(T,S.duration+(S.deltaPTS?S.deltaPTS:0))*1e3,x=S.endProgramDateTime||0;return x-A>D}function P(D,T){return I.default.search(D,function(S){return S.cc<T?1:S.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":(G,B,u)=>{u.r(B),u.d(B,{FragmentState:()=>b,FragmentTracker:()=>C});var M=u("./src/events.ts"),I=u("./src/types/loader.ts"),b;(function(P){P.NOT_LOADED="NOT_LOADED",P.APPENDING="APPENDING",P.PARTIAL="PARTIAL",P.OK="OK"})(b||(b={}));var C=function(){function P(T){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=T,this._registerListeners()}var D=P.prototype;return D._registerListeners=function(){var S=this.hls;S.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},D._unregisterListeners=function(){var S=this.hls;S.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},D.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},D.getAppendedFrag=function(S,A){if(A===I.PlaylistLevelType.MAIN){var x=this.activeFragment,y=this.activeParts;if(!x)return null;if(y)for(var l=y.length;l--;){var n=y[l],r=n?n.end:x.appendedPTS;if(n.start<=S&&r!==void 0&&S<=r)return l>9&&(this.activeParts=y.slice(l-9)),n}else if(x.start<=S&&x.appendedPTS!==void 0&&S<=x.appendedPTS)return x}return this.getBufferedFrag(S,A)},D.getBufferedFrag=function(S,A){for(var x=this.fragments,y=Object.keys(x),l=y.length;l--;){var n=x[y[l]];if((n==null?void 0:n.body.type)===A&&n.buffered){var r=n.body;if(r.start<=S&&S<=r.end)return r}}return null},D.detectEvictedFragments=function(S,A,x){var y=this;Object.keys(this.fragments).forEach(function(l){var n=y.fragments[l];if(!!n){if(!n.buffered){n.body.type===x&&y.removeFragment(n.body);return}var r=n.range[S];!r||r.time.some(function(c){var f=!y.isTimeBuffered(c.startPTS,c.endPTS,A);return f&&y.removeFragment(n.body),f})}})},D.detectPartialFragments=function(S){var A=this,x=this.timeRanges,y=S.frag,l=S.part;if(!(!x||y.sn==="initSegment")){var n=R(y),r=this.fragments[n];!r||(Object.keys(x).forEach(function(c){var f=y.elementaryStreams[c];if(!!f){var e=x[c],t=l!==null||f.partial===!0;r.range[c]=A.getBufferedTimes(y,l,t,e)}}),r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},D.fragBuffered=function(S){var A=R(S),x=this.fragments[A];x&&(x.loaded=null,x.buffered=!0)},D.getBufferedTimes=function(S,A,x,y){for(var l={time:[],partial:x},n=A?A.start:S.start,r=A?A.end:S.end,c=S.minEndPTS||r,f=S.maxStartPTS||n,e=0;e<y.length;e++){var t=y.start(e)-this.bufferPadding,i=y.end(e)+this.bufferPadding;if(f>=t&&c<=i){l.time.push({startPTS:Math.max(n,y.start(e)),endPTS:Math.min(r,y.end(e))});break}else if(n<i&&r>t)l.partial=!0,l.time.push({startPTS:Math.max(n,y.start(e)),endPTS:Math.min(r,y.end(e))});else if(r<=t)break}return l},D.getPartialFragment=function(S){var A=null,x,y,l,n=0,r=this.bufferPadding,c=this.fragments;return Object.keys(c).forEach(function(f){var e=c[f];!e||F(e)&&(y=e.body.start-r,l=e.body.end+r,S>=y&&S<=l&&(x=Math.min(S-y,l-S),n<=x&&(A=e.body,n=x)))}),A},D.getState=function(S){var A=R(S),x=this.fragments[A];return x?x.buffered?F(x)?b.PARTIAL:b.OK:b.APPENDING:b.NOT_LOADED},D.isTimeBuffered=function(S,A,x){for(var y,l,n=0;n<x.length;n++){if(y=x.start(n)-this.bufferPadding,l=x.end(n)+this.bufferPadding,S>=y&&A<=l)return!0;if(A<=y)return!1}return!1},D.onFragLoaded=function(S,A){var x=A.frag,y=A.part;if(!(x.sn==="initSegment"||x.bitrateTest||y)){var l=R(x);this.fragments[l]={body:x,loaded:A,buffered:!1,range:Object.create(null)}}},D.onBufferAppended=function(S,A){var x=this,y=A.frag,l=A.part,n=A.timeRanges;if(y.type===I.PlaylistLevelType.MAIN)if(this.activeFragment=y,l){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(l)}else this.activeParts=null;this.timeRanges=n,Object.keys(n).forEach(function(c){var f=n[c];if(x.detectEvictedFragments(c,f),!l)for(var e=0;e<f.length;e++)y.appendedPTS=Math.max(f.end(e),y.appendedPTS||0)})},D.onFragBuffered=function(S,A){this.detectPartialFragments(A)},D.hasFragment=function(S){var A=R(S);return!!this.fragments[A]},D.removeFragmentsInRange=function(S,A,x){var y=this;Object.keys(this.fragments).forEach(function(l){var n=y.fragments[l];if(!!n&&n.buffered){var r=n.body;r.type===x&&r.start<A&&r.end>S&&y.removeFragment(r)}})},D.removeFragment=function(S){var A=R(S);S.stats.loaded=0,S.clearElementaryStreamInfo(),delete this.fragments[A]},D.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},P}();function F(P){var D,T;return P.buffered&&(((D=P.range.video)===null||D===void 0?void 0:D.partial)||((T=P.range.audio)===null||T===void 0?void 0:T.partial))}function R(P){return P.type+"_"+P.level+"_"+P.urlId+"_"+P.sn}},"./src/controller/gap-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{MAX_START_GAP_JUMP:()=>R,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>P,SKIP_BUFFER_RANGE_START:()=>D,STALL_MINIMUM_DURATION_MS:()=>F,default:()=>T});var M=u("./src/utils/buffer-helper.ts"),I=u("./src/errors.ts"),b=u("./src/events.ts"),C=u("./src/utils/logger.ts"),F=250,R=2,P=.1,D=.05,T=function(){function S(x,y,l,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=x,this.media=y,this.fragmentTracker=l,this.hls=n}var A=S.prototype;return A.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},A.poll=function(y,l){var n=this.config,r=this.media,c=this.stalled;if(r!==null){var f=r.currentTime,e=r.seeking,t=this.seeking&&!e,i=!this.seeking&&e;if(this.seeking=e,f!==y){if(this.moved=!0,c!==null){if(this.stallReported){var v=self.performance.now()-c;C.logger.warn("playback not stuck anymore @"+f+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||t)&&(this.stalled=null),!(r.paused&&!e||r.ended||r.playbackRate===0||!M.BufferHelper.getBuffered(r).length)){var d=M.BufferHelper.bufferInfo(r,f,0),p=d.len>0,s=d.nextStart||0;if(!(!p&&!s)){if(e){var g=d.len>R,h=!s||l&&l.start<=f||s-f>R&&!this.fragmentTracker.getPartialFragment(f);if(g||h)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var o,_=Math.max(s,d.start||0)-f,O=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,k=O==null||(o=O.details)===null||o===void 0?void 0:o.live,K=k?O.details.targetduration*2:R;if(_>0&&_<=K){this._trySkipBufferHole(null);return}}var N=self.performance.now();if(c===null){this.stalled=N;return}var W=N-c;if(!(!e&&W>=F&&(this._reportStall(d),!this.media))){var H=M.BufferHelper.bufferInfo(r,f,n.maxBufferHole);this._tryFixBufferStall(H,W)}}}}},A._tryFixBufferStall=function(y,l){var n=this.config,r=this.fragmentTracker,c=this.media;if(c!==null){var f=c.currentTime,e=r.getPartialFragment(f);if(e){var t=this._trySkipBufferHole(e);if(t||!this.media)return}y.len>n.maxBufferHole&&l>n.highBufferWatchdogPeriod*1e3&&(C.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},A._reportStall=function(y){var l=this.hls,n=this.media,r=this.stallReported;!r&&n&&(this.stallReported=!0,C.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer ("+JSON.stringify(y)+")"),l.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y.len}))},A._trySkipBufferHole=function(y){var l=this.config,n=this.hls,r=this.media;if(r===null)return 0;for(var c=r.currentTime,f=0,e=M.BufferHelper.getBuffered(r),t=0;t<e.length;t++){var i=e.start(t);if(c+l.maxBufferHole>=f&&c<i){var v=Math.max(i+D,r.currentTime+P);return C.logger.warn("skipping hole, adjusting currentTime from "+c+" to "+v),this.moved=!0,this.stalled=null,r.currentTime=v,y&&n.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+c+" to "+v,frag:y}),v}f=e.end(t)}return 0},A._tryNudgeBuffer=function(){var y=this.config,l=this.hls,n=this.media,r=this.nudgeRetry;if(n!==null){var c=n.currentTime;if(this.nudgeRetry++,r<y.nudgeMaxRetry){var f=c+(r+1)*y.nudgeOffset;C.logger.warn("Nudging 'currentTime' from "+c+" to "+f),n.currentTime=f,l.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else C.logger.error("Playhead still not moving while enough data buffered @"+c+" after "+y.nudgeMaxRetry+" nudges"),l.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},S}()},"./src/controller/id3-track-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>y});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/utils/texttrack-utils.ts"),C=u("./src/demux/id3.ts"),F=u("./src/loader/date-range.ts"),R=u("./src/types/demuxer.ts"),P=.25;function D(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var T=function(){var l=D();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function S(l,n){return l.getTime()/1e3-n}function A(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var x=function(){function l(r){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=r,this._registerListeners()}var n=l.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var c=this.hls;c.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),c.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),c.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var c=this.hls;c.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),c.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),c.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),c.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(c,f){this.media=f.media},n.onMediaDetaching=function(){!this.id3Track||((0,b.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(c){var f=this.getID3Track(c.textTracks);return f.mode="hidden",f},n.getID3Track=function(c){if(!!this.media){for(var f=0;f<c.length;f++){var e=c[f];if(e.kind==="metadata"&&e.label==="id3")return(0,b.sendAddTrackEvent)(e,this.media),e}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(c,f){if(!!this.media){var e=this.hls.config,t=e.enableEmsgMetadataCues,i=e.enableID3MetadataCues;if(!(!t&&!i)){f.frag;var v=f.samples;f.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var d=D(),p=0;p<v.length;p++){var s=v[p].type;if(!(s===R.MetadataSchema.emsg&&!t||!i)){var g=C.getID3Frames(v[p].data);if(g){var h=v[p].pts,o=h+v[p].duration;o>T&&(o=T);var _=o-h;_<=0&&(o=h+P);for(var O=0;O<g.length;O++){var k=g[O];if(!C.isTimeStampFrame(k)){this.updateId3CueEnds(h);var K=new d(h,o,"");K.value=k,s&&(K.type=s),this.id3Track.addCue(K)}}}}}}}},n.updateId3CueEnds=function(c){var f,e=(f=this.id3Track)===null||f===void 0?void 0:f.cues;if(e)for(var t=e.length;t--;){var i=e[t];i.startTime<c&&i.endTime===T&&(i.endTime=c)}},n.onBufferFlushing=function(c,f){var e=f.startOffset,t=f.endOffset,i=f.type,v=this.id3Track,d=this.hls;if(!!d){var p=d.config,s=p.enableEmsgMetadataCues,g=p.enableID3MetadataCues;if(v&&(s||g)){var h;i==="audio"?h=function(_){return _.type===R.MetadataSchema.audioId3&&g}:i==="video"?h=function(_){return _.type===R.MetadataSchema.emsg&&s}:h=function(_){return _.type===R.MetadataSchema.audioId3&&g||_.type===R.MetadataSchema.emsg&&s},(0,b.removeCuesInRange)(v,e,t,h)}}},n.onLevelUpdated=function(c,f){var e=this,t=f.details;if(!(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.dateRangeCuesAppended,v=this.id3Track,d=t.dateRanges,p=Object.keys(d);if(v)for(var s=Object.keys(i).filter(function(N){return!p.includes(N)}),g=function(W){var H=s[W];Object.keys(i[H].cues).forEach(function(V){v.removeCue(i[H].cues[V])}),delete i[H]},h=s.length;h--;)g(h);var o=t.fragments[t.fragments.length-1];if(!(p.length===0||!(0,M.isFiniteNumber)(o==null?void 0:o.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var _=o.programDateTime/1e3-o.start,O=D(),k=function(W){var H=p[W],V=d[H],j=i[H],z=(j==null?void 0:j.cues)||{},$=(j==null?void 0:j.durationKnown)||!1,Y=S(V.startDate,_),X=T,Q=V.endDate;if(Q)X=S(Q,_),$=!0;else if(V.endOnNext&&!$){var q=p.reduce(function(fe,oe){var de=d[oe];return de.class===V.class&&de.id!==oe&&de.startDate>V.startDate&&fe.push(de),fe},[]).sort(function(fe,oe){return fe.startDate.getTime()-oe.startDate.getTime()})[0];q&&(X=S(q.startDate,_),$=!0)}for(var J=Object.keys(V.attr),ie=0;ie<J.length;ie++){var se=J[ie];if(!(se===F.DateRangeAttribute.ID||se===F.DateRangeAttribute.CLASS||se===F.DateRangeAttribute.START_DATE||se===F.DateRangeAttribute.DURATION||se===F.DateRangeAttribute.END_DATE||se===F.DateRangeAttribute.END_ON_NEXT)){var Z=z[se];if(Z)$&&!j.durationKnown&&(Z.endTime=X);else{var re=V.attr[se];Z=new O(Y,X,""),(se===F.DateRangeAttribute.SCTE35_OUT||se===F.DateRangeAttribute.SCTE35_IN)&&(re=A(re)),Z.value={key:se,data:re},Z.type=R.MetadataSchema.dateRange,e.id3Track.addCue(Z),z[se]=Z}}}i[H]={cues:z,dateRange:V,durationKnown:$}},K=0;K<p.length;K++)k(K)}}},l}();const y=x},"./src/controller/latency-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>R});var M=u("./src/errors.ts"),I=u("./src/events.ts"),b=u("./src/utils/logger.ts");function C(P,D){for(var T=0;T<D.length;T++){var S=D[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(P,S.key,S)}}function F(P,D,T){return D&&C(P.prototype,D),T&&C(P,T),Object.defineProperty(P,"prototype",{writable:!1}),P}var R=function(){function P(T){var S=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return S.timeupdate()},this.hls=T,this.config=T.config,this.registerListeners()}var D=P.prototype;return D.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},D.registerListeners=function(){this.hls.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(I.Events.ERROR,this.onError,this)},D.unregisterListeners=function(){this.hls.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(I.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(I.Events.ERROR,this.onError)},D.onMediaAttached=function(S,A){this.media=A.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},D.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},D.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},D.onLevelUpdated=function(S,A){var x=A.details;this.levelDetails=x,x.advanced&&this.timeupdate(),!x.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},D.onError=function(S,A){A.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},D.timeupdate=function(){var S=this.media,A=this.levelDetails;if(!(!S||!A)){this.currentTime=S.currentTime;var x=this.computeLatency();if(x!==null){this._latency=x;var y=this.config,l=y.lowLatencyMode,n=y.maxLiveSyncPlaybackRate;if(!(!l||n===1)){var r=this.targetLatency;if(r!==null){var c=x-r,f=Math.min(this.maxLatency,r+A.targetduration),e=c<f;if(A.live&&e&&c>.05&&this.forwardBufferLength>1){var t=Math.min(2,Math.max(1,n)),i=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;S.playbackRate=Math.min(t,Math.max(1,i))}else S.playbackRate!==1&&S.playbackRate!==0&&(S.playbackRate=1)}}}}},D.estimateLiveEdge=function(){var S=this.levelDetails;return S===null?null:S.edge+S.age},D.computeLatency=function(){var S=this.estimateLiveEdge();return S===null?null:S-this.currentTime},F(P,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var S=this.config,A=this.levelDetails;return S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:A?S.liveMaxLatencyDurationCount*A.targetduration:0}},{key:"targetLatency",get:function(){var S=this.levelDetails;if(S===null)return null;var A=S.holdBack,x=S.partHoldBack,y=S.targetduration,l=this.config,n=l.liveSyncDuration,r=l.liveSyncDurationCount,c=l.lowLatencyMode,f=this.hls.userConfig,e=c&&x||A;(f.liveSyncDuration||f.liveSyncDurationCount||e===0)&&(e=n!==void 0?n:r*y);var t=y,i=1;return e+Math.min(this.stallCount*i,t)}},{key:"liveSyncPosition",get:function(){var S=this.estimateLiveEdge(),A=this.targetLatency,x=this.levelDetails;if(S===null||A===null||x===null)return null;var y=x.edge,l=S-A-this.edgeStalled,n=y-x.totalduration,r=y-(this.config.lowLatencyMode&&x.partTarget||x.targetduration);return Math.min(Math.max(n,l),r)}},{key:"drift",get:function(){var S=this.levelDetails;return S===null?1:S.drift}},{key:"edgeStalled",get:function(){var S=this.levelDetails;if(S===null)return 0;var A=(this.config.lowLatencyMode&&S.partTarget||S.targetduration)*3;return Math.max(S.age-A,0)}},{key:"forwardBufferLength",get:function(){var S=this.media,A=this.levelDetails;if(!S||!A)return 0;var x=S.buffered.length;return(x?S.buffered.end(x-1):A.edge)-this.currentTime}}]),P}()},"./src/controller/level-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>l});var M=u("./src/types/level.ts"),I=u("./src/events.ts"),b=u("./src/errors.ts"),C=u("./src/utils/codecs.ts"),F=u("./src/controller/level-helper.ts"),R=u("./src/controller/base-playlist-controller.ts"),P=u("./src/types/loader.ts");function D(){return D=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(n[f]=c[f])}return n},D.apply(this,arguments)}function T(n,r){for(var c=0;c<r.length;c++){var f=r[c];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(n,f.key,f)}}function S(n,r,c){return r&&T(n.prototype,r),c&&T(n,c),Object.defineProperty(n,"prototype",{writable:!1}),n}function A(n,r){n.prototype=Object.create(r.prototype),n.prototype.constructor=n,x(n,r)}function x(n,r){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,e){return f.__proto__=e,f},x(n,r)}var y=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=function(n){A(r,n);function r(f){var e;return e=n.call(this,f,"[level-controller]")||this,e._levels=[],e._firstLevel=-1,e._startLevel=void 0,e.currentLevelIndex=-1,e.manualLevelIndex=-1,e.onParsedComplete=void 0,e._registerListeners(),e}var c=r.prototype;return c._registerListeners=function(){var e=this.hls;e.on(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(I.Events.ERROR,this.onError,this)},c._unregisterListeners=function(){var e=this.hls;e.off(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(I.Events.ERROR,this.onError,this)},c.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,n.prototype.destroy.call(this)},c.startLoad=function(){var e=this._levels;e.forEach(function(t){t.loadError=0}),n.prototype.startLoad.call(this)},c.onManifestLoaded=function(e,t){var i=[],v=[],d=[],p,s={},g,h=!1,o=!1,_=!1;if(t.levels.forEach(function(N){var W=N.attrs;h=h||!!(N.width&&N.height),o=o||!!N.videoCodec,_=_||!!N.audioCodec,y&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0);var H=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;g=s[H],g?g.url.push(N.url):(g=new M.Level(N),s[H]=g,i.push(g)),W&&(W.AUDIO&&(0,F.addGroupId)(g,"audio",W.AUDIO),W.SUBTITLES&&(0,F.addGroupId)(g,"text",W.SUBTITLES))}),(h||o)&&_&&(i=i.filter(function(N){var W=N.videoCodec,H=N.width,V=N.height;return!!W||!!(H&&V)})),i=i.filter(function(N){var W=N.audioCodec,H=N.videoCodec;return(!W||(0,C.isCodecSupportedInMp4)(W,"audio"))&&(!H||(0,C.isCodecSupportedInMp4)(H,"video"))}),t.audioTracks&&(v=t.audioTracks.filter(function(N){return!N.audioCodec||(0,C.isCodecSupportedInMp4)(N.audioCodec,"audio")}),(0,F.assignTrackIdsByGroup)(v)),t.subtitles&&(d=t.subtitles,(0,F.assignTrackIdsByGroup)(d)),i.length>0){p=i[0].bitrate,i.sort(function(N,W){return N.bitrate-W.bitrate}),this._levels=i;for(var O=0;O<i.length;O++)if(i[O].bitrate===p){this._firstLevel=O,this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+p);break}var k=_&&!o,K={levels:i,audioTracks:v,subtitleTracks:d,firstLevel:this._firstLevel,stats:t.stats,audio:_,video:o,altAudio:!k&&v.some(function(N){return!!N.url})};this.hls.trigger(I.Events.MANIFEST_PARSED,K),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(I.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},c.onError=function(e,t){var i;if(n.prototype.onError.call(this,e,t),!t.fatal){var v=t.context,d=this._levels[this.currentLevelIndex];if(v&&(v.type===P.PlaylistContextType.AUDIO_TRACK&&d.audioGroupIds&&v.groupId===d.audioGroupIds[d.urlId]||v.type===P.PlaylistContextType.SUBTITLE_TRACK&&d.textGroupIds&&v.groupId===d.textGroupIds[d.urlId])){this.redundantFailover(this.currentLevelIndex);return}var p=!1,s=!0,g;switch(t.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(t.frag){var h=t.frag.type===P.PlaylistLevelType.MAIN?t.frag.level:this.currentLevelIndex,o=this._levels[h];o?(o.fragmentError++,o.fragmentError>this.hls.config.fragLoadingMaxRetry&&(g=h)):g=h}break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:v&&(v.deliveryDirectives&&(s=!1),g=v.level),p=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:g=(i=t.level)!=null?i:this.currentLevelIndex,p=!0;break}g!==void 0&&this.recoverLevel(t,g,p,s)}},c.recoverLevel=function(e,t,i,v){var d=e.details,p=this._levels[t];if(p.loadError++,i){var s=this.retryLoadingOrFail(e);if(s)e.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(v){var g=p.url.length;if(g>1&&p.loadError<g)e.levelRetry=!0,this.redundantFailover(t);else if(this.manualLevelIndex===-1){for(var h=-1,o=this._levels,_=o.length;_--;){var O=(_+this.currentLevelIndex)%o.length;if(O!==this.currentLevelIndex&&o[O].loadError===0){h=O;break}}h>-1&&this.currentLevelIndex!==h&&(this.warn(d+": switch to "+h),e.levelRetry=!0,this.hls.nextAutoLevel=h)}}},c.redundantFailover=function(e){var t=this._levels[e],i=t.url.length;if(i>1){var v=(t.urlId+1)%i;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(d){d.urlId=v}),this.level=e}},c.onFragLoaded=function(e,t){var i=t.frag;if(i!==void 0&&i.type===P.PlaylistLevelType.MAIN){var v=this._levels[i.level];v!==void 0&&(v.fragmentError=0,v.loadError=0)}},c.onLevelLoaded=function(e,t){var i,v=t.level,d=t.details,p=this._levels[v];if(!p){var s;this.warn("Invalid level index "+v),(s=t.deliveryDirectives)!==null&&s!==void 0&&s.skip&&(d.deltaUpdateFailed=!0);return}v===this.currentLevelIndex?(p.fragmentError===0&&(p.loadError=0,this.retryCount=0),this.playlistLoaded(v,t,p.details)):(i=t.deliveryDirectives)!==null&&i!==void 0&&i.skip&&(d.deltaUpdateFailed=!0)},c.onAudioTrackSwitched=function(e,t){var i=this.hls.levels[this.currentLevelIndex];if(!!i&&i.audioGroupIds){for(var v=-1,d=this.hls.audioTracks[t.id].groupId,p=0;p<i.audioGroupIds.length;p++)if(i.audioGroupIds[p]===d){v=p;break}v!==i.urlId&&(i.urlId=v,this.startLoad())}},c.loadPlaylist=function(e){var t=this.currentLevelIndex,i=this._levels[t];if(this.canLoad&&i&&i.url.length>0){var v=i.urlId,d=i.url[v];if(e)try{d=e.addDirectives(d)}catch(p){this.warn("Could not construct new URL with HLS Delivery Directives: "+p)}this.log("Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+v+" "+d),this.clearTimer(),this.hls.trigger(I.Events.LEVEL_LOADING,{url:d,level:t,id:v,deliveryDirectives:e||null})}},c.removeLevel=function(e,t){var i=function(p,s){return s!==t},v=this._levels.filter(function(d,p){return p!==e?!0:d.url.length>1&&t!==void 0?(d.url=d.url.filter(i),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(i)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(i)),d.urlId=0,!0):!1}).map(function(d,p){var s=d.details;return s!=null&&s.fragments&&s.fragments.forEach(function(g){g.level=p}),d});this._levels=v,this.hls.trigger(I.Events.LEVELS_UPDATED,{levels:v})},S(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,i=this._levels;if(i.length!==0&&!(this.currentLevelIndex===e&&(t=i[e])!==null&&t!==void 0&&t.details)){if(e<0||e>=i.length){var v=e<0;if(this.hls.trigger(I.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:v,reason:"invalid level idx"}),v)return;e=Math.min(e,i.length-1)}this.clearTimer();var d=this.currentLevelIndex,p=i[d],s=i[e];this.log("switching to level "+e+" from "+d),this.currentLevelIndex=e;var g=D({},s,{level:e,maxBitrate:s.maxBitrate,uri:s.uri,urlId:s.urlId});delete g._urlId,this.hls.trigger(I.Events.LEVEL_SWITCHING,g);var h=s.details;if(!h||h.live){var o=this.switchParams(s.uri,p==null?void 0:p.details);this.loadPlaylist(o)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),r}(R.default)},"./src/controller/level-helper.ts":(G,B,u)=>{u.r(B),u.d(B,{addGroupId:()=>F,addSliding:()=>n,adjustSliding:()=>l,assignTrackIdsByGroup:()=>R,computeReloadInterval:()=>r,getFragmentWithSN:()=>c,getPartWith:()=>f,mapFragmentIntersection:()=>y,mapPartIntersection:()=>x,mergeDetails:()=>S,updateFragPTSDTS:()=>T,updatePTS:()=>P});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/logger.ts"),b=u("./src/loader/date-range.ts");function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var v in i)Object.prototype.hasOwnProperty.call(i,v)&&(e[v]=i[v])}return e},C.apply(this,arguments)}function F(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i);break}}function R(e){var t={};e.forEach(function(i){var v=i.groupId||"";i.id=t[v]=t[v]||0,t[v]++})}function P(e,t,i){var v=e[t],d=e[i];D(v,d)}function D(e,t){var i=t.startPTS;if((0,M.isFiniteNumber)(i)){var v=0,d;t.sn>e.sn?(v=i-e.start,d=e):(v=e.start-i,d=t),d.duration!==v&&(d.duration=v)}else if(t.sn>e.sn){var p=e.cc===t.cc;p&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function T(e,t,i,v,d,p){var s=v-i;s<=0&&(I.logger.warn("Fragment should have a positive duration",t),v=i+t.duration,p=d+t.duration);var g=i,h=v,o=t.startPTS,_=t.endPTS;if((0,M.isFiniteNumber)(o)){var O=Math.abs(o-i);(0,M.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(O,t.deltaPTS):t.deltaPTS=O,g=Math.max(i,o),i=Math.min(i,o),d=Math.min(d,t.startDTS),h=Math.min(v,_),v=Math.max(v,_),p=Math.max(p,t.endDTS)}t.duration=v-i;var k=i-t.start;t.appendedPTS=v,t.start=t.startPTS=i,t.maxStartPTS=g,t.startDTS=d,t.endPTS=v,t.minEndPTS=h,t.endDTS=p;var K=t.sn;if(!e||K<e.startSN||K>e.endSN)return 0;var N,W=K-e.startSN,H=e.fragments;for(H[W]=t,N=W;N>0;N--)D(H[N],H[N-1]);for(N=W;N<H.length-1;N++)D(H[N],H[N+1]);return e.fragmentHint&&D(H[H.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,k}function S(e,t){for(var i=null,v=e.fragments,d=v.length-1;d>=0;d--){var p=v[d].initSegment;if(p){i=p;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var s=0,g;if(y(e,t,function(N,W){N.relurl&&(s=N.cc-W.cc),(0,M.isFiniteNumber)(N.startPTS)&&(0,M.isFiniteNumber)(N.endPTS)&&(W.start=W.startPTS=N.startPTS,W.startDTS=N.startDTS,W.appendedPTS=N.appendedPTS,W.maxStartPTS=N.maxStartPTS,W.endPTS=N.endPTS,W.endDTS=N.endDTS,W.minEndPTS=N.minEndPTS,W.duration=N.endPTS-N.startPTS,W.duration&&(g=W),t.PTSKnown=t.alignedSliding=!0),W.elementaryStreams=N.elementaryStreams,W.loader=N.loader,W.stats=N.stats,W.urlId=N.urlId,N.initSegment&&(W.initSegment=N.initSegment,i=N.initSegment)}),i){var h=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;h.forEach(function(N){var W;(!N.initSegment||N.initSegment.relurl===((W=i)===null||W===void 0?void 0:W.relurl))&&(N.initSegment=i)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(N){return!N}),t.deltaUpdateFailed){I.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var o=t.skippedSegments;o--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=A(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var _=t.fragments;if(s){I.logger.warn("discontinuity sliding from playlist, take drift into account");for(var O=0;O<_.length;O++)_[O].cc+=s}t.skippedSegments&&(t.startCC=t.fragments[0].cc),x(e.partList,t.partList,function(N,W){W.elementaryStreams=N.elementaryStreams,W.stats=N.stats}),g?T(t,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):l(e,t),_.length&&(t.totalduration=t.edge-_[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var k=t.advancedDateTime;if(t.advanced&&k){var K=t.edge;t.driftStart||(t.driftStartTime=k,t.driftStart=K),t.driftEndTime=k,t.driftEnd=K}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function A(e,t,i){var v=C({},e);return i&&i.forEach(function(d){delete v[d]}),Object.keys(t).forEach(function(d){var p=new b.DateRange(t[d].attr,v[d]);p.isValid?v[d]=p:I.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[d].attr)+'"')}),v}function x(e,t,i){if(e&&t)for(var v=0,d=0,p=e.length;d<=p;d++){var s=e[d],g=t[d+v];s&&g&&s.index===g.index&&s.fragment.sn===g.fragment.sn?i(s,g):v--}}function y(e,t,i){for(var v=t.skippedSegments,d=Math.max(e.startSN,t.startSN)-t.startSN,p=(e.fragmentHint?1:0)+(v?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,g=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,h=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,o=d;o<=p;o++){var _=h[s+o],O=g[o];v&&!O&&o<v&&(O=t.fragments[o]=_),_&&O&&i(_,O)}}function l(e,t){var i=t.startSN+t.skippedSegments-e.startSN,v=e.fragments;i<0||i>=v.length||n(t,v[i].start)}function n(e,t){if(t){for(var i=e.fragments,v=e.skippedSegments;v<i.length;v++)i[v].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function r(e,t){var i=1e3*e.levelTargetDuration,v=i/2,d=e.age,p=d>0&&d<i*3,s=t.loading.end-t.loading.start,g,h=e.availabilityDelay;if(e.updated===!1)if(p){var o=333*e.misses;g=Math.max(Math.min(v,s*2),o),e.availabilityDelay=(e.availabilityDelay||0)+g}else g=v;else p?(h=Math.min(h||i/2,d),e.availabilityDelay=h,g=h+i-d):g=i-s;return Math.round(g)}function c(e,t,i){if(!e||!e.details)return null;var v=e.details,d=v.fragments[t-v.startSN];return d||(d=v.fragmentHint,d&&d.sn===t)?d:t<v.startSN&&i&&i.sn===t?i:null}function f(e,t,i){if(!e||!e.details)return null;var v=e.details.partList;if(v)for(var d=v.length;d--;){var p=v[d];if(p.index===i&&p.fragment.sn===t)return p}return null}},"./src/controller/stream-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>f});var M=u("./src/polyfills/number.ts"),I=u("./src/controller/base-stream-controller.ts"),b=u("./src/is-supported.ts"),C=u("./src/events.ts"),F=u("./src/utils/buffer-helper.ts"),R=u("./src/controller/fragment-tracker.ts"),P=u("./src/types/loader.ts"),D=u("./src/loader/fragment.ts"),T=u("./src/demux/transmuxer-interface.ts"),S=u("./src/types/transmuxer.ts"),A=u("./src/controller/gap-controller.ts"),x=u("./src/errors.ts");function y(e,t){for(var i=0;i<t.length;i++){var v=t[i];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(e,v.key,v)}}function l(e,t,i){return t&&y(e.prototype,t),i&&y(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,d){return v.__proto__=d,v},r(e,t)}var c=100,f=function(e){n(t,e);function t(v,d){var p;return p=e.call(this,v,d,"[stream-controller]")||this,p.audioCodecSwap=!1,p.gapController=null,p.level=-1,p._forceStartLoad=!1,p.altAudio=!1,p.audioOnly=!1,p.fragPlaying=null,p.onvplaying=null,p.onvseeked=null,p.fragLastKbps=0,p.couldBacktrack=!1,p.backtrackFragment=null,p.audioCodecSwitch=!1,p.videoBuffer=null,p._registerListeners(),p}var i=t.prototype;return i._registerListeners=function(){var d=this.hls;d.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),d.on(C.Events.ERROR,this.onError,this),d.on(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),d.on(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this),d.on(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),d.on(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),d.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var d=this.hls;d.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),d.off(C.Events.ERROR,this.onError,this),d.off(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),d.off(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),d.off(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),d.off(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),d.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(d){if(this.levels){var p=this.lastCurrentTime,s=this.hls;if(this.stopLoad(),this.setInterval(c),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var g=s.startLevel;g===-1&&(s.config.testBandwidth&&this.levels.length>1?(g=0,this.bitrateTest=!0):g=s.nextAutoLevel),this.level=s.nextLoadLevel=g,this.loadedmetadata=!1}p>0&&d===-1&&(this.log("Override startPosition with lastCurrentTime @"+p.toFixed(3)),d=p),this.state=I.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=d,this.tick()}else this._forceStartLoad=!0,this.state=I.State.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case I.State.IDLE:this.doTickIdle();break;case I.State.WAITING_LEVEL:{var d,p=this.levels,s=this.level,g=p==null||(d=p[s])===null||d===void 0?void 0:d.details;if(g&&(!g.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(g))break;this.state=I.State.IDLE;break}break}case I.State.FRAG_LOADING_WAITING_RETRY:{var h,o=self.performance.now(),_=this.retryDate;(!_||o>=_||(h=this.media)!==null&&h!==void 0&&h.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=I.State.IDLE)}break}this.onTickEnd()},i.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var d,p,s=this.hls,g=this.levelLastLoaded,h=this.levels,o=this.media,_=s.config,O=s.nextLoadLevel;if(!(g===null||!o&&(this.startFragRequested||!_.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!h||!h[O])){var k=h[O];this.level=s.nextLoadLevel=O;var K=k.details;if(!K||this.state===I.State.WAITING_LEVEL||K.live&&this.levelLastLoaded!==O){this.state=I.State.WAITING_LEVEL;return}var N=this.getMainFwdBufferInfo();if(N!==null){var W=N.len,H=this.getMaxBufferLength(k.maxBitrate);if(!(W>=H)){if(this._streamEnded(N,K)){var V={};this.altAudio&&(V.type="video"),this.hls.trigger(C.Events.BUFFER_EOS,V),this.state=I.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>N.end&&(this.backtrackFragment=null);var j=this.backtrackFragment?this.backtrackFragment.start:N.end,z=this.getNextFragment(j,K);if(this.couldBacktrack&&!this.fragPrevious&&z&&z.sn!=="initSegment"&&this.fragmentTracker.getState(z)!==R.FragmentState.OK){var $,Y=(($=this.backtrackFragment)!=null?$:z).sn,X=Y-K.startSN,Q=K.fragments[X-1];Q&&z.cc===Q.cc&&(z=Q,this.fragmentTracker.removeFragment(Q))}else this.backtrackFragment&&N.len&&(this.backtrackFragment=null);if(z&&this.fragmentTracker.getState(z)===R.FragmentState.OK&&this.nextLoadPosition>j){var q=this.audioOnly&&!this.altAudio?D.ElementaryStreamTypes.AUDIO:D.ElementaryStreamTypes.VIDEO;o&&this.afterBufferFlushed(o,q,P.PlaylistLevelType.MAIN),z=this.getNextFragment(this.nextLoadPosition,K)}!z||(z.initSegment&&!z.initSegment.data&&!this.bitrateTest&&(z=z.initSegment),((d=z.decryptdata)===null||d===void 0?void 0:d.keyFormat)==="identity"&&!((p=z.decryptdata)!==null&&p!==void 0&&p.key)?this.loadKey(z,K):this.loadFragment(z,K,j))}}}},i.loadFragment=function(d,p,s){var g,h=this.fragmentTracker.getState(d);this.fragCurrent=d,h===R.FragmentState.NOT_LOADED?d.sn==="initSegment"?this._loadInitSegment(d):this.bitrateTest?(this.log("Fragment "+d.sn+" of level "+d.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(d)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,d,p,s)):h===R.FragmentState.APPENDING?this.reduceMaxBufferLength(d.duration)&&this.fragmentTracker.removeFragment(d):((g=this.media)===null||g===void 0?void 0:g.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(d){var p=this.fragmentTracker.getAppendedFrag(d,P.PlaylistLevelType.MAIN);return p&&"fragment"in p?p.fragment:p},i.getBufferedFrag=function(d){return this.fragmentTracker.getBufferedFrag(d,P.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(d){return d?this.getBufferedFrag(d.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var d=this.levels,p=this.media;if(p!=null&&p.readyState){var s,g=this.getAppendedFrag(p.currentTime);if(g&&g.start>1&&this.flushMainBuffer(0,g.start-1),!p.paused&&d){var h=this.hls.nextLoadLevel,o=d[h],_=this.fragLastKbps;_&&this.fragCurrent?s=this.fragCurrent.duration*o.maxBitrate/(1e3*_)+1:s=0}else s=0;var O=this.getBufferedFrag(p.currentTime+s);if(O){var k=this.followingBufferedFrag(O);if(k){this.abortCurrentFrag();var K=k.maxStartPTS?k.maxStartPTS:k.start,N=k.duration,W=Math.max(O.end,K+Math.min(Math.max(N-this.config.maxFragLookUpTolerance,N*.5),N*.75));this.flushMainBuffer(W,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var d=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,d!=null&&d.loader&&d.loader.abort(),this.state){case I.State.KEY_LOADING:case I.State.FRAG_LOADING:case I.State.FRAG_LOADING_WAITING_RETRY:case I.State.PARSING:case I.State.PARSED:this.state=I.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(d,p){e.prototype.flushMainBuffer.call(this,d,p,this.altAudio?"video":null)},i.onMediaAttached=function(d,p){e.prototype.onMediaAttached.call(this,d,p);var s=p.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),s.addEventListener("playing",this.onvplaying),s.addEventListener("seeked",this.onvseeked),this.gapController=new A.default(this.config,s,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var d=this.media;d&&this.onvplaying&&this.onvseeked&&(d.removeEventListener("playing",this.onvplaying),d.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var d=this.media,p=d?d.currentTime:null;(0,M.isFiniteNumber)(p)&&this.log("Media seeked to "+p.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(d,p){var s=!1,g=!1,h;p.levels.forEach(function(o){h=o.audioCodec,h&&(h.indexOf("mp4a.40.2")!==-1&&(s=!0),h.indexOf("mp4a.40.5")!==-1&&(g=!0))}),this.audioCodecSwitch=s&&g&&!(0,b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=p.levels,this.startFragRequested=!1},i.onLevelLoading=function(d,p){var s=this.levels;if(!(!s||this.state!==I.State.IDLE)){var g=s[p.level];(!g.details||g.details.live&&this.levelLastLoaded!==p.level||this.waitForCdnTuneIn(g.details))&&(this.state=I.State.WAITING_LEVEL)}},i.onLevelLoaded=function(d,p){var s,g=this.levels,h=p.level,o=p.details,_=o.totalduration;if(!g){this.warn("Levels were reset while loading level "+h);return}this.log("Level "+h+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+_);var O=this.fragCurrent;O&&(this.state===I.State.FRAG_LOADING||this.state===I.State.FRAG_LOADING_WAITING_RETRY)&&O.level!==p.level&&O.loader&&(this.state=I.State.IDLE,this.backtrackFragment=null,O.loader.abort());var k=g[h],K=0;if(o.live||(s=k.details)!==null&&s!==void 0&&s.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;K=this.alignPlaylists(o,k.details)}if(k.details=o,this.levelLastLoaded=h,this.hls.trigger(C.Events.LEVEL_UPDATED,{details:o,level:h}),this.state===I.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=I.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,K),this.tick()},i._handleFragmentLoadProgress=function(d){var p,s=d.frag,g=d.part,h=d.payload,o=this.levels;if(!o){this.warn("Levels were reset while fragment load was in progress. Fragment "+s.sn+" of level "+s.level+" will not be buffered");return}var _=o[s.level],O=_.details;if(!O){this.warn("Dropping fragment "+s.sn+" of level "+s.level+" after level details were reset");return}var k=_.videoCodec,K=O.PTSKnown||!O.live,N=(p=s.initSegment)===null||p===void 0?void 0:p.data,W=this._getAudioCodec(_),H=this.transmuxer=this.transmuxer||new T.default(this.hls,P.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),V=g?g.index:-1,j=V!==-1,z=new S.ChunkMetadata(s.level,s.sn,s.stats.chunkCount,h.byteLength,V,j),$=this.initPTS[s.cc];H.push(h,N,W,k,s,g,O.totalduration,K,z,$)},i.onAudioTrackSwitching=function(d,p){var s=this.altAudio,g=!!p.url,h=p.id;if(!g){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var o=this.fragCurrent;o!=null&&o.loader&&(this.log("Switching to main audio track, cancel main fragment load"),o.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var _=this.hls;s&&_.trigger(C.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),_.trigger(C.Events.AUDIO_TRACK_SWITCHED,{id:h})}},i.onAudioTrackSwitched=function(d,p){var s=p.id,g=!!this.hls.audioTracks[s].url;if(g){var h=this.videoBuffer;h&&this.mediaBuffer!==h&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=h)}this.altAudio=g,this.tick()},i.onBufferCreated=function(d,p){var s=p.tracks,g,h,o=!1;for(var _ in s){var O=s[_];if(O.id==="main"){if(h=_,g=O,_==="video"){var k=s[_];k&&(this.videoBuffer=k.buffer)}}else o=!0}o&&g?(this.log("Alternate track found, use "+h+".buffered to schedule main fragment loading"),this.mediaBuffer=g.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(d,p){var s=p.frag,g=p.part;if(!(s&&s.type!==P.PlaylistLevelType.MAIN)){if(this.fragContextChanged(s)){this.warn("Fragment "+s.sn+(g?" p: "+g.index:"")+" of level "+s.level+" finished buffering, but was aborted. state: "+this.state),this.state===I.State.PARSED&&(this.state=I.State.IDLE);return}var h=g?g.stats:s.stats;this.fragLastKbps=Math.round(8*h.total/(h.buffering.end-h.loading.first)),s.sn!=="initSegment"&&(this.fragPrevious=s),this.fragBufferedComplete(s,g)}},i.onError=function(d,p){switch(p.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(P.PlaylistLevelType.MAIN,p);break;case x.ErrorDetails.LEVEL_LOAD_ERROR:case x.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==I.State.ERROR&&(p.fatal?(this.warn(""+p.details),this.state=I.State.ERROR):!p.levelRetry&&this.state===I.State.WAITING_LEVEL&&(this.state=I.State.IDLE));break;case x.ErrorDetails.BUFFER_FULL_ERROR:if(p.parent==="main"&&(this.state===I.State.PARSING||this.state===I.State.PARSED)){var s=!0,g=this.getFwdBufferInfo(this.media,P.PlaylistLevelType.MAIN);g&&g.len>.5&&(s=!this.reduceMaxBufferLength(g.len)),s&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},i.checkBuffer=function(){var d=this.media,p=this.gapController;if(!(!d||!p||!d.readyState)){if(this.loadedmetadata||!F.BufferHelper.getBuffered(d).length){var s=this.state!==I.State.IDLE?this.fragCurrent:null;p.poll(this.lastCurrentTime,s)}this.lastCurrentTime=d.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=I.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(d,p){var s=p.type;if(s!==D.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var g=(s===D.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(g,s,P.PlaylistLevelType.MAIN)}},i.onLevelsUpdated=function(d,p){this.levels=p.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var d=this.media;if(!!d){var p=d.currentTime,s=this.startPosition;if(s>=0&&p<s){if(d.seeking){this.log("could not seek to "+s+", already seeking at "+p);return}var g=F.BufferHelper.getBuffered(d),h=g.length?g.start(0):0,o=h-s;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+o+" to match buffer start"),s+=o,this.startPosition=s),this.log("seek to target start position "+s+" from current time "+p),d.currentTime=s}}},i._getAudioCodec=function(d){var p=this.config.defaultAudioCodec||d.audioCodec;return this.audioCodecSwap&&p&&(this.log("Swapping audio codec"),p.indexOf("mp4a.40.5")!==-1?p="mp4a.40.2":p="mp4a.40.5"),p},i._loadBitrateTestFrag=function(d){var p=this;d.bitrateTest=!0,this._doFragLoad(d).then(function(s){var g=p.hls;if(!(!s||g.nextLoadLevel||p.fragContextChanged(d))){p.fragLoadError=0,p.state=I.State.IDLE,p.startFragRequested=!1,p.bitrateTest=!1;var h=d.stats;h.parsing.start=h.parsing.end=h.buffering.start=h.buffering.end=self.performance.now(),g.trigger(C.Events.FRAG_LOADED,s),d.bitrateTest=!1}})},i._handleTransmuxComplete=function(d){var p,s="main",g=this.hls,h=d.remuxResult,o=d.chunkMeta,_=this.getCurrentContext(o);if(!_){this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(o.level);return}var O=_.frag,k=_.part,K=_.level,N=h.video,W=h.text,H=h.id3,V=h.initSegment,j=K.details,z=this.altAudio?void 0:h.audio;if(!this.fragContextChanged(O)){if(this.state=I.State.PARSING,V){V.tracks&&(this._bufferInitSegment(K,V.tracks,O,o),g.trigger(C.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:s,tracks:V.tracks}));var $=V.initPTS,Y=V.timescale;(0,M.isFiniteNumber)($)&&(this.initPTS[O.cc]=$,g.trigger(C.Events.INIT_PTS_FOUND,{frag:O,id:s,initPTS:$,timescale:Y}))}if(N&&h.independent!==!1){if(j){var X=N.startPTS,Q=N.endPTS,q=N.startDTS,J=N.endDTS;if(k)k.elementaryStreams[N.type]={startPTS:X,endPTS:Q,startDTS:q,endDTS:J};else if(N.firstKeyFrame&&N.independent&&(this.couldBacktrack=!0),N.dropped&&N.independent){var ie=this.getMainFwdBufferInfo(),se=(ie?ie.end:this.getLoadPosition())+this.config.maxBufferHole,Z=N.firstKeyFramePTS?N.firstKeyFramePTS:X;if(se<Z-this.config.maxBufferHole){this.backtrack(O);return}O.setElementaryStreamInfo(N.type,O.start,Q,O.start,J,!0)}O.setElementaryStreamInfo(N.type,X,Q,q,J),this.backtrackFragment&&(this.backtrackFragment=O),this.bufferFragmentData(N,O,k,o)}}else if(h.independent===!1){this.backtrack(O);return}if(z){var re=z.startPTS,fe=z.endPTS,oe=z.startDTS,de=z.endDTS;k&&(k.elementaryStreams[D.ElementaryStreamTypes.AUDIO]={startPTS:re,endPTS:fe,startDTS:oe,endDTS:de}),O.setElementaryStreamInfo(D.ElementaryStreamTypes.AUDIO,re,fe,oe,de),this.bufferFragmentData(z,O,k,o)}if(j&&H!==null&&H!==void 0&&(p=H.samples)!==null&&p!==void 0&&p.length){var xe={id:s,frag:O,details:j,samples:H.samples};g.trigger(C.Events.FRAG_PARSING_METADATA,xe)}if(j&&W){var he={id:s,frag:O,details:j,samples:W.samples};g.trigger(C.Events.FRAG_PARSING_USERDATA,he)}}},i._bufferInitSegment=function(d,p,s,g){var h=this;if(this.state===I.State.PARSING){this.audioOnly=!!p.audio&&!p.video,this.altAudio&&!this.audioOnly&&delete p.audio;var o=p.audio,_=p.video,O=p.audiovideo;if(o){var k=d.audioCodec,K=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(k&&(k.indexOf("mp4a.40.5")!==-1?k="mp4a.40.2":k="mp4a.40.5"),o.metadata.channelCount!==1&&K.indexOf("firefox")===-1&&(k="mp4a.40.5")),K.indexOf("android")!==-1&&o.container!=="audio/mpeg"&&(k="mp4a.40.2",this.log("Android: force audio codec to "+k)),d.audioCodec&&d.audioCodec!==k&&this.log('Swapping manifest audio codec "'+d.audioCodec+'" for "'+k+'"'),o.levelCodec=k,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(k||"")+"/"+(d.audioCodec||"")+"/"+o.codec+"]")}_&&(_.levelCodec=d.videoCodec,_.id="main",this.log("Init video buffer, container:"+_.container+", codecs[level/parsed]=["+(d.videoCodec||"")+"/"+_.codec+"]")),O&&this.log("Init audiovideo buffer, container:"+O.container+", codecs[level/parsed]=["+(d.attrs.CODECS||"")+"/"+O.codec+"]"),this.hls.trigger(C.Events.BUFFER_CODECS,p),Object.keys(p).forEach(function(N){var W=p[N],H=W.initSegment;H!=null&&H.byteLength&&h.hls.trigger(C.Events.BUFFER_APPENDING,{type:N,data:H,frag:s,part:null,chunkMeta:g,parent:s.type})}),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,P.PlaylistLevelType.MAIN)},i.backtrack=function(d){this.couldBacktrack=!0,this.backtrackFragment=d,this.resetTransmuxer(),this.flushBufferGap(d),this.fragmentTracker.removeFragment(d),this.fragPrevious=null,this.nextLoadPosition=d.start,this.state=I.State.IDLE},i.checkFragmentChanged=function(){var d=this.media,p=null;if(d&&d.readyState>1&&d.seeking===!1){var s=d.currentTime;if(F.BufferHelper.isBuffered(d,s)?p=this.getAppendedFrag(s):F.BufferHelper.isBuffered(d,s+.1)&&(p=this.getAppendedFrag(s+.1)),p){this.backtrackFragment=null;var g=this.fragPlaying,h=p.level;(!g||p.sn!==g.sn||g.level!==h||p.urlId!==g.urlId)&&(this.hls.trigger(C.Events.FRAG_CHANGED,{frag:p}),(!g||g.level!==h)&&this.hls.trigger(C.Events.LEVEL_SWITCHED,{level:h}),this.fragPlaying=p)}}},l(t,[{key:"nextLevel",get:function(){var d=this.nextBufferedFrag;return d?d.level:-1}},{key:"currentFrag",get:function(){var d=this.media;return d?this.fragPlaying||this.getAppendedFrag(d.currentTime):null}},{key:"currentProgramDateTime",get:function(){var d=this.media;if(d){var p=d.currentTime,s=this.currentFrag;if(s&&(0,M.isFiniteNumber)(p)&&(0,M.isFiniteNumber)(s.programDateTime)){var g=s.programDateTime+(p-s.start)*1e3;return new Date(g)}}return null}},{key:"currentLevel",get:function(){var d=this.currentFrag;return d?d.level:-1}},{key:"nextBufferedFrag",get:function(){var d=this.currentFrag;return d?this.followingBufferedFrag(d):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(I.default)},"./src/controller/subtitle-stream-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{SubtitleStreamController:()=>n});var M=u("./src/events.ts"),I=u("./src/utils/buffer-helper.ts"),b=u("./src/controller/fragment-finders.ts"),C=u("./src/utils/discontinuities.ts"),F=u("./src/controller/level-helper.ts"),R=u("./src/controller/fragment-tracker.ts"),P=u("./src/controller/base-stream-controller.ts"),D=u("./src/types/loader.ts"),T=u("./src/types/level.ts");function S(c,f){for(var e=0;e<f.length;e++){var t=f[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(c,t.key,t)}}function A(c,f,e){return f&&S(c.prototype,f),e&&S(c,e),Object.defineProperty(c,"prototype",{writable:!1}),c}function x(c,f){c.prototype=Object.create(f.prototype),c.prototype.constructor=c,y(c,f)}function y(c,f){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},y(c,f)}var l=500,n=function(c){x(f,c);function f(t,i){var v;return v=c.call(this,t,i,"[subtitle-stream-controller]")||this,v.levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}var e=f.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var i=this.hls;i.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(M.Events.ERROR,this.onError,this),i.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=function(){var i=this.hls;i.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(M.Events.ERROR,this.onError,this),i.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.startLoad=function(){this.stopLoad(),this.state=P.State.IDLE,this.setInterval(l),this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},e.onLevelLoaded=function(i,v){this.mainDetails=v.details},e.onSubtitleFragProcessed=function(i,v){var d=v.frag,p=v.success;if(this.fragPrevious=d,this.state=P.State.IDLE,!!p){var s=this.tracksBuffered[this.currentTrackId];if(!!s){for(var g,h=d.start,o=0;o<s.length;o++)if(h>=s[o].start&&h<=s[o].end){g=s[o];break}var _=d.start+d.duration;g?g.end=_:(g={start:h,end:_},s.push(g)),this.fragmentTracker.fragBuffered(d)}}},e.onBufferFlushing=function(i,v){var d=v.startOffset,p=v.endOffset;if(d===0&&p!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,g=this.levels;if(!g.length||!g[s]||!g[s].details)return;var h=g[s].details,o=h.targetduration,_=p-o;if(_<=0)return;v.endOffsetSubtitles=Math.max(0,_),this.tracksBuffered.forEach(function(O){for(var k=0;k<O.length;){if(O[k].end<=_){O.shift();continue}else if(O[k].start<_)O[k].start=_;else break;k++}}),this.fragmentTracker.removeFragmentsInRange(d,_,D.PlaylistLevelType.SUBTITLE)}},e.onError=function(i,v){var d,p=v.frag;!p||p.type!==D.PlaylistLevelType.SUBTITLE||((d=this.fragCurrent)!==null&&d!==void 0&&d.loader&&this.fragCurrent.loader.abort(),this.state=P.State.IDLE)},e.onSubtitleTracksUpdated=function(i,v){var d=this,p=v.subtitleTracks;this.tracksBuffered=[],this.levels=p.map(function(s){return new T.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){d.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},e.onSubtitleTrackSwitch=function(i,v){if(this.currentTrackId=v.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var d=this.levels[this.currentTrackId];d!=null&&d.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,d&&this.setInterval(l)},e.onSubtitleTrackLoaded=function(i,v){var d,p=v.details,s=v.id,g=this.currentTrackId,h=this.levels;if(!!h.length){var o=h[g];if(!(s>=h.length||s!==g||!o)){if(this.mediaBuffer=this.mediaBufferTimeRanges,p.live||(d=o.details)!==null&&d!==void 0&&d.live){var _=this.mainDetails;if(p.deltaUpdateFailed||!_)return;var O=_.fragments[0];if(!o.details)p.hasProgramDateTime&&_.hasProgramDateTime?(0,C.alignMediaPlaylistByPDT)(p,_):O&&(0,F.addSliding)(p,O.start);else{var k=this.alignPlaylists(p,o.details);k===0&&O&&(0,F.addSliding)(p,O.start)}}if(o.details=p,this.levelLastLoaded=s,this.tick(),p.live&&!this.fragCurrent&&this.media&&this.state===P.State.IDLE){var K=(0,b.findFragmentByPTS)(null,p.fragments,this.media.currentTime,0);K||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}}},e._handleFragmentLoadComplete=function(i){var v=i.frag,d=i.payload,p=v.decryptdata,s=this.hls;if(!this.fragContextChanged(v)&&d&&d.byteLength>0&&p&&p.key&&p.iv&&p.method==="AES-128"){var g=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(d),p.key.buffer,p.iv.buffer).then(function(h){var o=performance.now();s.trigger(M.Events.FRAG_DECRYPTED,{frag:v,payload:h,stats:{tstart:g,tdecrypt:o}})})}},e.doTick=function(){if(!this.media){this.state=P.State.IDLE;return}if(this.state===P.State.IDLE){var i=this.currentTrackId,v=this.levels;if(!v.length||!v[i]||!v[i].details)return;var d=v[i].details,p=d.targetduration,s=this.config,g=this.media,h=I.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],g.currentTime-p,s.maxBufferHole),o=h.end,_=h.len,O=this.getMaxBufferLength()+p;if(_>O)return;console.assert(d,"Subtitle track details are defined on idle subtitle stream controller tick");var k=d.fragments,K=k.length,N=d.edge,W,H=this.fragPrevious;if(o<N){var V=s.maxFragLookUpTolerance;W=(0,b.findFragmentByPTS)(H,k,Math.max(k[0].start,o),V),!W&&H&&H.start<k[0].start&&(W=k[0])}else W=k[K-1];if(W=this.mapToInitFragWhenRequired(W),!W||this.fragmentTracker.getState(W)!==R.FragmentState.NOT_LOADED)return;W.encrypted?this.loadKey(W,d):this.loadFragment(W,d,o)}},e.loadFragment=function(i,v,d){this.fragCurrent=i,i.sn==="initSegment"?this._loadInitSegment(i):c.prototype.loadFragment.call(this,i,v,d)},A(f,[{key:"mediaBufferTimeRanges",get:function(){return new r(this.tracksBuffered[this.currentTrackId]||[])}}]),f}(P.default),r=function(f){this.buffered=void 0;var e=function(i,v,d){if(v=v>>>0,v>d-1)throw new DOMException("Failed to execute '"+i+"' on 'TimeRanges': The index provided ("+v+") is greater than the maximum bound ("+d+")");return f[v][i]};this.buffered={get length(){return f.length},end:function(i){return e("end",i,f.length)},start:function(i){return e("start",i,f.length)}}}},"./src/controller/subtitle-track-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>A});var M=u("./src/events.ts"),I=u("./src/utils/texttrack-utils.ts"),b=u("./src/controller/base-playlist-controller.ts"),C=u("./src/types/loader.ts");function F(x,y){for(var l=0;l<y.length;l++){var n=y[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(x,n.key,n)}}function R(x,y,l){return y&&F(x.prototype,y),l&&F(x,l),Object.defineProperty(x,"prototype",{writable:!1}),x}function P(x,y){x.prototype=Object.create(y.prototype),x.prototype.constructor=x,D(x,y)}function D(x,y){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},D(x,y)}var T=function(x){P(y,x);function y(n){var r;return r=x.call(this,n,"[subtitle-track-controller]")||this,r.media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}var l=y.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,x.prototype.destroy.call(this)},l.registerListeners=function(){var r=this.hls;r.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(M.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var r=this.hls;r.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(M.Events.ERROR,this.onError,this)},l.onMediaAttached=function(r,c){this.media=c.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},l.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var r=S(this.media.textTracks);r.forEach(function(c){(0,I.clearCurrentCues)(c)}),this.subtitleTrack=-1,this.media=null}},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(r,c){this.tracks=c.subtitleTracks},l.onSubtitleTrackLoaded=function(r,c){var f=c.id,e=c.details,t=this.trackId,i=this.tracksInGroup[t];if(!i){this.warn("Invalid subtitle track id "+f);return}var v=i.details;i.details=c.details,this.log("subtitle track "+f+" loaded ["+e.startSN+"-"+e.endSN+"]"),f===this.trackId&&(this.retryCount=0,this.playlistLoaded(f,c,v))},l.onLevelLoading=function(r,c){this.switchLevel(c.level)},l.onLevelSwitching=function(r,c){this.switchLevel(c.level)},l.switchLevel=function(r){var c=this.hls.levels[r];if(!!(c!=null&&c.textGroupIds)){var f=c.textGroupIds[c.urlId];if(this.groupId!==f){var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,t=this.tracks.filter(function(d){return!f||d.groupId===f});this.tracksInGroup=t;var i=this.findTrackId(e==null?void 0:e.name)||this.findTrackId();this.groupId=f;var v={subtitleTracks:t};this.log("Updating subtitle tracks, "+t.length+' track(s) found in "'+f+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,v),i!==-1&&this.setSubtitleTrack(i,e)}}},l.findTrackId=function(r){for(var c=this.tracksInGroup,f=0;f<c.length;f++){var e=c[f];if((!this.selectDefaultTrack||e.default)&&(!r||r===e.name))return e.id}return-1},l.onError=function(r,c){x.prototype.onError.call(this,r,c),!(c.fatal||!c.context)&&c.context.type===C.PlaylistContextType.SUBTITLE_TRACK&&c.context.id===this.trackId&&c.context.groupId===this.groupId&&this.retryLoadingOrFail(c)},l.loadPlaylist=function(r){var c=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(c)){var f=c.id,e=c.groupId,t=c.url;if(r)try{t=r.addDirectives(t)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Loading subtitle playlist for id "+f),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:t,id:f,groupId:e,deliveryDirectives:r||null})}},l.toggleTrackModes=function(r){var c=this,f=this.media,e=this.trackId;if(!!f){var t=S(f.textTracks),i=t.filter(function(p){return p.groupId===c.groupId});if(r===-1)[].slice.call(t).forEach(function(p){p.mode="disabled"});else{var v=i[e];v&&(v.mode="disabled")}var d=i[r];d&&(d.mode=this.subtitleDisplay?"showing":"hidden")}},l.setSubtitleTrack=function(r,c){var f,e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=r;return}if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(f=e[r])!==null&&f!==void 0&&f.details)||r<-1||r>=e.length)){this.clearTimer();var t=e[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,t){var i=t.id,v=t.groupId,d=v===void 0?"":v,p=t.name,s=t.type,g=t.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:i,groupId:d,name:p,type:s,url:g});var h=this.switchParams(t.url,c==null?void 0:c.details);this.loadPlaylist(h)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:r})}},l.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var r=-1,c=S(this.media.textTracks),f=0;f<c.length;f++)if(c[f].mode==="hidden")r=f;else if(c[f].mode==="showing"){r=f;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},R(y,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var c=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,c)}}]),y}(b.default);function S(x){for(var y=[],l=0;l<x.length;l++){var n=x[l];n.kind==="subtitles"&&n.label&&y.push(x[l])}return y}const A=T},"./src/controller/timeline-controller.ts":(G,B,u)=>{u.r(B),u.d(B,{TimelineController:()=>A});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/utils/cea-608-parser.ts"),C=u("./src/utils/output-filter.ts"),F=u("./src/utils/webvtt-parser.ts"),R=u("./src/utils/texttrack-utils.ts"),P=u("./src/utils/imsc1-ttml-parser.ts"),D=u("./src/utils/mp4-tools.ts"),T=u("./src/types/loader.ts"),S=u("./src/utils/logger.ts"),A=function(){function n(c){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=c,this.config=c.config,this.Cues=c.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var f=new C.default(this,"textTrack1"),e=new C.default(this,"textTrack2"),t=new C.default(this,"textTrack3"),i=new C.default(this,"textTrack4");this.cea608Parser1=new b.default(1,f,e),this.cea608Parser2=new b.default(3,t,i)}c.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),c.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),c.on(I.Events.FRAG_LOADING,this.onFragLoading,this),c.on(I.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(I.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),c.on(I.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),c.on(I.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),c.on(I.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),c.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var r=n.prototype;return r.destroy=function(){var f=this.hls;f.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),f.off(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),f.off(I.Events.FRAG_LOADING,this.onFragLoading,this),f.off(I.Events.FRAG_LOADED,this.onFragLoaded,this),f.off(I.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),f.off(I.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),f.off(I.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.off(I.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),f.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},r.addCues=function(f,e,t,i,v){for(var d=!1,p=v.length;p--;){var s=v[p],g=y(s[0],s[1],e,t);if(g>=0&&(s[0]=Math.min(s[0],e),s[1]=Math.max(s[1],t),d=!0,g/(t-e)>.5))return}if(d||v.push([e,t]),this.config.renderTextTracksNatively){var h=this.captionsTracks[f];this.Cues.newCue(h,e,t,i)}else{var o=this.Cues.newCue(null,e,t,i);this.hls.trigger(I.Events.CUES_PARSED,{type:"captions",cues:o,track:f})}},r.onInitPtsFound=function(f,e){var t=this,i=e.frag,v=e.id,d=e.initPTS,p=e.timescale,s=this.unparsedVttFrags;v==="main"&&(this.initPTS[i.cc]=d,this.timescale[i.cc]=p),s.length&&(this.unparsedVttFrags=[],s.forEach(function(g){t.onFragLoaded(I.Events.FRAG_LOADED,g)}))},r.getExistingTrack=function(f){var e=this.media;if(e)for(var t=0;t<e.textTracks.length;t++){var i=e.textTracks[t];if(i[f])return i}return null},r.createCaptionsTrack=function(f){this.config.renderTextTracksNatively?this.createNativeTrack(f):this.createNonNativeTrack(f)},r.createNativeTrack=function(f){if(!this.captionsTracks[f]){var e=this.captionsProperties,t=this.captionsTracks,i=this.media,v=e[f],d=v.label,p=v.languageCode,s=this.getExistingTrack(f);if(s)t[f]=s,(0,R.clearCurrentCues)(t[f]),(0,R.sendAddTrackEvent)(t[f],i);else{var g=this.createTextTrack("captions",d,p);g&&(g[f]=!0,t[f]=g)}}},r.createNonNativeTrack=function(f){if(!this.nonNativeCaptionsTracks[f]){var e=this.captionsProperties[f];if(!!e){var t=e.label,i={_id:f,label:t,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[f]=i,this.hls.trigger(I.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},r.createTextTrack=function(f,e,t){var i=this.media;if(!!i)return i.addTextTrack(f,e,t)},r.onMediaAttaching=function(f,e){this.media=e.media,this._cleanTracks()},r.onMediaDetaching=function(){var f=this.captionsTracks;Object.keys(f).forEach(function(e){(0,R.clearCurrentCues)(f[e]),delete f[e]}),this.nonNativeCaptionsTracks={}},r.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},r._cleanTracks=function(){var f=this.media;if(!!f){var e=f.textTracks;if(e)for(var t=0;t<e.length;t++)(0,R.clearCurrentCues)(e[t])}},r.onSubtitleTracksUpdated=function(f,e){var t=this;this.textTracks=[];var i=e.subtitleTracks||[],v=i.some(function(g){return g.textCodec===P.IMSC1_CODEC});if(this.config.enableWebVTT||v&&this.config.enableIMSC1){var d=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var p=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,h){var o;if(h<p.length){for(var _=null,O=0;O<p.length;O++)if(x(p[O],g)){_=p[O];break}_&&(o=_)}if(o)(0,R.clearCurrentCues)(o);else{var k=t._captionsOrSubtitlesFromCharacteristics(g);o=t.createTextTrack(k,g.name,g.lang),o&&(o.mode="disabled")}o&&(o.groupId=g.groupId,t.textTracks.push(o))})}else if(!d&&this.tracks&&this.tracks.length){var s=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(I.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}},r._captionsOrSubtitlesFromCharacteristics=function(f){var e;if((e=f.attrs)!==null&&e!==void 0&&e.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(f.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(f.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"},r.onManifestLoaded=function(f,e){var t=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(i){var v=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!v){var d="textTrack"+v[1],p=t.captionsProperties[d];!p||(p.label=i.name,i.lang&&(p.languageCode=i.lang),p.media=i)}})},r.closedCaptionsForLevel=function(f){var e=this.hls.levels[f.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]},r.onFragLoading=function(f,e){var t=this.cea608Parser1,i=this.cea608Parser2,v=this.lastSn,d=this.lastPartIndex;if(!(!this.enabled||!(t&&i))&&e.frag.type===T.PlaylistLevelType.MAIN){var p,s,g=e.frag.sn,h=(p=e==null||(s=e.part)===null||s===void 0?void 0:s.index)!=null?p:-1;g===v+1||g===v&&h===d+1||(t.reset(),i.reset()),this.lastSn=g,this.lastPartIndex=h}},r.onFragLoaded=function(f,e){var t=e.frag,i=e.payload,v=this.initPTS,d=this.unparsedVttFrags;if(t.type===T.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!(0,M.isFiniteNumber)(v[t.cc])){d.push(e),v.length&&this.hls.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")});return}var p=t.decryptdata,s="stats"in e;if(p==null||p.key==null||p.method!=="AES-128"||s){var g=this.tracks[t.level],h=this.vttCCs;h[t.cc]||(h[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),g&&g.textCodec===P.IMSC1_CODEC?this._parseIMSC1(t,i):this._parseVTTs(t,i,h)}}else this.hls.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},r._parseIMSC1=function(f,e){var t=this,i=this.hls;(0,P.parseIMSC1)(e,this.initPTS[f.cc],this.timescale[f.cc],function(v){t._appendCues(v,f.level),i.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:f})},function(v){S.logger.log("Failed to parse IMSC1: "+v),i.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f,error:v})})},r._parseVTTs=function(f,e,t){var i,v=this,d=this.hls,p=(i=f.initSegment)!==null&&i!==void 0&&i.data?(0,D.appendUint8Array)(f.initSegment.data,new Uint8Array(e)):e;(0,F.parseWebVTT)(p,this.initPTS[f.cc],this.timescale[f.cc],t,f.cc,f.start,function(s){v._appendCues(s,f.level),d.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:f})},function(s){v._fallbackToIMSC1(f,e),S.logger.log("Failed to parse VTT cue: "+s),d.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:f,error:s})})},r._fallbackToIMSC1=function(f,e){var t=this,i=this.tracks[f.level];i.textCodec||(0,P.parseIMSC1)(e,this.initPTS[f.cc],this.timescale[f.cc],function(){i.textCodec=P.IMSC1_CODEC,t._parseIMSC1(f,e)},function(){i.textCodec="wvtt"})},r._appendCues=function(f,e){var t=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||i.mode==="disabled")return;f.forEach(function(p){return(0,R.addCueToTrack)(i,p)})}else{var v=this.tracks[e];if(!v)return;var d=v.default?"default":"subtitles"+e;t.trigger(I.Events.CUES_PARSED,{type:"subtitles",cues:f,track:d})}},r.onFragDecrypted=function(f,e){var t=e.frag;if(t.type===T.PlaylistLevelType.SUBTITLE){if(!(0,M.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);return}this.onFragLoaded(I.Events.FRAG_LOADED,e)}},r.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},r.onFragParsingUserdata=function(f,e){var t=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(t&&i))){var v=e.frag,d=e.samples;if(!(v.type===T.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(v)==="NONE"))for(var p=0;p<d.length;p++){var s=d[p].bytes;if(s){var g=this.extractCea608Data(s);t.addData(d[p].pts,g[0]),i.addData(d[p].pts,g[1])}}}},r.onBufferFlushing=function(f,e){var t=e.startOffset,i=e.endOffset,v=e.endOffsetSubtitles,d=e.type,p=this.media;if(!(!p||p.currentTime<i)){if(!d||d==="video"){var s=this.captionsTracks;Object.keys(s).forEach(function(h){return(0,R.removeCuesInRange)(s[h],t,i)})}if(this.config.renderTextTracksNatively&&t===0&&v!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(h){return(0,R.removeCuesInRange)(g[h],t,v)})}}},r.extractCea608Data=function(f){for(var e=[[],[]],t=f[0]&31,i=2,v=0;v<t;v++){var d=f[i++],p=127&f[i++],s=127&f[i++];if(!(p===0&&s===0)){var g=(4&d)!==0;if(g){var h=3&d;(h===0||h===1)&&(e[h].push(p),e[h].push(s))}}}return e},n}();function x(n,r){return n&&n.label===r.name&&!(n.textTrack1||n.textTrack2)}function y(n,r,c,f){return Math.min(r,f)-Math.max(n,c)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>M});var M=function(){function I(C,F){this.subtle=void 0,this.aesIV=void 0,this.subtle=C,this.aesIV=F}var b=I.prototype;return b.decrypt=function(F,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,F)},I}()},"./src/crypt/aes-decryptor.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>b,removePadding:()=>I});var M=u("./src/utils/typed-array.ts");function I(C){var F=C.byteLength,R=F&&new DataView(C.buffer).getUint8(F-1);return R?(0,M.sliceUint8)(C,0,F-R):C}var b=function(){function C(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var F=C.prototype;return F.uint8ArrayToUint32Array_=function(P){for(var D=new DataView(P),T=new Uint32Array(4),S=0;S<4;S++)T[S]=D.getUint32(S*4);return T},F.initTable=function(){var P=this.sBox,D=this.invSBox,T=this.subMix,S=T[0],A=T[1],x=T[2],y=T[3],l=this.invSubMix,n=l[0],r=l[1],c=l[2],f=l[3],e=new Uint32Array(256),t=0,i=0,v=0;for(v=0;v<256;v++)v<128?e[v]=v<<1:e[v]=v<<1^283;for(v=0;v<256;v++){var d=i^i<<1^i<<2^i<<3^i<<4;d=d>>>8^d&255^99,P[t]=d,D[d]=t;var p=e[t],s=e[p],g=e[s],h=e[d]*257^d*16843008;S[t]=h<<24|h>>>8,A[t]=h<<16|h>>>16,x[t]=h<<8|h>>>24,y[t]=h,h=g*16843009^s*65537^p*257^t*16843008,n[d]=h<<24|h>>>8,r[d]=h<<16|h>>>16,c[d]=h<<8|h>>>24,f[d]=h,t?(t=p^e[e[e[g^p]]],i^=e[e[i]]):t=i=1}},F.expandKey=function(P){for(var D=this.uint8ArrayToUint32Array_(P),T=!0,S=0;S<D.length&&T;)T=D[S]===this.key[S],S++;if(!T){this.key=D;var A=this.keySize=D.length;if(A!==4&&A!==6&&A!==8)throw new Error("Invalid aes key size="+A);var x=this.ksRows=(A+6+1)*4,y,l,n=this.keySchedule=new Uint32Array(x),r=this.invKeySchedule=new Uint32Array(x),c=this.sBox,f=this.rcon,e=this.invSubMix,t=e[0],i=e[1],v=e[2],d=e[3],p,s;for(y=0;y<x;y++){if(y<A){p=n[y]=D[y];continue}s=p,y%A===0?(s=s<<8|s>>>24,s=c[s>>>24]<<24|c[s>>>16&255]<<16|c[s>>>8&255]<<8|c[s&255],s^=f[y/A|0]<<24):A>6&&y%A===4&&(s=c[s>>>24]<<24|c[s>>>16&255]<<16|c[s>>>8&255]<<8|c[s&255]),n[y]=p=(n[y-A]^s)>>>0}for(l=0;l<x;l++)y=x-l,l&3?s=n[y]:s=n[y-4],l<4||y<=4?r[l]=s:r[l]=t[c[s>>>24]]^i[c[s>>>16&255]]^v[c[s>>>8&255]]^d[c[s&255]],r[l]=r[l]>>>0}},F.networkToHostOrderSwap=function(P){return P<<24|(P&65280)<<8|(P&16711680)>>8|P>>>24},F.decrypt=function(P,D,T){for(var S=this.keySize+6,A=this.invKeySchedule,x=this.invSBox,y=this.invSubMix,l=y[0],n=y[1],r=y[2],c=y[3],f=this.uint8ArrayToUint32Array_(T),e=f[0],t=f[1],i=f[2],v=f[3],d=new Int32Array(P),p=new Int32Array(d.length),s,g,h,o,_,O,k,K,N,W,H,V,j,z,$=this.networkToHostOrderSwap;D<d.length;){for(N=$(d[D]),W=$(d[D+1]),H=$(d[D+2]),V=$(d[D+3]),_=N^A[0],O=V^A[1],k=H^A[2],K=W^A[3],j=4,z=1;z<S;z++)s=l[_>>>24]^n[O>>16&255]^r[k>>8&255]^c[K&255]^A[j],g=l[O>>>24]^n[k>>16&255]^r[K>>8&255]^c[_&255]^A[j+1],h=l[k>>>24]^n[K>>16&255]^r[_>>8&255]^c[O&255]^A[j+2],o=l[K>>>24]^n[_>>16&255]^r[O>>8&255]^c[k&255]^A[j+3],_=s,O=g,k=h,K=o,j=j+4;s=x[_>>>24]<<24^x[O>>16&255]<<16^x[k>>8&255]<<8^x[K&255]^A[j],g=x[O>>>24]<<24^x[k>>16&255]<<16^x[K>>8&255]<<8^x[_&255]^A[j+1],h=x[k>>>24]<<24^x[K>>16&255]<<16^x[_>>8&255]<<8^x[O&255]^A[j+2],o=x[K>>>24]<<24^x[_>>16&255]<<16^x[O>>8&255]<<8^x[k&255]^A[j+3],p[D]=$(s^e),p[D+1]=$(o^t),p[D+2]=$(h^i),p[D+3]=$(g^v),e=N,t=W,i=H,v=V,D=D+4}return p.buffer},C}()},"./src/crypt/decrypter.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>D});var M=u("./src/crypt/aes-crypto.ts"),I=u("./src/crypt/fast-aes-key.ts"),b=u("./src/crypt/aes-decryptor.ts"),C=u("./src/utils/logger.ts"),F=u("./src/utils/mp4-tools.ts"),R=u("./src/utils/typed-array.ts"),P=16,D=function(){function T(A,x,y){var l=y===void 0?{}:y,n=l.removePKCS7Padding,r=n===void 0?!0:n;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=A,this.config=x,this.removePKCS7Padding=r,r)try{var c=self.crypto;c&&(this.subtle=c.subtle||c.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var S=T.prototype;return S.destroy=function(){this.observer=null},S.isSync=function(){return this.config.enableSoftwareAES},S.flush=function(){var x=this.currentResult;if(!x){this.reset();return}var y=new Uint8Array(x);return this.reset(),this.removePKCS7Padding?(0,b.removePadding)(y):y},S.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},S.decrypt=function(x,y,l,n){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(x),y,l);var r=this.flush();r&&n(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(x),y,l).then(n)},S.softwareDecrypt=function(x,y,l){var n=this.currentIV,r=this.currentResult,c=this.remainderData;this.logOnce("JS AES decrypt"),c&&(x=(0,F.appendUint8Array)(c,x),this.remainderData=null);var f=this.getValidChunk(x);if(!f.length)return null;n&&(l=n);var e=this.softwareDecrypter;e||(e=this.softwareDecrypter=new b.default),e.expandKey(y);var t=r;return this.currentResult=e.decrypt(f.buffer,0,l),this.currentIV=(0,R.sliceUint8)(f,-16).buffer,t||null},S.webCryptoDecrypt=function(x,y,l){var n=this,r=this.subtle;return(this.key!==y||!this.fastAesKey)&&(this.key=y,this.fastAesKey=new I.default(r,y)),this.fastAesKey.expandKey().then(function(c){if(!r)return Promise.reject(new Error("web crypto not initialized"));var f=new M.default(r,l);return f.decrypt(x.buffer,c)}).catch(function(c){return n.onWebCryptoError(c,x,y,l)})},S.onWebCryptoError=function(x,y,l,n){return C.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",x),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(y,l,n)},S.getValidChunk=function(x){var y=x,l=x.length-x.length%P;return l!==x.length&&(y=(0,R.sliceUint8)(x,0,l),this.remainderData=(0,R.sliceUint8)(x,l)),y},S.logOnce=function(x){!this.logEnabled||(C.logger.log("[decrypter.ts]: "+x),this.logEnabled=!1)},T}()},"./src/crypt/fast-aes-key.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>M});var M=function(){function I(C,F){this.subtle=void 0,this.key=void 0,this.subtle=C,this.key=F}var b=I.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},I}()},"./src/demux/aacdemuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>D});var M=u("./src/demux/base-audio-demuxer.ts"),I=u("./src/demux/adts.ts"),b=u("./src/utils/logger.ts"),C=u("./src/demux/id3.ts");function F(T,S){T.prototype=Object.create(S.prototype),T.prototype.constructor=T,R(T,S)}function R(T,S){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,y){return x.__proto__=y,x},R(T,S)}var P=function(T){F(S,T);function S(x,y){var l;return l=T.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=x,l.config=y,l}var A=S.prototype;return A.resetInitSegment=function(y,l,n,r){T.prototype.resetInitSegment.call(this,y,l,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:r,inputTimeScale:9e4,dropped:0}},S.probe=function(y){if(!y)return!1;for(var l=C.getID3Data(y,0)||[],n=l.length,r=y.length;n<r;n++)if(I.probe(y,n))return b.logger.log("ADTS sync word found !"),!0;return!1},A.canParse=function(y,l){return I.canParse(y,l)},A.appendFrame=function(y,l,n){I.initTrackConfig(y,this.observer,l,n,y.manifestCodec);var r=I.appendFrame(y,l,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r},S}(M.default);const D=P},"./src/demux/adts.ts":(G,B,u)=>{u.r(B),u.d(B,{appendFrame:()=>n,canGetFrameLength:()=>D,canParse:()=>S,getAudioConfig:()=>C,getFrameDuration:()=>y,getFullFrameLength:()=>P,getHeaderLength:()=>R,initTrackConfig:()=>x,isHeader:()=>T,isHeaderPattern:()=>F,parseFrameHeader:()=>l,probe:()=>A});var M=u("./src/utils/logger.ts"),I=u("./src/errors.ts"),b=u("./src/events.ts");function C(r,c,f,e){var t,i,v,d,p=navigator.userAgent.toLowerCase(),s=e,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];t=((c[f+2]&192)>>>6)+1;var h=(c[f+2]&60)>>>2;if(h>g.length-1){r.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h});return}return v=(c[f+2]&1)<<2,v|=(c[f+3]&192)>>>6,M.logger.log("manifest codec:"+e+", ADTS type:"+t+", samplingIndex:"+h),/firefox/i.test(p)?h>=6?(t=5,d=new Array(4),i=h-3):(t=2,d=new Array(2),i=h):p.indexOf("android")!==-1?(t=2,d=new Array(2),i=h):(t=5,d=new Array(4),e&&(e.indexOf("mp4a.40.29")!==-1||e.indexOf("mp4a.40.5")!==-1)||!e&&h>=6?i=h-3:((e&&e.indexOf("mp4a.40.2")!==-1&&(h>=6&&v===1||/vivaldi/i.test(p))||!e&&v===1)&&(t=2,d=new Array(2)),i=h)),d[0]=t<<3,d[0]|=(h&14)>>1,d[1]|=(h&1)<<7,d[1]|=v<<3,t===5&&(d[1]|=(i&14)>>1,d[2]=(i&1)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:g[h],channelCount:v,codec:"mp4a.40."+t,manifestCodec:s}}function F(r,c){return r[c]===255&&(r[c+1]&246)===240}function R(r,c){return r[c+1]&1?7:9}function P(r,c){return(r[c+3]&3)<<11|r[c+4]<<3|(r[c+5]&224)>>>5}function D(r,c){return c+5<r.length}function T(r,c){return c+1<r.length&&F(r,c)}function S(r,c){return D(r,c)&&F(r,c)&&P(r,c)<=r.length-c}function A(r,c){if(T(r,c)){var f=R(r,c);if(c+f>=r.length)return!1;var e=P(r,c);if(e<=f)return!1;var t=c+e;return t===r.length||T(r,t)}return!1}function x(r,c,f,e,t){if(!r.samplerate){var i=C(c,f,e,t);if(!i)return;r.config=i.config,r.samplerate=i.samplerate,r.channelCount=i.channelCount,r.codec=i.codec,r.manifestCodec=i.manifestCodec,M.logger.log("parsed codec:"+r.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function y(r){return 9216e4/r}function l(r,c){var f=R(r,c);if(c+f<=r.length){var e=P(r,c)-f;if(e>0)return{headerLength:f,frameLength:e}}}function n(r,c,f,e,t){var i=y(r.samplerate),v=e+t*i,d=l(c,f),p;if(d){var s=d.frameLength,g=d.headerLength,h=g+s,o=Math.max(0,f+h-c.length);o?(p=new Uint8Array(h-g),p.set(c.subarray(f+g,c.length),0)):p=c.subarray(f+g,f+h);var _={unit:p,pts:v};return o||r.samples.push(_),{sample:_,length:h,missing:o}}var O=c.length-f;p=new Uint8Array(O),p.set(c.subarray(f,c.length),0);var k={unit:p,pts:v};return{sample:k,length:O,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>T,initPTSFn:()=>D});var M=u("./src/polyfills/number.ts"),I=u("./src/demux/id3.ts"),b=u("./src/types/demuxer.ts"),C=u("./src/demux/dummy-demuxed-track.ts"),F=u("./src/utils/mp4-tools.ts"),R=u("./src/utils/typed-array.ts"),P=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var A=S.prototype;return A.resetInitSegment=function(y,l,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},A.resetTimeStamp=function(y){this.initPTS=y,this.resetContiguity()},A.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},A.canParse=function(y,l){return!1},A.appendFrame=function(y,l,n){},A.demux=function(y,l){this.cachedData&&(y=(0,F.appendUint8Array)(this.cachedData,y),this.cachedData=null);var n=I.getID3Data(y,0),r=n?n.length:0,c,f=this._audioTrack,e=this._id3Track,t=n?I.getTimeStamp(n):void 0,i=y.length;for((this.basePTS===null||this.frameIndex===0&&(0,M.isFiniteNumber)(t))&&(this.basePTS=D(t,l,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&e.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});r<i;){if(this.canParse(y,r)){var v=this.appendFrame(f,y,r);v?(this.frameIndex++,this.lastPTS=v.sample.pts,r+=v.length,c=r):r=i}else I.canParse(y,r)?(n=I.getID3Data(y,r),e.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,c=r):r++;if(r===i&&c!==i){var d=(0,R.sliceUint8)(y,c);this.cachedData?this.cachedData=(0,F.appendUint8Array)(this.cachedData,d):this.cachedData=d}}return{audioTrack:f,videoTrack:(0,C.dummyTrack)(),id3Track:e,textTrack:(0,C.dummyTrack)()}},A.demuxSampleAes=function(y,l,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},A.flush=function(y){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,C.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,C.dummyTrack)()}},A.destroy=function(){},S}(),D=function(A,x,y){return(0,M.isFiniteNumber)(A)?A*90:x*9e4+(y||0)};const T=P},"./src/demux/chunk-cache.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>M});var M=function(){function b(){this.chunks=[],this.dataLength=0}var C=b.prototype;return C.push=function(R){this.chunks.push(R),this.dataLength+=R.length},C.flush=function(){var R=this.chunks,P=this.dataLength,D;if(R.length)R.length===1?D=R[0]:D=I(R,P);else return new Uint8Array(0);return this.reset(),D},C.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function I(b,C){for(var F=new Uint8Array(C),R=0,P=0;P<b.length;P++){var D=b[P];F.set(D,R),R+=D.length}return F}},"./src/demux/dummy-demuxed-track.ts":(G,B,u)=>{u.r(B),u.d(B,{dummyTrack:()=>M});function M(I,b){return I===void 0&&(I=""),b===void 0&&(b=9e4),{type:I,id:-1,pid:-1,inputTimeScale:b,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>b});var M=u("./src/utils/logger.ts"),I=function(){function C(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var F=C.prototype;return F.loadWord=function(){var P=this.data,D=this.bytesAvailable,T=P.byteLength-D,S=new Uint8Array(4),A=Math.min(4,D);if(A===0)throw new Error("no bytes available");S.set(P.subarray(T,T+A)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=A*8,this.bytesAvailable-=A},F.skipBits=function(P){var D;this.bitsAvailable>P?(this.word<<=P,this.bitsAvailable-=P):(P-=this.bitsAvailable,D=P>>3,P-=D>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=P,this.bitsAvailable-=P)},F.readBits=function(P){var D=Math.min(this.bitsAvailable,P),T=this.word>>>32-D;return P>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),D=P-D,D>0&&this.bitsAvailable?T<<D|this.readBits(D):T},F.skipLZ=function(){var P;for(P=0;P<this.bitsAvailable;++P)if((this.word&2147483648>>>P)!==0)return this.word<<=P,this.bitsAvailable-=P,P;return this.loadWord(),P+this.skipLZ()},F.skipUEG=function(){this.skipBits(1+this.skipLZ())},F.skipEG=function(){this.skipBits(1+this.skipLZ())},F.readUEG=function(){var P=this.skipLZ();return this.readBits(P+1)-1},F.readEG=function(){var P=this.readUEG();return 1&P?1+P>>>1:-1*(P>>>1)},F.readBoolean=function(){return this.readBits(1)===1},F.readUByte=function(){return this.readBits(8)},F.readUShort=function(){return this.readBits(16)},F.readUInt=function(){return this.readBits(32)},F.skipScalingList=function(P){for(var D=8,T=8,S,A=0;A<P;A++)T!==0&&(S=this.readEG(),T=(D+S+256)%256),D=T===0?D:T},F.readSPS=function(){var P=0,D=0,T=0,S=0,A,x,y,l=this.readUByte.bind(this),n=this.readBits.bind(this),r=this.readUEG.bind(this),c=this.readBoolean.bind(this),f=this.skipBits.bind(this),e=this.skipEG.bind(this),t=this.skipUEG.bind(this),i=this.skipScalingList.bind(this);l();var v=l();if(n(5),f(3),l(),t(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var d=r();if(d===3&&f(1),t(),t(),f(1),c())for(x=d!==3?8:12,y=0;y<x;y++)c()&&(y<6?i(16):i(64))}t();var p=r();if(p===0)r();else if(p===1)for(f(1),e(),e(),A=r(),y=0;y<A;y++)e();t(),f(1);var s=r(),g=r(),h=n(1);h===0&&f(1),f(1),c()&&(P=r(),D=r(),T=r(),S=r());var o=[1,1];if(c()&&c()){var _=l();switch(_){case 1:o=[1,1];break;case 2:o=[12,11];break;case 3:o=[10,11];break;case 4:o=[16,11];break;case 5:o=[40,33];break;case 6:o=[24,11];break;case 7:o=[20,11];break;case 8:o=[32,11];break;case 9:o=[80,33];break;case 10:o=[18,11];break;case 11:o=[15,11];break;case 12:o=[64,33];break;case 13:o=[160,99];break;case 14:o=[4,3];break;case 15:o=[3,2];break;case 16:o=[2,1];break;case 255:{o=[l()<<8|l(),l()<<8|l()];break}}}return{width:Math.ceil((s+1)*16-P*2-D*2),height:(2-h)*(g+1)*16-(h?2:4)*(T+S),pixelRatio:o}},F.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},C}();const b=I},"./src/demux/id3.ts":(G,B,u)=>{u.r(B),u.d(B,{canParse:()=>F,decodeFrame:()=>S,getID3Data:()=>b,getID3Frames:()=>T,getTimeStamp:()=>R,isFooter:()=>I,isHeader:()=>M,isTimeStampFrame:()=>P,testables:()=>r,utf8ArrayToStr:()=>n});var M=function(t,i){return i+10<=t.length&&t[i]===73&&t[i+1]===68&&t[i+2]===51&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},I=function(t,i){return i+10<=t.length&&t[i]===51&&t[i+1]===68&&t[i+2]===73&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},b=function(t,i){for(var v=i,d=0;M(t,i);){d+=10;var p=C(t,i+6);d+=p,I(t,i+10)&&(d+=10),i+=d}if(d>0)return t.subarray(v,v+d)},C=function(t,i){var v=0;return v=(t[i]&127)<<21,v|=(t[i+1]&127)<<14,v|=(t[i+2]&127)<<7,v|=t[i+3]&127,v},F=function(t,i){return M(t,i)&&C(t,i+6)+10<=t.length-i},R=function(t){for(var i=T(t),v=0;v<i.length;v++){var d=i[v];if(P(d))return l(d)}},P=function(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"},D=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),v=C(t,4),d=10;return{type:i,size:v,data:t.subarray(d,d+v)}},T=function(t){for(var i=0,v=[];M(t,i);){var d=C(t,i+6);i+=10;for(var p=i+d;i+8<p;){var s=D(t.subarray(i)),g=S(s);g&&v.push(g),i+=s.size+10}I(t,i)&&(i+=10)}return v},S=function(t){return t.type==="PRIV"?A(t):t.type[0]==="W"?y(t):x(t)},A=function(t){if(!(t.size<2)){var i=n(t.data,!0),v=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:v.buffer}}},x=function(t){if(!(t.size<2)){if(t.type==="TXXX"){var i=1,v=n(t.data.subarray(i),!0);i+=v.length+1;var d=n(t.data.subarray(i));return{key:t.type,info:v,data:d}}var p=n(t.data.subarray(1));return{key:t.type,data:p}}},y=function(t){if(t.type==="WXXX"){if(t.size<2)return;var i=1,v=n(t.data.subarray(i),!0);i+=v.length+1;var d=n(t.data.subarray(i));return{key:t.type,info:v,data:d}}var p=n(t.data);return{key:t.type,data:p}},l=function(t){if(t.data.byteLength===8){var i=new Uint8Array(t.data),v=i[3]&1,d=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return d/=45,v&&(d+=4772185884e-2),Math.round(d)}},n=function(t,i){i===void 0&&(i=!1);var v=f();if(v){var d=v.decode(t);if(i){var p=d.indexOf("\0");return p!==-1?d.substring(0,p):d}return d.replace(/\0/g,"")}for(var s=t.length,g,h,o,_="",O=0;O<s;){if(g=t[O++],g===0&&i)return _;if(g===0||g===3)continue;switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:_+=String.fromCharCode(g);break;case 12:case 13:h=t[O++],_+=String.fromCharCode((g&31)<<6|h&63);break;case 14:h=t[O++],o=t[O++],_+=String.fromCharCode((g&15)<<12|(h&63)<<6|(o&63)<<0);break}}return _},r={decodeTextFrame:x},c;function f(){return!c&&typeof self.TextDecoder<"u"&&(c=new self.TextDecoder("utf-8")),c}},"./src/demux/mp3demuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>D});var M=u("./src/demux/base-audio-demuxer.ts"),I=u("./src/demux/id3.ts"),b=u("./src/utils/logger.ts"),C=u("./src/demux/mpegaudio.ts");function F(T,S){T.prototype=Object.create(S.prototype),T.prototype.constructor=T,R(T,S)}function R(T,S){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,y){return x.__proto__=y,x},R(T,S)}var P=function(T){F(S,T);function S(){return T.apply(this,arguments)||this}var A=S.prototype;return A.resetInitSegment=function(y,l,n,r){T.prototype.resetInitSegment.call(this,y,l,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:r,inputTimeScale:9e4,dropped:0}},S.probe=function(y){if(!y)return!1;for(var l=I.getID3Data(y,0)||[],n=l.length,r=y.length;n<r;n++)if(C.probe(y,n))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},A.canParse=function(y,l){return C.canParse(y,l)},A.appendFrame=function(y,l,n){if(this.basePTS!==null)return C.appendFrame(y,l,n,this.basePTS,this.frameIndex)},S}(M.default);const D=P},"./src/demux/mp4demuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>P});var M=u("./src/polyfills/number.ts"),I=u("./src/types/demuxer.ts"),b=u("./src/utils/mp4-tools.ts"),C=u("./src/demux/dummy-demuxed-track.ts"),F=/\/emsg[-/]ID3/i,R=function(){function D(S,A){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=A}var T=D.prototype;return T.resetTimeStamp=function(){},T.resetInitSegment=function(A,x,y,l){var n=(0,b.parseInitSegment)(A),r=this.videoTrack=(0,C.dummyTrack)("video",1),c=this.audioTrack=(0,C.dummyTrack)("audio",1),f=this.txtTrack=(0,C.dummyTrack)("text",1);if(this.id3Track=(0,C.dummyTrack)("id3",1),this.timeOffset=0,n.video){var e=n.video,t=e.id,i=e.timescale,v=e.codec;r.id=t,r.timescale=f.timescale=i,r.codec=v}if(n.audio){var d=n.audio,p=d.id,s=d.timescale,g=d.codec;c.id=p,c.timescale=s,c.codec=g}f.id=b.RemuxerTrackIdConfig.text,r.sampleDuration=0,r.duration=c.duration=l},T.resetContiguity=function(){},D.probe=function(A){return A=A.length>16384?A.subarray(0,16384):A,(0,b.findBox)(A,["moof"]).length>0},T.demux=function(A,x){this.timeOffset=x;var y=A,l=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(y=(0,b.appendUint8Array)(this.remainderData,A));var r=(0,b.segmentValidRange)(y);this.remainderData=r.remainder,l.samples=r.valid||new Uint8Array}else l.samples=y;var c=this.extractID3Track(l,x);return n.samples=(0,b.parseSamples)(x,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:c,textTrack:this.txtTrack}},T.flush=function(){var A=this.timeOffset,x=this.videoTrack,y=this.txtTrack;x.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(x,this.timeOffset);return y.samples=(0,b.parseSamples)(A,x),{videoTrack:x,audioTrack:(0,C.dummyTrack)(),id3Track:l,textTrack:(0,C.dummyTrack)()}},T.extractID3Track=function(A,x){var y=this.id3Track;if(A.samples.length){var l=(0,b.findBox)(A.samples,["emsg"]);l&&l.forEach(function(n){var r=(0,b.parseEmsg)(n);if(F.test(r.schemeIdUri)){var c=(0,M.isFiniteNumber)(r.presentationTime)?r.presentationTime/r.timeScale:x+r.presentationTimeDelta/r.timeScale,f=r.eventDuration===4294967295?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);var e=r.payload;y.samples.push({data:e,len:e.byteLength,dts:c,pts:c,type:I.MetadataSchema.emsg,duration:f})}})}return y},T.demuxSampleAes=function(A,x,y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},T.destroy=function(){},D}();const P=R},"./src/demux/mpegaudio.ts":(G,B,u)=>{u.r(B),u.d(B,{appendFrame:()=>R,canParse:()=>S,isHeader:()=>T,isHeaderPattern:()=>D,parseHeader:()=>P,probe:()=>A});var M=null,I=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],C=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],F=[0,1,1,4];function R(x,y,l,n,r){if(!(l+24>y.length)){var c=P(y,l);if(c&&l+c.frameLength<=y.length){var f=c.samplesPerFrame*9e4/c.sampleRate,e=n+r*f,t={unit:y.subarray(l,l+c.frameLength),pts:e,dts:e};return x.config=[],x.channelCount=c.channelCount,x.samplerate=c.sampleRate,x.samples.push(t),{sample:t,length:c.frameLength,missing:0}}}}function P(x,y){var l=x[y+1]>>3&3,n=x[y+1]>>1&3,r=x[y+2]>>4&15,c=x[y+2]>>2&3;if(l!==1&&r!==0&&r!==15&&c!==3){var f=x[y+2]>>1&1,e=x[y+3]>>6,t=l===3?3-n:n===3?3:4,i=I[t*14+r-1]*1e3,v=l===3?0:l===2?1:2,d=b[v*3+c],p=e===3?1:2,s=C[l][n],g=F[n],h=s*8*g,o=Math.floor(s*i/d+f)*g;if(M===null){var _=navigator.userAgent||"",O=_.match(/Chrome\/(\d+)/i);M=O?parseInt(O[1]):0}var k=!!M&&M<=87;return k&&n===2&&i>=224e3&&e===0&&(x[y+3]=x[y+3]|128),{sampleRate:d,channelCount:p,frameLength:o,samplesPerFrame:h}}}function D(x,y){return x[y]===255&&(x[y+1]&224)===224&&(x[y+1]&6)!==0}function T(x,y){return y+1<x.length&&D(x,y)}function S(x,y){var l=4;return D(x,y)&&l<=x.length-y}function A(x,y){if(y+1<x.length&&D(x,y)){var l=4,n=P(x,y),r=l;n!=null&&n.frameLength&&(r=n.frameLength);var c=y+r;return c===x.length||T(x,c)}return!1}},"./src/demux/sample-aes.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>C});var M=u("./src/crypt/decrypter.ts"),I=u("./src/utils/mp4-tools.ts"),b=function(){function F(P,D,T){this.keyData=void 0,this.decrypter=void 0,this.keyData=T,this.decrypter=new M.default(P,D,{removePKCS7Padding:!1})}var R=F.prototype;return R.decryptBuffer=function(D,T){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,T)},R.decryptAacSample=function(D,T,S,A){var x=D[T].unit;if(!(x.length<=16)){var y=x.subarray(16,x.length-x.length%16),l=y.buffer.slice(y.byteOffset,y.byteOffset+y.length),n=this;this.decryptBuffer(l,function(r){var c=new Uint8Array(r);x.set(c,16),A||n.decryptAacSamples(D,T+1,S)})}},R.decryptAacSamples=function(D,T,S){for(;;T++){if(T>=D.length){S();return}if(!(D[T].unit.length<32)){var A=this.decrypter.isSync();if(this.decryptAacSample(D,T,S,A),!A)return}}},R.getAvcEncryptedData=function(D){for(var T=Math.floor((D.length-48)/160)*16+16,S=new Int8Array(T),A=0,x=32;x<D.length-16;x+=160,A+=16)S.set(D.subarray(x,x+16),A);return S},R.getAvcDecryptedUnit=function(D,T){for(var S=new Uint8Array(T),A=0,x=32;x<D.length-16;x+=160,A+=16)D.set(S.subarray(A,A+16),x);return D},R.decryptAvcSample=function(D,T,S,A,x,y){var l=(0,I.discardEPB)(x.data),n=this.getAvcEncryptedData(l),r=this;this.decryptBuffer(n.buffer,function(c){x.data=r.getAvcDecryptedUnit(l,c),y||r.decryptAvcSamples(D,T,S+1,A)})},R.decryptAvcSamples=function(D,T,S,A){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,S=0){if(T>=D.length){A();return}for(var x=D[T].units;!(S>=x.length);S++){var y=x[S];if(!(y.data.length<=48||y.type!==1&&y.type!==5)){var l=this.decrypter.isSync();if(this.decryptAvcSample(D,T,S,A,y,l),!l)return}}}},F}();const C=b},"./src/demux/transmuxer-interface.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>T});var M=u("./src/demux/webworkify-webpack.js"),I=u("./src/events.ts"),b=u("./src/demux/transmuxer.ts"),C=u("./src/utils/logger.ts"),F=u("./src/errors.ts"),R=u("./src/utils/mediasource-helper.ts"),P=u("./node_modules/eventemitter3/index.js"),D=(0,R.getMediaSource)()||{isTypeSupported:function(){return!1}},T=function(){function S(x,y,l,n){var r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var c=x.config;this.hls=x,this.id=y,this.useWorker=!!c.enableWorker,this.onTransmuxComplete=l,this.onFlush=n;var f=function(d,p){p=p||{},p.frag=r.frag,p.id=r.id,r.hls.trigger(d,p)};this.observer=new P.EventEmitter,this.observer.on(I.Events.FRAG_DECRYPTED,f),this.observer.on(I.Events.ERROR,f);var e={mp4:D.isTypeSupported("video/mp4"),mpeg:D.isTypeSupported("audio/mpeg"),mp3:D.isTypeSupported('audio/mp4; codecs="mp3"')},t=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){C.logger.log("demuxing in webworker");var i;try{i=this.worker=(0,M.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(v){r.useWorker=!1,C.logger.warn("Exception in webworker, fallback to inline"),r.hls.trigger(I.Events.ERROR,{type:F.ErrorTypes.OTHER_ERROR,details:F.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(v.message+"  ("+v.filename+":"+v.lineno+")")})},i.postMessage({cmd:"init",typeSupported:e,vendor:t,id:y,config:JSON.stringify(c)})}catch(v){C.logger.warn("Error in worker:",v),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),i&&self.URL.revokeObjectURL(i.objectURL),this.transmuxer=new b.default(this.observer,e,c,t,y),this.worker=null}}else this.transmuxer=new b.default(this.observer,e,c,t,y)}var A=S.prototype;return A.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},A.push=function(y,l,n,r,c,f,e,t,i,v){var d,p,s=this;i.transmuxing.start=self.performance.now();var g=this.transmuxer,h=this.worker,o=f?f.start:c.start,_=c.decryptdata,O=this.frag,k=!(O&&c.cc===O.cc),K=!(O&&i.level===O.level),N=O?i.sn-O.sn:-1,W=this.part?i.part-this.part.index:-1,H=N===0&&i.id>1&&i.id===(O==null?void 0:O.stats.chunkCount),V=!K&&(N===1||N===0&&(W===1||H&&W<=0)),j=self.performance.now();(K||N||c.stats.parsing.start===0)&&(c.stats.parsing.start=j),f&&(W||!V)&&(f.stats.parsing.start=j);var z=!(O&&((d=c.initSegment)===null||d===void 0?void 0:d.url)===((p=O.initSegment)===null||p===void 0?void 0:p.url)),$=new b.TransmuxState(k,V,t,K,o,z);if(!V||k||z){C.logger.log("[transmuxer-interface, "+c.type+"]: Starting new transmux session for sn: "+i.sn+" p: "+i.part+" level: "+i.level+" id: "+i.id+`
        discontinuity: `+k+`
        trackSwitch: `+K+`
        contiguous: `+V+`
        accurateTimeOffset: `+t+`
        timeOffset: `+o+`
        initSegmentChange: `+z);var Y=new b.TransmuxConfig(n,r,l,e,v);this.configureTransmuxer(Y)}if(this.frag=c,this.part=f,h)h.postMessage({cmd:"demux",data:y,decryptdata:_,chunkMeta:i,state:$},y instanceof ArrayBuffer?[y]:[]);else if(g){var X=g.push(y,_,i,$);(0,b.isPromise)(X)?X.then(function(Q){s.handleTransmuxComplete(Q)}):this.handleTransmuxComplete(X)}},A.flush=function(y){var l=this;y.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:y});else if(n){var c=n.flush(y);(0,b.isPromise)(c)?c.then(function(f){l.handleFlushResult(f,y)}):this.handleFlushResult(c,y)}},A.handleFlushResult=function(y,l){var n=this;y.forEach(function(r){n.handleTransmuxComplete(r)}),this.onFlush(l)},A.onWorkerMessage=function(y){var l=y.data,n=this.hls;switch(l.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":C.logger[l.data.logType]&&C.logger[l.data.logType](l.data.message);break;default:{l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,n.trigger(l.event,l.data);break}}},A.configureTransmuxer=function(y){var l=this.worker,n=this.transmuxer;l?l.postMessage({cmd:"configure",config:y}):n&&n.configure(y)},A.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},S}()},"./src/demux/transmuxer-worker.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>F});var M=u("./src/demux/transmuxer.ts"),I=u("./src/events.ts"),b=u("./src/utils/logger.ts"),C=u("./node_modules/eventemitter3/index.js");function F(S){var A=new C.EventEmitter,x=function(n,r){S.postMessage({event:n,data:r})};A.on(I.Events.FRAG_DECRYPTED,x),A.on(I.Events.ERROR,x);var y=function(){var n=function(f){var e=function(i){x("workerLog",{logType:f,message:i})};b.logger[f]=e};for(var r in b.logger)n(r)};S.addEventListener("message",function(l){var n=l.data;switch(n.cmd){case"init":{var r=JSON.parse(n.config);S.transmuxer=new M.default(A,n.typeSupported,r,n.vendor,n.id),(0,b.enableLogs)(r.debug,n.id),y(),x("init",null);break}case"configure":{S.transmuxer.configure(n.config);break}case"demux":{var c=S.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);(0,M.isPromise)(c)?c.then(function(t){R(S,t)}):R(S,c);break}case"flush":{var f=n.chunkMeta,e=S.transmuxer.flush(f);(0,M.isPromise)(e)?e.then(function(t){D(S,t,f)}):D(S,e,f);break}}})}function R(S,A){if(T(A.remuxResult))return!1;var x=[],y=A.remuxResult,l=y.audio,n=y.video;return l&&P(x,l),n&&P(x,n),S.postMessage({event:"transmuxComplete",data:A},x),!0}function P(S,A){A.data1&&S.push(A.data1.buffer),A.data2&&S.push(A.data2.buffer)}function D(S,A,x){var y=A.reduce(function(l,n){return R(S,n)||l},!1);y||S.postMessage({event:"transmuxComplete",data:A[0]}),S.postMessage({event:"flush",data:x})}function T(S){return!S.audio&&!S.video&&!S.text&&!S.id3&&!S.initSegment}},"./src/demux/transmuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{TransmuxConfig:()=>c,TransmuxState:()=>f,default:()=>y,isPromise:()=>r});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/crypt/decrypter.ts"),C=u("./src/demux/aacdemuxer.ts"),F=u("./src/demux/mp4demuxer.ts"),R=u("./src/demux/tsdemuxer.ts"),P=u("./src/demux/mp3demuxer.ts"),D=u("./src/remux/mp4-remuxer.ts"),T=u("./src/remux/passthrough-remuxer.ts"),S=u("./src/utils/logger.ts"),A;try{A=self.performance.now.bind(self.performance)}catch{S.logger.debug("Unable to use Performance API on this environment"),A=self.Date.now}var x=[{demux:R.default,remux:D.default},{demux:F.default,remux:T.default},{demux:C.default,remux:D.default},{demux:P.default,remux:D.default}],y=function(){function e(i,v,d,p,s){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=i,this.typeSupported=v,this.config=d,this.vendor=p,this.id=s}var t=e.prototype;return t.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},t.push=function(v,d,p,s){var g=this,h=p.transmuxing;h.executeStart=A();var o=new Uint8Array(v),_=this.config,O=this.currentTransmuxState,k=this.transmuxConfig;s&&(this.currentTransmuxState=s);var K=s||O,N=K.contiguous,W=K.discontinuity,H=K.trackSwitch,V=K.accurateTimeOffset,j=K.timeOffset,z=K.initSegmentChange,$=k.audioCodec,Y=k.videoCodec,X=k.defaultInitPts,Q=k.duration,q=k.initSegmentData;(W||H||z)&&this.resetInitSegment(q,$,Y,Q),(W||z)&&this.resetInitialTimestamp(X),N||this.resetContiguity();var J=l(o,d);if(J&&J.method==="AES-128"){var ie=this.getDecrypter();if(_.enableSoftwareAES){var se=ie.softwareDecrypt(o,J.key.buffer,J.iv.buffer);if(!se)return h.executeEnd=A(),n(p);o=new Uint8Array(se)}else return this.decryptionPromise=ie.webCryptoDecrypt(o,J.key.buffer,J.iv.buffer).then(function(fe){var oe=g.push(fe,null,p);return g.decryptionPromise=null,oe}),this.decryptionPromise}this.needsProbing(o,W,H)&&this.configureTransmuxer(o,k);var Z=this.transmux(o,J,j,V,p),re=this.currentTransmuxState;return re.contiguous=!0,re.discontinuity=!1,re.trackSwitch=!1,h.executeEnd=A(),Z},t.flush=function(v){var d=this,p=v.transmuxing;p.executeStart=A();var s=this.decrypter,g=this.currentTransmuxState,h=this.decryptionPromise;if(h)return h.then(function(){return d.flush(v)});var o=[],_=g.timeOffset;if(s){var O=s.flush();O&&o.push(this.push(O,null,v))}var k=this.demuxer,K=this.remuxer;if(!k||!K)return this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),p.executeEnd=A(),[n(v)];var N=k.flush(_);return r(N)?N.then(function(W){return d.flushRemux(o,W,v),o}):(this.flushRemux(o,N,v),o)},t.flushRemux=function(v,d,p){var s=d.audioTrack,g=d.videoTrack,h=d.id3Track,o=d.textTrack,_=this.currentTransmuxState,O=_.accurateTimeOffset,k=_.timeOffset;S.logger.log("[transmuxer.ts]: Flushed fragment "+p.sn+(p.part>-1?" p: "+p.part:"")+" of level "+p.level);var K=this.remuxer.remux(s,g,h,o,k,O,!0,this.id);v.push({remuxResult:K,chunkMeta:p}),p.transmuxing.executeEnd=A()},t.resetInitialTimestamp=function(v){var d=this.demuxer,p=this.remuxer;!d||!p||(d.resetTimeStamp(v),p.resetTimeStamp(v))},t.resetContiguity=function(){var v=this.demuxer,d=this.remuxer;!v||!d||(v.resetContiguity(),d.resetNextTimestamp())},t.resetInitSegment=function(v,d,p,s){var g=this.demuxer,h=this.remuxer;!g||!h||(g.resetInitSegment(v,d,p,s),h.resetInitSegment(v,d,p))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(v,d,p,s,g){var h;return d&&d.method==="SAMPLE-AES"?h=this.transmuxSampleAes(v,d,p,s,g):h=this.transmuxUnencrypted(v,p,s,g),h},t.transmuxUnencrypted=function(v,d,p,s){var g=this.demuxer.demux(v,d,!1,!this.config.progressive),h=g.audioTrack,o=g.videoTrack,_=g.id3Track,O=g.textTrack,k=this.remuxer.remux(h,o,_,O,d,p,!1,this.id);return{remuxResult:k,chunkMeta:s}},t.transmuxSampleAes=function(v,d,p,s,g){var h=this;return this.demuxer.demuxSampleAes(v,d,p).then(function(o){var _=h.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,p,s,!1,h.id);return{remuxResult:_,chunkMeta:g}})},t.configureTransmuxer=function(v,d){for(var p=this.config,s=this.observer,g=this.typeSupported,h=this.vendor,o=d.audioCodec,_=d.defaultInitPts,O=d.duration,k=d.initSegmentData,K=d.videoCodec,N,W=0,H=x.length;W<H;W++)if(x[W].demux.probe(v)){N=x[W];break}N||(S.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:F.default,remux:T.default});var V=this.demuxer,j=this.remuxer,z=N.remux,$=N.demux;(!j||!(j instanceof z))&&(this.remuxer=new z(s,p,g,h)),(!V||!(V instanceof $))&&(this.demuxer=new $(s,p,g),this.probe=$.probe),this.resetInitSegment(k,o,K,O),this.resetInitialTimestamp(_)},t.needsProbing=function(v,d,p){return!this.demuxer||!this.remuxer||d||p},t.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new b.default(this.observer,this.config)),v},e}();function l(e,t){var i=null;return e.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(i=t),i}var n=function(t){return{remuxResult:{},chunkMeta:t}};function r(e){return"then"in e&&e.then instanceof Function}var c=function(t,i,v,d,p){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=i,this.initSegmentData=v,this.duration=d,this.defaultInitPts=p},f=function(t,i,v,d,p,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=i,this.accurateTimeOffset=v,this.trackSwitch=d,this.timeOffset=p,this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>f});var M=u("./src/demux/adts.ts"),I=u("./src/demux/mpegaudio.ts"),b=u("./src/demux/exp-golomb.ts"),C=u("./src/demux/sample-aes.ts"),F=u("./src/events.ts"),R=u("./src/utils/mp4-tools.ts"),P=u("./src/utils/logger.ts"),D=u("./src/errors.ts"),T=u("./src/types/demuxer.ts");function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var v in i)Object.prototype.hasOwnProperty.call(i,v)&&(e[v]=i[v])}return e},S.apply(this,arguments)}var A=188,x=function(){function e(i,v,d){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=i,this.config=v,this.typeSupported=d}e.probe=function(v){var d=e.syncOffset(v);return d>0&&P.logger.warn("MPEG2-TS detected but first sync word found @ offset "+d),d!==-1},e.syncOffset=function(v){for(var d=Math.min(A*5,v.length-A*2)+1,p=0;p<d;){if(v[p]===71&&v[p+A]===71)return p;p++}return-1},e.createTrack=function(v,d){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:R.RemuxerTrackIdConfig[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?d:void 0}};var t=e.prototype;return t.resetInitSegment=function(v,d,p,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",s),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=d,this.videoCodec=p,this._duration=s},t.resetTimeStamp=function(){},t.resetContiguity=function(){var v=this._audioTrack,d=this._avcTrack,p=this._id3Track;v&&(v.pesData=null),d&&(d.pesData=null),p&&(p.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(v,d,p,s){p===void 0&&(p=!1),s===void 0&&(s=!1),p||(this.sampleAes=null);var g,h=this._avcTrack,o=this._audioTrack,_=this._id3Track,O=this._txtTrack,k=h.pid,K=h.pesData,N=o.pid,W=_.pid,H=o.pesData,V=_.pesData,j=null,z=this.pmtParsed,$=this._pmtId,Y=v.length;if(this.remainderData&&(v=(0,R.appendUint8Array)(this.remainderData,v),Y=v.length,this.remainderData=null),Y<A&&!s)return this.remainderData=v,{audioTrack:o,videoTrack:h,id3Track:_,textTrack:O};var X=Math.max(0,e.syncOffset(v));Y-=(Y-X)%A,Y<v.byteLength&&!s&&(this.remainderData=new Uint8Array(v.buffer,Y,v.buffer.byteLength-Y));for(var Q=0,q=X;q<Y;q+=A)if(v[q]===71){var J=!!(v[q+1]&64),ie=((v[q+1]&31)<<8)+v[q+2],se=(v[q+3]&48)>>4,Z=void 0;if(se>1){if(Z=q+5+v[q+4],Z===q+A)continue}else Z=q+4;switch(ie){case k:J&&(K&&(g=r(K))&&this.parseAVCPES(h,O,g,!1),K={data:[],size:0}),K&&(K.data.push(v.subarray(Z,q+A)),K.size+=q+A-Z);break;case N:if(J){if(H&&(g=r(H)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,g);break;case"mp3":this.parseMPEGPES(o,g);break}H={data:[],size:0}}H&&(H.data.push(v.subarray(Z,q+A)),H.size+=q+A-Z);break;case W:J&&(V&&(g=r(V))&&this.parseID3PES(_,g),V={data:[],size:0}),V&&(V.data.push(v.subarray(Z,q+A)),V.size+=q+A-Z);break;case 0:J&&(Z+=v[Z]+1),$=this._pmtId=l(v,Z);break;case $:{J&&(Z+=v[Z]+1);var re=n(v,Z,this.typeSupported,p);k=re.avc,k>0&&(h.pid=k),N=re.audio,N>0&&(o.pid=N,o.segmentCodec=re.segmentCodec),W=re.id3,W>0&&(_.pid=W),j!==null&&!z&&(P.logger.log("unknown PID '"+j+"' in TS found"),j=null,q=X-188),z=this.pmtParsed=!0;break}case 17:case 8191:break;default:j=ie;break}}else Q++;Q>0&&this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Q+" TS packet/s that do not start with 0x47"}),h.pesData=K,o.pesData=H,_.pesData=V;var fe={audioTrack:o,videoTrack:h,id3Track:_,textTrack:O};return s&&this.extractRemainingSamples(fe),fe},t.flush=function(){var v=this.remainderData;this.remainderData=null;var d;return v?d=this.demux(v,-1,!1,!0):d={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(d),this.sampleAes?this.decrypt(d,this.sampleAes):d},t.extractRemainingSamples=function(v){var d=v.audioTrack,p=v.videoTrack,s=v.id3Track,g=v.textTrack,h=p.pesData,o=d.pesData,_=s.pesData,O;if(h&&(O=r(h))?(this.parseAVCPES(p,g,O,!0),p.pesData=null):p.pesData=h,o&&(O=r(o))){switch(d.segmentCodec){case"aac":this.parseAACPES(d,O);break;case"mp3":this.parseMPEGPES(d,O);break}d.pesData=null}else o!=null&&o.size&&P.logger.log("last AAC PES packet truncated,might overlap between fragments"),d.pesData=o;_&&(O=r(_))?(this.parseID3PES(s,O),s.pesData=null):s.pesData=_},t.demuxSampleAes=function(v,d,p){var s=this.demux(v,p,!0,!this.config.progressive),g=this.sampleAes=new C.default(this.observer,this.config,d);return this.decrypt(s,g)},t.decrypt=function(v,d){return new Promise(function(p){var s=v.audioTrack,g=v.videoTrack;s.samples&&s.segmentCodec==="aac"?d.decryptAacSamples(s.samples,0,function(){g.samples?d.decryptAvcSamples(g.samples,0,0,function(){p(v)}):p(v)}):g.samples&&d.decryptAvcSamples(g.samples,0,0,function(){p(v)})})},t.destroy=function(){this._duration=0},t.parseAVCPES=function(v,d,p,s){var g=this,h=this.parseAVCNALu(v,p.data),o=this.avcSample,_,O=!1;p.data=null,o&&h.length&&!v.audFound&&(c(o,v),o=this.avcSample=y(!1,p.pts,p.dts,"")),h.forEach(function(k){switch(k.type){case 1:{_=!0,o||(o=g.avcSample=y(!0,p.pts,p.dts,"")),o.frame=!0;var K=k.data;if(O&&K.length>4){var N=new b.default(K).readSliceType();(N===2||N===4||N===7||N===9)&&(o.key=!0)}break}case 5:_=!0,o||(o=g.avcSample=y(!0,p.pts,p.dts,"")),o.key=!0,o.frame=!0;break;case 6:{_=!0,(0,R.parseSEIMessageFromNALu)(k.data,1,p.pts,d.samples);break}case 7:if(_=!0,O=!0,!v.sps){var W=new b.default(k.data),H=W.readSPS();v.width=H.width,v.height=H.height,v.pixelRatio=H.pixelRatio,v.sps=[k.data],v.duration=g._duration;for(var V=k.data.subarray(1,4),j="avc1.",z=0;z<3;z++){var $=V[z].toString(16);$.length<2&&($="0"+$),j+=$}v.codec=j}break;case 8:_=!0,v.pps||(v.pps=[k.data]);break;case 9:_=!1,v.audFound=!0,o&&c(o,v),o=g.avcSample=y(!1,p.pts,p.dts,"");break;case 12:_=!0;break;default:_=!1,o&&(o.debug+="unknown NAL "+k.type+" ");break}if(o&&_){var Y=o.units;Y.push(k)}}),s&&o&&(c(o,v),this.avcSample=null)},t.getLastNalUnit=function(v){var d,p=this.avcSample,s;if((!p||p.units.length===0)&&(p=v[v.length-1]),(d=p)!==null&&d!==void 0&&d.units){var g=p.units;s=g[g.length-1]}return s},t.parseAVCNALu=function(v,d){var p=d.byteLength,s=v.naluState||0,g=s,h=[],o=0,_,O,k,K=-1,N=0;for(s===-1&&(K=0,N=d[0]&31,s=0,o=1);o<p;){if(_=d[o++],!s){s=_?0:1;continue}if(s===1){s=_?0:2;continue}if(!_)s=3;else if(_===1){if(K>=0){var W={data:d.subarray(K,o-s-1),type:N};h.push(W)}else{var H=this.getLastNalUnit(v.samples);if(H&&(g&&o<=4-g&&H.state&&(H.data=H.data.subarray(0,H.data.byteLength-g)),O=o-s-1,O>0)){var V=new Uint8Array(H.data.byteLength+O);V.set(H.data,0),V.set(d.subarray(0,O),H.data.byteLength),H.data=V,H.state=0}}o<p?(k=d[o]&31,K=o,N=k,s=0):s=-1}else s=0}if(K>=0&&s>=0){var j={data:d.subarray(K,p),type:N,state:s};h.push(j)}if(h.length===0){var z=this.getLastNalUnit(v.samples);if(z){var $=new Uint8Array(z.data.byteLength+d.byteLength);$.set(z.data,0),$.set(d,z.data.byteLength),z.data=$}}return v.naluState=s,h},t.parseAACPES=function(v,d){var p=0,s=this.aacOverFlow,g=d.data;if(s){this.aacOverFlow=null;var h=s.missing,o=s.sample.unit.byteLength;if(h===-1){var _=new Uint8Array(o+g.byteLength);_.set(s.sample.unit,0),_.set(g,o),g=_}else{var O=o-h;s.sample.unit.set(g.subarray(0,h),O),v.samples.push(s.sample),p=s.missing}}var k,K;for(k=p,K=g.length;k<K-1&&!M.isHeader(g,k);k++);if(k!==p){var N,W;if(k<K-1?(N="AAC PES did not start with ADTS header,offset:"+k,W=!1):(N="no ADTS header found in AAC PES",W=!0),P.logger.warn("parsing error:"+N),this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.FRAG_PARSING_ERROR,fatal:W,reason:N}),W)return}M.initTrackConfig(v,this.observer,g,k,this.audioCodec);var H;if(d.pts!==void 0)H=d.pts;else if(s){var V=M.getFrameDuration(v.samplerate);H=s.sample.pts+V}else{P.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var j=0,z;k<K;)if(z=M.appendFrame(v,g,k,H,j),k+=z.length,z.missing){this.aacOverFlow=z;break}else for(j++;k<K-1&&!M.isHeader(g,k);k++);},t.parseMPEGPES=function(v,d){var p=d.data,s=p.length,g=0,h=0,o=d.pts;if(o===void 0){P.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<s;)if(I.isHeader(p,h)){var _=I.appendFrame(v,p,h,o,g);if(_)h+=_.length,g++;else break}else h++},t.parseID3PES=function(v,d){if(d.pts===void 0){P.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var p=S({},d,{type:this._avcTrack?T.MetadataSchema.emsg:T.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});v.samples.push(p)},e}();function y(e,t,i,v){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:v,length:0}}function l(e,t){return(e[t+10]&31)<<8|e[t+11]}function n(e,t,i,v){var d={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},p=(e[t+1]&15)<<8|e[t+2],s=t+3+p-4,g=(e[t+10]&15)<<8|e[t+11];for(t+=12+g;t<s;){var h=(e[t+1]&31)<<8|e[t+2];switch(e[t]){case 207:if(!v){P.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:d.audio===-1&&(d.audio=h);break;case 21:d.id3===-1&&(d.id3=h);break;case 219:if(!v){P.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:d.avc===-1&&(d.avc=h);break;case 3:case 4:i.mpeg!==!0&&i.mp3!==!0?P.logger.log("MPEG audio found, not supported in this browser"):d.audio===-1&&(d.audio=h,d.segmentCodec="mp3");break;case 36:P.logger.warn("Unsupported HEVC stream type found");break}t+=((e[t+3]&15)<<8|e[t+4])+5}return d}function r(e){var t=0,i,v,d,p,s,g=e.data;if(!e||e.size===0)return null;for(;g[0].length<19&&g.length>1;){var h=new Uint8Array(g[0].length+g[1].length);h.set(g[0]),h.set(g[1],g[0].length),g[0]=h,g.splice(1,1)}i=g[0];var o=(i[0]<<16)+(i[1]<<8)+i[2];if(o===1){if(v=(i[4]<<8)+i[5],v&&v>e.size-6)return null;var _=i[7];_&192&&(p=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,_&64?(s=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,p-s>54e5&&(P.logger.warn(Math.round((p-s)/9e4)+"s delta between PTS and DTS, align them"),p=s)):s=p),d=i[8];var O=d+9;if(e.size<=O)return null;e.size-=O;for(var k=new Uint8Array(e.size),K=0,N=g.length;K<N;K++){i=g[K];var W=i.byteLength;if(O)if(O>W){O-=W;continue}else i=i.subarray(O),W-=O,O=0;k.set(i,t),t+=W}return v&&(v-=d+3),{data:k,pts:p,dts:s,len:v}}return null}function c(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){var i=t.samples,v=i.length;if(v){var d=i[v-1];e.pts=d.pts,e.dts=d.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&P.logger.log(e.pts+"/"+e.dts+":"+e.debug)}const f=x},"./src/demux/webworkify-webpack.js":(G,B,u)=>{u.r(B),u.d(B,{default:()=>A});var M=function(){var y=ENTRY_MODULE,l={},n=function c(f){var e=l[f];if(e!==void 0)return e.exports;var t=l[f]={exports:{}};return y[f].call(t.exports,t,t.exports,c),t.exports};n.m=y,function(){n.n=function(c){var f=c&&c.__esModule?function(){return c.default}:function(){return c};return n.d(f,{a:f}),f}}(),function(){n.d=function(c,f){for(var e in f)n.o(f,e)&&!n.o(c,e)&&Object.defineProperty(c,e,{enumerable:!0,get:f[e]})}}(),function(){n.o=function(c,f){return Object.prototype.hasOwnProperty.call(c,f)}}(),function(){n.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})}}();var r=n(ENTRY_MODULE);return r.default||r},I=M.toString().split("ENTRY_MODULE"),b="[\\.|\\-|\\+|\\w|/|@]+",C="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+b+").*?\\)";function F(x){return(x+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(x){return!isNaN(1*x)}function P(x,y,l){var n={};n[l]=[];var r=y.toString().replace(/^"[^"]+"/,"function"),c=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||r.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!c)return n;for(var f=c[1],e=new RegExp("(\\\\n|\\W)"+F(f)+C,"g"),t;t=e.exec(r);)t[3]!=="dll-reference"&&n[l].push(t[3]);for(e=new RegExp("\\("+F(f)+'\\("(dll-reference\\s('+b+'))"\\)\\)'+C,"g");t=e.exec(r);)x[t[2]]||(n[l].push(t[1]),x[t[2]]=u(t[1]).m),n[t[2]]=n[t[2]]||[],n[t[2]].push(t[4]);for(var i=Object.keys(n),v=0;v<i.length;v++)for(var d=0;d<n[i[v]].length;d++)R(n[i[v]][d])&&(n[i[v]][d]=1*n[i[v]][d]);return n}function D(x){var y=Object.keys(x);return y.reduce(function(l,n){return l||x[n].length>0},!1)}function T(x,y){for(var l={main:[y]},n={main:[]},r={main:{}};D(l);)for(var c=Object.keys(l),f=0;f<c.length;f++){var e=c[f],t=l[e],i=t.pop();if(r[e]=r[e]||{},!(r[e][i]||!x[e][i])){r[e][i]=!0,n[e]=n[e]||[],n[e].push(i);for(var v=P(x,x[e][i],e),d=Object.keys(v),p=0;p<d.length;p++)l[d[p]]=l[d[p]]||[],l[d[p]]=l[d[p]].concat(v[d[p]])}}return n}function S(x,y,l,n){var r=x[n].map(function(c){return'"'+c+'": '+y[n][c].toString().replace(/^"[^"]+"/,"function")}).join(",");return I[0]+"{"+r+"}"+I[1]+'"'+l+'"'+I[2]}function A(x,y){y=y||{};var l={main:u.m},n=y.all?{main:Object.keys(l.main)}:T(l,x),r="";Object.keys(n).filter(function(i){return i!=="main"}).forEach(function(i){for(var v=0;n[i][v];)v++;n[i].push(v),l[i][v]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+("var "+i+" = ("+S(n,l,v,modules)+`)();
`)}),r=r+("new (("+S(n,l,x,"main")+")())(self);");var c=new window.Blob([r],{type:"text/javascript"}),f=window.URL||window.webkitURL||window.mozURL||window.msURL,e=f.createObjectURL(c),t=new window.Worker(e);return t.objectURL=e,t}},"./src/errors.ts":(G,B,u)=>{u.r(B),u.d(B,{ErrorDetails:()=>I,ErrorTypes:()=>M});var M;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(M||(M={}));var I;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(I||(I={}))},"./src/events.ts":(G,B,u)=>{u.r(B),u.d(B,{Events:()=>M});var M;(function(I){I.MEDIA_ATTACHING="hlsMediaAttaching",I.MEDIA_ATTACHED="hlsMediaAttached",I.MEDIA_DETACHING="hlsMediaDetaching",I.MEDIA_DETACHED="hlsMediaDetached",I.BUFFER_RESET="hlsBufferReset",I.BUFFER_CODECS="hlsBufferCodecs",I.BUFFER_CREATED="hlsBufferCreated",I.BUFFER_APPENDING="hlsBufferAppending",I.BUFFER_APPENDED="hlsBufferAppended",I.BUFFER_EOS="hlsBufferEos",I.BUFFER_FLUSHING="hlsBufferFlushing",I.BUFFER_FLUSHED="hlsBufferFlushed",I.MANIFEST_LOADING="hlsManifestLoading",I.MANIFEST_LOADED="hlsManifestLoaded",I.MANIFEST_PARSED="hlsManifestParsed",I.LEVEL_SWITCHING="hlsLevelSwitching",I.LEVEL_SWITCHED="hlsLevelSwitched",I.LEVEL_LOADING="hlsLevelLoading",I.LEVEL_LOADED="hlsLevelLoaded",I.LEVEL_UPDATED="hlsLevelUpdated",I.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",I.LEVELS_UPDATED="hlsLevelsUpdated",I.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",I.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",I.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",I.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",I.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",I.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",I.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",I.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",I.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",I.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",I.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",I.CUES_PARSED="hlsCuesParsed",I.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",I.INIT_PTS_FOUND="hlsInitPtsFound",I.FRAG_LOADING="hlsFragLoading",I.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",I.FRAG_LOADED="hlsFragLoaded",I.FRAG_DECRYPTED="hlsFragDecrypted",I.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",I.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",I.FRAG_PARSING_METADATA="hlsFragParsingMetadata",I.FRAG_PARSED="hlsFragParsed",I.FRAG_BUFFERED="hlsFragBuffered",I.FRAG_CHANGED="hlsFragChanged",I.FPS_DROP="hlsFpsDrop",I.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",I.ERROR="hlsError",I.DESTROYING="hlsDestroying",I.KEY_LOADING="hlsKeyLoading",I.KEY_LOADED="hlsKeyLoaded",I.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",I.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>c});var M=u("./node_modules/url-toolkit/src/url-toolkit.js"),I=u("./src/loader/playlist-loader.ts"),b=u("./src/loader/key-loader.ts"),C=u("./src/controller/id3-track-controller.ts"),F=u("./src/controller/latency-controller.ts"),R=u("./src/controller/level-controller.ts"),P=u("./src/controller/fragment-tracker.ts"),D=u("./src/controller/stream-controller.ts"),T=u("./src/is-supported.ts"),S=u("./src/utils/logger.ts"),A=u("./src/config.ts"),x=u("./node_modules/eventemitter3/index.js"),y=u("./src/events.ts"),l=u("./src/errors.ts");function n(f,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(f,i.key,i)}}function r(f,e,t){return e&&n(f.prototype,e),t&&n(f,t),Object.defineProperty(f,"prototype",{writable:!1}),f}var c=function(){f.isSupported=function(){return(0,T.isSupported)()};function f(t){t===void 0&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new x.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=(0,A.mergeConfig)(f.DefaultConfig,t);this.userConfig=t,(0,S.enableLogs)(i.debug,"Hls instance"),this._autoLevelCapping=-1,i.progressive&&(0,A.enableStreamingMode)(i);var v=i.abrController,d=i.bufferController,p=i.capLevelController,s=i.fpsController,g=this.abrController=new v(this),h=this.bufferController=new d(this),o=this.capLevelController=new p(this),_=new s(this),O=new I.default(this),k=new b.default(this),K=new C.default(this),N=this.levelController=new R.default(this),W=new P.FragmentTracker(this),H=this.streamController=new D.default(this,W);o.setStreamController(H),_.setStreamController(H);var V=[O,k,N,H];this.networkControllers=V;var j=[g,h,o,_,K,W];this.audioTrackController=this.createController(i.audioTrackController,null,V),this.createController(i.audioStreamController,W,V),this.subtitleTrackController=this.createController(i.subtitleTrackController,null,V),this.createController(i.subtitleStreamController,W,V),this.createController(i.timelineController,null,j),this.emeController=this.createController(i.emeController,null,j),this.cmcdController=this.createController(i.cmcdController,null,j),this.latencyController=this.createController(F.default,null,j),this.coreComponents=j}var e=f.prototype;return e.createController=function(i,v,d){if(i){var p=v?new i(this,v):new i(this);return d&&d.push(p),p}return null},e.on=function(i,v,d){d===void 0&&(d=this),this._emitter.on(i,v,d)},e.once=function(i,v,d){d===void 0&&(d=this),this._emitter.once(i,v,d)},e.removeAllListeners=function(i){this._emitter.removeAllListeners(i)},e.off=function(i,v,d,p){d===void 0&&(d=this),this._emitter.off(i,v,d,p)},e.listeners=function(i){return this._emitter.listeners(i)},e.emit=function(i,v,d){return this._emitter.emit(i,v,d)},e.trigger=function(i,v){if(this.config.debug)return this.emit(i,i,v);try{return this.emit(i,i,v)}catch(d){S.logger.error("An internal error happened while handling event "+i+'. Error message: "'+d.message+'". Here is a stacktrace:',d),this.trigger(y.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:i,error:d})}return!1},e.listenerCount=function(i){return this._emitter.listenerCount(i)},e.destroy=function(){S.logger.log("destroy"),this.trigger(y.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(i){return i.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(i){return i.destroy()}),this.coreComponents.length=0},e.attachMedia=function(i){S.logger.log("attachMedia"),this._media=i,this.trigger(y.Events.MEDIA_ATTACHING,{media:i})},e.detachMedia=function(){S.logger.log("detachMedia"),this.trigger(y.Events.MEDIA_DETACHING,void 0),this._media=null},e.loadSource=function(i){this.stopLoad();var v=this.media,d=this.url,p=this.url=M.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});S.logger.log("loadSource:"+p),v&&d&&d!==p&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(v)),this.trigger(y.Events.MANIFEST_LOADING,{url:i})},e.startLoad=function(i){i===void 0&&(i=-1),S.logger.log("startLoad("+i+")"),this.networkControllers.forEach(function(v){v.startLoad(i)})},e.stopLoad=function(){S.logger.log("stopLoad"),this.networkControllers.forEach(function(i){i.stopLoad()})},e.swapAudioCodec=function(){S.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){S.logger.log("recoverMediaError");var i=this._media;this.detachMedia(),i&&this.attachMedia(i)},e.removeLevel=function(i,v){v===void 0&&(v=0),this.levelController.removeLevel(i,v)},r(f,[{key:"levels",get:function(){var i=this.levelController.levels;return i||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(i){S.logger.log("set currentLevel:"+i),this.loadLevel=i,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(i){S.logger.log("set nextLevel:"+i),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(i){S.logger.log("set loadLevel:"+i),this.levelController.manualLevel=i}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(i){this.levelController.nextLoadLevel=i}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(i){S.logger.log("set firstLevel:"+i),this.levelController.firstLevel=i}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(i){S.logger.log("set startLevel:"+i),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(i){var v=!!i;v!==this.config.capLevelToPlayerSize&&(v?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=v)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(i){this._autoLevelCapping!==i&&(S.logger.log("set autoLevelCapping:"+i),this._autoLevelCapping=i)}},{key:"bandwidthEstimate",get:function(){var i=this.abrController.bwEstimator;return i?i.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var i=this.levels,v=this.config.minAutoBitrate;if(!i)return 0;for(var d=i.length,p=0;p<d;p++)if(i[p].maxBitrate>=v)return p;return 0}},{key:"maxAutoLevel",get:function(){var i=this.levels,v=this.autoLevelCapping,d;return v===-1&&i&&i.length?d=i.length-1:d=v,d}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(i){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,i)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var i=this.audioTrackController;return i?i.audioTracks:[]}},{key:"audioTrack",get:function(){var i=this.audioTrackController;return i?i.audioTrack:-1},set:function(i){var v=this.audioTrackController;v&&(v.audioTrack=i)}},{key:"subtitleTracks",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTrack:-1},set:function(i){var v=this.subtitleTrackController;v&&(v.subtitleTrack=i)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var i=this.subtitleTrackController;return i?i.subtitleDisplay:!1},set:function(i){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=i)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(i){this.config.lowLatencyMode=i}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.8"}},{key:"Events",get:function(){return y.Events}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:A.hlsDefaultConfig},set:function(i){f.defaultConfig=i}}]),f}();c.defaultConfig=void 0},"./src/is-supported.ts":(G,B,u)=>{u.r(B),u.d(B,{changeTypeSupported:()=>C,isSupported:()=>b});var M=u("./src/utils/mediasource-helper.ts");function I(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var F=(0,M.getMediaSource)();if(!F)return!1;var R=I(),P=F&&typeof F.isTypeSupported=="function"&&F.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),D=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!P&&!!D}function C(){var F,R=I();return typeof(R==null||(F=R.prototype)===null||F===void 0?void 0:F.changeType)=="function"}},"./src/loader/date-range.ts":(G,B,u)=>{u.r(B),u.d(B,{DateRange:()=>D,DateRangeAttribute:()=>P});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/attr-list.ts"),b=u("./src/utils/logger.ts");function C(){return C=Object.assign?Object.assign.bind():function(T){for(var S=1;S<arguments.length;S++){var A=arguments[S];for(var x in A)Object.prototype.hasOwnProperty.call(A,x)&&(T[x]=A[x])}return T},C.apply(this,arguments)}function F(T,S){for(var A=0;A<S.length;A++){var x=S[A];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(T,x.key,x)}}function R(T,S,A){return S&&F(T.prototype,S),A&&F(T,A),Object.defineProperty(T,"prototype",{writable:!1}),T}var P;(function(T){T.ID="ID",T.CLASS="CLASS",T.START_DATE="START-DATE",T.DURATION="DURATION",T.END_DATE="END-DATE",T.END_ON_NEXT="END-ON-NEXT",T.PLANNED_DURATION="PLANNED-DURATION",T.SCTE35_OUT="SCTE35-OUT",T.SCTE35_IN="SCTE35-IN"})(P||(P={}));var D=function(){function T(S,A){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,A){var x=A.attr;for(var y in x)if(Object.prototype.hasOwnProperty.call(S,y)&&S[y]!==x[y]){b.logger.warn('DATERANGE tag attribute: "'+y+'" does not match for tags with ID: "'+S.ID+'"'),this._badValueForSameId=y;break}S=C(new I.AttrList({}),x,S)}if(this.attr=S,this._startDate=new Date(S[P.START_DATE]),P.END_DATE in this.attr){var l=new Date(this.attr[P.END_DATE]);(0,M.isFiniteNumber)(l.getTime())&&(this._endDate=l)}}return R(T,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var A=this.duration;return A!==null?new Date(this._startDate.getTime()+A*1e3):null}},{key:"duration",get:function(){if(P.DURATION in this.attr){var A=this.attr.decimalFloatingPoint(P.DURATION);if((0,M.isFiniteNumber)(A))return A}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return P.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(P.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(P.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,M.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),T}()},"./src/loader/fragment-loader.ts":(G,B,u)=>{u.r(B),u.d(B,{LoadError:()=>y,default:()=>A});var M=u("./src/polyfills/number.ts"),I=u("./src/errors.ts");function b(l,n){l.prototype=Object.create(n.prototype),l.prototype.constructor=l,D(l,n)}function C(l){var n=typeof Map=="function"?new Map:void 0;return C=function(c){if(c===null||!P(c))return c;if(typeof c!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(c))return n.get(c);n.set(c,f)}function f(){return F(c,arguments,T(this).constructor)}return f.prototype=Object.create(c.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),D(f,c)},C(l)}function F(l,n,r){return R()?F=Reflect.construct.bind():F=function(f,e,t){var i=[null];i.push.apply(i,e);var v=Function.bind.apply(f,i),d=new v;return t&&D(d,t.prototype),d},F.apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function D(l,n){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,f){return c.__proto__=f,c},D(l,n)}function T(l){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},T(l)}var S=Math.pow(2,17),A=function(){function l(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var n=l.prototype;return n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.abort=function(){this.loader&&this.loader.abort()},n.load=function(c,f){var e=this,t=c.url;if(!t)return Promise.reject(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var i=this.config,v=i.fLoader,d=i.loader;return new Promise(function(p,s){e.loader&&e.loader.destroy();var g=e.loader=c.loader=v?new v(i):new d(i),h=x(c),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:c.sn==="initSegment"?1/0:S};c.stats=g.stats,g.load(h,o,{onSuccess:function(O,k,K,N){e.resetLoader(c,g),p({frag:c,part:null,payload:O.data,networkDetails:N})},onError:function(O,k,K){e.resetLoader(c,g),s(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,response:O,networkDetails:K}))},onAbort:function(O,k,K){e.resetLoader(c,g),s(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:c,networkDetails:K}))},onTimeout:function(O,k,K){e.resetLoader(c,g),s(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c,networkDetails:K}))},onProgress:function(O,k,K,N){f&&f({frag:c,part:null,payload:K,networkDetails:N})}})})},n.loadPart=function(c,f,e){var t=this;this.abort();var i=this.config,v=i.fLoader,d=i.loader;return new Promise(function(p,s){t.loader&&t.loader.destroy();var g=t.loader=c.loader=v?new v(i):new d(i),h=x(c,f),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:S};f.stats=g.stats,g.load(h,o,{onSuccess:function(O,k,K,N){t.resetLoader(c,g),t.updateStatsFromPart(c,f);var W={frag:c,part:f,payload:O.data,networkDetails:N};e(W),p(W)},onError:function(O,k,K){t.resetLoader(c,g),s(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:c,part:f,response:O,networkDetails:K}))},onAbort:function(O,k,K){c.stats.aborted=f.stats.aborted,t.resetLoader(c,g),s(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:c,part:f,networkDetails:K}))},onTimeout:function(O,k,K){t.resetLoader(c,g),s(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:c,part:f,networkDetails:K}))}})})},n.updateStatsFromPart=function(c,f){var e=c.stats,t=f.stats,i=t.total;if(e.loaded+=t.loaded,i){var v=Math.round(c.duration/f.duration),d=Math.min(Math.round(e.loaded/i),v),p=v-d,s=p*Math.round(e.loaded/d);e.total=e.loaded+s}else e.total=Math.max(e.loaded,e.total);var g=e.loading,h=t.loading;g.start?g.first+=h.first-h.start:(g.start=h.start,g.first=h.first),g.end=h.end},n.resetLoader=function(c,f){c.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},l}();function x(l,n){n===void 0&&(n=null);var r=n||l,c={frag:l,part:n,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},f=r.byteRangeStartOffset,e=r.byteRangeEndOffset;return(0,M.isFiniteNumber)(f)&&(0,M.isFiniteNumber)(e)&&(c.rangeStart=f,c.rangeEnd=e),c}var y=function(l){b(n,l);function n(r){for(var c,f=arguments.length,e=new Array(f>1?f-1:0),t=1;t<f;t++)e[t-1]=arguments[t];return c=l.call.apply(l,[this].concat(e))||this,c.data=void 0,c.data=r,c}return n}(C(Error))},"./src/loader/fragment.ts":(G,B,u)=>{u.r(B),u.d(B,{BaseSegment:()=>A,ElementaryStreamTypes:()=>S,Fragment:()=>x,Part:()=>y});var M=u("./src/polyfills/number.ts"),I=u("./node_modules/url-toolkit/src/url-toolkit.js"),b=u("./src/utils/logger.ts"),C=u("./src/loader/level-key.ts"),F=u("./src/loader/load-stats.ts");function R(l,n){l.prototype=Object.create(n.prototype),l.prototype.constructor=l,P(l,n)}function P(l,n){return P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,f){return c.__proto__=f,c},P(l,n)}function D(l,n){for(var r=0;r<n.length;r++){var c=n[r];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(l,c.key,c)}}function T(l,n,r){return n&&D(l.prototype,n),r&&D(l,r),Object.defineProperty(l,"prototype",{writable:!1}),l}var S;(function(l){l.AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo"})(S||(S={}));var A=function(){function l(r){var c;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(c={},c[S.AUDIO]=null,c[S.VIDEO]=null,c[S.AUDIOVIDEO]=null,c),this.baseurl=r}var n=l.prototype;return n.setByteRange=function(c,f){var e=c.split("@",2),t=[];e.length===1?t[0]=f?f.byteRangeEndOffset:0:t[0]=parseInt(e[1]),t[1]=parseInt(e[0])+t[0],this._byteRange=t},T(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,I.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(c){this._url=c}}]),l}(),x=function(l){R(n,l);function n(c,f){var e;return e=l.call(this,f)||this,e._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkey=void 0,e.type=void 0,e.loader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.appendedPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new F.LoadStats,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.type=c,e}var r=n.prototype;return r.createInitializationVector=function(f){for(var e=new Uint8Array(16),t=12;t<16;t++)e[t]=f>>8*(15-t)&255;return e},r.setDecryptDataFromLevelKey=function(f,e){var t=f;return(f==null?void 0:f.method)==="AES-128"&&f.uri&&!f.iv&&(t=C.LevelKey.fromURI(f.uri),t.method=f.method,t.iv=this.createInitializationVector(e),t.keyFormat="identity"),t},r.setElementaryStreamInfo=function(f,e,t,i,v,d){d===void 0&&(d=!1);var p=this.elementaryStreams,s=p[f];if(!s){p[f]={startPTS:e,endPTS:t,startDTS:i,endDTS:v,partial:d};return}s.startPTS=Math.min(s.startPTS,e),s.endPTS=Math.max(s.endPTS,t),s.startDTS=Math.min(s.startDTS,i),s.endDTS=Math.max(s.endDTS,v)},r.clearElementaryStreamInfo=function(){var f=this.elementaryStreams;f[S.AUDIO]=null,f[S.VIDEO]=null,f[S.AUDIOVIDEO]=null},T(n,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var f=this.sn;typeof f!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&b.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),f=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,f)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,M.isFiniteNumber)(this.programDateTime))return null;var f=(0,M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+f*1e3}},{key:"encrypted",get:function(){var f;return!!((f=this.decryptdata)!==null&&f!==void 0&&f.keyFormat&&this.decryptdata.uri)}}]),n}(A),y=function(l){R(n,l);function n(r,c,f,e,t){var i;i=l.call(this,f)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new F.LoadStats,i.duration=r.decimalFloatingPoint("DURATION"),i.gap=r.bool("GAP"),i.independent=r.bool("INDEPENDENT"),i.relurl=r.enumeratedString("URI"),i.fragment=c,i.index=e;var v=r.enumeratedString("BYTERANGE");return v&&i.setByteRange(v,t),t&&(i.fragOffset=t.fragOffset+t.duration),i}return T(n,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var c=this.elementaryStreams;return!!(c.audio||c.video||c.audiovideo)}}]),n}(A)},"./src/loader/key-loader.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>C});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/utils/logger.ts"),C=function(){function F(P){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=P,this.registerListeners()}var R=F.prototype;return R.startLoad=function(D){},R.stopLoad=function(){this.destroyInternalLoaders()},R.registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},R.unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},R.destroyInternalLoaders=function(){for(var D in this.loaders){var T=this.loaders[D];T&&T.destroy()}this.loaders={}},R.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},R.onKeyLoading=function(D,T){var S=T.frag,A=S.type,x=this.loaders[A];if(!S.decryptdata){b.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var y=S.decryptdata.uri;if(y!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(x&&(b.logger.warn("abort previous key loader for type:"+A),x.abort()),!y){b.logger.warn("key uri is falsy");return}var n=l.loader,r=S.loader=this.loaders[A]=new n(l);this.decrypturl=y,this.decryptkey=null;var c={url:y,frag:S,responseType:"arraybuffer"},f={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},e={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(c,f,e)}else this.decryptkey&&(S.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:S}))},R.loadsuccess=function(D,T,S){var A=S.frag;if(!A.decryptdata){b.logger.error("after key load, decryptdata unset");return}this.decryptkey=A.decryptdata.key=new Uint8Array(D.data),A.loader=null,delete this.loaders[A.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:A})},R.loaderror=function(D,T){var S=T.frag,A=S.loader;A&&A.abort(),delete this.loaders[S.type],this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:S,response:D})},R.loadtimeout=function(D,T){var S=T.frag,A=S.loader;A&&A.abort(),delete this.loaders[S.type],this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:S})},F}()},"./src/loader/level-details.ts":(G,B,u)=>{u.r(B),u.d(B,{LevelDetails:()=>F});var M=u("./src/polyfills/number.ts");function I(R,P){for(var D=0;D<P.length;D++){var T=P[D];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function b(R,P,D){return P&&I(R.prototype,P),D&&I(R,D),Object.defineProperty(R,"prototype",{writable:!1}),R}var C=10,F=function(){function R(D){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=D}var P=R.prototype;return P.reloaded=function(T){if(!T){this.advanced=!0,this.updated=!0;return}var S=this.lastPartSn-T.lastPartSn,A=this.lastPartIndex-T.lastPartIndex;this.updated=this.endSN!==T.endSN||!!A||!!S,this.advanced=this.endSN>T.endSN||S>0||S===0&&A>0,this.updated||this.advanced?this.misses=Math.floor(T.misses*.6):this.misses=T.misses+1,this.availabilityDelay=T.availabilityDelay},b(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||C}},{key:"drift",get:function(){var T=this.driftEndTime-this.driftStartTime;if(T>0){var S=this.driftEnd-this.driftStart;return S*1e3/T}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var T;return(T=this.fragments)!==null&&T!==void 0&&T.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":(G,B,u)=>{u.r(B),u.d(B,{LevelKey:()=>C});var M=u("./node_modules/url-toolkit/src/url-toolkit.js");function I(F,R){for(var P=0;P<R.length;P++){var D=R[P];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(F,D.key,D)}}function b(F,R,P){return R&&I(F.prototype,R),P&&I(F,P),Object.defineProperty(F,"prototype",{writable:!1}),F}var C=function(){F.fromURL=function(P,D){return new F(P,D)},F.fromURI=function(P){return new F(P)};function F(R,P){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,P?this._uri=(0,M.buildAbsoluteURL)(R,P,{alwaysNormalize:!0}):this._uri=R}return b(F,[{key:"uri",get:function(){return this._uri}}]),F}()},"./src/loader/load-stats.ts":(G,B,u)=>{u.r(B),u.d(B,{LoadStats:()=>M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>r});var M=u("./src/polyfills/number.ts"),I=u("./node_modules/url-toolkit/src/url-toolkit.js"),b=u("./src/loader/date-range.ts"),C=u("./src/loader/fragment.ts"),F=u("./src/loader/level-details.ts"),R=u("./src/loader/level-key.ts"),P=u("./src/utils/attr-list.ts"),D=u("./src/utils/logger.ts"),T=u("./src/utils/codecs.ts"),S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,A=/#EXT-X-MEDIA:(.*)/g,x=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=/\.(mp4|m4s|m4v|m4a)$/i;function n(v){var d,p;return l.test((d=(p=I.parseURL(v))===null||p===void 0?void 0:p.path)!=null?d:"")}var r=function(){function v(){}return v.findGroup=function(p,s){for(var g=0;g<p.length;g++){var h=p[g];if(h.id===s)return h}},v.convertAVC1ToAVCOTI=function(p){var s=p.split(".");if(s.length>2){var g=s.shift()+".";return g+=parseInt(s.shift()).toString(16),g+=("000"+parseInt(s.shift()).toString(16)).slice(-4),g}return p},v.resolve=function(p,s){return I.buildAbsoluteURL(s,p,{alwaysNormalize:!0})},v.parseMasterPlaylist=function(p,s){var g=[],h=[],o={},_=!1;S.lastIndex=0;for(var O;(O=S.exec(p))!=null;)if(O[1]){var k,K=new P.AttrList(O[1]),N={attrs:K,bitrate:K.decimalInteger("AVERAGE-BANDWIDTH")||K.decimalInteger("BANDWIDTH"),name:K.NAME,url:v.resolve(O[2],s)},W=K.decimalResolution("RESOLUTION");W&&(N.width=W.width,N.height=W.height),c((K.CODECS||"").split(/[ ,]+/).filter(function(j){return j}),N),N.videoCodec&&N.videoCodec.indexOf("avc1")!==-1&&(N.videoCodec=v.convertAVC1ToAVCOTI(N.videoCodec)),(k=N.unknownCodecs)!==null&&k!==void 0&&k.length||h.push(N),g.push(N)}else if(O[3]){var H=new P.AttrList(O[3]);H["DATA-ID"]&&(_=!0,o[H["DATA-ID"]]=H)}var V=h.length>0&&h.length<g.length;return{levels:V?h:g,sessionData:_?o:null}},v.parseMasterPlaylistMedia=function(p,s,g,h){h===void 0&&(h=[]);var o,_=[],O=0;for(A.lastIndex=0;(o=A.exec(p))!==null;){var k=new P.AttrList(o[1]);if(k.TYPE===g){var K={attrs:k,bitrate:0,id:O++,groupId:k["GROUP-ID"],instreamId:k["INSTREAM-ID"],name:k.NAME||k.LANGUAGE||"",type:g,default:k.bool("DEFAULT"),autoselect:k.bool("AUTOSELECT"),forced:k.bool("FORCED"),lang:k.LANGUAGE,url:k.URI?v.resolve(k.URI,s):""};if(h.length){var N=v.findGroup(h,K.groupId)||h[0];f(K,N,"audioCodec"),f(K,N,"textCodec")}_.push(K)}}return _},v.parseLevelPlaylist=function(p,s,g,h,o){var _=new F.LevelDetails(s),O=_.fragments,k=null,K=0,N=0,W=0,H=0,V=null,j=new C.Fragment(h,s),z,$,Y,X=-1,Q=!1;for(x.lastIndex=0,_.m3u8=p;(z=x.exec(p))!==null;){Q&&(Q=!1,j=new C.Fragment(h,s),j.start=W,j.sn=K,j.cc=H,j.level=g,k&&(j.initSegment=k,j.rawProgramDateTime=k.rawProgramDateTime,k.rawProgramDateTime=null));var q=z[1];if(q){j.duration=parseFloat(q);var J=(" "+z[2]).slice(1);j.title=J||null,j.tagList.push(J?["INF",q,J]:["INF",q])}else if(z[3])(0,M.isFiniteNumber)(j.duration)&&(j.start=W,Y&&(j.levelkey=Y),j.sn=K,j.level=g,j.cc=H,j.urlId=o,O.push(j),j.relurl=(" "+z[3]).slice(1),t(j,V),V=j,W+=j.duration,K++,N=0,Q=!0);else if(z[4]){var ie=(" "+z[4]).slice(1);V?j.setByteRange(ie,V):j.setByteRange(ie)}else if(z[5])j.rawProgramDateTime=(" "+z[5]).slice(1),j.tagList.push(["PROGRAM-DATE-TIME",j.rawProgramDateTime]),X===-1&&(X=O.length);else{if(z=z[0].match(y),!z){D.logger.warn("No matches on slow regex match for level playlist!");continue}for($=1;$<z.length&&!(typeof z[$]<"u");$++);var se=(" "+z[$]).slice(1),Z=(" "+z[$+1]).slice(1),re=z[$+2]?(" "+z[$+2]).slice(1):"";switch(se){case"PLAYLIST-TYPE":_.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":K=_.startSN=parseInt(Z);break;case"SKIP":{var fe=new P.AttrList(Z),oe=fe.decimalInteger("SKIPPED-SEGMENTS");if((0,M.isFiniteNumber)(oe)){_.skippedSegments=oe;for(var de=oe;de--;)O.unshift(null);K+=oe}var xe=fe.enumeratedString("RECENTLY-REMOVED-DATERANGES");xe&&(_.recentlyRemovedDateranges=xe.split("	"));break}case"TARGETDURATION":_.targetduration=parseFloat(Z);break;case"VERSION":_.version=parseInt(Z);break;case"EXTM3U":break;case"ENDLIST":_.live=!1;break;case"#":(Z||re)&&j.tagList.push(re?[Z,re]:[Z]);break;case"DISCONTINUITY":H++,j.tagList.push(["DIS"]);break;case"GAP":j.tagList.push([se]);break;case"BITRATE":j.tagList.push([se,Z]);break;case"DATERANGE":{var he=new P.AttrList(Z),Ce=new b.DateRange(he,_.dateRanges[he.ID]);Ce.isValid||_.skippedSegments?_.dateRanges[Ce.id]=Ce:D.logger.warn('Ignoring invalid DATERANGE tag: "'+Z+'"'),j.tagList.push(["EXT-X-DATERANGE",Z]);break}case"DISCONTINUITY-SEQUENCE":H=parseInt(Z);break;case"KEY":{var Le,_e=new P.AttrList(Z),Ie=_e.enumeratedString("METHOD"),be=_e.URI,Be=_e.hexadecimalInteger("IV"),Me=_e.enumeratedString("KEYFORMATVERSIONS"),Oe=_e.enumeratedString("KEYID"),Ue=(Le=_e.enumeratedString("KEYFORMAT"))!=null?Le:"identity",we=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(we.indexOf(Ue)>-1){D.logger.warn("Keyformat "+Ue+" is not supported from the manifest");continue}else if(Ue!=="identity")continue;Ie&&(Y=R.LevelKey.fromURL(s,be),be&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Ie)>=0&&(Y.method=Ie,Y.keyFormat=Ue,Oe&&(Y.keyID=Oe),Me&&(Y.keyFormatVersions=Me),Y.iv=Be));break}case"START":{var We=new P.AttrList(Z),pe=We.decimalFloatingPoint("TIME-OFFSET");(0,M.isFiniteNumber)(pe)&&(_.startTimeOffset=pe);break}case"MAP":{var De=new P.AttrList(Z);if(j.duration){var Ne=new C.Fragment(h,s);i(Ne,De,g,Y),k=Ne,j.initSegment=k,k.rawProgramDateTime&&!j.rawProgramDateTime&&(j.rawProgramDateTime=k.rawProgramDateTime)}else i(j,De,g,Y),k=j,Q=!0;break}case"SERVER-CONTROL":{var ve=new P.AttrList(Z);_.canBlockReload=ve.bool("CAN-BLOCK-RELOAD"),_.canSkipUntil=ve.optionalFloat("CAN-SKIP-UNTIL",0),_.canSkipDateRanges=_.canSkipUntil>0&&ve.bool("CAN-SKIP-DATERANGES"),_.partHoldBack=ve.optionalFloat("PART-HOLD-BACK",0),_.holdBack=ve.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ae=new P.AttrList(Z);_.partTarget=Ae.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Fe=_.partList;Fe||(Fe=_.partList=[]);var Xe=N>0?Fe[Fe.length-1]:void 0,Qe=N++,ft=new C.Part(new P.AttrList(Z),j,s,Qe,Xe);Fe.push(ft),j.duration+=ft.duration;break}case"PRELOAD-HINT":{var Ge=new P.AttrList(Z);_.preloadHint=Ge;break}case"RENDITION-REPORT":{var Dt=new P.AttrList(Z);_.renditionReports=_.renditionReports||[],_.renditionReports.push(Dt);break}default:D.logger.warn("line parsed but not handled: "+z);break}}}V&&!V.relurl?(O.pop(),W-=V.duration,_.partList&&(_.fragmentHint=V)):_.partList&&(t(j,V),j.cc=H,_.fragmentHint=j);var Ze=O.length,He=O[0],dt=O[Ze-1];if(W+=_.skippedSegments*_.targetduration,W>0&&Ze&&dt){_.averagetargetduration=W/Ze;var Je=dt.sn;_.endSN=Je!=="initSegment"?Je:0,He&&(_.startCC=He.cc,He.initSegment||_.fragments.every(function(mt){return mt.relurl&&n(mt.relurl)})&&(D.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),j=new C.Fragment(h,s),j.relurl=dt.relurl,j.level=g,j.sn="initSegment",He.initSegment=j,_.needSidxRanges=!0))}else _.endSN=0,_.startCC=0;return _.fragmentHint&&(W+=_.fragmentHint.duration),_.totalduration=W,_.endCC=H,X>0&&e(O,X),_},v}();function c(v,d){["video","audio","text"].forEach(function(p){var s=v.filter(function(h){return(0,T.isCodecType)(h,p)});if(s.length){var g=s.filter(function(h){return h.lastIndexOf("avc1",0)===0||h.lastIndexOf("mp4a",0)===0});d[p+"Codec"]=g.length>0?g[0]:s[0],v=v.filter(function(h){return s.indexOf(h)===-1})}}),d.unknownCodecs=v}function f(v,d,p){var s=d[p];s&&(v[p]=s)}function e(v,d){for(var p=v[d],s=d;s--;){var g=v[s];if(!g)return;g.programDateTime=p.programDateTime-g.duration*1e3,p=g}}function t(v,d){v.rawProgramDateTime?v.programDateTime=Date.parse(v.rawProgramDateTime):d!=null&&d.programDateTime&&(v.programDateTime=d.endProgramDateTime),(0,M.isFiniteNumber)(v.programDateTime)||(v.programDateTime=null,v.rawProgramDateTime=null)}function i(v,d,p,s){v.relurl=d.URI,d.BYTERANGE&&v.setByteRange(d.BYTERANGE),v.level=p,v.sn="initSegment",s&&(v.levelkey=s),v.initSegment=null}},"./src/loader/playlist-loader.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>x});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/errors.ts"),C=u("./src/utils/logger.ts"),F=u("./src/utils/mp4-tools.ts"),R=u("./src/loader/m3u8-parser.ts"),P=u("./src/types/loader.ts"),D=u("./src/utils/attr-list.ts");function T(y){var l=y.type;switch(l){case P.PlaylistContextType.AUDIO_TRACK:return P.PlaylistLevelType.AUDIO;case P.PlaylistContextType.SUBTITLE_TRACK:return P.PlaylistLevelType.SUBTITLE;default:return P.PlaylistLevelType.MAIN}}function S(y,l){var n=y.url;return(n===void 0||n.indexOf("data:")===0)&&(n=l.url),n}var A=function(){function y(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var l=y.prototype;return l.startLoad=function(r){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var r=this.hls;r.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(I.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(I.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var r=this.hls;r.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(I.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(I.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(I.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(r){var c=this.hls.config,f=c.pLoader,e=c.loader,t=f||e,i=new t(c);return r.loader=i,this.loaders[r.type]=i,i},l.getInternalLoader=function(r){return this.loaders[r.type]},l.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},l.destroyInternalLoaders=function(){for(var r in this.loaders){var c=this.loaders[r];c&&c.destroy(),this.resetInternalLoader(r)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(r,c){var f=c.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:P.PlaylistContextType.MANIFEST,url:f,deliveryDirectives:null})},l.onLevelLoading=function(r,c){var f=c.id,e=c.level,t=c.url,i=c.deliveryDirectives;this.load({id:f,groupId:null,level:e,responseType:"text",type:P.PlaylistContextType.LEVEL,url:t,deliveryDirectives:i})},l.onAudioTrackLoading=function(r,c){var f=c.id,e=c.groupId,t=c.url,i=c.deliveryDirectives;this.load({id:f,groupId:e,level:null,responseType:"text",type:P.PlaylistContextType.AUDIO_TRACK,url:t,deliveryDirectives:i})},l.onSubtitleTrackLoading=function(r,c){var f=c.id,e=c.groupId,t=c.url,i=c.deliveryDirectives;this.load({id:f,groupId:e,level:null,responseType:"text",type:P.PlaylistContextType.SUBTITLE_TRACK,url:t,deliveryDirectives:i})},l.load=function(r){var c,f=this.hls.config,e=this.getInternalLoader(r);if(e){var t=e.context;if(t&&t.url===r.url){C.logger.trace("[playlist-loader]: playlist request ongoing");return}C.logger.log("[playlist-loader]: aborting previous loader for type: "+r.type),e.abort()}var i,v,d,p;switch(r.type){case P.PlaylistContextType.MANIFEST:i=f.manifestLoadingMaxRetry,v=f.manifestLoadingTimeOut,d=f.manifestLoadingRetryDelay,p=f.manifestLoadingMaxRetryTimeout;break;case P.PlaylistContextType.LEVEL:case P.PlaylistContextType.AUDIO_TRACK:case P.PlaylistContextType.SUBTITLE_TRACK:i=0,v=f.levelLoadingTimeOut;break;default:i=f.levelLoadingMaxRetry,v=f.levelLoadingTimeOut,d=f.levelLoadingRetryDelay,p=f.levelLoadingMaxRetryTimeout;break}if(e=this.createInternalLoader(r),(c=r.deliveryDirectives)!==null&&c!==void 0&&c.part){var s;if(r.type===P.PlaylistContextType.LEVEL&&r.level!==null?s=this.hls.levels[r.level].details:r.type===P.PlaylistContextType.AUDIO_TRACK&&r.id!==null?s=this.hls.audioTracks[r.id].details:r.type===P.PlaylistContextType.SUBTITLE_TRACK&&r.id!==null&&(s=this.hls.subtitleTracks[r.id].details),s){var g=s.partTarget,h=s.targetduration;g&&h&&(v=Math.min(Math.max(g*3,h*.8)*1e3,v))}}var o={timeout:v,maxRetry:i,retryDelay:d,maxRetryDelay:p,highWaterMark:0},_={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.load(r,o,_)},l.loadsuccess=function(r,c,f,e){if(e===void 0&&(e=null),f.isSidxRequest){this.handleSidxRequest(r,f),this.handlePlaylistLoaded(r,c,f,e);return}this.resetInternalLoader(f.type);var t=r.data;if(t.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(r,f,"no EXTM3U delimiter",e);return}c.parsing.start=performance.now(),t.indexOf("#EXTINF:")>0||t.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(r,c,f,e):this.handleMasterPlaylist(r,c,f,e)},l.loaderror=function(r,c,f){f===void 0&&(f=null),this.handleNetworkError(c,f,!1,r)},l.loadtimeout=function(r,c,f){f===void 0&&(f=null),this.handleNetworkError(c,f,!0)},l.handleMasterPlaylist=function(r,c,f,e){var t=this.hls,i=r.data,v=S(r,f),d=R.default.parseMasterPlaylist(i,v),p=d.levels,s=d.sessionData;if(!p.length){this.handleManifestParsingError(r,f,"no level found in manifest",e);return}var g=p.map(function(K){return{id:K.attrs.AUDIO,audioCodec:K.audioCodec}}),h=p.map(function(K){return{id:K.attrs.SUBTITLES,textCodec:K.textCodec}}),o=R.default.parseMasterPlaylistMedia(i,v,"AUDIO",g),_=R.default.parseMasterPlaylistMedia(i,v,"SUBTITLES",h),O=R.default.parseMasterPlaylistMedia(i,v,"CLOSED-CAPTIONS");if(o.length){var k=o.some(function(K){return!K.url});!k&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(C.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),o.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new D.AttrList({}),bitrate:0,url:""}))}t.trigger(I.Events.MANIFEST_LOADED,{levels:p,audioTracks:o,subtitles:_,captions:O,url:v,stats:c,networkDetails:e,sessionData:s})},l.handleTrackOrLevelPlaylist=function(r,c,f,e){var t=this.hls,i=f.id,v=f.level,d=f.type,p=S(r,f),s=(0,M.isFiniteNumber)(i)?i:0,g=(0,M.isFiniteNumber)(v)?v:s,h=T(f),o=R.default.parseLevelPlaylist(r.data,p,g,h,s);if(!o.fragments.length){t.trigger(I.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof f.level=="number"?f.level:void 0});return}if(d===P.PlaylistContextType.MANIFEST){var _={attrs:new D.AttrList({}),bitrate:0,details:o,name:"",url:p};t.trigger(I.Events.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:p,stats:c,networkDetails:e,sessionData:null})}if(c.parsing.end=performance.now(),o.needSidxRanges){var O,k=(O=o.fragments[0].initSegment)===null||O===void 0?void 0:O.url;this.load({url:k,isSidxRequest:!0,type:d,level:v,levelDetails:o,id:i,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}f.levelDetails=o,this.handlePlaylistLoaded(r,c,f,e)},l.handleSidxRequest=function(r,c){var f=new Uint8Array(r.data),e=(0,F.findBox)(f,["sidx"])[0];if(!!e){var t=(0,F.parseSegmentIndex)(e);if(!!t){var i=t.references,v=c.levelDetails;i.forEach(function(d,p){var s=d.info,g=v.fragments[p];if(g.byteRange.length===0&&g.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),g.initSegment){var h=(0,F.findBox)(f,["moov"])[0],o=h?h.length:null;g.initSegment.setByteRange(String(o)+"@0")}})}}},l.handleManifestParsingError=function(r,c,f,e){this.hls.trigger(I.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:c.type===P.PlaylistContextType.MANIFEST,url:r.url,reason:f,response:r,context:c,networkDetails:e})},l.handleNetworkError=function(r,c,f,e){f===void 0&&(f=!1),C.logger.warn("[playlist-loader]: A network "+(f?"timeout":"error")+" occurred while loading "+r.type+" level: "+r.level+" id: "+r.id+' group-id: "'+r.groupId+'"');var t=b.ErrorDetails.UNKNOWN,i=!1,v=this.getInternalLoader(r);switch(r.type){case P.PlaylistContextType.MANIFEST:t=f?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case P.PlaylistContextType.LEVEL:t=f?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case P.PlaylistContextType.AUDIO_TRACK:t=f?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case P.PlaylistContextType.SUBTITLE_TRACK:t=f?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1;break}v&&this.resetInternalLoader(r.type);var d={type:b.ErrorTypes.NETWORK_ERROR,details:t,fatal:i,url:r.url,loader:v,context:r,networkDetails:c};e&&(d.response=e),this.hls.trigger(I.Events.ERROR,d)},l.handlePlaylistLoaded=function(r,c,f,e){var t=f.type,i=f.level,v=f.id,d=f.groupId,p=f.loader,s=f.levelDetails,g=f.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(r,f,"invalid target duration",e);return}if(!!p)switch(s.live&&(p.getCacheAge&&(s.ageHeader=p.getCacheAge()||0),(!p.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),t){case P.PlaylistContextType.MANIFEST:case P.PlaylistContextType.LEVEL:this.hls.trigger(I.Events.LEVEL_LOADED,{details:s,level:i||0,id:v||0,stats:c,networkDetails:e,deliveryDirectives:g});break;case P.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(I.Events.AUDIO_TRACK_LOADED,{details:s,id:v||0,groupId:d||"",stats:c,networkDetails:e,deliveryDirectives:g});break;case P.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(I.Events.SUBTITLE_TRACK_LOADED,{details:s,id:v||0,groupId:d||"",stats:c,networkDetails:e,deliveryDirectives:g});break}},y}();const x=A},"./src/polyfills/number.ts":(G,B,u)=>{u.r(B),u.d(B,{MAX_SAFE_INTEGER:()=>I,isFiniteNumber:()=>M});var M=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},I=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>I});var M=function(){function b(){}return b.getSilentFrame=function(F,R){switch(F){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},b}();const I=M},"./src/remux/mp4-generator.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>b});var M=Math.pow(2,32)-1,I=function(){function C(){}return C.init=function(){C.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var R;for(R in C.types)C.types.hasOwnProperty(R)&&(C.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var P=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);C.HDLR_TYPES={video:P,audio:D};var T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);C.STTS=C.STSC=C.STCO=S,C.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),C.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),C.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),C.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var A=new Uint8Array([105,115,111,109]),x=new Uint8Array([97,118,99,49]),y=new Uint8Array([0,0,0,1]);C.FTYP=C.box(C.types.ftyp,A,y,A,x),C.DINF=C.box(C.types.dinf,C.box(C.types.dref,T))},C.box=function(R){for(var P=8,D=arguments.length,T=new Array(D>1?D-1:0),S=1;S<D;S++)T[S-1]=arguments[S];for(var A=T.length,x=A;A--;)P+=T[A].byteLength;var y=new Uint8Array(P);for(y[0]=P>>24&255,y[1]=P>>16&255,y[2]=P>>8&255,y[3]=P&255,y.set(R,4),A=0,P=8;A<x;A++)y.set(T[A],P),P+=T[A].byteLength;return y},C.hdlr=function(R){return C.box(C.types.hdlr,C.HDLR_TYPES[R])},C.mdat=function(R){return C.box(C.types.mdat,R)},C.mdhd=function(R,P){P*=R;var D=Math.floor(P/(M+1)),T=Math.floor(P%(M+1));return C.box(C.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,D>>24,D>>16&255,D>>8&255,D&255,T>>24,T>>16&255,T>>8&255,T&255,85,196,0,0]))},C.mdia=function(R){return C.box(C.types.mdia,C.mdhd(R.timescale,R.duration),C.hdlr(R.type),C.minf(R))},C.mfhd=function(R){return C.box(C.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255]))},C.minf=function(R){return R.type==="audio"?C.box(C.types.minf,C.box(C.types.smhd,C.SMHD),C.DINF,C.stbl(R)):C.box(C.types.minf,C.box(C.types.vmhd,C.VMHD),C.DINF,C.stbl(R))},C.moof=function(R,P,D){return C.box(C.types.moof,C.mfhd(R),C.traf(D,P))},C.moov=function(R){for(var P=R.length,D=[];P--;)D[P]=C.trak(R[P]);return C.box.apply(null,[C.types.moov,C.mvhd(R[0].timescale,R[0].duration)].concat(D).concat(C.mvex(R)))},C.mvex=function(R){for(var P=R.length,D=[];P--;)D[P]=C.trex(R[P]);return C.box.apply(null,[C.types.mvex].concat(D))},C.mvhd=function(R,P){P*=R;var D=Math.floor(P/(M+1)),T=Math.floor(P%(M+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,D>>24,D>>16&255,D>>8&255,D&255,T>>24,T>>16&255,T>>8&255,T&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return C.box(C.types.mvhd,S)},C.sdtp=function(R){var P=R.samples||[],D=new Uint8Array(4+P.length),T,S;for(T=0;T<P.length;T++)S=P[T].flags,D[T+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return C.box(C.types.sdtp,D)},C.stbl=function(R){return C.box(C.types.stbl,C.stsd(R),C.box(C.types.stts,C.STTS),C.box(C.types.stsc,C.STSC),C.box(C.types.stsz,C.STSZ),C.box(C.types.stco,C.STCO))},C.avc1=function(R){var P=[],D=[],T,S,A;for(T=0;T<R.sps.length;T++)S=R.sps[T],A=S.byteLength,P.push(A>>>8&255),P.push(A&255),P=P.concat(Array.prototype.slice.call(S));for(T=0;T<R.pps.length;T++)S=R.pps[T],A=S.byteLength,D.push(A>>>8&255),D.push(A&255),D=D.concat(Array.prototype.slice.call(S));var x=C.box(C.types.avcC,new Uint8Array([1,P[3],P[4],P[5],255,224|R.sps.length].concat(P).concat([R.pps.length]).concat(D))),y=R.width,l=R.height,n=R.pixelRatio[0],r=R.pixelRatio[1];return C.box(C.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>8&255,y&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),x,C.box(C.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),C.box(C.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255])))},C.esds=function(R){var P=R.config.length;return new Uint8Array([0,0,0,0,3,23+P,0,1,0,4,15+P,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([P]).concat(R.config).concat([6,1,2]))},C.mp4a=function(R){var P=R.samplerate;return C.box(C.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,P>>8&255,P&255,0,0]),C.box(C.types.esds,C.esds(R)))},C.mp3=function(R){var P=R.samplerate;return C.box(C.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,P>>8&255,P&255,0,0]))},C.stsd=function(R){return R.type==="audio"?R.segmentCodec==="mp3"&&R.codec==="mp3"?C.box(C.types.stsd,C.STSD,C.mp3(R)):C.box(C.types.stsd,C.STSD,C.mp4a(R)):C.box(C.types.stsd,C.STSD,C.avc1(R))},C.tkhd=function(R){var P=R.id,D=R.duration*R.timescale,T=R.width,S=R.height,A=Math.floor(D/(M+1)),x=Math.floor(D%(M+1));return C.box(C.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,x>>24,x>>16&255,x>>8&255,x&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,T>>8&255,T&255,0,0,S>>8&255,S&255,0,0]))},C.traf=function(R,P){var D=C.sdtp(R),T=R.id,S=Math.floor(P/(M+1)),A=Math.floor(P%(M+1));return C.box(C.types.traf,C.box(C.types.tfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,T&255])),C.box(C.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,A>>24,A>>16&255,A>>8&255,A&255])),C.trun(R,D.length+16+20+8+16+8+8),D)},C.trak=function(R){return R.duration=R.duration||4294967295,C.box(C.types.trak,C.tkhd(R),C.mdia(R))},C.trex=function(R){var P=R.id;return C.box(C.types.trex,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},C.trun=function(R,P){var D=R.samples||[],T=D.length,S=12+16*T,A=new Uint8Array(S),x,y,l,n,r,c;for(P+=8+S,A.set([R.type==="video"?1:0,0,15,1,T>>>24&255,T>>>16&255,T>>>8&255,T&255,P>>>24&255,P>>>16&255,P>>>8&255,P&255],0),x=0;x<T;x++)y=D[x],l=y.duration,n=y.size,r=y.flags,c=y.cts,A.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r.isLeading<<2|r.dependsOn,r.isDependedOn<<6|r.hasRedundancy<<4|r.paddingValue<<1|r.isNonSync,r.degradPrio&240<<8,r.degradPrio&15,c>>>24&255,c>>>16&255,c>>>8&255,c&255],12+16*x);return C.box(C.types.trun,A)},C.initSegment=function(R){C.types||C.init();var P=C.moov(R),D=new Uint8Array(C.FTYP.byteLength+P.byteLength);return D.set(C.FTYP),D.set(P,C.FTYP.byteLength),D},C}();I.types=void 0,I.HDLR_TYPES=void 0,I.STTS=void 0,I.STSC=void 0,I.STCO=void 0,I.STSZ=void 0,I.VMHD=void 0,I.SMHD=void 0,I.STSD=void 0,I.FTYP=void 0,I.DINF=void 0;const b=I},"./src/remux/mp4-remuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>n,flushTextTrackMetadataCueSamples:()=>f,flushTextTrackUserdataCueSamples:()=>e,normalizePts:()=>r});var M=u("./src/polyfills/number.ts"),I=u("./src/remux/aac-helper.ts"),b=u("./src/remux/mp4-generator.ts"),C=u("./src/events.ts"),F=u("./src/errors.ts"),R=u("./src/utils/logger.ts"),P=u("./src/types/loader.ts"),D=u("./src/utils/timescale-conversion.ts");function T(){return T=Object.assign?Object.assign.bind():function(v){for(var d=1;d<arguments.length;d++){var p=arguments[d];for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&(v[s]=p[s])}return v},T.apply(this,arguments)}var S=10*1e3,A=1024,x=1152,y=null,l=null,n=function(){function v(p,s,g,h){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=p,this.config=s,this.typeSupported=g,this.ISGenerated=!1,y===null){var o=navigator.userAgent||"",_=o.match(/Chrome\/(\d+)/i);y=_?parseInt(_[1]):0}if(l===null){var O=navigator.userAgent.match(/Safari\/(\d+)/i);l=O?parseInt(O[1]):0}}var d=v.prototype;return d.destroy=function(){},d.resetTimeStamp=function(s){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},d.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},d.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},d.getVideoStartPts=function(s){var g=!1,h=s.reduce(function(o,_){var O=_.pts-o;return O<-4294967296?(g=!0,r(o,_.pts)):O>0?o:_.pts},s[0].pts);return g&&R.logger.debug("PTS rollover detected"),h},d.remux=function(s,g,h,o,_,O,k,K){var N,W,H,V,j,z,$=_,Y=_,X=s.pid>-1,Q=g.pid>-1,q=g.samples.length,J=s.samples.length>0,ie=k&&q>0||q>1,se=(!X||J)&&(!Q||ie)||this.ISGenerated||k;if(se){this.ISGenerated||(H=this.generateIS(s,g,_));var Z=this.isVideoContiguous,re=-1,fe;if(ie&&(re=c(g.samples),!Z&&this.config.forceKeyFrameOnDiscontinuity))if(z=!0,re>0){R.logger.warn("[mp4-remuxer]: Dropped "+re+" out of "+q+" video samples due to a missing keyframe");var oe=this.getVideoStartPts(g.samples);g.samples=g.samples.slice(re),g.dropped+=re,Y+=(g.samples[0].pts-oe)/g.inputTimeScale,fe=Y}else re===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+q+" video samples"),z=!1);if(this.ISGenerated){if(J&&ie){var de=this.getVideoStartPts(g.samples),xe=r(s.samples[0].pts,de)-de,he=xe/g.inputTimeScale;$+=Math.max(0,he),Y+=Math.max(0,-he)}if(J){if(s.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),H=this.generateIS(s,g,_)),W=this.remuxAudio(s,$,this.isAudioContiguous,O,Q||ie||K===P.PlaylistLevelType.AUDIO?Y:void 0),ie){var Ce=W?W.endPTS-W.startPTS:0;g.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),H=this.generateIS(s,g,_)),N=this.remuxVideo(g,Y,Z,Ce)}}else ie&&(N=this.remuxVideo(g,Y,Z,0));N&&(N.firstKeyFrame=re,N.independent=re!==-1,N.firstKeyFramePTS=fe)}}return this.ISGenerated&&(h.samples.length&&(j=f(h,_,this._initPTS,this._initDTS)),o.samples.length&&(V=e(o,_,this._initPTS))),{audio:W,video:N,initSegment:H,independent:z,text:V,id3:j}},d.generateIS=function(s,g,h){var o=s.samples,_=g.samples,O=this.typeSupported,k={},K=!(0,M.isFiniteNumber)(this._initPTS),N="audio/mp4",W,H,V;if(K&&(W=H=1/0),s.config&&o.length){switch(s.timescale=s.samplerate,s.segmentCodec){case"mp3":O.mpeg?(N="audio/mpeg",s.codec=""):O.mp3&&(s.codec="mp3");break}k.audio={id:"audio",container:N,codec:s.codec,initSegment:s.segmentCodec==="mp3"&&O.mpeg?new Uint8Array(0):b.default.initSegment([s]),metadata:{channelCount:s.channelCount}},K&&(V=s.inputTimeScale,W=H=o[0].pts-Math.round(V*h))}if(g.sps&&g.pps&&_.length&&(g.timescale=g.inputTimeScale,k.video={id:"main",container:"video/mp4",codec:g.codec,initSegment:b.default.initSegment([g]),metadata:{width:g.width,height:g.height}},K)){V=g.inputTimeScale;var j=this.getVideoStartPts(_),z=Math.round(V*h);H=Math.min(H,r(_[0].dts,j)-z),W=Math.min(W,j-z)}if(Object.keys(k).length)return this.ISGenerated=!0,K&&(this._initPTS=W,this._initDTS=H),{tracks:k,initPTS:W,timescale:V}},d.remuxVideo=function(s,g,h,o){var _=s.inputTimeScale,O=s.samples,k=[],K=O.length,N=this._initPTS,W=this.nextAvcDts,H=8,V=this.videoSampleDuration,j,z,$=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,X=!1;if(!h||W===null){var Q=g*_,q=O[0].pts-r(O[0].dts,O[0].pts);W=Q-q}for(var J=0;J<K;J++){var ie=O[J];ie.pts=r(ie.pts-N,W),ie.dts=r(ie.dts-N,W),ie.dts<O[J>0?J-1:J].dts&&(X=!0)}X&&O.sort(function(Pt,zt){var Or=Pt.dts-zt.dts,Rr=Pt.pts-zt.pts;return Or||Rr}),j=O[0].dts,z=O[O.length-1].dts;var se=z-j,Z=se?Math.round(se/(K-1)):V||s.inputTimeScale/30;if(h){var re=j-W,fe=re>Z,oe=re<-1;if((fe||oe)&&(fe?R.logger.warn("AVC: "+(0,D.toMsFromMpegTsClock)(re,!0)+" ms ("+re+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+(0,D.toMsFromMpegTsClock)(-re,!0)+" ms ("+re+"dts) overlapping between fragments detected"),!oe||W>O[0].pts)){j=W;var de=O[0].pts-re;O[0].dts=j,O[0].pts=de,R.logger.log("Video: First PTS/DTS adjusted: "+(0,D.toMsFromMpegTsClock)(de,!0)+"/"+(0,D.toMsFromMpegTsClock)(j,!0)+", delta: "+(0,D.toMsFromMpegTsClock)(re,!0)+" ms")}}j=Math.max(0,j);for(var xe=0,he=0,Ce=0;Ce<K;Ce++){for(var Le=O[Ce],_e=Le.units,Ie=_e.length,be=0,Be=0;Be<Ie;Be++)be+=_e[Be].data.length;he+=be,xe+=Ie,Le.length=be,Le.dts=Math.max(Le.dts,j),$=Math.min(Le.pts,$),Y=Math.max(Le.pts,Y)}z=O[K-1].dts;var Me=he+4*xe+8,Oe;try{Oe=new Uint8Array(Me)}catch{this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:F.ErrorTypes.MUX_ERROR,details:F.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Me,reason:"fail allocating video mdat "+Me});return}var Ue=new DataView(Oe.buffer);Ue.setUint32(0,Me),Oe.set(b.default.types.mdat,4);for(var we=!1,We=Number.POSITIVE_INFINITY,pe=Number.POSITIVE_INFINITY,De=Number.NEGATIVE_INFINITY,Ne=Number.NEGATIVE_INFINITY,ve=0;ve<K;ve++){for(var Ae=O[ve],Fe=Ae.units,Xe=0,Qe=0,ft=Fe.length;Qe<ft;Qe++){var Ge=Fe[Qe],Dt=Ge.data,Ze=Ge.data.byteLength;Ue.setUint32(H,Ze),H+=4,Oe.set(Dt,H),H+=Ze,Xe+=4+Ze}var He=void 0;if(ve<K-1)V=O[ve+1].dts-Ae.dts,He=O[ve+1].pts-Ae.pts;else{var dt=this.config,Je=ve>0?Ae.dts-O[ve-1].dts:Z;if(He=ve>0?Ae.pts-O[ve-1].pts:Z,dt.stretchShortVideoTrack&&this.nextAudioPts!==null){var mt=Math.floor(dt.maxBufferHole*_),At=(o?$+o*_:this.nextAudioPts)-Ae.pts;At>mt?(V=At-Je,V<0?V=Je:we=!0,R.logger.log("[mp4-remuxer]: It is approximately "+At/90+" ms to the next segment; using duration "+V/90+" ms for the last video frame.")):V=Je}else V=Je}var Lr=Math.round(Ae.pts-Ae.dts);We=Math.min(We,V),De=Math.max(De,V),pe=Math.min(pe,He),Ne=Math.max(Ne,He),k.push(new t(Ae.key,V,Xe,Lr))}if(k.length){if(y){if(y<70){var Ht=k[0].flags;Ht.dependsOn=2,Ht.isNonSync=0}}else if(l&&Ne-pe<De-We&&Z/De<.025&&k[0].cts===0){R.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var It=j,Ke=0,Vt=k.length;Ke<Vt;Ke++){var jt=It+k[Ke].duration,Dr=It+k[Ke].cts;if(Ke<Vt-1){var Ar=jt+k[Ke+1].cts;k[Ke].duration=Ar-Dr}else k[Ke].duration=Ke?k[Ke-1].duration:Z;k[Ke].cts=0,It=jt}}}console.assert(V!==null,"mp4SampleDuration must be computed"),V=we||!V?Z:V,this.nextAvcDts=W=z+V,this.videoSampleDuration=V,this.isVideoContiguous=!0;var Ir=b.default.moof(s.sequenceNumber++,j,T({},s,{samples:k})),Pr="video",Cr={data1:Ir,data2:Oe,startPTS:$/_,endPTS:(Y+V)/_,startDTS:j/_,endDTS:W/_,type:Pr,hasAudio:!1,hasVideo:!0,nb:k.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(Oe.length,"MDAT length must not be zero"),Cr},d.remuxAudio=function(s,g,h,o,_){var O=s.inputTimeScale,k=s.samplerate?s.samplerate:O,K=O/k,N=s.segmentCodec==="aac"?A:x,W=N*K,H=this._initPTS,V=s.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],z=_!==void 0,$=s.samples,Y=V?0:8,X=this.nextAudioPts||-1,Q=g*O;if(this.isAudioContiguous=h=h||$.length&&X>0&&(o&&Math.abs(Q-X)<9e3||Math.abs(r($[0].pts-H,Q)-X)<20*W),$.forEach(function(Ge){Ge.pts=r(Ge.pts-H,Q)}),!h||X<0){if($=$.filter(function(Ge){return Ge.pts>=0}),!$.length)return;_===0?X=0:o&&!z?X=Math.max(0,Q):X=$[0].pts}if(s.segmentCodec==="aac")for(var q=this.config.maxAudioFramesDrift,J=0,ie=X;J<$.length;J++){var se=$[J],Z=se.pts,re=Z-ie,fe=Math.abs(1e3*re/O);if(re<=-q*W&&z)J===0&&(R.logger.warn("Audio frame @ "+(Z/O).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*re/O)+" ms."),this.nextAudioPts=X=ie=Z);else if(re>=q*W&&fe<S&&z){var oe=Math.round(re/W);ie=Z-oe*W,ie<0&&(oe--,ie+=W),J===0&&(this.nextAudioPts=X=ie),R.logger.warn("[mp4-remuxer]: Injecting "+oe+" audio frame @ "+(ie/O).toFixed(3)+"s due to "+Math.round(1e3*re/O)+" ms gap.");for(var de=0;de<oe;de++){var xe=Math.max(ie,0),he=I.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);he||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),he=se.unit.subarray()),$.splice(J,0,{unit:he,pts:xe}),ie+=W,J++}}se.pts=ie,ie+=W}for(var Ce=null,Le=null,_e,Ie=0,be=$.length;be--;)Ie+=$[be].unit.byteLength;for(var Be=0,Me=$.length;Be<Me;Be++){var Oe=$[Be],Ue=Oe.unit,we=Oe.pts;if(Le!==null){var We=j[Be-1];We.duration=Math.round((we-Le)/K)}else if(h&&s.segmentCodec==="aac"&&(we=X),Ce=we,Ie>0){Ie+=Y;try{_e=new Uint8Array(Ie)}catch{this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:F.ErrorTypes.MUX_ERROR,details:F.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ie,reason:"fail allocating audio mdat "+Ie});return}if(!V){var pe=new DataView(_e.buffer);pe.setUint32(0,Ie),_e.set(b.default.types.mdat,4)}}else return;_e.set(Ue,Y);var De=Ue.byteLength;Y+=De,j.push(new t(!0,N,De,0)),Le=we}var Ne=j.length;if(!!Ne){var ve=j[j.length-1];this.nextAudioPts=X=Le+K*ve.duration;var Ae=V?new Uint8Array(0):b.default.moof(s.sequenceNumber++,Ce/K,T({},s,{samples:j}));s.samples=[];var Fe=Ce/O,Xe=X/O,Qe="audio",ft={data1:Ae,data2:_e,startPTS:Fe,endPTS:Xe,startDTS:Fe,endDTS:Xe,type:Qe,hasAudio:!0,hasVideo:!1,nb:Ne};return this.isAudioContiguous=!0,console.assert(_e.length,"MDAT length must not be zero"),ft}},d.remuxEmptyAudio=function(s,g,h,o){var _=s.inputTimeScale,O=s.samplerate?s.samplerate:_,k=_/O,K=this.nextAudioPts,N=(K!==null?K:o.startDTS*_)+this._initDTS,W=o.endDTS*_+this._initDTS,H=k*A,V=Math.ceil((W-N)/H),j=I.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!j){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var z=[],$=0;$<V;$++){var Y=N+$*H;z.push({unit:j,pts:Y,dts:Y})}return s.samples=z,this.remuxAudio(s,g,h,!1)},v}();function r(v,d){var p;if(d===null)return v;for(d<v?p=-8589934592:p=8589934592;Math.abs(v-d)>4294967296;)v+=p;return v}function c(v){for(var d=0;d<v.length;d++)if(v[d].key)return d;return-1}function f(v,d,p,s){var g=v.samples.length;if(!!g){for(var h=v.inputTimeScale,o=0;o<g;o++){var _=v.samples[o];_.pts=r(_.pts-p,d*h)/h,_.dts=r(_.dts-s,d*h)/h}var O=v.samples;return v.samples=[],{samples:O}}}function e(v,d,p){var s=v.samples.length;if(!!s){for(var g=v.inputTimeScale,h=0;h<s;h++){var o=v.samples[h];o.pts=r(o.pts-p,d*g)/g}v.samples.sort(function(O,k){return O.pts-k.pts});var _=v.samples;return v.samples=[],{samples:_}}}var t=function(d,p,s,g){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=p,this.size=s,this.cts=g,this.flags=new i(d)},i=function(d){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=d?2:1,this.isNonSync=d?0:1}},"./src/remux/passthrough-remuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>D});var M=u("./src/polyfills/number.ts"),I=u("./src/remux/mp4-remuxer.ts"),b=u("./src/utils/mp4-tools.ts"),C=u("./src/loader/fragment.ts"),F=u("./src/utils/logger.ts"),R=function(){function T(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var S=T.prototype;return S.destroy=function(){},S.resetTimeStamp=function(x){this.initPTS=x,this.lastEndTime=null},S.resetNextTimestamp=function(){this.lastEndTime=null},S.resetInitSegment=function(x,y,l){this.audioCodec=y,this.videoCodec=l,this.generateInitSegment(x),this.emitInitSegment=!0},S.generateInitSegment=function(x){var y=this.audioCodec,l=this.videoCodec;if(!x||!x.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=(0,b.parseInitSegment)(x);y||(y=P(n.audio,C.ElementaryStreamTypes.AUDIO)),l||(l=P(n.video,C.ElementaryStreamTypes.VIDEO));var r={};n.audio&&n.video?r.audiovideo={container:"video/mp4",codec:y+","+l,initSegment:x,id:"main"}:n.audio?r.audio={container:"audio/mp4",codec:y,initSegment:x,id:"audio"}:n.video?r.video={container:"video/mp4",codec:l,initSegment:x,id:"main"}:F.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},S.remux=function(x,y,l,n,r){var c,f=this.initPTS,e=this.lastEndTime,t={audio:void 0,video:void 0,text:n,id3:l,initSegment:void 0};(0,M.isFiniteNumber)(e)||(e=this.lastEndTime=r||0);var i=y.samples;if(!i||!i.length)return t;var v={initPTS:void 0,timescale:1},d=this.initData;if((!d||!d.length)&&(this.generateInitSegment(i),d=this.initData),!d||!d.length)return F.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),t;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);var p=(0,b.getStartDTS)(d,i);(0,M.isFiniteNumber)(f)||(this.initPTS=v.initPTS=f=p-r);var s=(0,b.getDuration)(i,d),g=x?p-f:e,h=g+s;(0,b.offsetStartDTS)(d,i,f),s>0?this.lastEndTime=h:(F.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var o=!!d.audio,_=!!d.video,O="";o&&(O+="audio"),_&&(O+="video");var k={data1:i,startPTS:g,startDTS:g,endPTS:h,endDTS:h,type:O,hasAudio:o,hasVideo:_,nb:1,dropped:0};t.audio=k.type==="audio"?k:void 0,t.video=k.type!=="audio"?k:void 0,t.initSegment=v;var K=(c=this.initPTS)!=null?c:0;return t.id3=(0,I.flushTextTrackMetadataCueSamples)(l,r,K,K),n.samples.length&&(t.text=(0,I.flushTextTrackUserdataCueSamples)(n,r,K)),t},T}();function P(T,S){var A=T==null?void 0:T.codec;return A&&A.length>4?A:A==="hvc1"||A==="hev1"?"hvc1.1.c.L120.90":A==="av01"?"av01.0.04M.08":A==="avc1"||S===C.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const D=R},"./src/task-loop.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>M});var M=function(){function I(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=I.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(F){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,F),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},I}()},"./src/types/cmcd.ts":(G,B,u)=>{u.r(B),u.d(B,{CMCDObjectType:()=>I,CMCDStreamType:()=>C,CMCDStreamingFormat:()=>b,CMCDVersion:()=>M});var M=1,I;(function(F){F.MANIFEST="m",F.AUDIO="a",F.VIDEO="v",F.MUXED="av",F.INIT="i",F.CAPTION="c",F.TIMED_TEXT="tt",F.KEY="k",F.OTHER="o"})(I||(I={}));var b;(function(F){F.DASH="d",F.HLS="h",F.SMOOTH="s",F.OTHER="o"})(b||(b={}));var C;(function(F){F.VOD="v",F.LIVE="l"})(C||(C={}))},"./src/types/demuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{MetadataSchema:()=>M});var M;(function(I){I.audioId3="org.id3",I.dateRange="com.apple.quicktime.HLS",I.emsg="https://aomedia.org/emsg/ID3"})(M||(M={}))},"./src/types/level.ts":(G,B,u)=>{u.r(B),u.d(B,{HlsSkip:()=>b,HlsUrlParameters:()=>F,Level:()=>R,getSkipValue:()=>C});function M(P,D){for(var T=0;T<D.length;T++){var S=D[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(P,S.key,S)}}function I(P,D,T){return D&&M(P.prototype,D),T&&M(P,T),Object.defineProperty(P,"prototype",{writable:!1}),P}var b;(function(P){P.No="",P.Yes="YES",P.v2="v2"})(b||(b={}));function C(P,D){var T=P.canSkipUntil,S=P.canSkipDateRanges,A=P.endSN,x=D!==void 0?D-A:0;return T&&x<T?S?b.v2:b.Yes:b.No}var F=function(){function P(T,S,A){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=T,this.part=S,this.skip=A}var D=P.prototype;return D.addDirectives=function(S){var A=new self.URL(S);return this.msn!==void 0&&A.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&A.searchParams.set("_HLS_part",this.part.toString()),this.skip&&A.searchParams.set("_HLS_skip",this.skip),A.toString()},P}(),R=function(){function P(D){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[D.url],this.attrs=D.attrs,this.bitrate=D.bitrate,D.details&&(this.details=D.details),this.id=D.id||0,this.name=D.name,this.width=D.width||0,this.height=D.height||0,this.audioCodec=D.audioCodec,this.videoCodec=D.videoCodec,this.unknownCodecs=D.unknownCodecs,this.codecSet=[D.videoCodec,D.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}return I(P,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(T){var S=T%this.url.length;this._urlId!==S&&(this.details=void 0,this._urlId=S)}}]),P}()},"./src/types/loader.ts":(G,B,u)=>{u.r(B),u.d(B,{PlaylistContextType:()=>M,PlaylistLevelType:()=>I});var M;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var I;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(I||(I={}))},"./src/types/transmuxer.ts":(G,B,u)=>{u.r(B),u.d(B,{ChunkMetadata:()=>M});var M=function(C,F,R,P,D,T){P===void 0&&(P=0),D===void 0&&(D=-1),T===void 0&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=I(),this.buffering={audio:I(),video:I(),audiovideo:I()},this.level=C,this.sn=F,this.id=R,this.size=P,this.part=D,this.partial=T};function I(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(G,B,u)=>{u.r(B),u.d(B,{AttrList:()=>b});var M=/^(\d+)x(\d+)$/,I=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function C(R){typeof R=="string"&&(R=C.parseAttrList(R));for(var P in R)R.hasOwnProperty(P)&&(this[P]=R[P])}var F=C.prototype;return F.decimalInteger=function(P){var D=parseInt(this[P],10);return D>Number.MAX_SAFE_INTEGER?1/0:D},F.hexadecimalInteger=function(P){if(this[P]){var D=(this[P]||"0x").slice(2);D=(D.length&1?"0":"")+D;for(var T=new Uint8Array(D.length/2),S=0;S<D.length/2;S++)T[S]=parseInt(D.slice(S*2,S*2+2),16);return T}else return null},F.hexadecimalIntegerAsNumber=function(P){var D=parseInt(this[P],16);return D>Number.MAX_SAFE_INTEGER?1/0:D},F.decimalFloatingPoint=function(P){return parseFloat(this[P])},F.optionalFloat=function(P,D){var T=this[P];return T?parseFloat(T):D},F.enumeratedString=function(P){return this[P]},F.bool=function(P){return this[P]==="YES"},F.decimalResolution=function(P){var D=M.exec(this[P]);if(D!==null)return{width:parseInt(D[1],10),height:parseInt(D[2],10)}},C.parseAttrList=function(P){var D,T={},S='"';for(I.lastIndex=0;(D=I.exec(P))!==null;){var A=D[2];A.indexOf(S)===0&&A.lastIndexOf(S)===A.length-1&&(A=A.slice(1,-1)),T[D[1]]=A}return T},C}()},"./src/utils/binary-search.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>I});var M={search:function(C,F){for(var R=0,P=C.length-1,D=null,T=null;R<=P;){D=(R+P)/2|0,T=C[D];var S=F(T);if(S>0)R=D+1;else if(S<0)P=D-1;else return T}return null}};const I=M},"./src/utils/buffer-helper.ts":(G,B,u)=>{u.r(B),u.d(B,{BufferHelper:()=>b});var M=u("./src/utils/logger.ts"),I={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function C(){}return C.isBuffered=function(R,P){try{if(R){for(var D=C.getBuffered(R),T=0;T<D.length;T++)if(P>=D.start(T)&&P<=D.end(T))return!0}}catch{}return!1},C.bufferInfo=function(R,P,D){try{if(R){var T=C.getBuffered(R),S=[],A;for(A=0;A<T.length;A++)S.push({start:T.start(A),end:T.end(A)});return this.bufferedInfo(S,P,D)}}catch{}return{len:0,start:P,end:P,nextStart:void 0}},C.bufferedInfo=function(R,P,D){P=Math.max(0,P),R.sort(function(t,i){var v=t.start-i.start;return v||i.end-t.end});var T=[];if(D)for(var S=0;S<R.length;S++){var A=T.length;if(A){var x=T[A-1].end;R[S].start-x<D?R[S].end>x&&(T[A-1].end=R[S].end):T.push(R[S])}else T.push(R[S])}else T=R;for(var y=0,l,n=P,r=P,c=0;c<T.length;c++){var f=T[c].start,e=T[c].end;if(P+D>=f&&P<e)n=f,r=e,y=r-P;else if(P+D<f){l=f;break}}return{len:y,start:n||0,end:r||0,nextStart:l}},C.getBuffered=function(R){try{return R.buffered}catch(P){return M.logger.log("failed to get media.buffered",P),I}},C}()},"./src/utils/cea-608-parser.ts":(G,B,u)=>{u.r(B),u.d(B,{CaptionScreen:()=>c,Row:()=>r,default:()=>d});var M=u("./src/utils/logger.ts"),I={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(s){var g=s;return I.hasOwnProperty(s)&&(g=I[s]),String.fromCharCode(g)},C=15,F=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},P={17:2,18:4,21:6,22:8,23:10,19:13,20:15},D={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},S=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],A;(function(p){p[p.ERROR=0]="ERROR",p[p.TEXT=1]="TEXT",p[p.WARNING=2]="WARNING",p[p.INFO=2]="INFO",p[p.DEBUG=3]="DEBUG",p[p.DATA=3]="DATA"})(A||(A={}));var x=function(){function p(){this.time=null,this.verboseLevel=A.ERROR}var s=p.prototype;return s.log=function(h,o){this.verboseLevel>=h&&M.logger.log(this.time+" ["+h+"] "+o)},p}(),y=function(s){for(var g=[],h=0;h<s.length;h++)g.push(s[h].toString(16));return g},l=function(){function p(g,h,o,_,O){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=g||"white",this.underline=h||!1,this.italics=o||!1,this.background=_||"black",this.flash=O||!1}var s=p.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(h){for(var o=["foreground","underline","italics","background","flash"],_=0;_<o.length;_++){var O=o[_];h.hasOwnProperty(O)&&(this[O]=h[O])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(h){return this.foreground===h.foreground&&this.underline===h.underline&&this.italics===h.italics&&this.background===h.background&&this.flash===h.flash},s.copy=function(h){this.foreground=h.foreground,this.underline=h.underline,this.italics=h.italics,this.background=h.background,this.flash=h.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},p}(),n=function(){function p(g,h,o,_,O,k){this.uchar=void 0,this.penState=void 0,this.uchar=g||" ",this.penState=new l(h,o,_,O,k)}var s=p.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(h,o){this.uchar=h,this.penState.copy(o)},s.setPenState=function(h){this.penState.copy(h)},s.equals=function(h){return this.uchar===h.uchar&&this.penState.equals(h.penState)},s.copy=function(h){this.uchar=h.uchar,this.penState.copy(h.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},p}(),r=function(){function p(g){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var h=0;h<F;h++)this.chars.push(new n);this.logger=g,this.pos=0,this.currPenState=new l}var s=p.prototype;return s.equals=function(h){for(var o=!0,_=0;_<F;_++)if(!this.chars[_].equals(h.chars[_])){o=!1;break}return o},s.copy=function(h){for(var o=0;o<F;o++)this.chars[o].copy(h.chars[o])},s.isEmpty=function(){for(var h=!0,o=0;o<F;o++)if(!this.chars[o].isEmpty()){h=!1;break}return h},s.setCursor=function(h){this.pos!==h&&(this.pos=h),this.pos<0?(this.logger.log(A.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>F&&(this.logger.log(A.DEBUG,"Too large cursor position "+this.pos),this.pos=F)},s.moveCursor=function(h){var o=this.pos+h;if(h>1)for(var _=this.pos+1;_<o+1;_++)this.chars[_].setPenState(this.currPenState);this.setCursor(o)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(h){h>=144&&this.backSpace();var o=b(h);if(this.pos>=F){this.logger.log(A.ERROR,"Cannot insert "+h.toString(16)+" ("+o+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(o,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(h){var o;for(o=h;o<F;o++)this.chars[o].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var h=[],o=!0,_=0;_<F;_++){var O=this.chars[_].uchar;O!==" "&&(o=!1),h.push(O)}return o?"":h.join("")},s.setPenStyles=function(h){this.currPenState.setStyles(h);var o=this.chars[this.pos];o.setPenState(this.currPenState)},p}(),c=function(){function p(g){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var h=0;h<C;h++)this.rows.push(new r(g));this.logger=g,this.currRow=C-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=p.prototype;return s.reset=function(){for(var h=0;h<C;h++)this.rows[h].clear();this.currRow=C-1},s.equals=function(h){for(var o=!0,_=0;_<C;_++)if(!this.rows[_].equals(h.rows[_])){o=!1;break}return o},s.copy=function(h){for(var o=0;o<C;o++)this.rows[o].copy(h.rows[o])},s.isEmpty=function(){for(var h=!0,o=0;o<C;o++)if(!this.rows[o].isEmpty()){h=!1;break}return h},s.backSpace=function(){var h=this.rows[this.currRow];h.backSpace()},s.clearToEndOfRow=function(){var h=this.rows[this.currRow];h.clearToEndOfRow()},s.insertChar=function(h){var o=this.rows[this.currRow];o.insertChar(h)},s.setPen=function(h){var o=this.rows[this.currRow];o.setPenStyles(h)},s.moveCursor=function(h){var o=this.rows[this.currRow];o.moveCursor(h)},s.setCursor=function(h){this.logger.log(A.INFO,"setCursor: "+h);var o=this.rows[this.currRow];o.setCursor(h)},s.setPAC=function(h){this.logger.log(A.INFO,"pacData = "+JSON.stringify(h));var o=h.row-1;if(this.nrRollUpRows&&o<this.nrRollUpRows-1&&(o=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==o){for(var _=0;_<C;_++)this.rows[_].clear();var O=this.currRow+1-this.nrRollUpRows,k=this.lastOutputScreen;if(k){var K=k.rows[O].cueStartTime,N=this.logger.time;if(K&&N!==null&&K<N)for(var W=0;W<this.nrRollUpRows;W++)this.rows[o-this.nrRollUpRows+W+1].copy(k.rows[O+W])}}this.currRow=o;var H=this.rows[this.currRow];if(h.indent!==null){var V=h.indent,j=Math.max(V-1,0);H.setCursor(h.indent),h.color=H.chars[j].penState.foreground}var z={foreground:h.color,underline:h.underline,italics:h.italics,background:"black",flash:!1};this.setPen(z)},s.setBkgData=function(h){this.logger.log(A.INFO,"bkgData = "+JSON.stringify(h)),this.backSpace(),this.setPen(h),this.insertChar(32)},s.setRollUpRows=function(h){this.nrRollUpRows=h},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(A.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(A.TEXT,this.getDisplayText());var h=this.currRow+1-this.nrRollUpRows,o=this.rows.splice(h,1)[0];o.clear(),this.rows.splice(this.currRow,0,o),this.logger.log(A.INFO,"Rolling up")},s.getDisplayText=function(h){h=h||!1;for(var o=[],_="",O=-1,k=0;k<C;k++){var K=this.rows[k].getTextString();K&&(O=k+1,h?o.push("Row "+O+": '"+K+"'"):o.push(K.trim()))}return o.length>0&&(h?_="["+o.join(" | ")+"]":_=o.join(`
`)),_},s.getTextAndFormat=function(){return this.rows},p}(),f=function(){function p(g,h,o){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=g,this.outputFilter=h,this.mode=null,this.verbose=0,this.displayedMemory=new c(o),this.nonDisplayedMemory=new c(o),this.lastOutputScreen=new c(o),this.currRollUpRow=this.displayedMemory.rows[C-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=o}var s=p.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[C-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(h){this.outputFilter=h},s.setPAC=function(h){this.writeScreen.setPAC(h)},s.setBkgData=function(h){this.writeScreen.setBkgData(h)},s.setMode=function(h){h!==this.mode&&(this.mode=h,this.logger.log(A.INFO,"MODE="+h),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=h)},s.insertChars=function(h){for(var o=0;o<h.length;o++)this.writeScreen.insertChar(h[o]);var _=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(A.INFO,_+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(A.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(A.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(A.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(A.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(h){this.logger.log(A.INFO,"RU("+h+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(h)},s.ccFON=function(){this.logger.log(A.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(A.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(A.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(A.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(A.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(A.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(A.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(A.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var h=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=h,this.writeScreen=this.nonDisplayedMemory,this.logger.log(A.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(h){this.logger.log(A.INFO,"TO("+h+") - Tab Offset"),this.writeScreen.moveCursor(h)},s.ccMIDROW=function(h){var o={flash:!1};if(o.underline=h%2===1,o.italics=h>=46,o.italics)o.foreground="white";else{var _=Math.floor(h/2)-16,O=["white","green","blue","cyan","red","yellow","magenta"];o.foreground=O[_]}this.logger.log(A.INFO,"MIDROW: "+JSON.stringify(o)),this.writeScreen.setPen(o)},s.outputDataUpdate=function(h){h===void 0&&(h=!1);var o=this.logger.time;o!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=o:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,o,this.lastOutputScreen),h&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:o),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(h){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,h,this.displayedMemory),this.cueStartTime=h))},p}(),e=function(){function p(g,h,o){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var _=new x;this.channels=[null,new f(g,h,_),new f(g+1,o,_)],this.cmdHistory=v(),this.logger=_}var s=p.prototype;return s.getHandler=function(h){return this.channels[h].getHandler()},s.setHandler=function(h,o){this.channels[h].setHandler(o)},s.addData=function(h,o){var _,O,k,K=!1;this.logger.time=h;for(var N=0;N<o.length;N+=2)if(O=o[N]&127,k=o[N+1]&127,!(O===0&&k===0)){if(this.logger.log(A.DATA,"["+y([o[N],o[N+1]])+"] -> ("+y([O,k])+")"),_=this.parseCmd(O,k),_||(_=this.parseMidrow(O,k)),_||(_=this.parsePAC(O,k)),_||(_=this.parseBackgroundAttributes(O,k)),!_&&(K=this.parseChars(O,k),K)){var W=this.currentChannel;if(W&&W>0){var H=this.channels[W];H.insertChars(K)}else this.logger.log(A.WARNING,"No channel found yet. TEXT-MODE?")}!_&&!K&&this.logger.log(A.WARNING,"Couldn't parse cleaned data "+y([O,k])+" orig: "+y([o[N],o[N+1]]))}},s.parseCmd=function(h,o){var _=this.cmdHistory,O=(h===20||h===28||h===21||h===29)&&o>=32&&o<=47,k=(h===23||h===31)&&o>=33&&o<=35;if(!(O||k))return!1;if(i(h,o,_))return t(null,null,_),this.logger.log(A.DEBUG,"Repeated command ("+y([h,o])+") is dropped"),!0;var K=h===20||h===21||h===23?1:2,N=this.channels[K];return h===20||h===21||h===28||h===29?o===32?N.ccRCL():o===33?N.ccBS():o===34?N.ccAOF():o===35?N.ccAON():o===36?N.ccDER():o===37?N.ccRU(2):o===38?N.ccRU(3):o===39?N.ccRU(4):o===40?N.ccFON():o===41?N.ccRDC():o===42?N.ccTR():o===43?N.ccRTD():o===44?N.ccEDM():o===45?N.ccCR():o===46?N.ccENM():o===47&&N.ccEOC():N.ccTO(o-32),t(h,o,_),this.currentChannel=K,!0},s.parseMidrow=function(h,o){var _=0;if((h===17||h===25)&&o>=32&&o<=47){if(h===17?_=1:_=2,_!==this.currentChannel)return this.logger.log(A.ERROR,"Mismatch channel in midrow parsing"),!1;var O=this.channels[_];return O?(O.ccMIDROW(o),this.logger.log(A.DEBUG,"MIDROW ("+y([h,o])+")"),!0):!1}return!1},s.parsePAC=function(h,o){var _,O=this.cmdHistory,k=(h>=17&&h<=23||h>=25&&h<=31)&&o>=64&&o<=127,K=(h===16||h===24)&&o>=64&&o<=95;if(!(k||K))return!1;if(i(h,o,O))return t(null,null,O),!0;var N=h<=23?1:2;o>=64&&o<=95?_=N===1?R[h]:D[h]:_=N===1?P[h]:T[h];var W=this.channels[N];return W?(W.setPAC(this.interpretPAC(_,o)),t(h,o,O),this.currentChannel=N,!0):!1},s.interpretPAC=function(h,o){var _,O={color:null,italics:!1,indent:null,underline:!1,row:h};return o>95?_=o-96:_=o-64,O.underline=(_&1)===1,_<=13?O.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(_/2)]:_<=15?(O.italics=!0,O.color="white"):O.indent=Math.floor((_-16)/2)*4,O},s.parseChars=function(h,o){var _,O=null,k=null;if(h>=25?(_=2,k=h-8):(_=1,k=h),k>=17&&k<=19){var K;k===17?K=o+80:k===18?K=o+112:K=o+144,this.logger.log(A.INFO,"Special char '"+b(K)+"' in channel "+_),O=[K]}else h>=32&&h<=127&&(O=o===0?[h]:[h,o]);if(O){var N=y(O);this.logger.log(A.DEBUG,"Char codes =  "+N.join(",")),t(h,o,this.cmdHistory)}return O},s.parseBackgroundAttributes=function(h,o){var _=(h===16||h===24)&&o>=32&&o<=47,O=(h===23||h===31)&&o>=45&&o<=47;if(!(_||O))return!1;var k,K={};h===16||h===24?(k=Math.floor((o-32)/2),K.background=S[k],o%2===1&&(K.background=K.background+"_semi")):o===45?K.background="transparent":(K.foreground="black",o===47&&(K.underline=!0));var N=h<=23?1:2,W=this.channels[N];return W.setBkgData(K),t(h,o,this.cmdHistory),!0},s.reset=function(){for(var h=0;h<Object.keys(this.channels).length;h++){var o=this.channels[h];o&&o.reset()}this.cmdHistory=v()},s.cueSplitAtTime=function(h){for(var o=0;o<this.channels.length;o++){var _=this.channels[o];_&&_.cueSplitAtTime(h)}},p}();function t(p,s,g){g.a=p,g.b=s}function i(p,s,g){return g.a===p&&g.b===s}function v(){return{a:null,b:null}}const d=e},"./src/utils/codecs.ts":(G,B,u)=>{u.r(B),u.d(B,{isCodecSupportedInMp4:()=>b,isCodecType:()=>I});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function I(C,F){var R=M[F];return!!R&&R[C.slice(0,4)]===!0}function b(C,F){return MediaSource.isTypeSupported((F||"video")+'/mp4;codecs="'+C+'"')}},"./src/utils/cues.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>R});var M=u("./src/utils/vttparser.ts"),I=u("./src/utils/webvtt-parser.ts"),b=u("./src/utils/texttrack-utils.ts"),C=/\s/,F={newCue:function(D,T,S,A){for(var x=[],y,l,n,r,c,f=self.VTTCue||self.TextTrackCue,e=0;e<A.rows.length;e++)if(y=A.rows[e],n=!0,r=0,c="",!y.isEmpty()){for(var t=0;t<y.chars.length;t++)C.test(y.chars[t].uchar)&&n?r++:(c+=y.chars[t].uchar,n=!1);y.cueStartTime=T,T===S&&(S+=1e-4),r>=16?r--:r++;var i=(0,M.fixLineBreaks)(c.trim()),v=(0,I.generateCueId)(T,S,i);(!D||!D.cues||!D.cues.getCueById(v))&&(l=new f(T,S,i),l.id=v,l.line=e+1,l.align="left",l.position=10+Math.min(80,Math.floor(r*8/32)*10),x.push(l))}return D&&x.length&&(x.sort(function(d,p){return d.line==="auto"||p.line==="auto"?0:d.line>8&&p.line>8?p.line-d.line:d.line-p.line}),x.forEach(function(d){return(0,b.addCueToTrack)(D,d)})),x}};const R=F},"./src/utils/discontinuities.ts":(G,B,u)=>{u.r(B),u.d(B,{adjustSlidingStart:()=>D,alignMediaPlaylistByPDT:()=>x,alignPDT:()=>A,alignStream:()=>T,findDiscontinuousReferenceFrag:()=>R,findFirstFragWithCC:()=>C,shouldAlignOnDiscontinuities:()=>F});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/logger.ts"),b=u("./src/controller/level-helper.ts");function C(y,l){for(var n=null,r=0,c=y.length;r<c;r++){var f=y[r];if(f&&f.cc===l){n=f;break}}return n}function F(y,l,n){return!!(l.details&&(n.endCC>n.startCC||y&&y.cc<n.startCC))}function R(y,l,n){var r=y.fragments,c=l.fragments;if(!c.length||!r.length){I.logger.log("No fragments to align");return}var f=C(r,c[0].cc);if(!f||f&&!f.startPTS){I.logger.log("No frag in previous level to align on");return}return f}function P(y,l){if(y){var n=y.start+l;y.start=y.startPTS=n,y.endPTS=n+y.duration}}function D(y,l){for(var n=l.fragments,r=0,c=n.length;r<c;r++)P(n[r],y);l.fragmentHint&&P(l.fragmentHint,y),l.alignedSliding=!0}function T(y,l,n){!l||(S(y,n,l),!n.alignedSliding&&l.details&&A(n,l.details),!n.alignedSliding&&l.details&&!n.skippedSegments&&(0,b.adjustSliding)(l.details,n))}function S(y,l,n){if(F(y,n,l)){var r=R(n.details,l);r&&(0,M.isFiniteNumber)(r.start)&&(I.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),D(r.start,l))}}function A(y,l){if(!(!l.fragments.length||!y.hasProgramDateTime||!l.hasProgramDateTime)){var n=l.fragments[0].programDateTime,r=y.fragments[0].programDateTime,c=(r-n)/1e3+l.fragments[0].start;c&&(0,M.isFiniteNumber)(c)&&(I.logger.log("Adjusting PTS using programDateTime delta "+(r-n)+"ms, sliding:"+c.toFixed(3)+" "+y.url+" "),D(c,y))}}function x(y,l){if(!(!y.hasProgramDateTime||!l.hasProgramDateTime)){var n=y.fragments,r=l.fragments;if(!(!n.length||!r.length)){var c=Math.round(r.length/2)-1,f=r[c],e=C(n,f.cc)||n[Math.round(n.length/2)-1],t=f.programDateTime,i=e.programDateTime;if(!(t===null||i===null)){var v=(i-t)/1e3-(e.start-f.start);D(v,y)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>b});var M=u("./src/utils/ewma.ts"),I=function(){function C(R,P,D){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=D,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(R),this.fast_=new M.default(P)}var F=C.prototype;return F.update=function(P,D){var T=this.slow_,S=this.fast_;this.slow_.halfLife!==P&&(this.slow_=new M.default(P,T.getEstimate(),T.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new M.default(D,S.getEstimate(),S.getTotalWeight()))},F.sample=function(P,D){P=Math.max(P,this.minDelayMs_);var T=8*D,S=P/1e3,A=T/S;this.fast_.sample(S,A),this.slow_.sample(S,A)},F.canEstimate=function(){var P=this.fast_;return P&&P.getTotalWeight()>=this.minWeight_},F.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},F.destroy=function(){},C}();const b=I},"./src/utils/ewma.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>I});var M=function(){function b(F,R,P){R===void 0&&(R=0),P===void 0&&(P=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=F,this.alpha_=F?Math.exp(Math.log(.5)/F):0,this.estimate_=R,this.totalWeight_=P}var C=b.prototype;return C.sample=function(R,P){var D=Math.pow(this.alpha_,R);this.estimate_=P*(1-D)+D*this.estimate_,this.totalWeight_+=R},C.getTotalWeight=function(){return this.totalWeight_},C.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},b}();const I=M},"./src/utils/fetch-loader.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>c,fetchSupported:()=>x});var M=u("./src/polyfills/number.ts"),I=u("./src/loader/load-stats.ts"),b=u("./src/demux/chunk-cache.ts");function C(f,e){f.prototype=Object.create(e.prototype),f.prototype.constructor=f,T(f,e)}function F(f){var e=typeof Map=="function"?new Map:void 0;return F=function(i){if(i===null||!D(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(i))return e.get(i);e.set(i,v)}function v(){return R(i,arguments,S(this).constructor)}return v.prototype=Object.create(i.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),T(v,i)},F(f)}function R(f,e,t){return P()?R=Reflect.construct.bind():R=function(v,d,p){var s=[null];s.push.apply(s,d);var g=Function.bind.apply(v,s),h=new g;return p&&T(h,p.prototype),h},R.apply(null,arguments)}function P(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(f){return Function.toString.call(f).indexOf("[native code]")!==-1}function T(f,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,v){return i.__proto__=v,i},T(f,e)}function S(f){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},S(f)}function A(){return A=Object.assign?Object.assign.bind():function(f){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(f[i]=t[i])}return f},A.apply(this,arguments)}function x(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var y=function(){function f(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||n,this.controller=new self.AbortController,this.stats=new I.LoadStats}var e=f.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;(!i||!i.ok)&&(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,v,d){var p=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var g=l(i,this.controller.signal),h=d.onProgress,o=i.responseType==="arraybuffer",_=o?"byteLength":"length";this.context=i,this.config=v,this.callbacks=d,this.request=this.fetchSetup(i,g),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){p.abortInternal(),d.onTimeout(s,i,p.response)},v.timeout),self.fetch(this.request).then(function(O){if(p.response=p.loader=O,!O.ok){var k=O.status,K=O.statusText;throw new r(K||"fetch, bad network response",k,O)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(O.headers.get("Content-Length")||"0"),h&&(0,M.isFiniteNumber)(v.highWaterMark)?p.loadProgressively(O,s,i,v.highWaterMark,h):o?O.arrayBuffer():O.text()}).then(function(O){var k=p.response;self.clearTimeout(p.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var K=O[_];K&&(s.loaded=s.total=K);var N={url:k.url,data:O};h&&!(0,M.isFiniteNumber)(v.highWaterMark)&&h(s,i,O,k),d.onSuccess(N,s,i,k)}).catch(function(O){if(self.clearTimeout(p.requestTimeout),!s.aborted){var k=O&&O.code||0,K=O?O.message:null;d.onError({code:k,text:K},i,O?O.details:null)}})},e.getCacheAge=function(){var i=null;if(this.response){var v=this.response.headers.get("age");i=v?parseFloat(v):null}return i},e.loadProgressively=function(i,v,d,p,s){p===void 0&&(p=0);var g=new b.default,h=i.body.getReader(),o=function _(){return h.read().then(function(O){if(O.done)return g.dataLength&&s(v,d,g.flush(),i),Promise.resolve(new ArrayBuffer(0));var k=O.value,K=k.length;return v.loaded+=K,K<p||g.dataLength?(g.push(k),g.dataLength>=p&&s(v,d,g.flush(),i)):s(v,d,k,i),_()}).catch(function(){return Promise.reject()})};return o()},f}();function l(f,e){var t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(A({},f.headers))};return f.rangeEnd&&t.headers.set("Range","bytes="+f.rangeStart+"-"+String(f.rangeEnd-1)),t}function n(f,e){return new self.Request(f.url,e)}var r=function(f){C(e,f);function e(t,i,v){var d;return d=f.call(this,t)||this,d.code=void 0,d.details=void 0,d.code=i,d.details=v,d}return e}(F(Error));const c=y},"./src/utils/imsc1-ttml-parser.ts":(G,B,u)=>{u.r(B),u.d(B,{IMSC1_CODEC:()=>D,parseIMSC1:()=>x});var M=u("./src/utils/mp4-tools.ts"),I=u("./src/utils/vttparser.ts"),b=u("./src/utils/vttcue.ts"),C=u("./src/demux/id3.ts"),F=u("./src/utils/timescale-conversion.ts"),R=u("./src/utils/webvtt-parser.ts");function P(){return P=Object.assign?Object.assign.bind():function(d){for(var p=1;p<arguments.length;p++){var s=arguments[p];for(var g in s)Object.prototype.hasOwnProperty.call(s,g)&&(d[g]=s[g])}return d},P.apply(this,arguments)}var D="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,S=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,A={left:"start",center:"center",right:"end",start:"start",end:"end"};function x(d,p,s,g,h){var o=(0,M.findBox)(new Uint8Array(d),["mdat"]);if(o.length===0){h(new Error("Could not parse IMSC1 mdat"));return}var _=o.map(function(k){return(0,C.utf8ArrayToStr)(k)}),O=(0,F.toTimescaleFromScale)(p,1,s);try{_.forEach(function(k){return g(y(k,O))})}catch(k){h(k)}}function y(d,p){var s=new DOMParser,g=s.parseFromString(d,"text/xml"),h=g.getElementsByTagName("tt")[0];if(!h)throw new Error("Invalid ttml");var o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},_=Object.keys(o).reduce(function(W,H){return W[H]=h.getAttribute("ttp:"+H)||o[H],W},{}),O=h.getAttribute("xml:space")!=="preserve",k=n(l(h,"styling","style")),K=n(l(h,"layout","region")),N=l(h,"body","[begin]");return[].map.call(N,function(W){var H=r(W,O);if(!H||!W.hasAttribute("begin"))return null;var V=t(W.getAttribute("begin"),_),j=t(W.getAttribute("dur"),_),z=t(W.getAttribute("end"),_);if(V===null)throw e(W);if(z===null){if(j===null)throw e(W);z=V+j}var $=new b.default(V-p,z-p,H);$.id=(0,R.generateCueId)($.startTime,$.endTime,$.text);var Y=K[W.getAttribute("region")],X=k[W.getAttribute("style")];$.position=10,$.size=80;var Q=c(Y,X,k),q=Q.textAlign;if(q){var J=A[q];J&&($.lineAlign=J),$.align=q}return P($,Q),$}).filter(function(W){return W!==null})}function l(d,p,s){var g=d.getElementsByTagName(p)[0];return g?[].slice.call(g.querySelectorAll(s)):[]}function n(d){return d.reduce(function(p,s){var g=s.getAttribute("xml:id");return g&&(p[g]=s),p},{})}function r(d,p){return[].slice.call(d.childNodes).reduce(function(s,g,h){var o;return g.nodeName==="br"&&h?s+`
`:(o=g.childNodes)!==null&&o!==void 0&&o.length?r(g,p):p?s+g.textContent.trim().replace(/\s+/g," "):s+g.textContent},"")}function c(d,p,s){var g="http://www.w3.org/ns/ttml#styling",h=null,o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],_=d!=null&&d.hasAttribute("style")?d.getAttribute("style"):null;return _&&s.hasOwnProperty(_)&&(h=s[_]),o.reduce(function(O,k){var K=f(p,g,k)||f(d,g,k)||f(h,g,k);return K&&(O[k]=K),O},{})}function f(d,p,s){return d&&d.hasAttributeNS(p,s)?d.getAttributeNS(p,s):null}function e(d){return new Error("Could not parse ttml timestamp "+d)}function t(d,p){if(!d)return null;var s=(0,I.parseTimeStamp)(d);return s===null&&(T.test(d)?s=i(d,p):S.test(d)&&(s=v(d,p))),s}function i(d,p){var s=T.exec(d),g=(s[4]|0)+(s[5]|0)/p.subFrameRate;return(s[1]|0)*3600+(s[2]|0)*60+(s[3]|0)+g/p.frameRate}function v(d,p){var s=S.exec(d),g=Number(s[1]),h=s[2];switch(h){case"h":return g*3600;case"m":return g*60;case"ms":return g*1e3;case"f":return g/p.frameRate;case"t":return g/p.tickRate}return g}},"./src/utils/logger.ts":(G,B,u)=>{u.r(B),u.d(B,{enableLogs:()=>R,logger:()=>P});var M=function(){},I={trace:M,debug:M,log:M,warn:M,info:M,error:M},b=I;function C(D){var T=self.console[D];return T?T.bind(self.console,"["+D+"] >"):M}function F(D){for(var T=arguments.length,S=new Array(T>1?T-1:0),A=1;A<T;A++)S[A-1]=arguments[A];S.forEach(function(x){b[x]=D[x]?D[x].bind(D):C(x)})}function R(D,T){if(self.console&&D===!0||typeof D=="object"){F(D,"debug","log","info","warn","error");try{b.log('Debug logs enabled for "'+T+'"')}catch{b=I}}else b=I}var P=b},"./src/utils/mediakeys-helper.ts":(G,B,u)=>{u.r(B),u.d(B,{KeySystems:()=>M,requestMediaKeySystemAccess:()=>I});var M;(function(b){b.WIDEVINE="com.widevine.alpha",b.PLAYREADY="com.microsoft.playready"})(M||(M={}));var I=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":(G,B,u)=>{u.r(B),u.d(B,{getMediaSource:()=>M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(G,B,u)=>{u.r(B),u.d(B,{RemuxerTrackIdConfig:()=>R,appendUint8Array:()=>t,bin2str:()=>P,computeRawDurationFromSamples:()=>c,discardEPB:()=>s,findBox:()=>x,getDuration:()=>r,getStartDTS:()=>n,offsetStartDTS:()=>f,parseEmsg:()=>g,parseInitSegment:()=>l,parseSEIMessageFromNALu:()=>p,parseSamples:()=>i,parseSegmentIndex:()=>y,readSint32:()=>S,readUint16:()=>D,readUint32:()=>T,segmentValidRange:()=>e,writeUint32:()=>A});var M=u("./src/utils/typed-array.ts"),I=u("./src/loader/fragment.ts"),b=u("./src/demux/id3.ts"),C=Math.pow(2,32)-1,F=[].push,R={video:1,audio:2,id3:3,text:4};function P(h){return String.fromCharCode.apply(null,h)}function D(h,o){var _=h[o]<<8|h[o+1];return _<0?65536+_:_}function T(h,o){var _=S(h,o);return _<0?4294967296+_:_}function S(h,o){return h[o]<<24|h[o+1]<<16|h[o+2]<<8|h[o+3]}function A(h,o,_){h[o]=_>>24,h[o+1]=_>>16&255,h[o+2]=_>>8&255,h[o+3]=_&255}function x(h,o){var _=[];if(!o.length)return _;for(var O=h.byteLength,k=0;k<O;){var K=T(h,k),N=P(h.subarray(k+4,k+8)),W=K>1?k+K:O;if(N===o[0])if(o.length===1)_.push(h.subarray(k+8,W));else{var H=x(h.subarray(k+8,W),o.slice(1));H.length&&F.apply(_,H)}k=W}return _}function y(h){var o=[],_=h[0],O=8,k=T(h,O);O+=4;var K=0,N=0;_===0?O+=8:O+=16,O+=2;var W=h.length+N,H=D(h,O);O+=2;for(var V=0;V<H;V++){var j=O,z=T(h,j);j+=4;var $=z&2147483647,Y=(z&2147483648)>>>31;if(Y===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var X=T(h,j);j+=4,o.push({referenceSize:$,subsegmentDuration:X,info:{duration:X/k,start:W,end:W+$-1}}),W+=$,j+=4,O=j}return{earliestPresentationTime:K,timescale:k,version:_,referencesCount:H,references:o}}function l(h){for(var o=[],_=x(h,["moov","trak"]),O=0;O<_.length;O++){var k=_[O],K=x(k,["tkhd"])[0];if(K){var N=K[0],W=N===0?12:20,H=T(K,W),V=x(k,["mdia","mdhd"])[0];if(V){N=V[0],W=N===0?12:20;var j=T(V,W),z=x(k,["mdia","hdlr"])[0];if(z){var $=P(z.subarray(8,12)),Y={soun:I.ElementaryStreamTypes.AUDIO,vide:I.ElementaryStreamTypes.VIDEO}[$];if(Y){var X=x(k,["mdia","minf","stbl","stsd"])[0],Q=void 0;X&&(Q=P(X.subarray(12,16))),o[H]={timescale:j,type:Y},o[Y]={timescale:j,id:H,codec:Q}}}}}}var q=x(h,["moov","mvex","trex"]);return q.forEach(function(J){var ie=T(J,4),se=o[ie];se&&(se.default={duration:T(J,12),flags:T(J,20)})}),o}function n(h,o){return x(o,["moof","traf"]).reduce(function(_,O){var k=x(O,["tfdt"])[0],K=k[0],N=x(O,["tfhd"]).reduce(function(W,H){var V=T(H,4),j=h[V];if(j){var z=T(k,4);K===1&&(z*=Math.pow(2,32),z+=T(k,8));var $=j.timescale||9e4,Y=z/$;if(isFinite(Y)&&(W===null||Y<W))return Y}return W},null);return N!==null&&isFinite(N)&&(_===null||N<_)?N:_},null)||0}function r(h,o){for(var _=0,O=0,k=0,K=x(h,["moof","traf"]),N=0;N<K.length;N++){var W=K[N],H=x(W,["tfhd"])[0],V=T(H,4),j=o[V];if(!!j){var z=j.default,$=T(H,0)|(z==null?void 0:z.flags),Y=z==null?void 0:z.duration;$&8&&($&2?Y=T(H,12):Y=T(H,8));for(var X=j.timescale||9e4,Q=x(W,["trun"]),q=0;q<Q.length;q++){if(_=c(Q[q]),!_&&Y){var J=T(Q[q],4);_=Y*J}j.type===I.ElementaryStreamTypes.VIDEO?O+=_/X:j.type===I.ElementaryStreamTypes.AUDIO&&(k+=_/X)}}}if(O===0&&k===0){for(var ie=0,se=x(h,["sidx"]),Z=0;Z<se.length;Z++){var re=y(se[Z]);re!=null&&re.references&&(ie+=re.references.reduce(function(fe,oe){return fe+oe.info.duration||0},0))}return ie}return O||k}function c(h){var o=T(h,0),_=8;o&1&&(_+=4),o&4&&(_+=4);for(var O=0,k=T(h,4),K=0;K<k;K++){if(o&256){var N=T(h,_);O+=N,_+=4}o&512&&(_+=4),o&1024&&(_+=4),o&2048&&(_+=4)}return O}function f(h,o,_){x(o,["moof","traf"]).forEach(function(O){x(O,["tfhd"]).forEach(function(k){var K=T(k,4),N=h[K];if(!!N){var W=N.timescale||9e4;x(O,["tfdt"]).forEach(function(H){var V=H[0],j=T(H,4);if(V===0)j-=_*W,j=Math.max(j,0),A(H,4,j);else{j*=Math.pow(2,32),j+=T(H,8),j-=_*W,j=Math.max(j,0);var z=Math.floor(j/(C+1)),$=Math.floor(j%(C+1));A(H,4,z),A(H,8,$)}})}})})}function e(h){var o={valid:null,remainder:null},_=x(h,["moof"]);if(_){if(_.length<2)return o.remainder=h,o}else return o;var O=_[_.length-1];return o.valid=(0,M.sliceUint8)(h,0,O.byteOffset-8),o.remainder=(0,M.sliceUint8)(h,O.byteOffset-8),o}function t(h,o){var _=new Uint8Array(h.length+o.length);return _.set(h),_.set(o,h.length),_}function i(h,o){var _=[],O=o.samples,k=o.timescale,K=o.id,N=!1,W=x(O,["moof"]);return W.map(function(H){var V=H.byteOffset-8,j=x(H,["traf"]);j.map(function(z){var $=x(z,["tfdt"]).map(function(Y){var X=Y[0],Q=T(Y,4);return X===1&&(Q*=Math.pow(2,32),Q+=T(Y,8)),Q/k})[0];return $!==void 0&&(h=$),x(z,["tfhd"]).map(function(Y){var X=T(Y,4),Q=T(Y,0)&16777215,q=(Q&1)!==0,J=(Q&2)!==0,ie=(Q&8)!==0,se=0,Z=(Q&16)!==0,re=0,fe=(Q&32)!==0,oe=8;X===K&&(q&&(oe+=8),J&&(oe+=4),ie&&(se=T(Y,oe),oe+=4),Z&&(re=T(Y,oe),oe+=4),fe&&(oe+=4),o.type==="video"&&(N=v(o.codec)),x(z,["trun"]).map(function(de){var xe=de[0],he=T(de,0)&16777215,Ce=(he&1)!==0,Le=0,_e=(he&4)!==0,Ie=(he&256)!==0,be=0,Be=(he&512)!==0,Me=0,Oe=(he&1024)!==0,Ue=(he&2048)!==0,we=0,We=T(de,4),pe=8;Ce&&(Le=T(de,pe),pe+=4),_e&&(pe+=4);for(var De=Le+V,Ne=0;Ne<We;Ne++){if(Ie?(be=T(de,pe),pe+=4):be=se,Be?(Me=T(de,pe),pe+=4):Me=re,Oe&&(pe+=4),Ue&&(xe===0?we=T(de,pe):we=S(de,pe),pe+=4),o.type===I.ElementaryStreamTypes.VIDEO)for(var ve=0;ve<Me;){var Ae=T(O,De);if(De+=4,d(N,O[De])){var Fe=O.subarray(De,De+Ae);p(Fe,N?2:1,h+we/k,_)}De+=Ae,ve+=Ae+4}h+=be/k}}))})})}),_}function v(h){if(!h)return!1;var o=h.indexOf("."),_=o<0?h:h.substring(0,o);return _==="hvc1"||_==="hev1"||_==="dvh1"||_==="dvhe"}function d(h,o){if(h){var _=o>>1&63;return _===39||_===40}else{var O=o&31;return O===6}}function p(h,o,_,O){var k=s(h),K=0;K+=o;for(var N=0,W=0,H=!1,V=0;K<k.length;){N=0;do{if(K>=k.length)break;V=k[K++],N+=V}while(V===255);W=0;do{if(K>=k.length)break;V=k[K++],W+=V}while(V===255);var j=k.length-K;if(!H&&N===4&&K<k.length){H=!0;var z=k[K++];if(z===181){var $=D(k,K);if(K+=2,$===49){var Y=T(k,K);if(K+=4,Y===1195456820){var X=k[K++];if(X===3){var Q=k[K++],q=31&Q,J=64&Q,ie=J?2+q*3:0,se=new Uint8Array(ie);if(J){se[0]=Q;for(var Z=1;Z<ie;Z++)se[Z]=k[K++]}O.push({type:X,payloadType:N,pts:_,bytes:se})}}}}}else if(N===5&&W<j){if(H=!0,W>16){for(var re=[],fe=0;fe<16;fe++){var oe=k[K++].toString(16);re.push(oe.length==1?"0"+oe:oe),(fe===3||fe===5||fe===7||fe===9)&&re.push("-")}for(var de=W-16,xe=new Uint8Array(de),he=0;he<de;he++)xe[he]=k[K++];O.push({payloadType:N,pts:_,uuid:re.join(""),userData:(0,b.utf8ArrayToStr)(xe),userDataBytes:xe})}}else if(W<j)K+=W;else if(W>j)break}}function s(h){for(var o=h.byteLength,_=[],O=1;O<o-2;)h[O]===0&&h[O+1]===0&&h[O+2]===3?(_.push(O+2),O+=2):O++;if(_.length===0)return h;var k=o-_.length,K=new Uint8Array(k),N=0;for(O=0;O<k;N++,O++)N===_[0]&&(N++,_.shift()),K[O]=h[N];return K}function g(h){var o=h[0],_="",O="",k=0,K=0,N=0,W=0,H=0,V=0;if(o===0){for(;P(h.subarray(V,V+1))!=="\0";)_+=P(h.subarray(V,V+1)),V+=1;for(_+=P(h.subarray(V,V+1)),V+=1;P(h.subarray(V,V+1))!=="\0";)O+=P(h.subarray(V,V+1)),V+=1;O+=P(h.subarray(V,V+1)),V+=1,k=T(h,12),K=T(h,16),W=T(h,20),H=T(h,24),V=28}else if(o===1){V+=4,k=T(h,V),V+=4;var j=T(h,V);V+=4;var z=T(h,V);for(V+=4,N=Math.pow(2,32)*j+z,Number.isSafeInteger(N)||(N=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),W=T(h,V),V+=4,H=T(h,V),V+=4;P(h.subarray(V,V+1))!=="\0";)_+=P(h.subarray(V,V+1)),V+=1;for(_+=P(h.subarray(V,V+1)),V+=1;P(h.subarray(V,V+1))!=="\0";)O+=P(h.subarray(V,V+1)),V+=1;O+=P(h.subarray(V,V+1)),V+=1}var $=h.subarray(V,h.byteLength);return{schemeIdUri:_,value:O,timeScale:k,presentationTime:N,presentationTimeDelta:K,eventDuration:W,id:H,payload:$}}},"./src/utils/output-filter.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>M});var M=function(){function I(C,F){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=C,this.trackName=F}var b=I.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(F,R,P){(this.startTime===null||this.startTime>F)&&(this.startTime=F),this.endTime=R,this.screen=P,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},I}()},"./src/utils/texttrack-utils.ts":(G,B,u)=>{u.r(B),u.d(B,{addCueToTrack:()=>b,clearCurrentCues:()=>C,getCuesInRange:()=>P,removeCuesInRange:()=>F,sendAddTrackEvent:()=>I});var M=u("./src/utils/logger.ts");function I(D,T){var S;try{S=new Event("addtrack")}catch{S=document.createEvent("Event"),S.initEvent("addtrack",!1,!1)}S.track=D,T.dispatchEvent(S)}function b(D,T){var S=D.mode;if(S==="disabled"&&(D.mode="hidden"),D.cues&&!D.cues.getCueById(T.id))try{if(D.addCue(T),!D.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(x){M.logger.debug("[texttrack-utils]: "+x);var A=new self.TextTrackCue(T.startTime,T.endTime,T.text);A.id=T.id,D.addCue(A)}S==="disabled"&&(D.mode=S)}function C(D){var T=D.mode;if(T==="disabled"&&(D.mode="hidden"),D.cues)for(var S=D.cues.length;S--;)D.removeCue(D.cues[S]);T==="disabled"&&(D.mode=T)}function F(D,T,S,A){var x=D.mode;if(x==="disabled"&&(D.mode="hidden"),D.cues&&D.cues.length>0)for(var y=P(D.cues,T,S),l=0;l<y.length;l++)(!A||A(y[l]))&&D.removeCue(y[l]);x==="disabled"&&(D.mode=x)}function R(D,T){if(T<D[0].startTime)return 0;var S=D.length-1;if(T>D[S].endTime)return-1;for(var A=0,x=S;A<=x;){var y=Math.floor((x+A)/2);if(T<D[y].startTime)x=y-1;else if(T>D[y].startTime&&A<S)A=y+1;else return y}return D[A].startTime-T<T-D[x].startTime?A:x}function P(D,T,S){var A=[],x=R(D,T);if(x>-1)for(var y=x,l=D.length;y<l;y++){var n=D[y];if(n.startTime>=T&&n.endTime<=S)A.push(n);else if(n.startTime>S)return A}return A}},"./src/utils/time-ranges.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>I});var M={toString:function(C){for(var F="",R=C.length,P=0;P<R;P++)F+="["+C.start(P).toFixed(3)+","+C.end(P).toFixed(3)+"]";return F}};const I=M},"./src/utils/timescale-conversion.ts":(G,B,u)=>{u.r(B),u.d(B,{toMpegTsClockFromTimescale:()=>F,toMsFromMpegTsClock:()=>C,toTimescaleFromBase:()=>I,toTimescaleFromScale:()=>b});var M=9e4;function I(R,P,D,T){D===void 0&&(D=1),T===void 0&&(T=!1);var S=R*P*D;return T?Math.round(S):S}function b(R,P,D,T){return D===void 0&&(D=1),T===void 0&&(T=!1),I(R,P,1/D,T)}function C(R,P){return P===void 0&&(P=!1),I(R,1e3,1/M,P)}function F(R,P){return P===void 0&&(P=1),I(R,M,1/P)}},"./src/utils/typed-array.ts":(G,B,u)=>{u.r(B),u.d(B,{sliceUint8:()=>M});function M(I,b,C){return Uint8Array.prototype.slice?I.slice(b,C):new Uint8Array(Array.prototype.slice.call(I,b,C))}},"./src/utils/vttcue.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>M});const M=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var I=["","lr","rl"],b=["start","middle","end","left","right"];function C(T,S){if(typeof S!="string"||!Array.isArray(T))return!1;var A=S.toLowerCase();return~T.indexOf(A)?A:!1}function F(T){return C(I,T)}function R(T){return C(b,T)}function P(T){for(var S=arguments.length,A=new Array(S>1?S-1:0),x=1;x<S;x++)A[x-1]=arguments[x];for(var y=1;y<arguments.length;y++){var l=arguments[y];for(var n in l)T[n]=l[n]}return T}function D(T,S,A){var x=this,y={enumerable:!0};x.hasBeenReset=!1;var l="",n=!1,r=T,c=S,f=A,e=null,t="",i=!0,v="auto",d="start",p=50,s="middle",g=50,h="middle";Object.defineProperty(x,"id",P({},y,{get:function(){return l},set:function(_){l=""+_}})),Object.defineProperty(x,"pauseOnExit",P({},y,{get:function(){return n},set:function(_){n=!!_}})),Object.defineProperty(x,"startTime",P({},y,{get:function(){return r},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");r=_,this.hasBeenReset=!0}})),Object.defineProperty(x,"endTime",P({},y,{get:function(){return c},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");c=_,this.hasBeenReset=!0}})),Object.defineProperty(x,"text",P({},y,{get:function(){return f},set:function(_){f=""+_,this.hasBeenReset=!0}})),Object.defineProperty(x,"region",P({},y,{get:function(){return e},set:function(_){e=_,this.hasBeenReset=!0}})),Object.defineProperty(x,"vertical",P({},y,{get:function(){return t},set:function(_){var O=F(_);if(O===!1)throw new SyntaxError("An invalid or illegal string was specified.");t=O,this.hasBeenReset=!0}})),Object.defineProperty(x,"snapToLines",P({},y,{get:function(){return i},set:function(_){i=!!_,this.hasBeenReset=!0}})),Object.defineProperty(x,"line",P({},y,{get:function(){return v},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");v=_,this.hasBeenReset=!0}})),Object.defineProperty(x,"lineAlign",P({},y,{get:function(){return d},set:function(_){var O=R(_);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");d=O,this.hasBeenReset=!0}})),Object.defineProperty(x,"position",P({},y,{get:function(){return p},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");p=_,this.hasBeenReset=!0}})),Object.defineProperty(x,"positionAlign",P({},y,{get:function(){return s},set:function(_){var O=R(_);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");s=O,this.hasBeenReset=!0}})),Object.defineProperty(x,"size",P({},y,{get:function(){return g},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(x,"align",P({},y,{get:function(){return h},set:function(_){var O=R(_);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");h=O,this.hasBeenReset=!0}})),x.displayState=void 0}return D.prototype.getCueAsHTML=function(){var T=self.WebVTT;return T.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":(G,B,u)=>{u.r(B),u.d(B,{VTTParser:()=>S,fixLineBreaks:()=>T,parseTimeStamp:()=>b});var M=u("./src/utils/vttcue.ts"),I=function(){function A(){}var x=A.prototype;return x.decode=function(l,n){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},A}();function b(A){function x(l,n,r,c){return(l|0)*3600+(n|0)*60+(r|0)+parseFloat(c||0)}var y=A.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return y?parseFloat(y[2])>59?x(y[2],y[3],0,y[4]):x(y[1],y[2],y[3],y[4]):null}var C=function(){function A(){this.values=Object.create(null)}var x=A.prototype;return x.set=function(l,n){!this.get(l)&&n!==""&&(this.values[l]=n)},x.get=function(l,n,r){return r?this.has(l)?this.values[l]:n[r]:this.has(l)?this.values[l]:n},x.has=function(l){return l in this.values},x.alt=function(l,n,r){for(var c=0;c<r.length;++c)if(n===r[c]){this.set(l,n);break}},x.integer=function(l,n){/^-?\d+$/.test(n)&&this.set(l,parseInt(n,10))},x.percent=function(l,n){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(n)){var r=parseFloat(n);if(r>=0&&r<=100)return this.set(l,r),!0}return!1},A}();function F(A,x,y,l){var n=l?A.split(l):[A];for(var r in n)if(typeof n[r]=="string"){var c=n[r].split(y);if(c.length===2){var f=c[0],e=c[1];x(f,e)}}}var R=new M.default(0,0,""),P=R.align==="middle"?"middle":"center";function D(A,x,y){var l=A;function n(){var f=b(A);if(f===null)throw new Error("Malformed timestamp: "+l);return A=A.replace(/^[^\sa-zA-Z-]+/,""),f}function r(f,e){var t=new C;F(f,function(d,p){var s;switch(d){case"region":for(var g=y.length-1;g>=0;g--)if(y[g].id===p){t.set(d,y[g].region);break}break;case"vertical":t.alt(d,p,["rl","lr"]);break;case"line":s=p.split(","),t.integer(d,s[0]),t.percent(d,s[0])&&t.set("snapToLines",!1),t.alt(d,s[0],["auto"]),s.length===2&&t.alt("lineAlign",s[1],["start",P,"end"]);break;case"position":s=p.split(","),t.percent(d,s[0]),s.length===2&&t.alt("positionAlign",s[1],["start",P,"end","line-left","line-right","auto"]);break;case"size":t.percent(d,p);break;case"align":t.alt(d,p,["start",P,"end","left","right"]);break}},/:/,/\s/),e.region=t.get("region",null),e.vertical=t.get("vertical","");var i=t.get("line","auto");i==="auto"&&R.line===-1&&(i=-1),e.line=i,e.lineAlign=t.get("lineAlign","start"),e.snapToLines=t.get("snapToLines",!0),e.size=t.get("size",100),e.align=t.get("align",P);var v=t.get("position","auto");v==="auto"&&R.position===50&&(v=e.align==="start"||e.align==="left"?0:e.align==="end"||e.align==="right"?100:50),e.position=v}function c(){A=A.replace(/^\s+/,"")}if(c(),x.startTime=n(),c(),A.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);A=A.slice(3),c(),x.endTime=n(),c(),r(A,x)}function T(A){return A.replace(/<br(?: \/)?>/gi,`
`)}var S=function(){function A(){this.state="INITIAL",this.buffer="",this.decoder=new I,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var x=A.prototype;return x.parse=function(l){var n=this;l&&(n.buffer+=n.decoder.decode(l,{stream:!0}));function r(){var v=n.buffer,d=0;for(v=T(v);d<v.length&&v[d]!=="\r"&&v[d]!==`
`;)++d;var p=v.slice(0,d);return v[d]==="\r"&&++d,v[d]===`
`&&++d,n.buffer=v.slice(d),p}function c(v){F(v,function(d,p){},/:/)}try{var f="";if(n.state==="INITIAL"){if(!/\r\n|\n/.test(n.buffer))return this;f=r();var e=f.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!e||!e[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var t=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(t?t=!1:f=r(),n.state){case"HEADER":/:/.test(f)?c(f):f||(n.state="ID");continue;case"NOTE":f||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){n.state="NOTE";break}if(!f)continue;if(n.cue=new M.default(0,0,""),n.state="CUE",f.indexOf("-->")===-1){n.cue.id=f;continue}case"CUE":if(!n.cue){n.state="BADCUE";continue}try{D(f,n.cue,n.regionList)}catch{n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":{var i=f.indexOf("-->")!==-1;if(!f||i&&(t=!0)){n.oncue&&n.cue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}if(n.cue===null)continue;n.cue.text&&(n.cue.text+=`
`),n.cue.text+=f}continue;case"BADCUE":f||(n.state="ID")}}}catch{n.state==="CUETEXT"&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state=n.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},x.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(n){l.onparsingerror&&l.onparsingerror(n)}return l.onflush&&l.onflush(),this},A}()},"./src/utils/webvtt-parser.ts":(G,B,u)=>{u.r(B),u.d(B,{generateCueId:()=>S,parseWebVTT:()=>x});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/vttparser.ts"),b=u("./src/demux/id3.ts"),C=u("./src/utils/timescale-conversion.ts"),F=u("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,P=function(l,n,r){return r===void 0&&(r=0),l.slice(r,r+n.length)===n},D=function(l){var n=parseInt(l.slice(-3)),r=parseInt(l.slice(-6,-4)),c=parseInt(l.slice(-9,-7)),f=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!(0,M.isFiniteNumber)(n)||!(0,M.isFiniteNumber)(r)||!(0,M.isFiniteNumber)(c)||!(0,M.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return n+=1e3*r,n+=60*1e3*c,n+=60*60*1e3*f,n},T=function(l){for(var n=5381,r=l.length;r;)n=n*33^l.charCodeAt(--r);return(n>>>0).toString()};function S(y,l,n){return T(y.toString())+T(l.toString())+T(n)}var A=function(l,n,r){var c=l[n],f=l[c.prevCC];if(!f||!f.new&&c.new){l.ccOffset=l.presentationOffset=c.start,c.new=!1;return}for(;(e=f)!==null&&e!==void 0&&e.new;){var e;l.ccOffset+=c.start-f.start,c.new=!1,c=f,f=l[c.prevCC]}l.presentationOffset=r};function x(y,l,n,r,c,f,e,t){var i=new I.VTTParser,v=(0,b.utf8ArrayToStr)(new Uint8Array(y)).trim().replace(R,`
`).split(`
`),d=[],p=(0,C.toMpegTsClockFromTimescale)(l,n),s="00:00.000",g=0,h=0,o,_=!0;i.oncue=function(O){var k=r[c],K=r.ccOffset,N=(g-p)/9e4;k!=null&&k.new&&(h!==void 0?K=r.ccOffset=k.start:A(r,c,N)),N&&(K=N-r.presentationOffset);var W=O.endTime-O.startTime,H=(0,F.normalizePts)((O.startTime+K-h)*9e4,f*9e4)/9e4;O.startTime=Math.max(H,0),O.endTime=Math.max(H+W,0);var V=O.text.trim();O.text=decodeURIComponent(encodeURIComponent(V)),O.id||(O.id=S(O.startTime,O.endTime,V)),O.endTime>0&&d.push(O)},i.onparsingerror=function(O){o=O},i.onflush=function(){if(o){t(o);return}e(d)},v.forEach(function(O){if(_)if(P(O,"X-TIMESTAMP-MAP=")){_=!1,O.slice(16).split(",").forEach(function(k){P(k,"LOCAL:")?s=k.slice(6):P(k,"MPEGTS:")&&(g=parseInt(k.slice(7)))});try{h=D(s)/1e3}catch(k){o=k}return}else O===""&&(_=!1);i.parse(O+`
`)}),i.flush()}},"./src/utils/xhr-loader.ts":(G,B,u)=>{u.r(B),u.d(B,{default:()=>F});var M=u("./src/utils/logger.ts"),I=u("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,C=function(){function R(D){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=D?D.xhrSetup:null,this.stats=new I.LoadStats,this.retryDelay=0}var P=R.prototype;return P.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},P.abortInternal=function(){var T=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),T&&(T.onreadystatechange=null,T.onprogress=null,T.readyState!==4&&(this.stats.aborted=!0,T.abort()))},P.abort=function(){var T;this.abortInternal(),(T=this.callbacks)!==null&&T!==void 0&&T.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},P.load=function(T,S,A){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=T,this.config=S,this.callbacks=A,this.retryDelay=S.retryDelay,this.loadInternal()},P.loadInternal=function(){var T=this.config,S=this.context;if(!!T){var A=this.loader=new self.XMLHttpRequest,x=this.stats;x.loading.first=0,x.loaded=0;var y=this.xhrSetup;try{if(y)try{y(A,S.url)}catch{A.open("GET",S.url,!0),y(A,S.url)}A.readyState||A.open("GET",S.url,!0);var l=this.context.headers;if(l)for(var n in l)A.setRequestHeader(n,l[n])}catch(r){this.callbacks.onError({code:A.status,text:r.message},S,A);return}S.rangeEnd&&A.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),A.onreadystatechange=this.readystatechange.bind(this),A.onprogress=this.loadprogress.bind(this),A.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout),A.send()}},P.readystatechange=function(){var T=this.context,S=this.loader,A=this.stats;if(!(!T||!S)){var x=S.readyState,y=this.config;if(!A.aborted&&x>=2)if(self.clearTimeout(this.requestTimeout),A.loading.first===0&&(A.loading.first=Math.max(self.performance.now(),A.loading.start)),x===4){S.onreadystatechange=null,S.onprogress=null;var l=S.status,n=S.responseType==="arraybuffer";if(l>=200&&l<300&&(n&&S.response||S.responseText!==null)){A.loading.end=Math.max(self.performance.now(),A.loading.first);var r,c;if(n?(r=S.response,c=r.byteLength):(r=S.responseText,c=r.length),A.loaded=A.total=c,!this.callbacks)return;var f=this.callbacks.onProgress;if(f&&f(A,T,r,S),!this.callbacks)return;var e={url:S.responseURL,data:r};this.callbacks.onSuccess(e,A,T,S)}else A.retry>=y.maxRetry||l>=400&&l<499?(M.logger.error(l+" while loading "+T.url),this.callbacks.onError({code:l,text:S.statusText},T,S)):(M.logger.warn(l+" while loading "+T.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,y.maxRetryDelay),A.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),y.timeout)}},P.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var T=this.callbacks;T&&(this.abortInternal(),T.onTimeout(this.stats,this.context,this.loader))},P.loadprogress=function(T){var S=this.stats;S.loaded=T.loaded,T.lengthComputable&&(S.total=T.total)},P.getCacheAge=function(){var T=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");T=S?parseFloat(S):null}return T},R}();const F=C},"./node_modules/eventemitter3/index.js":G=>{var B=Object.prototype.hasOwnProperty,u="~";function M(){}Object.create&&(M.prototype=Object.create(null),new M().__proto__||(u=!1));function I(R,P,D){this.fn=R,this.context=P,this.once=D||!1}function b(R,P,D,T,S){if(typeof D!="function")throw new TypeError("The listener must be a function");var A=new I(D,T||R,S),x=u?u+P:P;return R._events[x]?R._events[x].fn?R._events[x]=[R._events[x],A]:R._events[x].push(A):(R._events[x]=A,R._eventsCount++),R}function C(R,P){--R._eventsCount===0?R._events=new M:delete R._events[P]}function F(){this._events=new M,this._eventsCount=0}F.prototype.eventNames=function(){var P=[],D,T;if(this._eventsCount===0)return P;for(T in D=this._events)B.call(D,T)&&P.push(u?T.slice(1):T);return Object.getOwnPropertySymbols?P.concat(Object.getOwnPropertySymbols(D)):P},F.prototype.listeners=function(P){var D=u?u+P:P,T=this._events[D];if(!T)return[];if(T.fn)return[T.fn];for(var S=0,A=T.length,x=new Array(A);S<A;S++)x[S]=T[S].fn;return x},F.prototype.listenerCount=function(P){var D=u?u+P:P,T=this._events[D];return T?T.fn?1:T.length:0},F.prototype.emit=function(P,D,T,S,A,x){var y=u?u+P:P;if(!this._events[y])return!1;var l=this._events[y],n=arguments.length,r,c;if(l.fn){switch(l.once&&this.removeListener(P,l.fn,void 0,!0),n){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,D),!0;case 3:return l.fn.call(l.context,D,T),!0;case 4:return l.fn.call(l.context,D,T,S),!0;case 5:return l.fn.call(l.context,D,T,S,A),!0;case 6:return l.fn.call(l.context,D,T,S,A,x),!0}for(c=1,r=new Array(n-1);c<n;c++)r[c-1]=arguments[c];l.fn.apply(l.context,r)}else{var f=l.length,e;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(P,l[c].fn,void 0,!0),n){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,D);break;case 3:l[c].fn.call(l[c].context,D,T);break;case 4:l[c].fn.call(l[c].context,D,T,S);break;default:if(!r)for(e=1,r=new Array(n-1);e<n;e++)r[e-1]=arguments[e];l[c].fn.apply(l[c].context,r)}}return!0},F.prototype.on=function(P,D,T){return b(this,P,D,T,!1)},F.prototype.once=function(P,D,T){return b(this,P,D,T,!0)},F.prototype.removeListener=function(P,D,T,S){var A=u?u+P:P;if(!this._events[A])return this;if(!D)return C(this,A),this;var x=this._events[A];if(x.fn)x.fn===D&&(!S||x.once)&&(!T||x.context===T)&&C(this,A);else{for(var y=0,l=[],n=x.length;y<n;y++)(x[y].fn!==D||S&&!x[y].once||T&&x[y].context!==T)&&l.push(x[y]);l.length?this._events[A]=l.length===1?l[0]:l:C(this,A)}return this},F.prototype.removeAllListeners=function(P){var D;return P?(D=u?u+P:P,this._events[D]&&C(this,D)):(this._events=new M,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=u,F.EventEmitter=F,G.exports=F},"./node_modules/url-toolkit/src/url-toolkit.js":function(G){(function(B){var u=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,M=/^(?=([^\/?#]*))\1([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,C={buildAbsoluteURL:function(F,R,P){if(P=P||{},F=F.trim(),R=R.trim(),!R){if(!P.alwaysNormalize)return F;var D=C.parseURL(F);if(!D)throw new Error("Error trying to parse base URL.");return D.path=C.normalizePath(D.path),C.buildURLFromParts(D)}var T=C.parseURL(R);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return P.alwaysNormalize?(T.path=C.normalizePath(T.path),C.buildURLFromParts(T)):R;var S=C.parseURL(F);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var A=M.exec(S.path);S.netLoc=A[1],S.path=A[2]}S.netLoc&&!S.path&&(S.path="/");var x={scheme:S.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(x.netLoc=S.netLoc,T.path[0]!=="/"))if(!T.path)x.path=S.path,T.params||(x.params=S.params,T.query||(x.query=S.query));else{var y=S.path,l=y.substring(0,y.lastIndexOf("/")+1)+T.path;x.path=C.normalizePath(l)}return x.path===null&&(x.path=P.alwaysNormalize?C.normalizePath(T.path):T.path),C.buildURLFromParts(x)},parseURL:function(F){var R=u.exec(F);return R?{scheme:R[1]||"",netLoc:R[2]||"",path:R[3]||"",params:R[4]||"",query:R[5]||"",fragment:R[6]||""}:null},normalizePath:function(F){for(F=F.split("").reverse().join("").replace(I,"");F.length!==(F=F.replace(b,"")).length;);return F.split("").reverse().join("")},buildURLFromParts:function(F){return F.scheme+F.netLoc+F.path+F.params+F.query+F.fragment}};G.exports=C})()}},L={};function w(G){var B=L[G];if(B!==void 0)return B.exports;var u=L[G]={exports:{}};return E[G].call(u.exports,u,u.exports,w),u.exports}w.m=E,w.n=G=>{var B=G&&G.__esModule?()=>G.default:()=>G;return w.d(B,{a:B}),B},w.d=(G,B)=>{for(var u in B)w.o(B,u)&&!w.o(G,u)&&Object.defineProperty(G,u,{enumerable:!0,get:B[u]})},w.o=(G,B)=>Object.prototype.hasOwnProperty.call(G,B),w.r=G=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(G,"__esModule",{value:!0})};var U=w("./src/hls.ts");return U=U.default,U})())})(as);function dr(a){let m,E;return m=new qn({props:{slidesPerView:a[0],autoplay:{delay:1e3,disableOnInteraction:!1},spaceBetween:30,class:"slides",loop:!0,modules:[Gn],style:"width: 60%;",$$slots:{default:[hs]},$$scope:{ctx:a}}}),{c(){qe(m.$$.fragment)},l(L){et(m.$$.fragment,L)},m(L,w){tt(m,L,w),E=!0},p(L,w){const U={};w&1&&(U.slidesPerView=L[0]),w&2&&(U.$$scope={dirty:w,ctx:L}),m.$set(U)},i(L){E||(Te(m.$$.fragment,L),E=!0)},o(L){ye(m.$$.fragment,L),E=!1},d(L){rt(m,L)}}}function os(a){let m,E,L;return{c(){m=le("a"),E=le("img"),this.h()},l(w){m=ue(w,"A",{href:!0,target:!0,class:!0});var U=ce(m);E=ue(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){ut(E.src,L="/images/clients-icons/nzxt-icon.png")||ee(E,"src",L),ee(E,"alt","NZXT"),ee(E,"class","svelte-zh1v7o"),ee(m,"href","https://nzxt.com/"),ee(m,"target","_blank"),ee(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function ls(a){let m,E,L;return{c(){m=le("a"),E=le("img"),this.h()},l(w){m=ue(w,"A",{href:!0,target:!0,class:!0});var U=ce(m);E=ue(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){ut(E.src,L="/images/clients-icons/cushion-icon.png")||ee(E,"src",L),ee(E,"alt","Cushion"),ee(E,"class","svelte-zh1v7o"),ee(m,"href","https://cushion.ai/"),ee(m,"target","_blank"),ee(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function us(a){let m,E,L;return{c(){m=le("a"),E=le("img"),this.h()},l(w){m=ue(w,"A",{href:!0,target:!0,class:!0});var U=ce(m);E=ue(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){ut(E.src,L="/images/clients-icons/irl-icon.png")||ee(E,"src",L),ee(E,"alt","IRL"),ee(E,"class","svelte-zh1v7o"),ee(m,"href","https://www.irl.com/"),ee(m,"target","_blank"),ee(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function fs(a){let m,E,L;return{c(){m=le("a"),E=le("img"),this.h()},l(w){m=ue(w,"A",{href:!0,target:!0,class:!0});var U=ce(m);E=ue(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){ut(E.src,L="/images/clients-icons/kyla.png")||ee(E,"src",L),ee(E,"alt","Kyla"),ee(E,"class","svelte-zh1v7o"),ee(m,"href","https://kyla.com/p/"),ee(m,"target","_blank"),ee(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function ds(a){let m,E,L;return{c(){m=le("a"),E=le("img"),this.h()},l(w){m=ue(w,"A",{href:!0,target:!0,class:!0});var U=ce(m);E=ue(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){ut(E.src,L="/images/clients-icons/outco-icon.png")||ee(E,"src",L),ee(E,"alt","Outco"),ee(E,"class","svelte-zh1v7o"),ee(m,"href","#"),ee(m,"target","_blank"),ee(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function cs(a){let m,E,L;return{c(){m=le("a"),E=le("img"),this.h()},l(w){m=ue(w,"A",{href:!0,target:!0,class:!0});var U=ce(m);E=ue(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){ut(E.src,L="/images/clients-icons/ficon.png")||ee(E,"src",L),ee(E,"alt","Fellow"),ee(E,"class","svelte-zh1v7o"),ee(m,"href","https://fellowproducts.com/"),ee(m,"target","_blank"),ee(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function hs(a){let m,E,L,w,U,G,B,u,M,I,b,C;return m=new ct({props:{$$slots:{default:[os]},$$scope:{ctx:a}}}),L=new ct({props:{$$slots:{default:[ls]},$$scope:{ctx:a}}}),U=new ct({props:{$$slots:{default:[us]},$$scope:{ctx:a}}}),B=new ct({props:{$$slots:{default:[fs]},$$scope:{ctx:a}}}),M=new ct({props:{$$slots:{default:[ds]},$$scope:{ctx:a}}}),b=new ct({props:{$$slots:{default:[cs]},$$scope:{ctx:a}}}),{c(){qe(m.$$.fragment),E=me(),qe(L.$$.fragment),w=me(),qe(U.$$.fragment),G=me(),qe(B.$$.fragment),u=me(),qe(M.$$.fragment),I=me(),qe(b.$$.fragment)},l(F){et(m.$$.fragment,F),E=Ee(F),et(L.$$.fragment,F),w=Ee(F),et(U.$$.fragment,F),G=Ee(F),et(B.$$.fragment,F),u=Ee(F),et(M.$$.fragment,F),I=Ee(F),et(b.$$.fragment,F)},m(F,R){tt(m,F,R),ge(F,E,R),tt(L,F,R),ge(F,w,R),tt(U,F,R),ge(F,G,R),tt(B,F,R),ge(F,u,R),tt(M,F,R),ge(F,I,R),tt(b,F,R),C=!0},p(F,R){const P={};R&2&&(P.$$scope={dirty:R,ctx:F}),m.$set(P);const D={};R&2&&(D.$$scope={dirty:R,ctx:F}),L.$set(D);const T={};R&2&&(T.$$scope={dirty:R,ctx:F}),U.$set(T);const S={};R&2&&(S.$$scope={dirty:R,ctx:F}),B.$set(S);const A={};R&2&&(A.$$scope={dirty:R,ctx:F}),M.$set(A);const x={};R&2&&(x.$$scope={dirty:R,ctx:F}),b.$set(x)},i(F){C||(Te(m.$$.fragment,F),Te(L.$$.fragment,F),Te(U.$$.fragment,F),Te(B.$$.fragment,F),Te(M.$$.fragment,F),Te(b.$$.fragment,F),C=!0)},o(F){ye(m.$$.fragment,F),ye(L.$$.fragment,F),ye(U.$$.fragment,F),ye(B.$$.fragment,F),ye(M.$$.fragment,F),ye(b.$$.fragment,F),C=!1},d(F){rt(m,F),F&&ne(E),rt(L,F),F&&ne(w),rt(U,F),F&&ne(G),rt(B,F),F&&ne(u),rt(M,F),F&&ne(I),rt(b,F)}}}function vs(a){let m,E,L,w,U,G,B,u,M,I,b,C,F,R,P,D,T,S,A,x,y,l,n,r,c,f,e,t,i,v,d,p,s=a[0]>0&&dr(a);return{c(){m=le("div"),E=le("section"),L=le("script"),U=me(),G=le("video"),B=me(),u=le("script"),M=je(`var video = document.getElementById('video');
				var videoSrc = 'https://customer-si5cxun7zm99ttrb.cloudflarestream.com/38201dc5c5d26f789caf61e77babb163/manifest/video.m3u8';
				  //
          // First check for native browser HLS support
          //
        if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
         //
        // If no native HLS support, check if HLS.js is supported
        //
        } else if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
        }`),I=me(),b=le("div"),C=le("h1"),F=je("We Tackle Your "),R=le("br"),P=je("Growth Problems"),D=me(),T=le("p"),S=je("Scalewhale is a Paid Media agency"),A=le("br"),x=je(" with expertise in Analytics, and MarOps"),y=me(),l=le("a"),n=je("Get in Touch"),r=me(),c=le("section"),f=le("div"),e=le("h2"),t=je("We've had the pleasure"),i=le("br"),v=je(" of working with:"),d=me(),s&&s.c(),this.h()},l(g){m=ue(g,"DIV",{class:!0});var h=ce(m);E=ue(h,"SECTION",{class:!0});var o=ce(E);L=ue(o,"SCRIPT",{src:!0,class:!0});var _=ce(L);_.forEach(ne),U=Ee(o),G=ue(o,"VIDEO",{id:!0,style:!0,class:!0}),ce(G).forEach(ne),B=Ee(o),u=ue(o,"SCRIPT",{class:!0});var O=ce(u);M=ze(O,`var video = document.getElementById('video');
				var videoSrc = 'https://customer-si5cxun7zm99ttrb.cloudflarestream.com/38201dc5c5d26f789caf61e77babb163/manifest/video.m3u8';
				  //
          // First check for native browser HLS support
          //
        if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
         //
        // If no native HLS support, check if HLS.js is supported
        //
        } else if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(videoSrc);
        hls.attachMedia(video);
        }`),O.forEach(ne),I=Ee(o),b=ue(o,"DIV",{class:!0});var k=ce(b);C=ue(k,"H1",{class:!0});var K=ce(C);F=ze(K,"We Tackle Your "),R=ue(K,"BR",{class:!0}),P=ze(K,"Growth Problems"),K.forEach(ne),D=Ee(k),T=ue(k,"P",{class:!0});var N=ce(T);S=ze(N,"Scalewhale is a Paid Media agency"),A=ue(N,"BR",{class:!0}),x=ze(N," with expertise in Analytics, and MarOps"),N.forEach(ne),y=Ee(k),l=ue(k,"A",{style:!0,id:!0,href:!0,class:!0});var W=ce(l);n=ze(W,"Get in Touch"),W.forEach(ne),k.forEach(ne),o.forEach(ne),r=Ee(h),c=ue(h,"SECTION",{class:!0});var H=ce(c);f=ue(H,"DIV",{class:!0});var V=ce(f);e=ue(V,"H2",{class:!0});var j=ce(e);t=ze(j,"We've had the pleasure"),i=ue(j,"BR",{class:!0}),v=ze(j," of working with:"),j.forEach(ne),d=Ee(V),s&&s.l(V),V.forEach(ne),H.forEach(ne),h.forEach(ne),this.h()},h(){ut(L.src,w="https://cdn.jsdelivr.net/npm/hls.js@1")||ee(L,"src",w),ee(L,"class","svelte-zh1v7o"),G.autoplay="autoplay",G.muted=!0,G.loop=!0,ee(G,"id","video"),G.playsInline=!0,Yt(G,"pointer-events","none"),ee(G,"class","svelte-zh1v7o"),ee(u,"class","svelte-zh1v7o"),ee(R,"class","svelte-zh1v7o"),ee(C,"class","svelte-zh1v7o"),ee(A,"class","svelte-zh1v7o"),ee(T,"class","svelte-zh1v7o"),Yt(l,"color","black"),ee(l,"id","get-in-touch"),ee(l,"href","/contact"),ee(l,"class","svelte-zh1v7o"),ee(b,"class","hero-content svelte-zh1v7o"),ee(E,"class","hero svelte-zh1v7o"),ee(i,"class","svelte-zh1v7o"),ee(e,"class","svelte-zh1v7o"),ee(f,"class","clients svelte-zh1v7o"),ee(c,"class","container svelte-zh1v7o"),ee(m,"class","main-page svelte-zh1v7o")},m(g,h){ge(g,m,h),ae(m,E),ae(E,L),ae(E,U),ae(E,G),ae(E,B),ae(E,u),ae(u,M),ae(E,I),ae(E,b),ae(b,C),ae(C,F),ae(C,R),ae(C,P),ae(b,D),ae(b,T),ae(T,S),ae(T,A),ae(T,x),ae(b,y),ae(b,l),ae(l,n),ae(m,r),ae(m,c),ae(c,f),ae(f,e),ae(e,t),ae(e,i),ae(e,v),ae(f,d),s&&s.m(f,null),p=!0},p(g,[h]){g[0]>0?s?(s.p(g,h),h&1&&Te(s,1)):(s=dr(g),s.c(),Te(s,1),s.m(f,null)):s&&(gr(),ye(s,1,1,()=>{s=null}),pr())},i(g){p||(Te(s),p=!0)},o(g){ye(s),p=!1},d(g){g&&ne(m),s&&s.d()}}}function gs(a,m,E){let L=0;return Gt(()=>{E(0,L=window.innerWidth>1200?3:window.innerWidth>500?2:1)}),[L]}class Es extends Nt{constructor(m){super(),Kt(this,m,gs,vs,Lt,{})}}export{Es as default};
