import{S as Nt,i as Kt,s as Lt,e as $t,b as ge,f as me,t as ye,h as ne,L as _t,M as Mr,N as wr,o as Gt,j as cr,O as hr,P as ot,Q as vr,C as it,k as ue,a as Ee,l as fe,m as he,c as Te,R as Et,T as ht,F as ae,H as nt,I as st,J as at,U as Ft,V as ct,n as te,B as Ve,A as Fr,g as gr,d as pr,W as kr,X as Br,q as je,r as ze,p as Yt,w as qe,x as et,y as tt,z as rt,D as vt}from"../../chunks/index-a41dc320.js";import{c as Ur}from"../../chunks/_commonjsHelpers-456b4ed0.js";function Xt(s){return s!==null&&typeof s=="object"&&"constructor"in s&&s.constructor===Object}function Wt(s={},m={}){Object.keys(m).forEach(E=>{typeof s[E]>"u"?s[E]=m[E]:Xt(m[E])&&Xt(s[E])&&Object.keys(m[E]).length>0&&Wt(s[E],m[E])})}const mr={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Ce(){const s=typeof document<"u"?document:{};return Wt(s,mr),s}const Nr={document:mr,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(s){return typeof setTimeout>"u"?(s(),null):setTimeout(s,0)},cancelAnimationFrame(s){typeof setTimeout>"u"||clearTimeout(s)}};function Se(){const s=typeof window<"u"?window:{};return Wt(s,Nr),s}function Kr(s){const m=s.__proto__;Object.defineProperty(s,"__proto__",{get(){return m},set(E){m.__proto__=E}})}class $e extends Array{constructor(m){typeof m=="number"?super(m):(super(...m||[]),Kr(this))}}function pt(s=[]){const m=[];return s.forEach(E=>{Array.isArray(E)?m.push(...pt(E)):m.push(E)}),m}function Er(s,m){return Array.prototype.filter.call(s,m)}function Gr(s){const m=[];for(let E=0;E<s.length;E+=1)m.indexOf(s[E])===-1&&m.push(s[E]);return m}function Wr(s,m){if(typeof s!="string")return[s];const E=[],x=m.querySelectorAll(s);for(let w=0;w<x.length;w+=1)E.push(x[w]);return E}function ee(s,m){const E=Se(),x=Ce();let w=[];if(!m&&s instanceof $e)return s;if(!s)return new $e(w);if(typeof s=="string"){const U=s.trim();if(U.indexOf("<")>=0&&U.indexOf(">")>=0){let G="div";U.indexOf("<li")===0&&(G="ul"),U.indexOf("<tr")===0&&(G="tbody"),(U.indexOf("<td")===0||U.indexOf("<th")===0)&&(G="tr"),U.indexOf("<tbody")===0&&(G="table"),U.indexOf("<option")===0&&(G="select");const k=x.createElement(G);k.innerHTML=U;for(let u=0;u<k.childNodes.length;u+=1)w.push(k.childNodes[u])}else w=Wr(s.trim(),m||x)}else if(s.nodeType||s===E||s===x)w.push(s);else if(Array.isArray(s)){if(s instanceof $e)return s;w=s}return new $e(Gr(w))}ee.fn=$e.prototype;function Hr(...s){const m=pt(s.map(E=>E.split(" ")));return this.forEach(E=>{E.classList.add(...m)}),this}function Vr(...s){const m=pt(s.map(E=>E.split(" ")));return this.forEach(E=>{E.classList.remove(...m)}),this}function jr(...s){const m=pt(s.map(E=>E.split(" ")));this.forEach(E=>{m.forEach(x=>{E.classList.toggle(x)})})}function zr(...s){const m=pt(s.map(E=>E.split(" ")));return Er(this,E=>m.filter(x=>E.classList.contains(x)).length>0).length>0}function $r(s,m){if(arguments.length===1&&typeof s=="string")return this[0]?this[0].getAttribute(s):void 0;for(let E=0;E<this.length;E+=1)if(arguments.length===2)this[E].setAttribute(s,m);else for(const x in s)this[E][x]=s[x],this[E].setAttribute(x,s[x]);return this}function Yr(s){for(let m=0;m<this.length;m+=1)this[m].removeAttribute(s);return this}function Xr(s){for(let m=0;m<this.length;m+=1)this[m].style.transform=s;return this}function Qr(s){for(let m=0;m<this.length;m+=1)this[m].style.transitionDuration=typeof s!="string"?`${s}ms`:s;return this}function Zr(...s){let[m,E,x,w]=s;typeof s[1]=="function"&&([m,x,w]=s,E=void 0),w||(w=!1);function U(M){const I=M.target;if(!I)return;const b=M.target.dom7EventData||[];if(b.indexOf(M)<0&&b.unshift(M),ee(I).is(E))x.apply(I,b);else{const P=ee(I).parents();for(let F=0;F<P.length;F+=1)ee(P[F]).is(E)&&x.apply(P[F],b)}}function G(M){const I=M&&M.target?M.target.dom7EventData||[]:[];I.indexOf(M)<0&&I.unshift(M),x.apply(this,I)}const k=m.split(" ");let u;for(let M=0;M<this.length;M+=1){const I=this[M];if(E)for(u=0;u<k.length;u+=1){const b=k[u];I.dom7LiveListeners||(I.dom7LiveListeners={}),I.dom7LiveListeners[b]||(I.dom7LiveListeners[b]=[]),I.dom7LiveListeners[b].push({listener:x,proxyListener:U}),I.addEventListener(b,U,w)}else for(u=0;u<k.length;u+=1){const b=k[u];I.dom7Listeners||(I.dom7Listeners={}),I.dom7Listeners[b]||(I.dom7Listeners[b]=[]),I.dom7Listeners[b].push({listener:x,proxyListener:G}),I.addEventListener(b,G,w)}}return this}function Jr(...s){let[m,E,x,w]=s;typeof s[1]=="function"&&([m,x,w]=s,E=void 0),w||(w=!1);const U=m.split(" ");for(let G=0;G<U.length;G+=1){const k=U[G];for(let u=0;u<this.length;u+=1){const M=this[u];let I;if(!E&&M.dom7Listeners?I=M.dom7Listeners[k]:E&&M.dom7LiveListeners&&(I=M.dom7LiveListeners[k]),I&&I.length)for(let b=I.length-1;b>=0;b-=1){const P=I[b];x&&P.listener===x||x&&P.listener&&P.listener.dom7proxy&&P.listener.dom7proxy===x?(M.removeEventListener(k,P.proxyListener,w),I.splice(b,1)):x||(M.removeEventListener(k,P.proxyListener,w),I.splice(b,1))}}}return this}function qr(...s){const m=Se(),E=s[0].split(" "),x=s[1];for(let w=0;w<E.length;w+=1){const U=E[w];for(let G=0;G<this.length;G+=1){const k=this[G];if(m.CustomEvent){const u=new m.CustomEvent(U,{detail:x,bubbles:!0,cancelable:!0});k.dom7EventData=s.filter((M,I)=>I>0),k.dispatchEvent(u),k.dom7EventData=[],delete k.dom7EventData}}}return this}function ei(s){const m=this;function E(x){x.target===this&&(s.call(this,x),m.off("transitionend",E))}return s&&m.on("transitionend",E),this}function ti(s){if(this.length>0){if(s){const m=this.styles();return this[0].offsetWidth+parseFloat(m.getPropertyValue("margin-right"))+parseFloat(m.getPropertyValue("margin-left"))}return this[0].offsetWidth}return null}function ri(s){if(this.length>0){if(s){const m=this.styles();return this[0].offsetHeight+parseFloat(m.getPropertyValue("margin-top"))+parseFloat(m.getPropertyValue("margin-bottom"))}return this[0].offsetHeight}return null}function ii(){if(this.length>0){const s=Se(),m=Ce(),E=this[0],x=E.getBoundingClientRect(),w=m.body,U=E.clientTop||w.clientTop||0,G=E.clientLeft||w.clientLeft||0,k=E===s?s.scrollY:E.scrollTop,u=E===s?s.scrollX:E.scrollLeft;return{top:x.top+k-U,left:x.left+u-G}}return null}function ni(){const s=Se();return this[0]?s.getComputedStyle(this[0],null):{}}function si(s,m){const E=Se();let x;if(arguments.length===1)if(typeof s=="string"){if(this[0])return E.getComputedStyle(this[0],null).getPropertyValue(s)}else{for(x=0;x<this.length;x+=1)for(const w in s)this[x].style[w]=s[w];return this}if(arguments.length===2&&typeof s=="string"){for(x=0;x<this.length;x+=1)this[x].style[s]=m;return this}return this}function ai(s){return s?(this.forEach((m,E)=>{s.apply(m,[m,E])}),this):this}function oi(s){const m=Er(this,s);return ee(m)}function li(s){if(typeof s>"u")return this[0]?this[0].innerHTML:null;for(let m=0;m<this.length;m+=1)this[m].innerHTML=s;return this}function ui(s){if(typeof s>"u")return this[0]?this[0].textContent.trim():null;for(let m=0;m<this.length;m+=1)this[m].textContent=s;return this}function fi(s){const m=Se(),E=Ce(),x=this[0];let w,U;if(!x||typeof s>"u")return!1;if(typeof s=="string"){if(x.matches)return x.matches(s);if(x.webkitMatchesSelector)return x.webkitMatchesSelector(s);if(x.msMatchesSelector)return x.msMatchesSelector(s);for(w=ee(s),U=0;U<w.length;U+=1)if(w[U]===x)return!0;return!1}if(s===E)return x===E;if(s===m)return x===m;if(s.nodeType||s instanceof $e){for(w=s.nodeType?[s]:s,U=0;U<w.length;U+=1)if(w[U]===x)return!0;return!1}return!1}function di(){let s=this[0],m;if(s){for(m=0;(s=s.previousSibling)!==null;)s.nodeType===1&&(m+=1);return m}}function ci(s){if(typeof s>"u")return this;const m=this.length;if(s>m-1)return ee([]);if(s<0){const E=m+s;return E<0?ee([]):ee([this[E]])}return ee([this[s]])}function hi(...s){let m;const E=Ce();for(let x=0;x<s.length;x+=1){m=s[x];for(let w=0;w<this.length;w+=1)if(typeof m=="string"){const U=E.createElement("div");for(U.innerHTML=m;U.firstChild;)this[w].appendChild(U.firstChild)}else if(m instanceof $e)for(let U=0;U<m.length;U+=1)this[w].appendChild(m[U]);else this[w].appendChild(m)}return this}function vi(s){const m=Ce();let E,x;for(E=0;E<this.length;E+=1)if(typeof s=="string"){const w=m.createElement("div");for(w.innerHTML=s,x=w.childNodes.length-1;x>=0;x-=1)this[E].insertBefore(w.childNodes[x],this[E].childNodes[0])}else if(s instanceof $e)for(x=0;x<s.length;x+=1)this[E].insertBefore(s[x],this[E].childNodes[0]);else this[E].insertBefore(s,this[E].childNodes[0]);return this}function gi(s){return this.length>0?s?this[0].nextElementSibling&&ee(this[0].nextElementSibling).is(s)?ee([this[0].nextElementSibling]):ee([]):this[0].nextElementSibling?ee([this[0].nextElementSibling]):ee([]):ee([])}function pi(s){const m=[];let E=this[0];if(!E)return ee([]);for(;E.nextElementSibling;){const x=E.nextElementSibling;s?ee(x).is(s)&&m.push(x):m.push(x),E=x}return ee(m)}function mi(s){if(this.length>0){const m=this[0];return s?m.previousElementSibling&&ee(m.previousElementSibling).is(s)?ee([m.previousElementSibling]):ee([]):m.previousElementSibling?ee([m.previousElementSibling]):ee([])}return ee([])}function Ei(s){const m=[];let E=this[0];if(!E)return ee([]);for(;E.previousElementSibling;){const x=E.previousElementSibling;s?ee(x).is(s)&&m.push(x):m.push(x),E=x}return ee(m)}function Ti(s){const m=[];for(let E=0;E<this.length;E+=1)this[E].parentNode!==null&&(s?ee(this[E].parentNode).is(s)&&m.push(this[E].parentNode):m.push(this[E].parentNode));return ee(m)}function yi(s){const m=[];for(let E=0;E<this.length;E+=1){let x=this[E].parentNode;for(;x;)s?ee(x).is(s)&&m.push(x):m.push(x),x=x.parentNode}return ee(m)}function _i(s){let m=this;return typeof s>"u"?ee([]):(m.is(s)||(m=m.parents(s).eq(0)),m)}function Si(s){const m=[];for(let E=0;E<this.length;E+=1){const x=this[E].querySelectorAll(s);for(let w=0;w<x.length;w+=1)m.push(x[w])}return ee(m)}function xi(s){const m=[];for(let E=0;E<this.length;E+=1){const x=this[E].children;for(let w=0;w<x.length;w+=1)(!s||ee(x[w]).is(s))&&m.push(x[w])}return ee(m)}function Li(){for(let s=0;s<this.length;s+=1)this[s].parentNode&&this[s].parentNode.removeChild(this[s]);return this}const Qt={addClass:Hr,removeClass:Vr,hasClass:zr,toggleClass:jr,attr:$r,removeAttr:Yr,transform:Xr,transition:Qr,on:Zr,off:Jr,trigger:qr,transitionEnd:ei,outerWidth:ti,outerHeight:ri,styles:ni,offset:ii,css:si,each:ai,html:li,text:ui,is:fi,index:di,eq:ci,append:hi,prepend:vi,next:gi,nextAll:pi,prev:mi,prevAll:Ei,parent:Ti,parents:yi,closest:_i,find:Si,children:xi,filter:oi,remove:Li};Object.keys(Qt).forEach(s=>{Object.defineProperty(ee.fn,s,{value:Qt[s],writable:!0})});function Di(s){const m=s;Object.keys(m).forEach(E=>{try{m[E]=null}catch{}try{delete m[E]}catch{}})}function St(s,m=0){return setTimeout(s,m)}function gt(){return Date.now()}function Ai(s){const m=Se();let E;return m.getComputedStyle&&(E=m.getComputedStyle(s,null)),!E&&s.currentStyle&&(E=s.currentStyle),E||(E=s.style),E}function Ii(s,m="x"){const E=Se();let x,w,U;const G=Ai(s);return E.WebKitCSSMatrix?(w=G.transform||G.webkitTransform,w.split(",").length>6&&(w=w.split(", ").map(k=>k.replace(",",".")).join(", ")),U=new E.WebKitCSSMatrix(w==="none"?"":w)):(U=G.MozTransform||G.OTransform||G.MsTransform||G.msTransform||G.transform||G.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),x=U.toString().split(",")),m==="x"&&(E.WebKitCSSMatrix?w=U.m41:x.length===16?w=parseFloat(x[12]):w=parseFloat(x[4])),m==="y"&&(E.WebKitCSSMatrix?w=U.m42:x.length===16?w=parseFloat(x[13]):w=parseFloat(x[5])),w||0}function Tt(s){return typeof s=="object"&&s!==null&&s.constructor&&Object.prototype.toString.call(s).slice(8,-1)==="Object"}function Ci(s){return typeof window<"u"&&typeof window.HTMLElement<"u"?s instanceof HTMLElement:s&&(s.nodeType===1||s.nodeType===11)}function ke(...s){const m=Object(s[0]),E=["__proto__","constructor","prototype"];for(let x=1;x<s.length;x+=1){const w=s[x];if(w!=null&&!Ci(w)){const U=Object.keys(Object(w)).filter(G=>E.indexOf(G)<0);for(let G=0,k=U.length;G<k;G+=1){const u=U[G],M=Object.getOwnPropertyDescriptor(w,u);M!==void 0&&M.enumerable&&(Tt(m[u])&&Tt(w[u])?w[u].__swiper__?m[u]=w[u]:ke(m[u],w[u]):!Tt(m[u])&&Tt(w[u])?(m[u]={},w[u].__swiper__?m[u]=w[u]:ke(m[u],w[u])):m[u]=w[u])}}}return m}function yt(s,m,E){s.style.setProperty(m,E)}function Tr({swiper:s,targetPosition:m,side:E}){const x=Se(),w=-s.translate;let U=null,G;const k=s.params.speed;s.wrapperEl.style.scrollSnapType="none",x.cancelAnimationFrame(s.cssModeFrameID);const u=m>w?"next":"prev",M=(b,P)=>u==="next"&&b>=P||u==="prev"&&b<=P,I=()=>{G=new Date().getTime(),U===null&&(U=G);const b=Math.max(Math.min((G-U)/k,1),0),P=.5-Math.cos(b*Math.PI)/2;let F=w+P*(m-w);if(M(F,m)&&(F=m),s.wrapperEl.scrollTo({[E]:F}),M(F,m)){s.wrapperEl.style.overflow="hidden",s.wrapperEl.style.scrollSnapType="",setTimeout(()=>{s.wrapperEl.style.overflow="",s.wrapperEl.scrollTo({[E]:F})}),x.cancelAnimationFrame(s.cssModeFrameID);return}s.cssModeFrameID=x.requestAnimationFrame(I)};I()}let Pt;function Pi(){const s=Se(),m=Ce();return{smoothScroll:m.documentElement&&"scrollBehavior"in m.documentElement.style,touch:!!("ontouchstart"in s||s.DocumentTouch&&m instanceof s.DocumentTouch),passiveListener:function(){let x=!1;try{const w=Object.defineProperty({},"passive",{get(){x=!0}});s.addEventListener("testPassiveListener",null,w)}catch{}return x}(),gestures:function(){return"ongesturestart"in s}()}}function yr(){return Pt||(Pt=Pi()),Pt}let Ot;function Oi({userAgent:s}={}){const m=yr(),E=Se(),x=E.navigator.platform,w=s||E.navigator.userAgent,U={ios:!1,android:!1},G=E.screen.width,k=E.screen.height,u=w.match(/(Android);?[\s\/]+([\d.]+)?/);let M=w.match(/(iPad).*OS\s([\d_]+)/);const I=w.match(/(iPod)(.*OS\s([\d_]+))?/),b=!M&&w.match(/(iPhone\sOS|iOS)\s([\d_]+)/),P=x==="Win32";let F=x==="MacIntel";const R=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!M&&F&&m.touch&&R.indexOf(`${G}x${k}`)>=0&&(M=w.match(/(Version)\/([\d.]+)/),M||(M=[0,1,"13_0_0"]),F=!1),u&&!P&&(U.os="android",U.android=!0),(M||b||I)&&(U.os="ios",U.ios=!0),U}function Ri(s={}){return Ot||(Ot=Oi(s)),Ot}let Rt;function bi(){const s=Se();function m(){const E=s.navigator.userAgent.toLowerCase();return E.indexOf("safari")>=0&&E.indexOf("chrome")<0&&E.indexOf("android")<0}return{isSafari:m(),isWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(s.navigator.userAgent)}}function Mi(){return Rt||(Rt=bi()),Rt}function wi({swiper:s,on:m,emit:E}){const x=Se();let w=null,U=null;const G=()=>{!s||s.destroyed||!s.initialized||(E("beforeResize"),E("resize"))},k=()=>{!s||s.destroyed||!s.initialized||(w=new ResizeObserver(I=>{U=x.requestAnimationFrame(()=>{const{width:b,height:P}=s;let F=b,R=P;I.forEach(({contentBoxSize:C,contentRect:A,target:T})=>{T&&T!==s.el||(F=A?A.width:(C[0]||C).inlineSize,R=A?A.height:(C[0]||C).blockSize)}),(F!==b||R!==P)&&G()})}),w.observe(s.el))},u=()=>{U&&x.cancelAnimationFrame(U),w&&w.unobserve&&s.el&&(w.unobserve(s.el),w=null)},M=()=>{!s||s.destroyed||!s.initialized||E("orientationchange")};m("init",()=>{if(s.params.resizeObserver&&typeof x.ResizeObserver<"u"){k();return}x.addEventListener("resize",G),x.addEventListener("orientationchange",M)}),m("destroy",()=>{u(),x.removeEventListener("resize",G),x.removeEventListener("orientationchange",M)})}function Fi({swiper:s,extendParams:m,on:E,emit:x}){const w=[],U=Se(),G=(M,I={})=>{const b=U.MutationObserver||U.WebkitMutationObserver,P=new b(F=>{if(F.length===1){x("observerUpdate",F[0]);return}const R=function(){x("observerUpdate",F[0])};U.requestAnimationFrame?U.requestAnimationFrame(R):U.setTimeout(R,0)});P.observe(M,{attributes:typeof I.attributes>"u"?!0:I.attributes,childList:typeof I.childList>"u"?!0:I.childList,characterData:typeof I.characterData>"u"?!0:I.characterData}),w.push(P)},k=()=>{if(!!s.params.observer){if(s.params.observeParents){const M=s.$el.parents();for(let I=0;I<M.length;I+=1)G(M[I])}G(s.$el[0],{childList:s.params.observeSlideChildren}),G(s.$wrapperEl[0],{attributes:!1})}},u=()=>{w.forEach(M=>{M.disconnect()}),w.splice(0,w.length)};m({observer:!1,observeParents:!1,observeSlideChildren:!1}),E("init",k),E("destroy",u)}const ki={on(s,m,E){const x=this;if(!x.eventsListeners||x.destroyed||typeof m!="function")return x;const w=E?"unshift":"push";return s.split(" ").forEach(U=>{x.eventsListeners[U]||(x.eventsListeners[U]=[]),x.eventsListeners[U][w](m)}),x},once(s,m,E){const x=this;if(!x.eventsListeners||x.destroyed||typeof m!="function")return x;function w(...U){x.off(s,w),w.__emitterProxy&&delete w.__emitterProxy,m.apply(x,U)}return w.__emitterProxy=m,x.on(s,w,E)},onAny(s,m){const E=this;if(!E.eventsListeners||E.destroyed||typeof s!="function")return E;const x=m?"unshift":"push";return E.eventsAnyListeners.indexOf(s)<0&&E.eventsAnyListeners[x](s),E},offAny(s){const m=this;if(!m.eventsListeners||m.destroyed||!m.eventsAnyListeners)return m;const E=m.eventsAnyListeners.indexOf(s);return E>=0&&m.eventsAnyListeners.splice(E,1),m},off(s,m){const E=this;return!E.eventsListeners||E.destroyed||!E.eventsListeners||s.split(" ").forEach(x=>{typeof m>"u"?E.eventsListeners[x]=[]:E.eventsListeners[x]&&E.eventsListeners[x].forEach((w,U)=>{(w===m||w.__emitterProxy&&w.__emitterProxy===m)&&E.eventsListeners[x].splice(U,1)})}),E},emit(...s){const m=this;if(!m.eventsListeners||m.destroyed||!m.eventsListeners)return m;let E,x,w;return typeof s[0]=="string"||Array.isArray(s[0])?(E=s[0],x=s.slice(1,s.length),w=m):(E=s[0].events,x=s[0].data,w=s[0].context||m),x.unshift(w),(Array.isArray(E)?E:E.split(" ")).forEach(G=>{m.eventsAnyListeners&&m.eventsAnyListeners.length&&m.eventsAnyListeners.forEach(k=>{k.apply(w,[G,...x])}),m.eventsListeners&&m.eventsListeners[G]&&m.eventsListeners[G].forEach(k=>{k.apply(w,x)})}),m}};function Bi(){const s=this;let m,E;const x=s.$el;typeof s.params.width<"u"&&s.params.width!==null?m=s.params.width:m=x[0].clientWidth,typeof s.params.height<"u"&&s.params.height!==null?E=s.params.height:E=x[0].clientHeight,!(m===0&&s.isHorizontal()||E===0&&s.isVertical())&&(m=m-parseInt(x.css("padding-left")||0,10)-parseInt(x.css("padding-right")||0,10),E=E-parseInt(x.css("padding-top")||0,10)-parseInt(x.css("padding-bottom")||0,10),Number.isNaN(m)&&(m=0),Number.isNaN(E)&&(E=0),Object.assign(s,{width:m,height:E,size:s.isHorizontal()?m:E}))}function Ui(){const s=this;function m(d){return s.isHorizontal()?d:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[d]}function E(d,e){return parseFloat(d.getPropertyValue(m(e))||0)}const x=s.params,{$wrapperEl:w,size:U,rtlTranslate:G,wrongRTL:k}=s,u=s.virtual&&x.virtual.enabled,M=u?s.virtual.slides.length:s.slides.length,I=w.children(`.${s.params.slideClass}`),b=u?s.virtual.slides.length:I.length;let P=[];const F=[],R=[];let C=x.slidesOffsetBefore;typeof C=="function"&&(C=x.slidesOffsetBefore.call(s));let A=x.slidesOffsetAfter;typeof A=="function"&&(A=x.slidesOffsetAfter.call(s));const T=s.snapGrid.length,S=s.slidesGrid.length;let D=x.spaceBetween,L=-C,y=0,l=0;if(typeof U>"u")return;typeof D=="string"&&D.indexOf("%")>=0&&(D=parseFloat(D.replace("%",""))/100*U),s.virtualSize=-D,G?I.css({marginLeft:"",marginBottom:"",marginTop:""}):I.css({marginRight:"",marginBottom:"",marginTop:""}),x.centeredSlides&&x.cssMode&&(yt(s.wrapperEl,"--swiper-centered-offset-before",""),yt(s.wrapperEl,"--swiper-centered-offset-after",""));const n=x.grid&&x.grid.rows>1&&s.grid;n&&s.grid.initSlides(b);let r;const h=x.slidesPerView==="auto"&&x.breakpoints&&Object.keys(x.breakpoints).filter(d=>typeof x.breakpoints[d].slidesPerView<"u").length>0;for(let d=0;d<b;d+=1){r=0;const e=I.eq(d);if(n&&s.grid.updateSlide(d,e,b,m),e.css("display")!=="none"){if(x.slidesPerView==="auto"){h&&(I[d].style[m("width")]="");const t=getComputedStyle(e[0]),i=e[0].style.transform,c=e[0].style.webkitTransform;if(i&&(e[0].style.transform="none"),c&&(e[0].style.webkitTransform="none"),x.roundLengths)r=s.isHorizontal()?e.outerWidth(!0):e.outerHeight(!0);else{const f=E(t,"width"),g=E(t,"padding-left"),a=E(t,"padding-right"),p=E(t,"margin-left"),v=E(t,"margin-right"),o=t.getPropertyValue("box-sizing");if(o&&o==="border-box")r=f+p+v;else{const{clientWidth:_,offsetWidth:O}=e[0];r=f+g+a+p+v+(O-_)}}i&&(e[0].style.transform=i),c&&(e[0].style.webkitTransform=c),x.roundLengths&&(r=Math.floor(r))}else r=(U-(x.slidesPerView-1)*D)/x.slidesPerView,x.roundLengths&&(r=Math.floor(r)),I[d]&&(I[d].style[m("width")]=`${r}px`);I[d]&&(I[d].swiperSlideSize=r),R.push(r),x.centeredSlides?(L=L+r/2+y/2+D,y===0&&d!==0&&(L=L-U/2-D),d===0&&(L=L-U/2-D),Math.abs(L)<1/1e3&&(L=0),x.roundLengths&&(L=Math.floor(L)),l%x.slidesPerGroup===0&&P.push(L),F.push(L)):(x.roundLengths&&(L=Math.floor(L)),(l-Math.min(s.params.slidesPerGroupSkip,l))%s.params.slidesPerGroup===0&&P.push(L),F.push(L),L=L+r+D),s.virtualSize+=r+D,y=r,l+=1}}if(s.virtualSize=Math.max(s.virtualSize,U)+A,G&&k&&(x.effect==="slide"||x.effect==="coverflow")&&w.css({width:`${s.virtualSize+x.spaceBetween}px`}),x.setWrapperSize&&w.css({[m("width")]:`${s.virtualSize+x.spaceBetween}px`}),n&&s.grid.updateWrapperSize(r,P,m),!x.centeredSlides){const d=[];for(let e=0;e<P.length;e+=1){let t=P[e];x.roundLengths&&(t=Math.floor(t)),P[e]<=s.virtualSize-U&&d.push(t)}P=d,Math.floor(s.virtualSize-U)-Math.floor(P[P.length-1])>1&&P.push(s.virtualSize-U)}if(P.length===0&&(P=[0]),x.spaceBetween!==0){const d=s.isHorizontal()&&G?"marginLeft":m("marginRight");I.filter((e,t)=>x.cssMode?t!==I.length-1:!0).css({[d]:`${D}px`})}if(x.centeredSlides&&x.centeredSlidesBounds){let d=0;R.forEach(t=>{d+=t+(x.spaceBetween?x.spaceBetween:0)}),d-=x.spaceBetween;const e=d-U;P=P.map(t=>t<0?-C:t>e?e+A:t)}if(x.centerInsufficientSlides){let d=0;if(R.forEach(e=>{d+=e+(x.spaceBetween?x.spaceBetween:0)}),d-=x.spaceBetween,d<U){const e=(U-d)/2;P.forEach((t,i)=>{P[i]=t-e}),F.forEach((t,i)=>{F[i]=t+e})}}if(Object.assign(s,{slides:I,snapGrid:P,slidesGrid:F,slidesSizesGrid:R}),x.centeredSlides&&x.cssMode&&!x.centeredSlidesBounds){yt(s.wrapperEl,"--swiper-centered-offset-before",`${-P[0]}px`),yt(s.wrapperEl,"--swiper-centered-offset-after",`${s.size/2-R[R.length-1]/2}px`);const d=-s.snapGrid[0],e=-s.slidesGrid[0];s.snapGrid=s.snapGrid.map(t=>t+d),s.slidesGrid=s.slidesGrid.map(t=>t+e)}if(b!==M&&s.emit("slidesLengthChange"),P.length!==T&&(s.params.watchOverflow&&s.checkOverflow(),s.emit("snapGridLengthChange")),F.length!==S&&s.emit("slidesGridLengthChange"),x.watchSlidesProgress&&s.updateSlidesOffset(),!u&&!x.cssMode&&(x.effect==="slide"||x.effect==="fade")){const d=`${x.containerModifierClass}backface-hidden`,e=s.$el.hasClass(d);b<=x.maxBackfaceHiddenSlides?e||s.$el.addClass(d):e&&s.$el.removeClass(d)}}function Ni(s){const m=this,E=[],x=m.virtual&&m.params.virtual.enabled;let w=0,U;typeof s=="number"?m.setTransition(s):s===!0&&m.setTransition(m.params.speed);const G=k=>x?m.slides.filter(u=>parseInt(u.getAttribute("data-swiper-slide-index"),10)===k)[0]:m.slides.eq(k)[0];if(m.params.slidesPerView!=="auto"&&m.params.slidesPerView>1)if(m.params.centeredSlides)(m.visibleSlides||ee([])).each(k=>{E.push(k)});else for(U=0;U<Math.ceil(m.params.slidesPerView);U+=1){const k=m.activeIndex+U;if(k>m.slides.length&&!x)break;E.push(G(k))}else E.push(G(m.activeIndex));for(U=0;U<E.length;U+=1)if(typeof E[U]<"u"){const k=E[U].offsetHeight;w=k>w?k:w}(w||w===0)&&m.$wrapperEl.css("height",`${w}px`)}function Ki(){const s=this,m=s.slides;for(let E=0;E<m.length;E+=1)m[E].swiperSlideOffset=s.isHorizontal()?m[E].offsetLeft:m[E].offsetTop}function Gi(s=this&&this.translate||0){const m=this,E=m.params,{slides:x,rtlTranslate:w,snapGrid:U}=m;if(x.length===0)return;typeof x[0].swiperSlideOffset>"u"&&m.updateSlidesOffset();let G=-s;w&&(G=s),x.removeClass(E.slideVisibleClass),m.visibleSlidesIndexes=[],m.visibleSlides=[];for(let k=0;k<x.length;k+=1){const u=x[k];let M=u.swiperSlideOffset;E.cssMode&&E.centeredSlides&&(M-=x[0].swiperSlideOffset);const I=(G+(E.centeredSlides?m.minTranslate():0)-M)/(u.swiperSlideSize+E.spaceBetween),b=(G-U[0]+(E.centeredSlides?m.minTranslate():0)-M)/(u.swiperSlideSize+E.spaceBetween),P=-(G-M),F=P+m.slidesSizesGrid[k];(P>=0&&P<m.size-1||F>1&&F<=m.size||P<=0&&F>=m.size)&&(m.visibleSlides.push(u),m.visibleSlidesIndexes.push(k),x.eq(k).addClass(E.slideVisibleClass)),u.progress=w?-I:I,u.originalProgress=w?-b:b}m.visibleSlides=ee(m.visibleSlides)}function Wi(s){const m=this;if(typeof s>"u"){const M=m.rtlTranslate?-1:1;s=m&&m.translate&&m.translate*M||0}const E=m.params,x=m.maxTranslate()-m.minTranslate();let{progress:w,isBeginning:U,isEnd:G}=m;const k=U,u=G;x===0?(w=0,U=!0,G=!0):(w=(s-m.minTranslate())/x,U=w<=0,G=w>=1),Object.assign(m,{progress:w,isBeginning:U,isEnd:G}),(E.watchSlidesProgress||E.centeredSlides&&E.autoHeight)&&m.updateSlidesProgress(s),U&&!k&&m.emit("reachBeginning toEdge"),G&&!u&&m.emit("reachEnd toEdge"),(k&&!U||u&&!G)&&m.emit("fromEdge"),m.emit("progress",w)}function Hi(){const s=this,{slides:m,params:E,$wrapperEl:x,activeIndex:w,realIndex:U}=s,G=s.virtual&&E.virtual.enabled;m.removeClass(`${E.slideActiveClass} ${E.slideNextClass} ${E.slidePrevClass} ${E.slideDuplicateActiveClass} ${E.slideDuplicateNextClass} ${E.slideDuplicatePrevClass}`);let k;G?k=s.$wrapperEl.find(`.${E.slideClass}[data-swiper-slide-index="${w}"]`):k=m.eq(w),k.addClass(E.slideActiveClass),E.loop&&(k.hasClass(E.slideDuplicateClass)?x.children(`.${E.slideClass}:not(.${E.slideDuplicateClass})[data-swiper-slide-index="${U}"]`).addClass(E.slideDuplicateActiveClass):x.children(`.${E.slideClass}.${E.slideDuplicateClass}[data-swiper-slide-index="${U}"]`).addClass(E.slideDuplicateActiveClass));let u=k.nextAll(`.${E.slideClass}`).eq(0).addClass(E.slideNextClass);E.loop&&u.length===0&&(u=m.eq(0),u.addClass(E.slideNextClass));let M=k.prevAll(`.${E.slideClass}`).eq(0).addClass(E.slidePrevClass);E.loop&&M.length===0&&(M=m.eq(-1),M.addClass(E.slidePrevClass)),E.loop&&(u.hasClass(E.slideDuplicateClass)?x.children(`.${E.slideClass}:not(.${E.slideDuplicateClass})[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicateNextClass):x.children(`.${E.slideClass}.${E.slideDuplicateClass}[data-swiper-slide-index="${u.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicateNextClass),M.hasClass(E.slideDuplicateClass)?x.children(`.${E.slideClass}:not(.${E.slideDuplicateClass})[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicatePrevClass):x.children(`.${E.slideClass}.${E.slideDuplicateClass}[data-swiper-slide-index="${M.attr("data-swiper-slide-index")}"]`).addClass(E.slideDuplicatePrevClass)),s.emitSlidesClasses()}function Vi(s){const m=this,E=m.rtlTranslate?m.translate:-m.translate,{slidesGrid:x,snapGrid:w,params:U,activeIndex:G,realIndex:k,snapIndex:u}=m;let M=s,I;if(typeof M>"u"){for(let P=0;P<x.length;P+=1)typeof x[P+1]<"u"?E>=x[P]&&E<x[P+1]-(x[P+1]-x[P])/2?M=P:E>=x[P]&&E<x[P+1]&&(M=P+1):E>=x[P]&&(M=P);U.normalizeSlideIndex&&(M<0||typeof M>"u")&&(M=0)}if(w.indexOf(E)>=0)I=w.indexOf(E);else{const P=Math.min(U.slidesPerGroupSkip,M);I=P+Math.floor((M-P)/U.slidesPerGroup)}if(I>=w.length&&(I=w.length-1),M===G){I!==u&&(m.snapIndex=I,m.emit("snapIndexChange"));return}const b=parseInt(m.slides.eq(M).attr("data-swiper-slide-index")||M,10);Object.assign(m,{snapIndex:I,realIndex:b,previousIndex:G,activeIndex:M}),m.emit("activeIndexChange"),m.emit("snapIndexChange"),k!==b&&m.emit("realIndexChange"),(m.initialized||m.params.runCallbacksOnInit)&&m.emit("slideChange")}function ji(s){const m=this,E=m.params,x=ee(s).closest(`.${E.slideClass}`)[0];let w=!1,U;if(x){for(let G=0;G<m.slides.length;G+=1)if(m.slides[G]===x){w=!0,U=G;break}}if(x&&w)m.clickedSlide=x,m.virtual&&m.params.virtual.enabled?m.clickedIndex=parseInt(ee(x).attr("data-swiper-slide-index"),10):m.clickedIndex=U;else{m.clickedSlide=void 0,m.clickedIndex=void 0;return}E.slideToClickedSlide&&m.clickedIndex!==void 0&&m.clickedIndex!==m.activeIndex&&m.slideToClickedSlide()}const zi={updateSize:Bi,updateSlides:Ui,updateAutoHeight:Ni,updateSlidesOffset:Ki,updateSlidesProgress:Gi,updateProgress:Wi,updateSlidesClasses:Hi,updateActiveIndex:Vi,updateClickedSlide:ji};function $i(s=this.isHorizontal()?"x":"y"){const m=this,{params:E,rtlTranslate:x,translate:w,$wrapperEl:U}=m;if(E.virtualTranslate)return x?-w:w;if(E.cssMode)return w;let G=Ii(U[0],s);return x&&(G=-G),G||0}function Yi(s,m){const E=this,{rtlTranslate:x,params:w,$wrapperEl:U,wrapperEl:G,progress:k}=E;let u=0,M=0;const I=0;E.isHorizontal()?u=x?-s:s:M=s,w.roundLengths&&(u=Math.floor(u),M=Math.floor(M)),w.cssMode?G[E.isHorizontal()?"scrollLeft":"scrollTop"]=E.isHorizontal()?-u:-M:w.virtualTranslate||U.transform(`translate3d(${u}px, ${M}px, ${I}px)`),E.previousTranslate=E.translate,E.translate=E.isHorizontal()?u:M;let b;const P=E.maxTranslate()-E.minTranslate();P===0?b=0:b=(s-E.minTranslate())/P,b!==k&&E.updateProgress(s),E.emit("setTranslate",E.translate,m)}function Xi(){return-this.snapGrid[0]}function Qi(){return-this.snapGrid[this.snapGrid.length-1]}function Zi(s=0,m=this.params.speed,E=!0,x=!0,w){const U=this,{params:G,wrapperEl:k}=U;if(U.animating&&G.preventInteractionOnTransition)return!1;const u=U.minTranslate(),M=U.maxTranslate();let I;if(x&&s>u?I=u:x&&s<M?I=M:I=s,U.updateProgress(I),G.cssMode){const b=U.isHorizontal();if(m===0)k[b?"scrollLeft":"scrollTop"]=-I;else{if(!U.support.smoothScroll)return Tr({swiper:U,targetPosition:-I,side:b?"left":"top"}),!0;k.scrollTo({[b?"left":"top"]:-I,behavior:"smooth"})}return!0}return m===0?(U.setTransition(0),U.setTranslate(I),E&&(U.emit("beforeTransitionStart",m,w),U.emit("transitionEnd"))):(U.setTransition(m),U.setTranslate(I),E&&(U.emit("beforeTransitionStart",m,w),U.emit("transitionStart")),U.animating||(U.animating=!0,U.onTranslateToWrapperTransitionEnd||(U.onTranslateToWrapperTransitionEnd=function(P){!U||U.destroyed||P.target===this&&(U.$wrapperEl[0].removeEventListener("transitionend",U.onTranslateToWrapperTransitionEnd),U.$wrapperEl[0].removeEventListener("webkitTransitionEnd",U.onTranslateToWrapperTransitionEnd),U.onTranslateToWrapperTransitionEnd=null,delete U.onTranslateToWrapperTransitionEnd,E&&U.emit("transitionEnd"))}),U.$wrapperEl[0].addEventListener("transitionend",U.onTranslateToWrapperTransitionEnd),U.$wrapperEl[0].addEventListener("webkitTransitionEnd",U.onTranslateToWrapperTransitionEnd))),!0}const Ji={getTranslate:$i,setTranslate:Yi,minTranslate:Xi,maxTranslate:Qi,translateTo:Zi};function qi(s,m){const E=this;E.params.cssMode||E.$wrapperEl.transition(s),E.emit("setTransition",s,m)}function _r({swiper:s,runCallbacks:m,direction:E,step:x}){const{activeIndex:w,previousIndex:U}=s;let G=E;if(G||(w>U?G="next":w<U?G="prev":G="reset"),s.emit(`transition${x}`),m&&w!==U){if(G==="reset"){s.emit(`slideResetTransition${x}`);return}s.emit(`slideChangeTransition${x}`),G==="next"?s.emit(`slideNextTransition${x}`):s.emit(`slidePrevTransition${x}`)}}function en(s=!0,m){const E=this,{params:x}=E;x.cssMode||(x.autoHeight&&E.updateAutoHeight(),_r({swiper:E,runCallbacks:s,direction:m,step:"Start"}))}function tn(s=!0,m){const E=this,{params:x}=E;E.animating=!1,!x.cssMode&&(E.setTransition(0),_r({swiper:E,runCallbacks:s,direction:m,step:"End"}))}const rn={setTransition:qi,transitionStart:en,transitionEnd:tn};function nn(s=0,m=this.params.speed,E=!0,x,w){if(typeof s!="number"&&typeof s!="string")throw new Error(`The 'index' argument cannot have type other than 'number' or 'string'. [${typeof s}] given.`);if(typeof s=="string"){const D=parseInt(s,10);if(!isFinite(D))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${s}] given.`);s=D}const U=this;let G=s;G<0&&(G=0);const{params:k,snapGrid:u,slidesGrid:M,previousIndex:I,activeIndex:b,rtlTranslate:P,wrapperEl:F,enabled:R}=U;if(U.animating&&k.preventInteractionOnTransition||!R&&!x&&!w)return!1;const C=Math.min(U.params.slidesPerGroupSkip,G);let A=C+Math.floor((G-C)/U.params.slidesPerGroup);A>=u.length&&(A=u.length-1);const T=-u[A];if(k.normalizeSlideIndex)for(let D=0;D<M.length;D+=1){const L=-Math.floor(T*100),y=Math.floor(M[D]*100),l=Math.floor(M[D+1]*100);typeof M[D+1]<"u"?L>=y&&L<l-(l-y)/2?G=D:L>=y&&L<l&&(G=D+1):L>=y&&(G=D)}if(U.initialized&&G!==b&&(!U.allowSlideNext&&T<U.translate&&T<U.minTranslate()||!U.allowSlidePrev&&T>U.translate&&T>U.maxTranslate()&&(b||0)!==G))return!1;G!==(I||0)&&E&&U.emit("beforeSlideChangeStart"),U.updateProgress(T);let S;if(G>b?S="next":G<b?S="prev":S="reset",P&&-T===U.translate||!P&&T===U.translate)return U.updateActiveIndex(G),k.autoHeight&&U.updateAutoHeight(),U.updateSlidesClasses(),k.effect!=="slide"&&U.setTranslate(T),S!=="reset"&&(U.transitionStart(E,S),U.transitionEnd(E,S)),!1;if(k.cssMode){const D=U.isHorizontal(),L=P?T:-T;if(m===0){const y=U.virtual&&U.params.virtual.enabled;y&&(U.wrapperEl.style.scrollSnapType="none",U._immediateVirtual=!0),F[D?"scrollLeft":"scrollTop"]=L,y&&requestAnimationFrame(()=>{U.wrapperEl.style.scrollSnapType="",U._swiperImmediateVirtual=!1})}else{if(!U.support.smoothScroll)return Tr({swiper:U,targetPosition:L,side:D?"left":"top"}),!0;F.scrollTo({[D?"left":"top"]:L,behavior:"smooth"})}return!0}return U.setTransition(m),U.setTranslate(T),U.updateActiveIndex(G),U.updateSlidesClasses(),U.emit("beforeTransitionStart",m,x),U.transitionStart(E,S),m===0?U.transitionEnd(E,S):U.animating||(U.animating=!0,U.onSlideToWrapperTransitionEnd||(U.onSlideToWrapperTransitionEnd=function(L){!U||U.destroyed||L.target===this&&(U.$wrapperEl[0].removeEventListener("transitionend",U.onSlideToWrapperTransitionEnd),U.$wrapperEl[0].removeEventListener("webkitTransitionEnd",U.onSlideToWrapperTransitionEnd),U.onSlideToWrapperTransitionEnd=null,delete U.onSlideToWrapperTransitionEnd,U.transitionEnd(E,S))}),U.$wrapperEl[0].addEventListener("transitionend",U.onSlideToWrapperTransitionEnd),U.$wrapperEl[0].addEventListener("webkitTransitionEnd",U.onSlideToWrapperTransitionEnd)),!0}function sn(s=0,m=this.params.speed,E=!0,x){if(typeof s=="string"){const G=parseInt(s,10);if(!isFinite(G))throw new Error(`The passed-in 'index' (string) couldn't be converted to 'number'. [${s}] given.`);s=G}const w=this;let U=s;return w.params.loop&&(U+=w.loopedSlides),w.slideTo(U,m,E,x)}function an(s=this.params.speed,m=!0,E){const x=this,{animating:w,enabled:U,params:G}=x;if(!U)return x;let k=G.slidesPerGroup;G.slidesPerView==="auto"&&G.slidesPerGroup===1&&G.slidesPerGroupAuto&&(k=Math.max(x.slidesPerViewDynamic("current",!0),1));const u=x.activeIndex<G.slidesPerGroupSkip?1:k;if(G.loop){if(w&&G.loopPreventsSlide)return!1;x.loopFix(),x._clientLeft=x.$wrapperEl[0].clientLeft}return G.rewind&&x.isEnd?x.slideTo(0,s,m,E):x.slideTo(x.activeIndex+u,s,m,E)}function on(s=this.params.speed,m=!0,E){const x=this,{params:w,animating:U,snapGrid:G,slidesGrid:k,rtlTranslate:u,enabled:M}=x;if(!M)return x;if(w.loop){if(U&&w.loopPreventsSlide)return!1;x.loopFix(),x._clientLeft=x.$wrapperEl[0].clientLeft}const I=u?x.translate:-x.translate;function b(A){return A<0?-Math.floor(Math.abs(A)):Math.floor(A)}const P=b(I),F=G.map(A=>b(A));let R=G[F.indexOf(P)-1];if(typeof R>"u"&&w.cssMode){let A;G.forEach((T,S)=>{P>=T&&(A=S)}),typeof A<"u"&&(R=G[A>0?A-1:A])}let C=0;if(typeof R<"u"&&(C=k.indexOf(R),C<0&&(C=x.activeIndex-1),w.slidesPerView==="auto"&&w.slidesPerGroup===1&&w.slidesPerGroupAuto&&(C=C-x.slidesPerViewDynamic("previous",!0)+1,C=Math.max(C,0))),w.rewind&&x.isBeginning){const A=x.params.virtual&&x.params.virtual.enabled&&x.virtual?x.virtual.slides.length-1:x.slides.length-1;return x.slideTo(A,s,m,E)}return x.slideTo(C,s,m,E)}function ln(s=this.params.speed,m=!0,E){const x=this;return x.slideTo(x.activeIndex,s,m,E)}function un(s=this.params.speed,m=!0,E,x=.5){const w=this;let U=w.activeIndex;const G=Math.min(w.params.slidesPerGroupSkip,U),k=G+Math.floor((U-G)/w.params.slidesPerGroup),u=w.rtlTranslate?w.translate:-w.translate;if(u>=w.snapGrid[k]){const M=w.snapGrid[k],I=w.snapGrid[k+1];u-M>(I-M)*x&&(U+=w.params.slidesPerGroup)}else{const M=w.snapGrid[k-1],I=w.snapGrid[k];u-M<=(I-M)*x&&(U-=w.params.slidesPerGroup)}return U=Math.max(U,0),U=Math.min(U,w.slidesGrid.length-1),w.slideTo(U,s,m,E)}function fn(){const s=this,{params:m,$wrapperEl:E}=s,x=m.slidesPerView==="auto"?s.slidesPerViewDynamic():m.slidesPerView;let w=s.clickedIndex,U;if(m.loop){if(s.animating)return;U=parseInt(ee(s.clickedSlide).attr("data-swiper-slide-index"),10),m.centeredSlides?w<s.loopedSlides-x/2||w>s.slides.length-s.loopedSlides+x/2?(s.loopFix(),w=E.children(`.${m.slideClass}[data-swiper-slide-index="${U}"]:not(.${m.slideDuplicateClass})`).eq(0).index(),St(()=>{s.slideTo(w)})):s.slideTo(w):w>s.slides.length-x?(s.loopFix(),w=E.children(`.${m.slideClass}[data-swiper-slide-index="${U}"]:not(.${m.slideDuplicateClass})`).eq(0).index(),St(()=>{s.slideTo(w)})):s.slideTo(w)}else s.slideTo(w)}const dn={slideTo:nn,slideToLoop:sn,slideNext:an,slidePrev:on,slideReset:ln,slideToClosest:un,slideToClickedSlide:fn};function cn(){const s=this,m=Ce(),{params:E,$wrapperEl:x}=s,w=x.children().length>0?ee(x.children()[0].parentNode):x;w.children(`.${E.slideClass}.${E.slideDuplicateClass}`).remove();let U=w.children(`.${E.slideClass}`);if(E.loopFillGroupWithBlank){const u=E.slidesPerGroup-U.length%E.slidesPerGroup;if(u!==E.slidesPerGroup){for(let M=0;M<u;M+=1){const I=ee(m.createElement("div")).addClass(`${E.slideClass} ${E.slideBlankClass}`);w.append(I)}U=w.children(`.${E.slideClass}`)}}E.slidesPerView==="auto"&&!E.loopedSlides&&(E.loopedSlides=U.length),s.loopedSlides=Math.ceil(parseFloat(E.loopedSlides||E.slidesPerView,10)),s.loopedSlides+=E.loopAdditionalSlides,s.loopedSlides>U.length&&s.params.loopedSlidesLimit&&(s.loopedSlides=U.length);const G=[],k=[];U.each((u,M)=>{ee(u).attr("data-swiper-slide-index",M)});for(let u=0;u<s.loopedSlides;u+=1){const M=u-Math.floor(u/U.length)*U.length;k.push(U.eq(M)[0]),G.unshift(U.eq(U.length-M-1)[0])}for(let u=0;u<k.length;u+=1)w.append(ee(k[u].cloneNode(!0)).addClass(E.slideDuplicateClass));for(let u=G.length-1;u>=0;u-=1)w.prepend(ee(G[u].cloneNode(!0)).addClass(E.slideDuplicateClass))}function hn(){const s=this;s.emit("beforeLoopFix");const{activeIndex:m,slides:E,loopedSlides:x,allowSlidePrev:w,allowSlideNext:U,snapGrid:G,rtlTranslate:k}=s;let u;s.allowSlidePrev=!0,s.allowSlideNext=!0;const I=-G[m]-s.getTranslate();m<x?(u=E.length-x*3+m,u+=x,s.slideTo(u,0,!1,!0)&&I!==0&&s.setTranslate((k?-s.translate:s.translate)-I)):m>=E.length-x&&(u=-E.length+m+x,u+=x,s.slideTo(u,0,!1,!0)&&I!==0&&s.setTranslate((k?-s.translate:s.translate)-I)),s.allowSlidePrev=w,s.allowSlideNext=U,s.emit("loopFix")}function vn(){const s=this,{$wrapperEl:m,params:E,slides:x}=s;m.children(`.${E.slideClass}.${E.slideDuplicateClass},.${E.slideClass}.${E.slideBlankClass}`).remove(),x.removeAttr("data-swiper-slide-index")}const gn={loopCreate:cn,loopFix:hn,loopDestroy:vn};function pn(s){const m=this;if(m.support.touch||!m.params.simulateTouch||m.params.watchOverflow&&m.isLocked||m.params.cssMode)return;const E=m.params.touchEventsTarget==="container"?m.el:m.wrapperEl;E.style.cursor="move",E.style.cursor=s?"grabbing":"grab"}function mn(){const s=this;s.support.touch||s.params.watchOverflow&&s.isLocked||s.params.cssMode||(s[s.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="")}const En={setGrabCursor:pn,unsetGrabCursor:mn};function Tn(s,m=this){function E(x){if(!x||x===Ce()||x===Se())return null;x.assignedSlot&&(x=x.assignedSlot);const w=x.closest(s);return!w&&!x.getRootNode?null:w||E(x.getRootNode().host)}return E(m)}function yn(s){const m=this,E=Ce(),x=Se(),w=m.touchEventsData,{params:U,touches:G,enabled:k}=m;if(!k||m.animating&&U.preventInteractionOnTransition)return;!m.animating&&U.cssMode&&U.loop&&m.loopFix();let u=s;u.originalEvent&&(u=u.originalEvent);let M=ee(u.target);if(U.touchEventsTarget==="wrapper"&&!M.closest(m.wrapperEl).length||(w.isTouchEvent=u.type==="touchstart",!w.isTouchEvent&&"which"in u&&u.which===3)||!w.isTouchEvent&&"button"in u&&u.button>0||w.isTouched&&w.isMoved)return;const I=!!U.noSwipingClass&&U.noSwipingClass!=="",b=s.composedPath?s.composedPath():s.path;I&&u.target&&u.target.shadowRoot&&b&&(M=ee(b[0]));const P=U.noSwipingSelector?U.noSwipingSelector:`.${U.noSwipingClass}`,F=!!(u.target&&u.target.shadowRoot);if(U.noSwiping&&(F?Tn(P,M[0]):M.closest(P)[0])){m.allowClick=!0;return}if(U.swipeHandler&&!M.closest(U.swipeHandler)[0])return;G.currentX=u.type==="touchstart"?u.targetTouches[0].pageX:u.pageX,G.currentY=u.type==="touchstart"?u.targetTouches[0].pageY:u.pageY;const R=G.currentX,C=G.currentY,A=U.edgeSwipeDetection||U.iOSEdgeSwipeDetection,T=U.edgeSwipeThreshold||U.iOSEdgeSwipeThreshold;if(A&&(R<=T||R>=x.innerWidth-T))if(A==="prevent")s.preventDefault();else return;if(Object.assign(w,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),G.startX=R,G.startY=C,w.touchStartTime=gt(),m.allowClick=!0,m.updateSize(),m.swipeDirection=void 0,U.threshold>0&&(w.allowThresholdMove=!1),u.type!=="touchstart"){let S=!0;M.is(w.focusableElements)&&(S=!1,M[0].nodeName==="SELECT"&&(w.isTouched=!1)),E.activeElement&&ee(E.activeElement).is(w.focusableElements)&&E.activeElement!==M[0]&&E.activeElement.blur();const D=S&&m.allowTouchMove&&U.touchStartPreventDefault;(U.touchStartForcePreventDefault||D)&&!M[0].isContentEditable&&u.preventDefault()}m.params.freeMode&&m.params.freeMode.enabled&&m.freeMode&&m.animating&&!U.cssMode&&m.freeMode.onTouchStart(),m.emit("touchStart",u)}function _n(s){const m=Ce(),E=this,x=E.touchEventsData,{params:w,touches:U,rtlTranslate:G,enabled:k}=E;if(!k)return;let u=s;if(u.originalEvent&&(u=u.originalEvent),!x.isTouched){x.startMoving&&x.isScrolling&&E.emit("touchMoveOpposite",u);return}if(x.isTouchEvent&&u.type!=="touchmove")return;const M=u.type==="touchmove"&&u.targetTouches&&(u.targetTouches[0]||u.changedTouches[0]),I=u.type==="touchmove"?M.pageX:u.pageX,b=u.type==="touchmove"?M.pageY:u.pageY;if(u.preventedByNestedSwiper){U.startX=I,U.startY=b;return}if(!E.allowTouchMove){ee(u.target).is(x.focusableElements)||(E.allowClick=!1),x.isTouched&&(Object.assign(U,{startX:I,startY:b,currentX:I,currentY:b}),x.touchStartTime=gt());return}if(x.isTouchEvent&&w.touchReleaseOnEdges&&!w.loop){if(E.isVertical()){if(b<U.startY&&E.translate<=E.maxTranslate()||b>U.startY&&E.translate>=E.minTranslate()){x.isTouched=!1,x.isMoved=!1;return}}else if(I<U.startX&&E.translate<=E.maxTranslate()||I>U.startX&&E.translate>=E.minTranslate())return}if(x.isTouchEvent&&m.activeElement&&u.target===m.activeElement&&ee(u.target).is(x.focusableElements)){x.isMoved=!0,E.allowClick=!1;return}if(x.allowTouchCallbacks&&E.emit("touchMove",u),u.targetTouches&&u.targetTouches.length>1)return;U.currentX=I,U.currentY=b;const P=U.currentX-U.startX,F=U.currentY-U.startY;if(E.params.threshold&&Math.sqrt(P**2+F**2)<E.params.threshold)return;if(typeof x.isScrolling>"u"){let T;E.isHorizontal()&&U.currentY===U.startY||E.isVertical()&&U.currentX===U.startX?x.isScrolling=!1:P*P+F*F>=25&&(T=Math.atan2(Math.abs(F),Math.abs(P))*180/Math.PI,x.isScrolling=E.isHorizontal()?T>w.touchAngle:90-T>w.touchAngle)}if(x.isScrolling&&E.emit("touchMoveOpposite",u),typeof x.startMoving>"u"&&(U.currentX!==U.startX||U.currentY!==U.startY)&&(x.startMoving=!0),x.isScrolling){x.isTouched=!1;return}if(!x.startMoving)return;E.allowClick=!1,!w.cssMode&&u.cancelable&&u.preventDefault(),w.touchMoveStopPropagation&&!w.nested&&u.stopPropagation(),x.isMoved||(w.loop&&!w.cssMode&&E.loopFix(),x.startTranslate=E.getTranslate(),E.setTransition(0),E.animating&&E.$wrapperEl.trigger("webkitTransitionEnd transitionend"),x.allowMomentumBounce=!1,w.grabCursor&&(E.allowSlideNext===!0||E.allowSlidePrev===!0)&&E.setGrabCursor(!0),E.emit("sliderFirstMove",u)),E.emit("sliderMove",u),x.isMoved=!0;let R=E.isHorizontal()?P:F;U.diff=R,R*=w.touchRatio,G&&(R=-R),E.swipeDirection=R>0?"prev":"next",x.currentTranslate=R+x.startTranslate;let C=!0,A=w.resistanceRatio;if(w.touchReleaseOnEdges&&(A=0),R>0&&x.currentTranslate>E.minTranslate()?(C=!1,w.resistance&&(x.currentTranslate=E.minTranslate()-1+(-E.minTranslate()+x.startTranslate+R)**A)):R<0&&x.currentTranslate<E.maxTranslate()&&(C=!1,w.resistance&&(x.currentTranslate=E.maxTranslate()+1-(E.maxTranslate()-x.startTranslate-R)**A)),C&&(u.preventedByNestedSwiper=!0),!E.allowSlideNext&&E.swipeDirection==="next"&&x.currentTranslate<x.startTranslate&&(x.currentTranslate=x.startTranslate),!E.allowSlidePrev&&E.swipeDirection==="prev"&&x.currentTranslate>x.startTranslate&&(x.currentTranslate=x.startTranslate),!E.allowSlidePrev&&!E.allowSlideNext&&(x.currentTranslate=x.startTranslate),w.threshold>0)if(Math.abs(R)>w.threshold||x.allowThresholdMove){if(!x.allowThresholdMove){x.allowThresholdMove=!0,U.startX=U.currentX,U.startY=U.currentY,x.currentTranslate=x.startTranslate,U.diff=E.isHorizontal()?U.currentX-U.startX:U.currentY-U.startY;return}}else{x.currentTranslate=x.startTranslate;return}!w.followFinger||w.cssMode||((w.freeMode&&w.freeMode.enabled&&E.freeMode||w.watchSlidesProgress)&&(E.updateActiveIndex(),E.updateSlidesClasses()),E.params.freeMode&&w.freeMode.enabled&&E.freeMode&&E.freeMode.onTouchMove(),E.updateProgress(x.currentTranslate),E.setTranslate(x.currentTranslate))}function Sn(s){const m=this,E=m.touchEventsData,{params:x,touches:w,rtlTranslate:U,slidesGrid:G,enabled:k}=m;if(!k)return;let u=s;if(u.originalEvent&&(u=u.originalEvent),E.allowTouchCallbacks&&m.emit("touchEnd",u),E.allowTouchCallbacks=!1,!E.isTouched){E.isMoved&&x.grabCursor&&m.setGrabCursor(!1),E.isMoved=!1,E.startMoving=!1;return}x.grabCursor&&E.isMoved&&E.isTouched&&(m.allowSlideNext===!0||m.allowSlidePrev===!0)&&m.setGrabCursor(!1);const M=gt(),I=M-E.touchStartTime;if(m.allowClick){const S=u.path||u.composedPath&&u.composedPath();m.updateClickedSlide(S&&S[0]||u.target),m.emit("tap click",u),I<300&&M-E.lastClickTime<300&&m.emit("doubleTap doubleClick",u)}if(E.lastClickTime=gt(),St(()=>{m.destroyed||(m.allowClick=!0)}),!E.isTouched||!E.isMoved||!m.swipeDirection||w.diff===0||E.currentTranslate===E.startTranslate){E.isTouched=!1,E.isMoved=!1,E.startMoving=!1;return}E.isTouched=!1,E.isMoved=!1,E.startMoving=!1;let b;if(x.followFinger?b=U?m.translate:-m.translate:b=-E.currentTranslate,x.cssMode)return;if(m.params.freeMode&&x.freeMode.enabled){m.freeMode.onTouchEnd({currentPos:b});return}let P=0,F=m.slidesSizesGrid[0];for(let S=0;S<G.length;S+=S<x.slidesPerGroupSkip?1:x.slidesPerGroup){const D=S<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;typeof G[S+D]<"u"?b>=G[S]&&b<G[S+D]&&(P=S,F=G[S+D]-G[S]):b>=G[S]&&(P=S,F=G[G.length-1]-G[G.length-2])}let R=null,C=null;x.rewind&&(m.isBeginning?C=m.params.virtual&&m.params.virtual.enabled&&m.virtual?m.virtual.slides.length-1:m.slides.length-1:m.isEnd&&(R=0));const A=(b-G[P])/F,T=P<x.slidesPerGroupSkip-1?1:x.slidesPerGroup;if(I>x.longSwipesMs){if(!x.longSwipes){m.slideTo(m.activeIndex);return}m.swipeDirection==="next"&&(A>=x.longSwipesRatio?m.slideTo(x.rewind&&m.isEnd?R:P+T):m.slideTo(P)),m.swipeDirection==="prev"&&(A>1-x.longSwipesRatio?m.slideTo(P+T):C!==null&&A<0&&Math.abs(A)>x.longSwipesRatio?m.slideTo(C):m.slideTo(P))}else{if(!x.shortSwipes){m.slideTo(m.activeIndex);return}m.navigation&&(u.target===m.navigation.nextEl||u.target===m.navigation.prevEl)?u.target===m.navigation.nextEl?m.slideTo(P+T):m.slideTo(P):(m.swipeDirection==="next"&&m.slideTo(R!==null?R:P+T),m.swipeDirection==="prev"&&m.slideTo(C!==null?C:P))}}function Zt(){const s=this,{params:m,el:E}=s;if(E&&E.offsetWidth===0)return;m.breakpoints&&s.setBreakpoint();const{allowSlideNext:x,allowSlidePrev:w,snapGrid:U}=s;s.allowSlideNext=!0,s.allowSlidePrev=!0,s.updateSize(),s.updateSlides(),s.updateSlidesClasses(),(m.slidesPerView==="auto"||m.slidesPerView>1)&&s.isEnd&&!s.isBeginning&&!s.params.centeredSlides?s.slideTo(s.slides.length-1,0,!1,!0):s.slideTo(s.activeIndex,0,!1,!0),s.autoplay&&s.autoplay.running&&s.autoplay.paused&&s.autoplay.run(),s.allowSlidePrev=w,s.allowSlideNext=x,s.params.watchOverflow&&U!==s.snapGrid&&s.checkOverflow()}function xn(s){const m=this;!m.enabled||m.allowClick||(m.params.preventClicks&&s.preventDefault(),m.params.preventClicksPropagation&&m.animating&&(s.stopPropagation(),s.stopImmediatePropagation()))}function Ln(){const s=this,{wrapperEl:m,rtlTranslate:E,enabled:x}=s;if(!x)return;s.previousTranslate=s.translate,s.isHorizontal()?s.translate=-m.scrollLeft:s.translate=-m.scrollTop,s.translate===0&&(s.translate=0),s.updateActiveIndex(),s.updateSlidesClasses();let w;const U=s.maxTranslate()-s.minTranslate();U===0?w=0:w=(s.translate-s.minTranslate())/U,w!==s.progress&&s.updateProgress(E?-s.translate:s.translate),s.emit("setTranslate",s.translate,!1)}let Jt=!1;function Dn(){}const Sr=(s,m)=>{const E=Ce(),{params:x,touchEvents:w,el:U,wrapperEl:G,device:k,support:u}=s,M=!!x.nested,I=m==="on"?"addEventListener":"removeEventListener",b=m;if(!u.touch)U[I](w.start,s.onTouchStart,!1),E[I](w.move,s.onTouchMove,M),E[I](w.end,s.onTouchEnd,!1);else{const P=w.start==="touchstart"&&u.passiveListener&&x.passiveListeners?{passive:!0,capture:!1}:!1;U[I](w.start,s.onTouchStart,P),U[I](w.move,s.onTouchMove,u.passiveListener?{passive:!1,capture:M}:M),U[I](w.end,s.onTouchEnd,P),w.cancel&&U[I](w.cancel,s.onTouchEnd,P)}(x.preventClicks||x.preventClicksPropagation)&&U[I]("click",s.onClick,!0),x.cssMode&&G[I]("scroll",s.onScroll),x.updateOnWindowResize?s[b](k.ios||k.android?"resize orientationchange observerUpdate":"resize observerUpdate",Zt,!0):s[b]("observerUpdate",Zt,!0)};function An(){const s=this,m=Ce(),{params:E,support:x}=s;s.onTouchStart=yn.bind(s),s.onTouchMove=_n.bind(s),s.onTouchEnd=Sn.bind(s),E.cssMode&&(s.onScroll=Ln.bind(s)),s.onClick=xn.bind(s),x.touch&&!Jt&&(m.addEventListener("touchstart",Dn),Jt=!0),Sr(s,"on")}function In(){Sr(this,"off")}const Cn={attachEvents:An,detachEvents:In},qt=(s,m)=>s.grid&&m.grid&&m.grid.rows>1;function Pn(){const s=this,{activeIndex:m,initialized:E,loopedSlides:x=0,params:w,$el:U}=s,G=w.breakpoints;if(!G||G&&Object.keys(G).length===0)return;const k=s.getBreakpoint(G,s.params.breakpointsBase,s.el);if(!k||s.currentBreakpoint===k)return;const M=(k in G?G[k]:void 0)||s.originalParams,I=qt(s,w),b=qt(s,M),P=w.enabled;I&&!b?(U.removeClass(`${w.containerModifierClass}grid ${w.containerModifierClass}grid-column`),s.emitContainerClasses()):!I&&b&&(U.addClass(`${w.containerModifierClass}grid`),(M.grid.fill&&M.grid.fill==="column"||!M.grid.fill&&w.grid.fill==="column")&&U.addClass(`${w.containerModifierClass}grid-column`),s.emitContainerClasses()),["navigation","pagination","scrollbar"].forEach(A=>{const T=w[A]&&w[A].enabled,S=M[A]&&M[A].enabled;T&&!S&&s[A].disable(),!T&&S&&s[A].enable()});const F=M.direction&&M.direction!==w.direction,R=w.loop&&(M.slidesPerView!==w.slidesPerView||F);F&&E&&s.changeDirection(),ke(s.params,M);const C=s.params.enabled;Object.assign(s,{allowTouchMove:s.params.allowTouchMove,allowSlideNext:s.params.allowSlideNext,allowSlidePrev:s.params.allowSlidePrev}),P&&!C?s.disable():!P&&C&&s.enable(),s.currentBreakpoint=k,s.emit("_beforeBreakpoint",M),R&&E&&(s.loopDestroy(),s.loopCreate(),s.updateSlides(),s.slideTo(m-x+s.loopedSlides,0,!1)),s.emit("breakpoint",M)}function On(s,m="window",E){if(!s||m==="container"&&!E)return;let x=!1;const w=Se(),U=m==="window"?w.innerHeight:E.clientHeight,G=Object.keys(s).map(k=>{if(typeof k=="string"&&k.indexOf("@")===0){const u=parseFloat(k.substr(1));return{value:U*u,point:k}}return{value:k,point:k}});G.sort((k,u)=>parseInt(k.value,10)-parseInt(u.value,10));for(let k=0;k<G.length;k+=1){const{point:u,value:M}=G[k];m==="window"?w.matchMedia(`(min-width: ${M}px)`).matches&&(x=u):M<=E.clientWidth&&(x=u)}return x||"max"}const Rn={setBreakpoint:Pn,getBreakpoint:On};function bn(s,m){const E=[];return s.forEach(x=>{typeof x=="object"?Object.keys(x).forEach(w=>{x[w]&&E.push(m+w)}):typeof x=="string"&&E.push(m+x)}),E}function Mn(){const s=this,{classNames:m,params:E,rtl:x,$el:w,device:U,support:G}=s,k=bn(["initialized",E.direction,{"pointer-events":!G.touch},{"free-mode":s.params.freeMode&&E.freeMode.enabled},{autoheight:E.autoHeight},{rtl:x},{grid:E.grid&&E.grid.rows>1},{"grid-column":E.grid&&E.grid.rows>1&&E.grid.fill==="column"},{android:U.android},{ios:U.ios},{"css-mode":E.cssMode},{centered:E.cssMode&&E.centeredSlides},{"watch-progress":E.watchSlidesProgress}],E.containerModifierClass);m.push(...k),w.addClass([...m].join(" ")),s.emitContainerClasses()}function wn(){const s=this,{$el:m,classNames:E}=s;m.removeClass(E.join(" ")),s.emitContainerClasses()}const Fn={addClasses:Mn,removeClasses:wn};function kn(s,m,E,x,w,U){const G=Se();let k;function u(){U&&U()}!ee(s).parent("picture")[0]&&(!s.complete||!w)&&m?(k=new G.Image,k.onload=u,k.onerror=u,x&&(k.sizes=x),E&&(k.srcset=E),m&&(k.src=m)):u()}function Bn(){const s=this;s.imagesToLoad=s.$el.find("img");function m(){typeof s>"u"||s===null||!s||s.destroyed||(s.imagesLoaded!==void 0&&(s.imagesLoaded+=1),s.imagesLoaded===s.imagesToLoad.length&&(s.params.updateOnImagesReady&&s.update(),s.emit("imagesReady")))}for(let E=0;E<s.imagesToLoad.length;E+=1){const x=s.imagesToLoad[E];s.loadImage(x,x.currentSrc||x.getAttribute("src"),x.srcset||x.getAttribute("srcset"),x.sizes||x.getAttribute("sizes"),!0,m)}}const Un={loadImage:kn,preloadImages:Bn};function Nn(){const s=this,{isLocked:m,params:E}=s,{slidesOffsetBefore:x}=E;if(x){const w=s.slides.length-1,U=s.slidesGrid[w]+s.slidesSizesGrid[w]+x*2;s.isLocked=s.size>U}else s.isLocked=s.snapGrid.length===1;E.allowSlideNext===!0&&(s.allowSlideNext=!s.isLocked),E.allowSlidePrev===!0&&(s.allowSlidePrev=!s.isLocked),m&&m!==s.isLocked&&(s.isEnd=!1),m!==s.isLocked&&s.emit(s.isLocked?"lock":"unlock")}const Kn={checkOverflow:Nn},er={init:!0,direction:"horizontal",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:0,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,loopedSlidesLimit:!0,loopFillGroupWithBlank:!1,loopPreventsSlide:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-invisible-blank",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",runCallbacksOnInit:!0,_emitClasses:!1};function Gn(s,m){return function(x={}){const w=Object.keys(x)[0],U=x[w];if(typeof U!="object"||U===null){ke(m,x);return}if(["navigation","pagination","scrollbar"].indexOf(w)>=0&&s[w]===!0&&(s[w]={auto:!0}),!(w in s&&"enabled"in U)){ke(m,x);return}s[w]===!0&&(s[w]={enabled:!0}),typeof s[w]=="object"&&!("enabled"in s[w])&&(s[w].enabled=!0),s[w]||(s[w]={enabled:!1}),ke(m,x)}}const bt={eventsEmitter:ki,update:zi,translate:Ji,transition:rn,slide:dn,loop:gn,grabCursor:En,events:Cn,breakpoints:Rn,checkOverflow:Kn,classes:Fn,images:Un},Mt={};class Re{constructor(...m){let E,x;if(m.length===1&&m[0].constructor&&Object.prototype.toString.call(m[0]).slice(8,-1)==="Object"?x=m[0]:[E,x]=m,x||(x={}),x=ke({},x),E&&!x.el&&(x.el=E),x.el&&ee(x.el).length>1){const k=[];return ee(x.el).each(u=>{const M=ke({},x,{el:u});k.push(new Re(M))}),k}const w=this;w.__swiper__=!0,w.support=yr(),w.device=Ri({userAgent:x.userAgent}),w.browser=Mi(),w.eventsListeners={},w.eventsAnyListeners=[],w.modules=[...w.__modules__],x.modules&&Array.isArray(x.modules)&&w.modules.push(...x.modules);const U={};w.modules.forEach(k=>{k({swiper:w,extendParams:Gn(x,U),on:w.on.bind(w),once:w.once.bind(w),off:w.off.bind(w),emit:w.emit.bind(w)})});const G=ke({},er,U);return w.params=ke({},G,Mt,x),w.originalParams=ke({},w.params),w.passedParams=ke({},x),w.params&&w.params.on&&Object.keys(w.params.on).forEach(k=>{w.on(k,w.params.on[k])}),w.params&&w.params.onAny&&w.onAny(w.params.onAny),w.$=ee,Object.assign(w,{enabled:w.params.enabled,el:E,classNames:[],slides:ee(),slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return w.params.direction==="horizontal"},isVertical(){return w.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,allowSlideNext:w.params.allowSlideNext,allowSlidePrev:w.params.allowSlidePrev,touchEvents:function(){const u=["touchstart","touchmove","touchend","touchcancel"],M=["pointerdown","pointermove","pointerup"];return w.touchEventsTouch={start:u[0],move:u[1],end:u[2],cancel:u[3]},w.touchEventsDesktop={start:M[0],move:M[1],end:M[2]},w.support.touch||!w.params.simulateTouch?w.touchEventsTouch:w.touchEventsDesktop}(),touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:w.params.focusableElements,lastClickTime:gt(),clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,isTouchEvent:void 0,startMoving:void 0},allowClick:!0,allowTouchMove:w.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),w.emit("_swiper"),w.params.init&&w.init(),w}enable(){const m=this;m.enabled||(m.enabled=!0,m.params.grabCursor&&m.setGrabCursor(),m.emit("enable"))}disable(){const m=this;!m.enabled||(m.enabled=!1,m.params.grabCursor&&m.unsetGrabCursor(),m.emit("disable"))}setProgress(m,E){const x=this;m=Math.min(Math.max(m,0),1);const w=x.minTranslate(),G=(x.maxTranslate()-w)*m+w;x.translateTo(G,typeof E>"u"?0:E),x.updateActiveIndex(),x.updateSlidesClasses()}emitContainerClasses(){const m=this;if(!m.params._emitClasses||!m.el)return;const E=m.el.className.split(" ").filter(x=>x.indexOf("swiper")===0||x.indexOf(m.params.containerModifierClass)===0);m.emit("_containerClasses",E.join(" "))}getSlideClasses(m){const E=this;return E.destroyed?"":m.className.split(" ").filter(x=>x.indexOf("swiper-slide")===0||x.indexOf(E.params.slideClass)===0).join(" ")}emitSlidesClasses(){const m=this;if(!m.params._emitClasses||!m.el)return;const E=[];m.slides.each(x=>{const w=m.getSlideClasses(x);E.push({slideEl:x,classNames:w}),m.emit("_slideClass",x,w)}),m.emit("_slideClasses",E)}slidesPerViewDynamic(m="current",E=!1){const x=this,{params:w,slides:U,slidesGrid:G,slidesSizesGrid:k,size:u,activeIndex:M}=x;let I=1;if(w.centeredSlides){let b=U[M].swiperSlideSize,P;for(let F=M+1;F<U.length;F+=1)U[F]&&!P&&(b+=U[F].swiperSlideSize,I+=1,b>u&&(P=!0));for(let F=M-1;F>=0;F-=1)U[F]&&!P&&(b+=U[F].swiperSlideSize,I+=1,b>u&&(P=!0))}else if(m==="current")for(let b=M+1;b<U.length;b+=1)(E?G[b]+k[b]-G[M]<u:G[b]-G[M]<u)&&(I+=1);else for(let b=M-1;b>=0;b-=1)G[M]-G[b]<u&&(I+=1);return I}update(){const m=this;if(!m||m.destroyed)return;const{snapGrid:E,params:x}=m;x.breakpoints&&m.setBreakpoint(),m.updateSize(),m.updateSlides(),m.updateProgress(),m.updateSlidesClasses();function w(){const G=m.rtlTranslate?m.translate*-1:m.translate,k=Math.min(Math.max(G,m.maxTranslate()),m.minTranslate());m.setTranslate(k),m.updateActiveIndex(),m.updateSlidesClasses()}let U;m.params.freeMode&&m.params.freeMode.enabled?(w(),m.params.autoHeight&&m.updateAutoHeight()):((m.params.slidesPerView==="auto"||m.params.slidesPerView>1)&&m.isEnd&&!m.params.centeredSlides?U=m.slideTo(m.slides.length-1,0,!1,!0):U=m.slideTo(m.activeIndex,0,!1,!0),U||w()),x.watchOverflow&&E!==m.snapGrid&&m.checkOverflow(),m.emit("update")}changeDirection(m,E=!0){const x=this,w=x.params.direction;return m||(m=w==="horizontal"?"vertical":"horizontal"),m===w||m!=="horizontal"&&m!=="vertical"||(x.$el.removeClass(`${x.params.containerModifierClass}${w}`).addClass(`${x.params.containerModifierClass}${m}`),x.emitContainerClasses(),x.params.direction=m,x.slides.each(U=>{m==="vertical"?U.style.width="":U.style.height=""}),x.emit("changeDirection"),E&&x.update()),x}changeLanguageDirection(m){const E=this;E.rtl&&m==="rtl"||!E.rtl&&m==="ltr"||(E.rtl=m==="rtl",E.rtlTranslate=E.params.direction==="horizontal"&&E.rtl,E.rtl?(E.$el.addClass(`${E.params.containerModifierClass}rtl`),E.el.dir="rtl"):(E.$el.removeClass(`${E.params.containerModifierClass}rtl`),E.el.dir="ltr"),E.update())}mount(m){const E=this;if(E.mounted)return!0;const x=ee(m||E.params.el);if(m=x[0],!m)return!1;m.swiper=E;const w=()=>`.${(E.params.wrapperClass||"").trim().split(" ").join(".")}`;let G=(()=>{if(m&&m.shadowRoot&&m.shadowRoot.querySelector){const k=ee(m.shadowRoot.querySelector(w()));return k.children=u=>x.children(u),k}return x.children?x.children(w()):ee(x).children(w())})();if(G.length===0&&E.params.createElements){const u=Ce().createElement("div");G=ee(u),u.className=E.params.wrapperClass,x.append(u),x.children(`.${E.params.slideClass}`).each(M=>{G.append(M)})}return Object.assign(E,{$el:x,el:m,$wrapperEl:G,wrapperEl:G[0],mounted:!0,rtl:m.dir.toLowerCase()==="rtl"||x.css("direction")==="rtl",rtlTranslate:E.params.direction==="horizontal"&&(m.dir.toLowerCase()==="rtl"||x.css("direction")==="rtl"),wrongRTL:G.css("display")==="-webkit-box"}),!0}init(m){const E=this;return E.initialized||E.mount(m)===!1||(E.emit("beforeInit"),E.params.breakpoints&&E.setBreakpoint(),E.addClasses(),E.params.loop&&E.loopCreate(),E.updateSize(),E.updateSlides(),E.params.watchOverflow&&E.checkOverflow(),E.params.grabCursor&&E.enabled&&E.setGrabCursor(),E.params.preloadImages&&E.preloadImages(),E.params.loop?E.slideTo(E.params.initialSlide+E.loopedSlides,0,E.params.runCallbacksOnInit,!1,!0):E.slideTo(E.params.initialSlide,0,E.params.runCallbacksOnInit,!1,!0),E.attachEvents(),E.initialized=!0,E.emit("init"),E.emit("afterInit")),E}destroy(m=!0,E=!0){const x=this,{params:w,$el:U,$wrapperEl:G,slides:k}=x;return typeof x.params>"u"||x.destroyed||(x.emit("beforeDestroy"),x.initialized=!1,x.detachEvents(),w.loop&&x.loopDestroy(),E&&(x.removeClasses(),U.removeAttr("style"),G.removeAttr("style"),k&&k.length&&k.removeClass([w.slideVisibleClass,w.slideActiveClass,w.slideNextClass,w.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-slide-index")),x.emit("destroy"),Object.keys(x.eventsListeners).forEach(u=>{x.off(u)}),m!==!1&&(x.$el[0].swiper=null,Di(x)),x.destroyed=!0),null}static extendDefaults(m){ke(Mt,m)}static get extendedDefaults(){return Mt}static get defaults(){return er}static installModule(m){Re.prototype.__modules__||(Re.prototype.__modules__=[]);const E=Re.prototype.__modules__;typeof m=="function"&&E.indexOf(m)<0&&E.push(m)}static use(m){return Array.isArray(m)?(m.forEach(E=>Re.installModule(E)),Re):(Re.installModule(m),Re)}}Object.keys(bt).forEach(s=>{Object.keys(bt[s]).forEach(m=>{Re.prototype[m]=bt[s][m]})});Re.use([wi,Fi]);function Wn({swiper:s,extendParams:m,on:E,emit:x}){let w;s.autoplay={running:!1,paused:!1},m({autoplay:{enabled:!1,delay:3e3,waitForTransition:!0,disableOnInteraction:!0,stopOnLastSlide:!1,reverseDirection:!1,pauseOnMouseEnter:!1}});function U(){if(!s.size){s.autoplay.running=!1,s.autoplay.paused=!1;return}const C=s.slides.eq(s.activeIndex);let A=s.params.autoplay.delay;C.attr("data-swiper-autoplay")&&(A=C.attr("data-swiper-autoplay")||s.params.autoplay.delay),clearTimeout(w),w=St(()=>{let T;s.params.autoplay.reverseDirection?s.params.loop?(s.loopFix(),T=s.slidePrev(s.params.speed,!0,!0),x("autoplay")):s.isBeginning?s.params.autoplay.stopOnLastSlide?k():(T=s.slideTo(s.slides.length-1,s.params.speed,!0,!0),x("autoplay")):(T=s.slidePrev(s.params.speed,!0,!0),x("autoplay")):s.params.loop?(s.loopFix(),T=s.slideNext(s.params.speed,!0,!0),x("autoplay")):s.isEnd?s.params.autoplay.stopOnLastSlide?k():(T=s.slideTo(0,s.params.speed,!0,!0),x("autoplay")):(T=s.slideNext(s.params.speed,!0,!0),x("autoplay")),(s.params.cssMode&&s.autoplay.running||T===!1)&&U()},A)}function G(){return typeof w<"u"||s.autoplay.running?!1:(s.autoplay.running=!0,x("autoplayStart"),U(),!0)}function k(){return!s.autoplay.running||typeof w>"u"?!1:(w&&(clearTimeout(w),w=void 0),s.autoplay.running=!1,x("autoplayStop"),!0)}function u(C){!s.autoplay.running||s.autoplay.paused||(w&&clearTimeout(w),s.autoplay.paused=!0,C===0||!s.params.autoplay.waitForTransition?(s.autoplay.paused=!1,U()):["transitionend","webkitTransitionEnd"].forEach(A=>{s.$wrapperEl[0].addEventListener(A,I)}))}function M(){const C=Ce();C.visibilityState==="hidden"&&s.autoplay.running&&u(),C.visibilityState==="visible"&&s.autoplay.paused&&(U(),s.autoplay.paused=!1)}function I(C){!s||s.destroyed||!s.$wrapperEl||C.target===s.$wrapperEl[0]&&(["transitionend","webkitTransitionEnd"].forEach(A=>{s.$wrapperEl[0].removeEventListener(A,I)}),s.autoplay.paused=!1,s.autoplay.running?U():k())}function b(){s.params.autoplay.disableOnInteraction?k():(x("autoplayPause"),u()),["transitionend","webkitTransitionEnd"].forEach(C=>{s.$wrapperEl[0].removeEventListener(C,I)})}function P(){s.params.autoplay.disableOnInteraction||(s.autoplay.paused=!1,x("autoplayResume"),U())}function F(){s.params.autoplay.pauseOnMouseEnter&&(s.$el.on("mouseenter",b),s.$el.on("mouseleave",P))}function R(){s.$el.off("mouseenter",b),s.$el.off("mouseleave",P)}E("init",()=>{s.params.autoplay.enabled&&(G(),Ce().addEventListener("visibilitychange",M),F())}),E("beforeTransitionStart",(C,A,T)=>{s.autoplay.running&&(T||!s.params.autoplay.disableOnInteraction?s.autoplay.pause(A):k())}),E("sliderFirstMove",()=>{s.autoplay.running&&(s.params.autoplay.disableOnInteraction?k():u())}),E("touchEnd",()=>{s.params.cssMode&&s.autoplay.paused&&!s.params.autoplay.disableOnInteraction&&U()}),E("destroy",()=>{R(),s.autoplay.running&&k(),Ce().removeEventListener("visibilitychange",M)}),Object.assign(s.autoplay,{pause:u,run:U,start:G,stop:k})}function lt(s){return typeof s=="object"&&s!==null&&s.constructor&&Object.prototype.toString.call(s).slice(8,-1)==="Object"}function Ye(s,m){const E=["__proto__","constructor","prototype"];Object.keys(m).filter(x=>E.indexOf(x)<0).forEach(x=>{typeof s[x]>"u"?s[x]=m[x]:lt(m[x])&&lt(s[x])&&Object.keys(m[x]).length>0?m[x].__swiper__?s[x]=m[x]:Ye(s[x],m[x]):s[x]=m[x]})}function kt(s={}){return s.navigation&&typeof s.navigation.nextEl>"u"&&typeof s.navigation.prevEl>"u"}function Bt(s={}){return s.pagination&&typeof s.pagination.el>"u"}function Ut(s={}){return s.scrollbar&&typeof s.scrollbar.el>"u"}function xt(s=""){const m=s.split(" ").map(x=>x.trim()).filter(x=>!!x),E=[];return m.forEach(x=>{E.indexOf(x)<0&&E.push(x)}),E.join(" ")}const xr=["modules","init","_direction","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_preloadImages","updateOnImagesReady","_loop","_loopAdditionalSlides","_loopedSlides","_loopedSlidesLimit","_loopFillGroupWithBlank","loopPreventsSlide","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideBlankClass","slideActiveClass","slideDuplicateActiveClass","slideVisibleClass","slideDuplicateClass","slideNextClass","slideDuplicateNextClass","slidePrevClass","slideDuplicatePrevClass","wrapperClass","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","lazy","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom"];function Hn(s={},m=!0){const E={on:{}},x={},w={};Ye(E,Re.defaults),Ye(E,Re.extendedDefaults),E._emitClasses=!0,E.init=!1;const U={},G=xr.map(u=>u.replace(/_/,"")),k=Object.assign({},s);return Object.keys(k).forEach(u=>{typeof s[u]>"u"||(G.indexOf(u)>=0?lt(s[u])?(E[u]={},w[u]={},Ye(E[u],s[u]),Ye(w[u],s[u])):(E[u]=s[u],w[u]=s[u]):u.search(/on[A-Z]/)===0&&typeof s[u]=="function"?m?x[`${u[2].toLowerCase()}${u.substr(3)}`]=s[u]:E.on[`${u[2].toLowerCase()}${u.substr(3)}`]=s[u]:U[u]=s[u])}),["navigation","pagination","scrollbar"].forEach(u=>{E[u]===!0&&(E[u]={}),E[u]===!1&&delete E[u]}),{params:E,passedParams:w,rest:U,events:x}}function Vn({el:s,nextEl:m,prevEl:E,paginationEl:x,scrollbarEl:w,swiper:U},G){kt(G)&&m&&E&&(U.params.navigation.nextEl=m,U.originalParams.navigation.nextEl=m,U.params.navigation.prevEl=E,U.originalParams.navigation.prevEl=E),Bt(G)&&x&&(U.params.pagination.el=x,U.originalParams.pagination.el=x),Ut(G)&&w&&(U.params.scrollbar.el=w,U.originalParams.scrollbar.el=w),U.init(s)}function jn(s,m,E,x,w){const U=[];if(!m)return U;const G=u=>{U.indexOf(u)<0&&U.push(u)};if(E&&x){const u=x.map(w),M=E.map(w);u.join("")!==M.join("")&&G("children"),x.length!==E.length&&G("children")}return xr.filter(u=>u[0]==="_").map(u=>u.replace(/_/,"")).forEach(u=>{if(u in s&&u in m)if(lt(s[u])&&lt(m[u])){const M=Object.keys(s[u]),I=Object.keys(m[u]);M.length!==I.length?G(u):(M.forEach(b=>{s[u][b]!==m[u][b]&&G(u)}),I.forEach(b=>{s[u][b]!==m[u][b]&&G(u)}))}else s[u]!==m[u]&&G(u)}),U}function zn({swiper:s,slides:m,passedParams:E,changedParams:x,nextEl:w,prevEl:U,scrollbarEl:G,paginationEl:k}){const u=x.filter(y=>y!=="children"&&y!=="direction"),{params:M,pagination:I,navigation:b,scrollbar:P,virtual:F,thumbs:R}=s;let C,A,T,S,D;x.includes("thumbs")&&E.thumbs&&E.thumbs.swiper&&M.thumbs&&!M.thumbs.swiper&&(C=!0),x.includes("controller")&&E.controller&&E.controller.control&&M.controller&&!M.controller.control&&(A=!0),x.includes("pagination")&&E.pagination&&(E.pagination.el||k)&&(M.pagination||M.pagination===!1)&&I&&!I.el&&(T=!0),x.includes("scrollbar")&&E.scrollbar&&(E.scrollbar.el||G)&&(M.scrollbar||M.scrollbar===!1)&&P&&!P.el&&(S=!0),x.includes("navigation")&&E.navigation&&(E.navigation.prevEl||U)&&(E.navigation.nextEl||w)&&(M.navigation||M.navigation===!1)&&b&&!b.prevEl&&!b.nextEl&&(D=!0);const L=y=>{!s[y]||(s[y].destroy(),y==="navigation"?(M[y].prevEl=void 0,M[y].nextEl=void 0,s[y].prevEl=void 0,s[y].nextEl=void 0):(M[y].el=void 0,s[y].el=void 0))};u.forEach(y=>{if(lt(M[y])&&lt(E[y]))Ye(M[y],E[y]);else{const l=E[y];(l===!0||l===!1)&&(y==="navigation"||y==="pagination"||y==="scrollbar")?l===!1&&L(y):M[y]=E[y]}}),u.includes("controller")&&!A&&s.controller&&s.controller.control&&M.controller&&M.controller.control&&(s.controller.control=M.controller.control),x.includes("children")&&m&&F&&M.virtual.enabled?(F.slides=m,F.update(!0)):x.includes("children")&&s.lazy&&s.params.lazy.enabled&&s.lazy.load(),C&&R.init()&&R.update(!0),A&&(s.controller.control=M.controller.control),T&&(k&&(M.pagination.el=k),I.init(),I.render(),I.update()),S&&(G&&(M.scrollbar.el=G),P.init(),P.updateSize(),P.setTranslate()),D&&(w&&(M.navigation.nextEl=w),U&&(M.navigation.prevEl=U),b.init(),b.update()),x.includes("allowSlideNext")&&(s.allowSlideNext=E.allowSlideNext),x.includes("allowSlidePrev")&&(s.allowSlidePrev=E.allowSlidePrev),x.includes("direction")&&s.changeDirection(E.direction,!1),s.update()}const $n=s=>({virtualData:s&2048}),tr=s=>({virtualData:s[11]}),Yn=s=>({virtualData:s&2048}),rr=s=>({virtualData:s[11]}),Xn=s=>({virtualData:s&2048}),ir=s=>({virtualData:s[11]}),Qn=s=>({virtualData:s&2048}),nr=s=>({virtualData:s[11]}),Zn=s=>({virtualData:s&2048}),sr=s=>({virtualData:s[11]});function ar(s){let m,E,x;return{c(){m=ue("div"),E=Ee(),x=ue("div"),this.h()},l(w){m=fe(w,"DIV",{class:!0}),he(m).forEach(ne),E=Te(w),x=fe(w,"DIV",{class:!0}),he(x).forEach(ne),this.h()},h(){te(m,"class","swiper-button-prev"),te(x,"class","swiper-button-next")},m(w,U){ge(w,m,U),s[15](m),ge(w,E,U),ge(w,x,U),s[16](x)},p:Ve,d(w){w&&ne(m),s[15](null),w&&ne(E),w&&ne(x),s[16](null)}}}function or(s){let m;return{c(){m=ue("div"),this.h()},l(E){m=fe(E,"DIV",{class:!0}),he(m).forEach(ne),this.h()},h(){te(m,"class","swiper-scrollbar")},m(E,x){ge(E,m,x),s[17](m)},p:Ve,d(E){E&&ne(m),s[17](null)}}}function lr(s){let m;return{c(){m=ue("div"),this.h()},l(E){m=fe(E,"DIV",{class:!0}),he(m).forEach(ne),this.h()},h(){te(m,"class","swiper-pagination")},m(E,x){ge(E,m,x),s[18](m)},p:Ve,d(E){E&&ne(m),s[18](null)}}}function wt(s){let m,E,x,w,U,G,k=kt(s[4]),u,M=Ut(s[4]),I,b=Bt(s[4]),P,F,R;const C=s[14]["container-start"],A=it(C,s,s[13],sr),T=s[14]["wrapper-start"],S=it(T,s,s[13],nr),D=s[14].default,L=it(D,s,s[13],ir),y=s[14]["wrapper-end"],l=it(y,s,s[13],rr);let n=[{class:"swiper-wrapper"}],r={};for(let g=0;g<n.length;g+=1)r=ot(r,n[g]);let h=k&&ar(s),d=M&&or(s),e=b&&lr(s);const t=s[14]["container-end"],i=it(t,s,s[13],tr);let c=[{class:F=xt(`${s[3]}${s[0]?` ${s[0]}`:""}`)},s[5]],f={};for(let g=0;g<c.length;g+=1)f=ot(f,c[g]);return{c(){m=ue(s[1]),A&&A.c(),E=Ee(),x=ue(s[2]),S&&S.c(),w=Ee(),L&&L.c(),U=Ee(),l&&l.c(),G=Ee(),h&&h.c(),u=Ee(),d&&d.c(),I=Ee(),e&&e.c(),P=Ee(),i&&i.c(),this.h()},l(g){m=fe(g,(s[1]||"null").toUpperCase(),{class:!0});var a=he(m);A&&A.l(a),E=Te(a),x=fe(a,(s[2]||"null").toUpperCase(),{class:!0});var p=he(x);S&&S.l(p),w=Te(p),L&&L.l(p),U=Te(p),l&&l.l(p),p.forEach(ne),G=Te(a),h&&h.l(a),u=Te(a),d&&d.l(a),I=Te(a),e&&e.l(a),P=Te(a),i&&i.l(a),a.forEach(ne),this.h()},h(){/-/.test(s[2])?Et(x,r):ht(x,r),/-/.test(s[1])?Et(m,f):ht(m,f)},m(g,a){ge(g,m,a),A&&A.m(m,null),ae(m,E),ae(m,x),S&&S.m(x,null),ae(x,w),L&&L.m(x,null),ae(x,U),l&&l.m(x,null),ae(m,G),h&&h.m(m,null),ae(m,u),d&&d.m(m,null),ae(m,I),e&&e.m(m,null),ae(m,P),i&&i.m(m,null),s[19](m),R=!0},p(g,a){A&&A.p&&(!R||a&10240)&&nt(A,C,g,g[13],R?at(C,g[13],a,Zn):st(g[13]),sr),S&&S.p&&(!R||a&10240)&&nt(S,T,g,g[13],R?at(T,g[13],a,Qn):st(g[13]),nr),L&&L.p&&(!R||a&10240)&&nt(L,D,g,g[13],R?at(D,g[13],a,Xn):st(g[13]),ir),l&&l.p&&(!R||a&10240)&&nt(l,y,g,g[13],R?at(y,g[13],a,Yn):st(g[13]),rr),r=Ft(n,[{class:"swiper-wrapper"}]),/-/.test(g[2])?Et(x,r):ht(x,r),a&16&&(k=kt(g[4])),k?h?h.p(g,a):(h=ar(g),h.c(),h.m(m,u)):h&&(h.d(1),h=null),a&16&&(M=Ut(g[4])),M?d?d.p(g,a):(d=or(g),d.c(),d.m(m,I)):d&&(d.d(1),d=null),a&16&&(b=Bt(g[4])),b?e?e.p(g,a):(e=lr(g),e.c(),e.m(m,P)):e&&(e.d(1),e=null),i&&i.p&&(!R||a&10240)&&nt(i,t,g,g[13],R?at(t,g[13],a,$n):st(g[13]),tr),f=Ft(c,[(!R||a&9&&F!==(F=xt(`${g[3]}${g[0]?` ${g[0]}`:""}`)))&&{class:F},a&32&&g[5]]),/-/.test(g[1])?Et(m,f):ht(m,f)},i(g){R||(me(A,g),me(S,g),me(L,g),me(l,g),me(i,g),R=!0)},o(g){ye(A,g),ye(S,g),ye(L,g),ye(l,g),ye(i,g),R=!1},d(g){g&&ne(m),A&&A.d(g),S&&S.d(g),L&&L.d(g),l&&l.d(g),h&&h.d(),d&&d.d(),e&&e.d(),i&&i.d(g),s[19](null)}}}function Jn(s){let m=s[1],E,x,w=s[1]&&wt(s);return{c(){w&&w.c(),E=$t()},l(U){w&&w.l(U),E=$t()},m(U,G){w&&w.m(U,G),ge(U,E,G),x=!0},p(U,[G]){U[1]?m?Lt(m,U[1])?(w.d(1),w=wt(U),w.c(),w.m(E.parentNode,E)):w.p(U,G):(w=wt(U),w.c(),w.m(E.parentNode,E)):m&&(w.d(1),w=null),m=U[1]},i(U){x||(me(w),x=!0)},o(U){ye(w),x=!1},d(U){U&&ne(E),w&&w.d(U)}}}function qn(s,m,E){const x=["class","tag","wrapperTag","swiper"];let w=_t(m,x),{$$slots:U={},$$scope:G}=m;const k=Mr();let{class:u=void 0}=m,{tag:M="div"}=m,{wrapperTag:I="div"}=m,b="swiper",P=!1,F=null,R=null,C,A,T,S,D=null,L=null,y=null,l=null,n=null,r={slides:[]};function h(){return F}const d=p=>{E(11,r=p),Fr().then(()=>{F.$wrapperEl.children(".swiper-slide").each(v=>{v.onSwiper&&v.onSwiper(F)}),F.updateSlides(),F.updateProgress(),F.updateSlidesClasses(),F.lazy&&F.params.lazy.enabled&&F.lazy.load()})},e=()=>{C=Hn(w),E(4,A=C.params),T=C.passedParams,E(5,S=C.rest)};e(),R=T;const t=()=>{P=!0};if(A.onAny=(p,...v)=>{k(p,v)},Object.assign(A.on,{_beforeBreakpoint:t,_containerClasses(p,v){E(3,b=v)}}),F=new Re(A),wr("swiper",F),F.virtual&&F.params.virtual.enabled){const p={cache:!1,renderExternal:v=>{d(v),A.virtual&&A.virtual.renderExternal&&A.virtual.renderExternal(v)},renderExternalUpdate:!1};Ye(F.params.virtual,p),Ye(F.originalParams.virtual,p)}Gt(()=>{!D||(Vn({el:D,nextEl:y,prevEl:L,paginationEl:n,scrollbarEl:l,swiper:F},A),k("swiper",[F]),!A.virtual&&F.slides.each(p=>{p.onSwiper&&p.onSwiper(F)}))}),cr(()=>{if(!F)return;e();const p=jn(T,R);(p.length||P)&&F&&!F.destroyed&&zn({swiper:F,passedParams:T,changedParams:p,nextEl:y,prevEl:L,scrollbarEl:l,paginationEl:n}),P=!1,R=T}),hr(()=>{typeof window<"u"&&F&&!F.destroyed&&F.destroy(!0,!1)});function i(p){ct[p?"unshift":"push"](()=>{L=p,E(7,L)})}function c(p){ct[p?"unshift":"push"](()=>{y=p,E(8,y)})}function f(p){ct[p?"unshift":"push"](()=>{l=p,E(9,l)})}function g(p){ct[p?"unshift":"push"](()=>{n=p,E(10,n)})}function a(p){ct[p?"unshift":"push"](()=>{D=p,E(6,D)})}return s.$$set=p=>{m=ot(ot({},m),vr(p)),E(29,w=_t(m,x)),"class"in p&&E(0,u=p.class),"tag"in p&&E(1,M=p.tag),"wrapperTag"in p&&E(2,I=p.wrapperTag),"$$scope"in p&&E(13,G=p.$$scope)},[u,M,I,b,A,S,D,L,y,l,n,r,h,G,U,i,c,f,g,a]}class es extends Nt{constructor(m){super(),Kt(this,m,qn,Jn,Lt,{class:0,tag:1,wrapperTag:2,swiper:12})}get swiper(){return this.$$.ctx[12]}}const ts=s=>({data:s&32}),ur=s=>({data:s[5]}),rs=s=>({data:s&32}),fr=s=>({data:s[5]});function is(s){let m;const E=s[8].default,x=it(E,s,s[7],ur);return{c(){x&&x.c()},l(w){x&&x.l(w)},m(w,U){x&&x.m(w,U),m=!0},p(w,U){x&&x.p&&(!m||U&160)&&nt(x,E,w,w[7],m?at(E,w[7],U,ts):st(w[7]),ur)},i(w){m||(me(x,w),m=!0)},o(w){ye(x,w),m=!1},d(w){x&&x.d(w)}}}function ns(s){let m,E,x;const w=s[8].default,U=it(w,s,s[7],fr);return{c(){m=ue("div"),U&&U.c(),this.h()},l(G){m=fe(G,"DIV",{class:!0,"data-swiper-zoom":!0});var k=he(m);U&&U.l(k),k.forEach(ne),this.h()},h(){te(m,"class","swiper-zoom-container"),te(m,"data-swiper-zoom",E=typeof s[0]=="number"?s[0]:void 0)},m(G,k){ge(G,m,k),U&&U.m(m,null),x=!0},p(G,k){U&&U.p&&(!x||k&160)&&nt(U,w,G,G[7],x?at(w,G[7],k,rs):st(G[7]),fr),(!x||k&1&&E!==(E=typeof G[0]=="number"?G[0]:void 0))&&te(m,"data-swiper-zoom",E)},i(G){x||(me(U,G),x=!0)},o(G){ye(U,G),x=!1},d(G){G&&ne(m),U&&U.d(G)}}}function ss(s){let m,E,x,w,U;const G=[ns,is],k=[];function u(b,P){return b[0]?0:1}E=u(s),x=k[E]=G[E](s);let M=[{class:w=xt(`${s[3]}${s[2]?` ${s[2]}`:""}`)},{"data-swiper-slide-index":s[1]},s[6]],I={};for(let b=0;b<M.length;b+=1)I=ot(I,M[b]);return{c(){m=ue("div"),x.c(),this.h()},l(b){m=fe(b,"DIV",{class:!0,"data-swiper-slide-index":!0});var P=he(m);x.l(P),P.forEach(ne),this.h()},h(){ht(m,I)},m(b,P){ge(b,m,P),k[E].m(m,null),s[9](m),U=!0},p(b,[P]){let F=E;E=u(b),E===F?k[E].p(b,P):(gr(),ye(k[F],1,1,()=>{k[F]=null}),pr(),x=k[E],x?x.p(b,P):(x=k[E]=G[E](b),x.c()),me(x,1),x.m(m,null)),ht(m,I=Ft(M,[(!U||P&12&&w!==(w=xt(`${b[3]}${b[2]?` ${b[2]}`:""}`)))&&{class:w},(!U||P&2)&&{"data-swiper-slide-index":b[1]},P&64&&b[6]]))},i(b){U||(me(x),U=!0)},o(b){ye(x),U=!1},d(b){b&&ne(m),k[E].d(),s[9](null)}}}function as(s,m,E){let x;const w=["zoom","virtualIndex","class"];let U=_t(m,w),{$$slots:G={},$$scope:k}=m,{zoom:u=void 0}=m,{virtualIndex:M=void 0}=m,{class:I=void 0}=m,b=null,P="swiper-slide",F=kr("swiper"),R=!1;const C=(D,L,y)=>{L===b&&E(3,P=y)},A=()=>{!F||R||(F.on("_slideClass",C),R=!0)},T=()=>{!F||(F.off("_slideClass",C),R=!1)};Gt(()=>{typeof M>"u"||(E(4,b.onSwiper=D=>{F=D,A()},b),A())}),cr(()=>{if(!(!b||!F)){if(F.destroyed){P!=="swiper-slide"&&E(3,P="swiper-slide");return}A()}}),Br(()=>{A()}),hr(()=>{!F||T()});function S(D){ct[D?"unshift":"push"](()=>{b=D,E(4,b)})}return s.$$set=D=>{m=ot(ot({},m),vr(D)),E(6,U=_t(m,w)),"zoom"in D&&E(0,u=D.zoom),"virtualIndex"in D&&E(1,M=D.virtualIndex),"class"in D&&E(2,I=D.class),"$$scope"in D&&E(7,k=D.$$scope)},s.$$.update=()=>{s.$$.dirty&8&&E(5,x={isActive:P.indexOf("swiper-slide-active")>=0||P.indexOf("swiper-slide-duplicate-active")>=0,isVisible:P.indexOf("swiper-slide-visible")>=0,isDuplicate:P.indexOf("swiper-slide-duplicate")>=0,isPrev:P.indexOf("swiper-slide-prev")>=0||P.indexOf("swiper-slide-duplicate-prev")>=0,isNext:P.indexOf("swiper-slide-next")>=0||P.indexOf("swiper-slide-duplicate-next")>=0})},[u,M,I,P,b,x,U,k,G,S]}class dt extends Nt{constructor(m){super(),Kt(this,m,as,ss,Lt,{zoom:0,virtualIndex:1,class:2})}}var Lr={exports:{}};(function(s,m){typeof window<"u"&&function(x,w){s.exports=w()}(Ur,()=>(()=>{var E={"./src/config.ts":(G,k,u)=>{u.r(k),u.d(k,{enableStreamingMode:()=>g,hlsDefaultConfig:()=>i,mergeConfig:()=>f});var M=u("./src/controller/abr-controller.ts"),I=u("./src/controller/audio-stream-controller.ts"),b=u("./src/controller/audio-track-controller.ts"),P=u("./src/controller/subtitle-stream-controller.ts"),F=u("./src/controller/subtitle-track-controller.ts"),R=u("./src/controller/buffer-controller.ts"),C=u("./src/controller/timeline-controller.ts"),A=u("./src/controller/cap-level-controller.ts"),T=u("./src/controller/fps-controller.ts"),S=u("./src/controller/eme-controller.ts"),D=u("./src/controller/cmcd-controller.ts"),L=u("./src/utils/xhr-loader.ts"),y=u("./src/utils/fetch-loader.ts"),l=u("./src/utils/cues.ts"),n=u("./src/utils/mediakeys-helper.ts"),r=u("./src/utils/logger.ts");function h(){return h=Object.assign?Object.assign.bind():function(a){for(var p=1;p<arguments.length;p++){var v=arguments[p];for(var o in v)Object.prototype.hasOwnProperty.call(v,o)&&(a[o]=v[o])}return a},h.apply(this,arguments)}function d(a,p){var v=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);p&&(o=o.filter(function(_){return Object.getOwnPropertyDescriptor(a,_).enumerable})),v.push.apply(v,o)}return v}function e(a){for(var p=1;p<arguments.length;p++){var v=arguments[p]!=null?arguments[p]:{};p%2?d(Object(v),!0).forEach(function(o){t(a,o,v[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(v)):d(Object(v)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(v,o))})}return a}function t(a,p,v){return p in a?Object.defineProperty(a,p,{value:v,enumerable:!0,configurable:!0,writable:!0}):a[p]=v,a}var i=e(e({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:L.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:R.default,capLevelController:A.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:n.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},c()),{},{subtitleStreamController:P.SubtitleStreamController,subtitleTrackController:F.default,timelineController:C.TimelineController,audioStreamController:I.default,audioTrackController:b.default,emeController:S.default,cmcdController:D.default});function c(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function f(a,p){if((p.liveSyncDurationCount||p.liveMaxLatencyDurationCount)&&(p.liveSyncDuration||p.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(p.liveMaxLatencyDurationCount!==void 0&&(p.liveSyncDurationCount===void 0||p.liveMaxLatencyDurationCount<=p.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(p.liveMaxLatencyDuration!==void 0&&(p.liveSyncDuration===void 0||p.liveMaxLatencyDuration<=p.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return h({},a,p)}function g(a){var p=a.loader;if(p!==y.default&&p!==L.default)r.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var v=(0,y.fetchSupported)();v&&(a.loader=y.default,a.progressive=!0,a.enableSoftwareAES=!0,r.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>S});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/ewma-bandwidth-estimator.ts"),b=u("./src/events.ts"),P=u("./src/errors.ts"),F=u("./src/types/loader.ts"),R=u("./src/utils/logger.ts");function C(D,L){for(var y=0;y<L.length;y++){var l=L[y];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(D,l.key,l)}}function A(D,L,y){return L&&C(D.prototype,L),y&&C(D,y),Object.defineProperty(D,"prototype",{writable:!1}),D}var T=function(){function D(y){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=y;var l=y.config;this.bwEstimator=new I.default(l.abrEwmaSlowVoD,l.abrEwmaFastVoD,l.abrEwmaDefaultEstimate),this.registerListeners()}var L=D.prototype;return L.registerListeners=function(){var l=this.hls;l.on(b.Events.FRAG_LOADING,this.onFragLoading,this),l.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(b.Events.ERROR,this.onError,this)},L.unregisterListeners=function(){var l=this.hls;l.off(b.Events.FRAG_LOADING,this.onFragLoading,this),l.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(b.Events.ERROR,this.onError,this)},L.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},L.onFragLoading=function(l,n){var r=n.frag;if(r.type===F.PlaylistLevelType.MAIN&&!this.timer){var h;this.fragCurrent=r,this.partCurrent=(h=n.part)!=null?h:null,this.timer=self.setInterval(this.onCheck,100)}},L.onLevelLoaded=function(l,n){var r=this.hls.config;n.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},L._abandonRulesCheck=function(){var l=this.fragCurrent,n=this.partCurrent,r=this.hls,h=r.autoLevelEnabled;r.config;var d=r.media;if(!(!l||!d)){var e=n?n.stats:l.stats,t=n?n.duration:l.duration;if(e.aborted||e.loaded&&e.loaded===e.total||l.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!h||d.paused||!d.playbackRate||!d.readyState)){var i=r.mainForwardBufferInfo;if(i!==null){var c=performance.now()-e.loading.start,f=Math.abs(d.playbackRate);if(!(c<=500*t/f)){var g=e.loaded&&e.loading.first,a=this.bwEstimator.getEstimate(),p=r.levels,v=r.minAutoLevel,o=p[l.level],_=e.total||Math.max(e.loaded,Math.round(t*o.maxBitrate/8)),O=g?e.loaded*1e3/c:0,B=O?(_-e.loaded)/O:_*8/a,K=i.len/f;if(!(B<=K)){var N=Number.POSITIVE_INFINITY,W;for(W=l.level-1;W>v;W--){var H=p[W].maxBitrate;if(N=O?t*H/(8*.8*O):t*H/a,N<K)break}N>=B||(R.logger.warn("Fragment "+l.sn+(n?" part "+n.index:"")+" of level "+l.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+W+`
      Current BW estimate: `+((0,M.isFiniteNumber)(a)?(a/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+B.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+K.toFixed(3)+" s"),r.nextLoadLevel=W,g&&this.bwEstimator.sample(c,e.loaded),this.clearTimer(),l.loader&&(this.fragCurrent=this.partCurrent=null,l.loader.abort()),r.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:n,stats:e}))}}}}}},L.onFragLoaded=function(l,n){var r=n.frag,h=n.part;if(r.type===F.PlaylistLevelType.MAIN&&(0,M.isFiniteNumber)(r.sn)){var d=h?h.stats:r.stats,e=h?h.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var t=this.hls.levels[r.level],i=(t.loaded?t.loaded.bytes:0)+d.loaded,c=(t.loaded?t.loaded.duration:0)+e;t.loaded={bytes:i,duration:c},t.realBitrate=Math.round(8*i/c)}if(r.bitrateTest){var f={stats:d,frag:r,part:h,id:r.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,f)}}},L.onFragBuffered=function(l,n){var r=n.frag,h=n.part,d=h?h.stats:r.stats;if(!d.aborted&&!(r.type!==F.PlaylistLevelType.MAIN||r.sn==="initSegment")){var e=d.parsing.end-d.loading.start;this.bwEstimator.sample(e,d.loaded),d.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}},L.onError=function(l,n){switch(n.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},L.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},L.getNextABRAutoLevel=function(){var l=this.fragCurrent,n=this.partCurrent,r=this.hls,h=r.maxAutoLevel,d=r.config,e=r.minAutoLevel,t=r.media,i=n?n.duration:l?l.duration:0;t&&t.currentTime;var c=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,g=r.mainForwardBufferInfo,a=(g?g.len:0)/c,p=this.findBestLevel(f,e,h,a,d.abrBandWidthFactor,d.abrBandWidthUpFactor);if(p>=0)return p;R.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=i?Math.min(i,d.maxStarvationDelay):d.maxStarvationDelay,o=d.abrBandWidthFactor,_=d.abrBandWidthUpFactor;if(!a){var O=this.bitrateTestDelay;if(O){var B=i?Math.min(i,d.maxLoadingDelay):d.maxLoadingDelay;v=B-O,R.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),o=_=1}}return p=this.findBestLevel(f,e,h,a+v,o,_),Math.max(p,0)},L.findBestLevel=function(l,n,r,h,d,e){for(var t,i=this.fragCurrent,c=this.partCurrent,f=this.lastLoadedFragLevel,g=this.hls.levels,a=g[f],p=!!(a!=null&&(t=a.details)!==null&&t!==void 0&&t.live),v=a==null?void 0:a.codecSet,o=c?c.duration:i?i.duration:0,_=r;_>=n;_--){var O=g[_];if(!(!O||v&&O.codecSet!==v)){var B=O.details,K=(c?B==null?void 0:B.partTarget:B==null?void 0:B.averagetargetduration)||o,N=void 0;_<=f?N=d*l:N=e*l;var W=g[_].maxBitrate,H=W*K/N;if(R.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+_+"/"+Math.round(N)+"/"+W+"/"+K+"/"+h+"/"+H),N>W&&(H===0||!(0,M.isFiniteNumber)(H)||p&&!this.bitrateTestDelay||H<h))return _}}return-1},A(D,[{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,n=this.bwEstimator;if(l!==-1&&!n.canEstimate())return l;var r=this.getNextABRAutoLevel();return l!==-1&&this.hls.levels[r].loadError?l:(l!==-1&&(r=Math.min(l,r)),r)},set:function(l){this._nextAutoLevel=l}}]),D}();const S=T},"./src/controller/audio-stream-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>t});var M=u("./src/polyfills/number.ts"),I=u("./src/controller/base-stream-controller.ts"),b=u("./src/events.ts"),P=u("./src/utils/buffer-helper.ts"),F=u("./src/controller/fragment-tracker.ts"),R=u("./src/types/level.ts"),C=u("./src/types/loader.ts"),A=u("./src/loader/fragment.ts"),T=u("./src/demux/chunk-cache.ts"),S=u("./src/demux/transmuxer-interface.ts"),D=u("./src/types/transmuxer.ts"),L=u("./src/controller/fragment-finders.ts"),y=u("./src/utils/discontinuities.ts"),l=u("./src/errors.ts");function n(){return n=Object.assign?Object.assign.bind():function(i){for(var c=1;c<arguments.length;c++){var f=arguments[c];for(var g in f)Object.prototype.hasOwnProperty.call(f,g)&&(i[g]=f[g])}return i},n.apply(this,arguments)}function r(i,c){i.prototype=Object.create(c.prototype),i.prototype.constructor=i,h(i,c)}function h(i,c){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,a){return g.__proto__=a,g},h(i,c)}var d=100,e=function(i){r(c,i);function c(g,a){var p;return p=i.call(this,g,a,"[audio-stream-controller]")||this,p.videoBuffer=null,p.videoTrackCC=-1,p.waitingVideoCC=-1,p.audioSwitch=!1,p.trackId=-1,p.waitingData=null,p.mainDetails=null,p.bufferFlushed=!1,p.cachedTrackLoadedData=null,p._registerListeners(),p}var f=c.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var a=this.hls;a.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(b.Events.ERROR,this.onError,this),a.on(b.Events.BUFFER_RESET,this.onBufferReset,this),a.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var a=this.hls;a.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(b.Events.ERROR,this.onError,this),a.off(b.Events.BUFFER_RESET,this.onBufferReset,this),a.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f.onInitPtsFound=function(a,p){var v=p.frag,o=p.id,_=p.initPTS;if(o==="main"){var O=v.cc;this.initPTS[v.cc]=_,this.log("InitPTS for cc: "+O+" found from main: "+_),this.videoTrackCC=O,this.state===I.State.WAITING_INIT_PTS&&this.tick()}},f.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=I.State.STOPPED;return}var p=this.lastCurrentTime;this.stopLoad(),this.setInterval(d),this.fragLoadError=0,p>0&&a===-1?(this.log("Override startPosition with lastCurrentTime @"+p.toFixed(3)),a=p,this.state=I.State.IDLE):(this.loadedmetadata=!1,this.state=I.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},f.doTick=function(){switch(this.state){case I.State.IDLE:this.doTickIdle();break;case I.State.WAITING_TRACK:{var a,p=this.levels,v=this.trackId,o=p==null||(a=p[v])===null||a===void 0?void 0:a.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=I.State.WAITING_INIT_PTS}break}case I.State.FRAG_LOADING_WAITING_RETRY:{var _,O=performance.now(),B=this.retryDate;(!B||O>=B||(_=this.media)!==null&&_!==void 0&&_.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=I.State.IDLE);break}case I.State.WAITING_INIT_PTS:{var K=this.waitingData;if(K){var N=K.frag,W=K.part,H=K.cache,V=K.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=I.State.FRAG_LOADING;var j=H.flush(),z={frag:N,part:W,payload:j,networkDetails:null};this._handleFragmentLoadProgress(z),V&&i.prototype._handleFragmentLoadComplete.call(this,z)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var $=this.getLoadPosition(),Y=P.BufferHelper.bufferInfo(this.mediaBuffer,$,this.config.maxBufferHole),X=(0,L.fragmentWithinToleranceTest)(Y.end,this.config.maxFragLookUpTolerance,N);X<0&&(this.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+Y.end+" is needed"),this.clearWaitingFragment())}}else this.state=I.State.IDLE}}this.onTickEnd()},f.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=I.State.IDLE)},f.resetLoadingState=function(){this.clearWaitingFragment(),i.prototype.resetLoadingState.call(this)},f.onTickEnd=function(){var a=this.media;if(!(!a||!a.readyState)){var p=this.mediaBuffer?this.mediaBuffer:a,v=p.buffered;!this.loadedmetadata&&v.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},f.doTickIdle=function(){var a,p,v=this.hls,o=this.levels,_=this.media,O=this.trackId,B=v.config;if(!(!o||!o[O])&&!(!_&&(this.startFragRequested||!B.startFragPrefetch))){var K=o[O],N=K.details;if(!N||N.live&&this.levelLastLoaded!==O||this.waitForCdnTuneIn(N)){this.state=I.State.WAITING_TRACK;return}var W=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&W&&(this.bufferFlushed=!1,this.afterBufferFlushed(W,A.ElementaryStreamTypes.AUDIO,C.PlaylistLevelType.AUDIO));var H=this.getFwdBufferInfo(W,C.PlaylistLevelType.AUDIO);if(H!==null){var V=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,C.PlaylistLevelType.MAIN),j=H.len,z=this.getMaxBufferLength(V==null?void 0:V.len),$=this.audioSwitch;if(!(j>=z&&!$)){if(!$&&this._streamEnded(H,N)){v.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=I.State.ENDED;return}var Y=N.fragments,X=Y[0].start,Q=H.end;if($&&_){var q=this.getLoadPosition();Q=q,N.PTSKnown&&q<X&&(H.end>X||H.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),_.currentTime=X+.05)}if(!(V&&Q>V.end+N.targetduration)&&!((!V||!V.len)&&H.len)){var J=this.getNextFragment(Q,N);if(!J){this.bufferFlushed=!0;return}((a=J.decryptdata)===null||a===void 0?void 0:a.keyFormat)==="identity"&&!((p=J.decryptdata)!==null&&p!==void 0&&p.key)?this.loadKey(J,N):this.loadFragment(J,N,Q)}}}}},f.getMaxBufferLength=function(a){var p=i.prototype.getMaxBufferLength.call(this);return a?Math.max(p,a):p},f.onMediaDetaching=function(){this.videoBuffer=null,i.prototype.onMediaDetaching.call(this)},f.onAudioTracksUpdated=function(a,p){var v=p.audioTracks;this.resetTransmuxer(),this.levels=v.map(function(o){return new R.Level(o)})},f.onAudioTrackSwitching=function(a,p){var v=!!p.url;this.trackId=p.id;var o=this.fragCurrent;o!=null&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),v?this.setInterval(d):this.resetTransmuxer(),v?(this.audioSwitch=!0,this.state=I.State.IDLE):this.state=I.State.STOPPED,this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},f.onLevelLoaded=function(a,p){this.mainDetails=p.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},f.onAudioTrackLoaded=function(a,p){var v;if(this.mainDetails==null){this.cachedTrackLoadedData=p;return}var o=this.levels,_=p.details,O=p.id;if(!o){this.warn("Audio tracks were reset while loading level "+O);return}this.log("Track "+O+" loaded ["+_.startSN+","+_.endSN+"],duration:"+_.totalduration);var B=o[O],K=0;if(_.live||(v=B.details)!==null&&v!==void 0&&v.live){var N=this.mainDetails;if(_.fragments[0]||(_.deltaUpdateFailed=!0),_.deltaUpdateFailed||!N)return;!B.details&&_.hasProgramDateTime&&N.hasProgramDateTime?((0,y.alignMediaPlaylistByPDT)(_,N),K=_.fragments[0].start):K=this.alignPlaylists(_,B.details)}B.details=_,this.levelLastLoaded=O,!this.startFragRequested&&(this.mainDetails||!_.live)&&this.setStartPosition(B.details,K),this.state===I.State.WAITING_TRACK&&!this.waitForCdnTuneIn(_)&&(this.state=I.State.IDLE),this.tick()},f._handleFragmentLoadProgress=function(a){var p,v=a.frag,o=a.part,_=a.payload,O=this.config,B=this.trackId,K=this.levels;if(!K){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered");return}var N=K[B];console.assert(N,"Audio track is defined on fragment load progress");var W=N.details;console.assert(W,"Audio track details are defined on fragment load progress");var H=O.defaultAudioCodec||N.audioCodec||"mp4a.40.2",V=this.transmuxer;V||(V=this.transmuxer=new S.default(this.hls,C.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var j=this.initPTS[v.cc],z=(p=v.initSegment)===null||p===void 0?void 0:p.data;if(j!==void 0){var $=!1,Y=o?o.index:-1,X=Y!==-1,Q=new D.ChunkMetadata(v.level,v.sn,v.stats.chunkCount,_.byteLength,Y,X);V.push(_,z,H,"",v,o,W.totalduration,$,Q,j)}else{this.log("Unknown video PTS for cc "+v.cc+", waiting for video PTS before demuxing audio frag "+v.sn+" of ["+W.startSN+" ,"+W.endSN+"],track "+B);var q=this.waitingData=this.waitingData||{frag:v,part:o,cache:new T.default,complete:!1},J=q.cache;J.push(new Uint8Array(_)),this.waitingVideoCC=this.videoTrackCC,this.state=I.State.WAITING_INIT_PTS}},f._handleFragmentLoadComplete=function(a){if(this.waitingData){this.waitingData.complete=!0;return}i.prototype._handleFragmentLoadComplete.call(this,a)},f.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},f.onBufferCreated=function(a,p){var v=p.tracks.audio;v&&(this.mediaBuffer=v.buffer||null),p.tracks.video&&(this.videoBuffer=p.tracks.video.buffer||null)},f.onFragBuffered=function(a,p){var v=p.frag,o=p.part;if(v.type===C.PlaylistLevelType.AUDIO){if(this.fragContextChanged(v)){this.warn("Fragment "+v.sn+(o?" p: "+o.index:"")+" of level "+v.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}v.sn!=="initSegment"&&(this.fragPrevious=v,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(v,o)}},f.onError=function(a,p){switch(p.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.AUDIO,p);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==I.State.ERROR&&this.state!==I.State.STOPPED&&(this.state=p.fatal?I.State.ERROR:I.State.IDLE,this.warn(p.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(p.parent==="audio"&&(this.state===I.State.PARSING||this.state===I.State.PARSED)){var v=!0,o=this.getFwdBufferInfo(this.mediaBuffer,C.PlaylistLevelType.AUDIO);o&&o.len>.5&&(v=!this.reduceMaxBufferLength(o.len)),v&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},f.onBufferFlushed=function(a,p){var v=p.type;v===A.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},f._handleTransmuxComplete=function(a){var p,v="audio",o=this.hls,_=a.remuxResult,O=a.chunkMeta,B=this.getCurrentContext(O);if(!B){this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(O.level);return}var K=B.frag,N=B.part,W=B.level.details,H=_.audio,V=_.text,j=_.id3,z=_.initSegment;if(!(this.fragContextChanged(K)||!W)){if(this.state=I.State.PARSING,this.audioSwitch&&H&&this.completeAudioSwitch(),z!=null&&z.tracks&&(this._bufferInitSegment(z.tracks,K,O),o.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:K,id:v,tracks:z.tracks})),H){var $=H.startPTS,Y=H.endPTS,X=H.startDTS,Q=H.endDTS;N&&(N.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:$,endPTS:Y,startDTS:X,endDTS:Q}),K.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,$,Y,X,Q),this.bufferFragmentData(H,K,N,O)}if(j!=null&&(p=j.samples)!==null&&p!==void 0&&p.length){var q=n({id:v,frag:K,details:W},j);o.trigger(b.Events.FRAG_PARSING_METADATA,q)}if(V){var J=n({id:v,frag:K,details:W},V);o.trigger(b.Events.FRAG_PARSING_USERDATA,J)}}},f._bufferInitSegment=function(a,p,v){if(this.state===I.State.PARSING){a.video&&delete a.video;var o=a.audio;if(!!o){o.levelCodec=o.codec,o.id="audio",this.log("Init audio buffer, container:"+o.container+", codecs[parsed]=["+o.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,a);var _=o.initSegment;if(_!=null&&_.byteLength){var O={type:"audio",frag:p,part:null,chunkMeta:v,parent:p.type,data:_};this.hls.trigger(b.Events.BUFFER_APPENDING,O)}this.tick()}}},f.loadFragment=function(a,p,v){var o=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||o===F.FragmentState.NOT_LOADED||o===F.FragmentState.PARTIAL)&&(a.sn==="initSegment"?this._loadInitSegment(a):p.live&&!(0,M.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=I.State.WAITING_INIT_PTS):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,a,p,v)))},f.completeAudioSwitch=function(){var a=this.hls,p=this.media,v=this.trackId;p&&(this.log("Switching audio track : flushing all audio"),i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:v})},c}(I.default);const t=e},"./src/controller/audio-track-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>S});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/controller/base-playlist-controller.ts"),P=u("./src/types/loader.ts");function F(D,L){for(var y=0;y<L.length;y++){var l=L[y];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(D,l.key,l)}}function R(D,L,y){return L&&F(D.prototype,L),y&&F(D,y),Object.defineProperty(D,"prototype",{writable:!1}),D}function C(D,L){D.prototype=Object.create(L.prototype),D.prototype.constructor=D,A(D,L)}function A(D,L){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,n){return l.__proto__=n,l},A(D,L)}var T=function(D){C(L,D);function L(l){var n;return n=D.call(this,l,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var y=L.prototype;return y.registerListeners=function(){var n=this.hls;n.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(M.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){var n=this.hls;n.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(M.Events.ERROR,this.onError,this)},y.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,D.prototype.destroy.call(this)},y.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},y.onManifestParsed=function(n,r){this.tracks=r.audioTracks||[]},y.onAudioTrackLoaded=function(n,r){var h=r.id,d=r.details,e=this.tracksInGroup[h];if(!e){this.warn("Invalid audio track id "+h);return}var t=e.details;e.details=r.details,this.log("audioTrack "+h+" loaded ["+d.startSN+"-"+d.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,r,t))},y.onLevelLoading=function(n,r){this.switchLevel(r.level)},y.onLevelSwitching=function(n,r){this.switchLevel(r.level)},y.switchLevel=function(n){var r=this.hls.levels[n];if(!!(r!=null&&r.audioGroupIds)){var h=r.audioGroupIds[r.urlId];if(this.groupId!==h){this.groupId=h;var d=this.tracks.filter(function(t){return!h||t.groupId===h});this.selectDefaultTrack&&!d.some(function(t){return t.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=d;var e={audioTracks:d};this.log("Updating audio tracks, "+d.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,e),this.selectInitialTrack()}}},y.onError=function(n,r){D.prototype.onError.call(this,n,r),!(r.fatal||!r.context)&&r.context.type===P.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},y.setAudioTrack=function(n){var r=this.tracksInGroup;if(n<0||n>=r.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var h=r[this.trackId];this.log("Now switching to audio-track index "+n);var d=r[n],e=d.id,t=d.groupId,i=t===void 0?"":t,c=d.name,f=d.type,g=d.url;if(this.trackId=n,this.trackName=c,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:e,groupId:i,name:c,type:f,url:g}),!(d.details&&!d.details.live)){var a=this.switchParams(d.url,h==null?void 0:h.details);this.loadPlaylist(a)}},y.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var r=this.trackName,h=this.findTrackId(r)||this.findTrackId();h!==-1?this.setAudioTrack(h):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},y.findTrackId=function(n){for(var r=this.tracksInGroup,h=0;h<r.length;h++){var d=r[h];if((!this.selectDefaultTrack||d.default)&&(!n||n===d.name))return d.id}return-1},y.loadPlaylist=function(n){var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var h=r.id,d=r.groupId,e=r.url;if(n)try{e=n.addDirectives(e)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+h),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:e,id:h,groupId:d,deliveryDirectives:n||null})}},R(L,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),L}(b.default);const S=T},"./src/controller/base-playlist-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>R});var M=u("./src/polyfills/number.ts"),I=u("./src/types/level.ts"),b=u("./src/controller/level-helper.ts"),P=u("./src/utils/logger.ts"),F=u("./src/errors.ts"),R=function(){function C(T,S){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=P.logger.log.bind(P.logger,S+":"),this.warn=P.logger.warn.bind(P.logger,S+":"),this.hls=T}var A=C.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(S,D){D.fatal&&D.type===F.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(S,D){var L=D==null?void 0:D.renditionReports;if(L)for(var y=0;y<L.length;y++){var l=L[y],n=""+l.URI;if(n===S.slice(-n.length)){var r=parseInt(l["LAST-MSN"]),h=parseInt(l["LAST-PART"]);if(D&&this.hls.config.lowLatencyMode){var d=Math.min(D.age-D.partTarget,D.targetduration);h!==void 0&&d>D.partTarget&&(h+=1)}if((0,M.isFiniteNumber)(r))return new I.HlsUrlParameters(r,(0,M.isFiniteNumber)(h)?h:void 0,I.HlsSkip.No)}}},A.loadPlaylist=function(S){},A.shouldLoadTrack=function(S){return this.canLoad&&S&&!!S.url&&(!S.details||S.details.live)},A.playlistLoaded=function(S,D,L){var y=this,l=D.details,n=D.stats,r=n.loading.end?Math.max(0,self.performance.now()-n.loading.end):0;if(l.advancedDateTime=Date.now()-r,l.live||L!=null&&L.live){if(l.reloaded(L),L&&this.log("live playlist "+S+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),L&&l.fragments.length>0&&(0,b.mergeDetails)(L,l),!this.canLoad||!l.live)return;var h,d=void 0,e=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var t=this.hls.config.lowLatencyMode,i=l.lastPartSn,c=l.endSN,f=l.lastPartIndex,g=f!==-1,a=i===c,p=t?0:f;g?(d=a?c+1:i,e=a?p:f+1):d=c+1;var v=l.age,o=v+l.ageHeader,_=Math.min(o-l.partTarget,l.targetduration*1.5);if(_>0){if(L&&_>L.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+L.tuneInGoal+" to: "+_+" with playlist age: "+l.age),_=0;else{var O=Math.floor(_/l.targetduration);if(d+=O,e!==void 0){var B=Math.round(_%l.targetduration/l.partTarget);e+=B}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+v.toFixed(2)+"s goal: "+_+" skip sn "+O+" to part "+e)}l.tuneInGoal=_}if(h=this.getDeliveryDirectives(l,D.deliveryDirectives,d,e),t||!a){this.loadPlaylist(h);return}}else h=this.getDeliveryDirectives(l,D.deliveryDirectives,d,e);var K=(0,b.computeReloadInterval)(l,n);d!==void 0&&l.canBlockReload&&(K-=l.partTarget||1),this.log("reload live playlist "+S+" in "+Math.round(K)+" ms"),this.timer=self.setTimeout(function(){return y.loadPlaylist(h)},K)}else this.clearTimer()},A.getDeliveryDirectives=function(S,D,L,y){var l=(0,I.getSkipValue)(S,L);return D!=null&&D.skip&&S.deltaUpdateFailed&&(L=D.msn,y=D.part,l=I.HlsSkip.No),new I.HlsUrlParameters(L,y,l)},A.retryLoadingOrFail=function(S){var D=this,L=this.hls.config,y=this.retryCount<L.levelLoadingMaxRetry;if(y){var l;if(this.retryCount++,S.details.indexOf("LoadTimeOut")>-1&&(l=S.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+S.details+'"'),this.loadPlaylist();else{var n=Math.min(Math.pow(2,this.retryCount)*L.levelLoadingRetryDelay,L.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return D.loadPlaylist()},n),this.warn("retry playlist loading #"+this.retryCount+" in "+n+' ms after "'+S.details+'"')}}else this.warn('cannot recover from error "'+S.details+'"'),this.clearTimer(),S.fatal=!0;return y},C}()},"./src/controller/base-stream-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{State:()=>c,default:()=>f});var M=u("./src/polyfills/number.ts"),I=u("./src/task-loop.ts"),b=u("./src/controller/fragment-tracker.ts"),P=u("./src/utils/buffer-helper.ts"),F=u("./src/utils/logger.ts"),R=u("./src/events.ts"),C=u("./src/errors.ts"),A=u("./src/types/transmuxer.ts"),T=u("./src/utils/mp4-tools.ts"),S=u("./src/utils/discontinuities.ts"),D=u("./src/controller/fragment-finders.ts"),L=u("./src/controller/level-helper.ts"),y=u("./src/loader/fragment-loader.ts"),l=u("./src/crypt/decrypter.ts"),n=u("./src/utils/time-ranges.ts"),r=u("./src/types/loader.ts");function h(g,a){for(var p=0;p<a.length;p++){var v=a[p];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(g,v.key,v)}}function d(g,a,p){return a&&h(g.prototype,a),p&&h(g,p),Object.defineProperty(g,"prototype",{writable:!1}),g}function e(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function t(g,a){g.prototype=Object.create(a.prototype),g.prototype.constructor=g,i(g,a)}function i(g,a){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,o){return v.__proto__=o,v},i(g,a)}var c={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},f=function(g){t(a,g);function a(v,o,_){var O;return O=g.call(this)||this,O.hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=c.STOPPED,O.media=null,O.mediaBuffer=null,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=_,O.log=F.logger.log.bind(F.logger,_+":"),O.warn=F.logger.warn.bind(F.logger,_+":"),O.hls=v,O.fragmentLoader=new y.default(v.config),O.fragmentTracker=o,O.config=v.config,O.decrypter=new l.default(v,v.config),v.on(R.Events.KEY_LOADED,O.onKeyLoaded,e(O)),v.on(R.Events.LEVEL_SWITCHING,O.onLevelSwitching,e(O)),O}var p=a.prototype;return p.doTick=function(){this.onTickEnd()},p.onTickEnd=function(){},p.startLoad=function(o){},p.stopLoad=function(){this.fragmentLoader.abort();var o=this.fragCurrent;o&&this.fragmentTracker.removeFragment(o),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=c.STOPPED},p._streamEnded=function(o,_){var O=this.fragCurrent,B=this.fragmentTracker;if(!_.live&&O&&this.media&&O.sn>=_.endSN&&!o.nextStart){var K=_.partList;if(K!=null&&K.length){var N=K[K.length-1],W=P.BufferHelper.isBuffered(this.media,N.start+N.duration/2);return W}var H=B.getState(O);return H===b.FragmentState.PARTIAL||H===b.FragmentState.OK}return!1},p.onMediaAttached=function(o,_){var O=this.media=this.mediaBuffer=_.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var B=this.config;this.levels&&B.autoStartLoad&&this.state===c.STOPPED&&this.startLoad(B.startPosition)},p.onMediaDetaching=function(){var o=this.media;o!=null&&o.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),o&&this.onvseeking&&this.onvended&&(o.removeEventListener("seeking",this.onvseeking),o.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},p.onMediaSeeking=function(){var o=this.config,_=this.fragCurrent,O=this.media,B=this.mediaBuffer,K=this.state,N=O?O.currentTime:0,W=P.BufferHelper.bufferInfo(B||O,N,o.maxBufferHole);if(this.log("media seeking to "+((0,M.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+K),K===c.ENDED)this.resetLoadingState();else if(_&&!W.len){var H=o.maxFragLookUpTolerance,V=_.start-H,j=_.start+_.duration+H,z=N>j;(N<V||z)&&(z&&_.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),_.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=N),!this.loadedmetadata&&!W.len&&(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},p.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},p.onKeyLoaded=function(o,_){if(!(this.state!==c.KEY_LOADING||_.frag!==this.fragCurrent||!this.levels)){this.state=c.IDLE;var O=this.levels[_.frag.level].details;O&&this.loadFragment(_.frag,O,_.frag.start)}},p.onLevelSwitching=function(o,_){this.fragLoadError=0},p.onHandlerDestroying=function(){this.stopLoad(),g.prototype.onHandlerDestroying.call(this)},p.onHandlerDestroyed=function(){this.state=c.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,g.prototype.onHandlerDestroyed.call(this)},p.loadKey=function(o,_){this.log("Loading key for "+o.sn+" of ["+_.startSN+"-"+_.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+o.level),this.state=c.KEY_LOADING,this.fragCurrent=o,this.hls.trigger(R.Events.KEY_LOADING,{frag:o})},p.loadFragment=function(o,_,O){this._loadFragForPlayback(o,_,O)},p._loadFragForPlayback=function(o,_,O){var B=this,K=function(W){if(B.fragContextChanged(o)){B.warn("Fragment "+o.sn+(W.part?" p: "+W.part.index:"")+" of level "+o.level+" was dropped during download."),B.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,B._handleFragmentLoadProgress(W)};this._doFragLoad(o,_,O,K).then(function(N){if(!!N){B.fragLoadError=0;var W=B.state;if(B.fragContextChanged(o)){(W===c.FRAG_LOADING||!B.fragCurrent&&W===c.PARSING)&&(B.fragmentTracker.removeFragment(o),B.state=c.IDLE);return}"payload"in N&&(B.log("Loaded fragment "+o.sn+" of level "+o.level),B.hls.trigger(R.Events.FRAG_LOADED,N)),B._handleFragmentLoadComplete(N)}}).catch(function(N){B.state===c.STOPPED||B.state===c.ERROR||(B.warn(N),B.resetFragmentLoading(o))})},p.flushMainBuffer=function(o,_,O){if(O===void 0&&(O=null),!!(o-_)){var B={startOffset:o,endOffset:_,type:O};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,B)}},p._loadInitSegment=function(o){var _=this;this._doFragLoad(o).then(function(O){if(!O||_.fragContextChanged(o)||!_.levels)throw new Error("init load aborted");return O}).then(function(O){var B=_.hls,K=O.payload,N=o.decryptdata;if(K&&K.byteLength>0&&N&&N.key&&N.iv&&N.method==="AES-128"){var W=self.performance.now();return _.decrypter.webCryptoDecrypt(new Uint8Array(K),N.key.buffer,N.iv.buffer).then(function(H){var V=self.performance.now();return B.trigger(R.Events.FRAG_DECRYPTED,{frag:o,payload:H,stats:{tstart:W,tdecrypt:V}}),O.payload=H,O})}return O}).then(function(O){var B=_.fragCurrent,K=_.hls,N=_.levels;if(!N)throw new Error("init load aborted, missing levels");var W=N[o.level].details;console.assert(W,"Level details are defined when init segment is loaded");var H=o.stats;_.state=c.IDLE,_.fragLoadError=0,o.data=new Uint8Array(O.payload),H.parsing.start=H.buffering.start=self.performance.now(),H.parsing.end=H.buffering.end=self.performance.now(),O.frag===B&&K.trigger(R.Events.FRAG_BUFFERED,{stats:H,frag:B,part:null,id:o.type}),_.tick()}).catch(function(O){_.state===c.STOPPED||_.state===c.ERROR||(_.warn(O),_.resetFragmentLoading(o))})},p.fragContextChanged=function(o){var _=this.fragCurrent;return!o||!_||o.level!==_.level||o.sn!==_.sn||o.urlId!==_.urlId},p.fragBufferedComplete=function(o,_){var O,B,K=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+o.type+" sn: "+o.sn+(_?" part: "+_.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+o.level+" "+(K?n.default.toString(P.BufferHelper.getBuffered(K)):"(detached)")),this.state=c.IDLE,K&&(!this.loadedmetadata&&K.buffered.length&&((O=this.fragCurrent)===null||O===void 0?void 0:O.sn)===((B=this.fragPrevious)===null||B===void 0?void 0:B.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},p.seekToStartPos=function(){},p._handleFragmentLoadComplete=function(o){var _=this.transmuxer;if(!!_){var O=o.frag,B=o.part,K=o.partsLoaded,N=!K||K.length===0||K.some(function(H){return!H}),W=new A.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,B?B.index:-1,!N);_.flush(W)}},p._handleFragmentLoadProgress=function(o){},p._doFragLoad=function(o,_,O,B){var K=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(o.start,O||0),this.config.lowLatencyMode&&_){var N=_.partList;if(N&&B){O>o.end&&_.fragmentHint&&(o=_.fragmentHint);var W=this.getNextPart(N,o,O);if(W>-1){var H=N[W];return this.log("Loading part sn: "+o.sn+" p: "+H.index+" cc: "+o.cc+" of playlist ["+_.startSN+"-"+_.endSN+"] parts [0-"+W+"-"+(N.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+o.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=H.start+H.duration,this.state=c.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:o,part:N[W],targetBufferTime:O}),this.doFragPartsLoad(o,N,W,B).catch(function(V){return K.handleFragLoadError(V)})}else if(!o.url||this.loadedEndOfParts(N,O))return Promise.resolve(null)}}return this.log("Loading fragment "+o.sn+" cc: "+o.cc+" "+(_?"of ["+_.startSN+"-"+_.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+o.level+", target: "+parseFloat(O.toFixed(3))),(0,M.isFiniteNumber)(o.sn)&&!this.bitrateTest&&(this.nextLoadPosition=o.start+o.duration),this.state=c.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:o,targetBufferTime:O}),this.fragmentLoader.load(o,B).catch(function(V){return K.handleFragLoadError(V)})},p.doFragPartsLoad=function(o,_,O,B){var K=this;return new Promise(function(N,W){var H=[],V=function j(z){var $=_[z];K.fragmentLoader.loadPart(o,$,B).then(function(Y){H[$.index]=Y;var X=Y.part;K.hls.trigger(R.Events.FRAG_LOADED,Y);var Q=_[z+1];if(Q&&Q.fragment===o)j(z+1);else return N({frag:o,part:X,partsLoaded:H})}).catch(W)};V(O)})},p.handleFragLoadError=function(o){var _=o.data;return _&&_.details===C.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(_.frag,_.part):this.hls.trigger(R.Events.ERROR,_),null},p._handleTransmuxerFlush=function(o){var _=this.getCurrentContext(o);if(!_||this.state!==c.PARSING){this.fragCurrent||(this.state=c.IDLE);return}var O=_.frag,B=_.part,K=_.level,N=self.performance.now();O.stats.parsing.end=N,B&&(B.stats.parsing.end=N),this.updateLevelTiming(O,B,K,o.partial)},p.getCurrentContext=function(o){var _=this.levels,O=o.level,B=o.sn,K=o.part;if(!_||!_[O])return this.warn("Levels object was unset while buffering fragment "+B+" of level "+O+". The current chunk will not be buffered."),null;var N=_[O],W=K>-1?(0,L.getPartWith)(N,B,K):null,H=W?W.fragment:(0,L.getFragmentWithSN)(N,B,this.fragCurrent);return H?{frag:H,part:W,level:N}:null},p.bufferFragmentData=function(o,_,O,B){if(!(!o||this.state!==c.PARSING)){var K=o.data1,N=o.data2,W=K;if(K&&N&&(W=(0,T.appendUint8Array)(K,N)),!(!W||!W.length)){var H={type:o.type,frag:_,part:O,chunkMeta:B,parent:_.type,data:W};this.hls.trigger(R.Events.BUFFER_APPENDING,H),o.dropped&&o.independent&&!O&&this.flushBufferGap(_)}}},p.flushBufferGap=function(o){var _=this.media;if(!!_){if(!P.BufferHelper.isBuffered(_,_.currentTime)){this.flushMainBuffer(0,o.start);return}var O=_.currentTime,B=P.BufferHelper.bufferInfo(_,O,0),K=o.duration,N=Math.min(this.config.maxFragLookUpTolerance*2,K*.25),W=Math.max(Math.min(o.start-N,B.end-N),O+N);o.start-W>N&&this.flushMainBuffer(W,o.start)}},p.getFwdBufferInfo=function(o,_){var O=this.config,B=this.getLoadPosition();if(!(0,M.isFiniteNumber)(B))return null;var K=P.BufferHelper.bufferInfo(o,B,O.maxBufferHole);if(K.len===0&&K.nextStart!==void 0){var N=this.fragmentTracker.getBufferedFrag(B,_);if(N&&K.nextStart<N.end)return P.BufferHelper.bufferInfo(o,B,Math.max(K.nextStart,O.maxBufferHole))}return K},p.getMaxBufferLength=function(o){var _=this.config,O;return o?O=Math.max(8*_.maxBufferSize/o,_.maxBufferLength):O=_.maxBufferLength,Math.min(O,_.maxMaxBufferLength)},p.reduceMaxBufferLength=function(o){var _=this.config,O=o||_.maxBufferLength;return _.maxMaxBufferLength>=O?(_.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+_.maxMaxBufferLength+"s"),!0):!1},p.getNextFragment=function(o,_){var O=_.fragments,B=O.length;if(!B)return null;var K=this.config,N=O[0].start,W;if(_.live){var H=K.initialLiveManifestSize;if(B<H)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+H+")"),null;!_.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(W=this.getInitialLiveFragment(_,O),this.startPosition=W?this.hls.liveSyncPosition||W.start:o)}else o<=N&&(W=O[0]);if(!W){var V=K.lowLatencyMode?_.partEnd:_.fragmentEnd;W=this.getFragmentAtPosition(o,V,_)}return this.mapToInitFragWhenRequired(W)},p.mapToInitFragWhenRequired=function(o){return o!=null&&o.initSegment&&!(o!=null&&o.initSegment.data)&&!this.bitrateTest?o.initSegment:o},p.getNextPart=function(o,_,O){for(var B=-1,K=!1,N=!0,W=0,H=o.length;W<H;W++){var V=o[W];if(N=N&&!V.independent,B>-1&&O<V.start)break;var j=V.loaded;!j&&(K||V.independent||N)&&V.fragment===_&&(B=W),K=j}return B},p.loadedEndOfParts=function(o,_){var O=o[o.length-1];return O&&_>O.start&&O.loaded},p.getInitialLiveFragment=function(o,_){var O=this.fragPrevious,B=null;if(O){if(o.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),B=(0,D.findFragmentByPDT)(_,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!B){var K=O.sn+1;if(K>=o.startSN&&K<=o.endSN){var N=_[K-o.startSN];O.cc===N.cc&&(B=N,this.log("Live playlist, switching playlist, load frag with next SN: "+B.sn))}B||(B=(0,D.findFragWithCC)(_,O.cc),B&&this.log("Live playlist, switching playlist, load frag with same CC: "+B.sn))}}else{var W=this.hls.liveSyncPosition;W!==null&&(B=this.getFragmentAtPosition(W,this.bitrateTest?o.fragmentEnd:o.edge,o))}return B},p.getFragmentAtPosition=function(o,_,O){var B=this.config,K=this.fragPrevious,N=O.fragments,W=O.endSN,H=O.fragmentHint,V=B.maxFragLookUpTolerance,j=!!(B.lowLatencyMode&&O.partList&&H);j&&H&&!this.bitrateTest&&(N=N.concat(H),W=H.sn);var z;if(o<_){var $=o>_-V?0:V;z=(0,D.findFragmentByPTS)(K,N,o,$)}else z=N[N.length-1];if(z){var Y=z.sn-O.startSN;if(this.fragmentTracker.getState(z)===b.FragmentState.OK&&(K=z),K&&z.sn===K.sn&&!j){var X=K&&z.level===K.level;if(X){var Q=N[Y+1];z.sn<W&&this.fragmentTracker.getState(Q)!==b.FragmentState.OK?(this.log("SN "+z.sn+" just loaded, load next one: "+Q.sn),z=Q):z=null}}}return z},p.synchronizeToLiveEdge=function(o){var _=this.config,O=this.media;if(!!O){var B=this.hls.liveSyncPosition,K=O.currentTime,N=o.fragments[0].start,W=o.edge,H=K>=N-_.maxFragLookUpTolerance&&K<=W;if(B!==null&&O.duration>B&&(K<B||!H)){var V=_.liveMaxLatencyDuration!==void 0?_.liveMaxLatencyDuration:_.liveMaxLatencyDurationCount*o.targetduration;(!H&&O.readyState<4||K<W-V)&&(this.loadedmetadata||(this.nextLoadPosition=B),O.readyState&&(this.warn("Playback: "+K.toFixed(3)+" is located too far from the end of live sliding playlist: "+W+", reset currentTime to : "+B.toFixed(3)),O.currentTime=B))}}},p.alignPlaylists=function(o,_){var O=this.levels,B=this.levelLastLoaded,K=this.fragPrevious,N=B!==null?O[B]:null,W=o.fragments.length;if(!W)return this.warn("No fragments in live playlist"),0;var H=o.fragments[0].start,V=!_,j=o.alignedSliding&&(0,M.isFiniteNumber)(H);if(V||!j&&!H){(0,S.alignStream)(K,N,o);var z=o.fragments[0].start;return this.log("Live playlist sliding: "+z.toFixed(2)+" start-sn: "+(_?_.startSN:"na")+"->"+o.startSN+" prev-sn: "+(K?K.sn:"na")+" fragments: "+W),z}return H},p.waitForCdnTuneIn=function(o){var _=3;return o.live&&o.canBlockReload&&o.partTarget&&o.tuneInGoal>Math.max(o.partHoldBack,o.partTarget*_)},p.setStartPosition=function(o,_){var O=this.startPosition;if(O<_&&(O=-1),O===-1||this.lastCurrentTime===-1){var B=o.startTimeOffset;(0,M.isFiniteNumber)(B)?(O=_+B,B<0&&(O+=o.totalduration),O=Math.min(Math.max(_,O),_+o.totalduration),this.log("Start time offset "+B+" found in playlist, adjust startPosition to "+O),this.startPosition=O):o.live?O=this.hls.liveSyncPosition||_:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},p.getLoadPosition=function(){var o=this.media,_=0;return this.loadedmetadata&&o?_=o.currentTime:this.nextLoadPosition&&(_=this.nextLoadPosition),_},p.handleFragLoadAborted=function(o,_){this.transmuxer&&o.sn!=="initSegment"&&o.stats.aborted&&(this.warn("Fragment "+o.sn+(_?" part"+_.index:"")+" of level "+o.level+" was aborted"),this.resetFragmentLoading(o))},p.resetFragmentLoading=function(o){(!this.fragCurrent||!this.fragContextChanged(o)&&this.state!==c.FRAG_LOADING_WAITING_RETRY)&&(this.state=c.IDLE)},p.onFragmentOrKeyLoadError=function(o,_){if(!_.fatal){var O=_.frag;if(!(!O||O.type!==o)){var B=this.fragCurrent;console.assert(B&&O.sn===B.sn&&O.level===B.level&&O.urlId===B.urlId,"Frag load error must match current frag to retry");var K=this.config;if(this.fragLoadError+1<=K.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var N=Math.min(Math.pow(2,this.fragLoadError)*K.fragLoadingRetryDelay,K.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+o+" "+O.level+" failed to load, retrying in "+N+"ms"),this.retryDate=self.performance.now()+N,this.fragLoadError++,this.state=c.FRAG_LOADING_WAITING_RETRY}else _.levelRetry?(o===r.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=c.IDLE):(F.logger.error(_.details+" reaches max retry, redispatch as fatal ..."),_.fatal=!0,this.hls.stopLoad(),this.state=c.ERROR)}}},p.afterBufferFlushed=function(o,_,O){if(!!o){var B=P.BufferHelper.getBuffered(o);this.fragmentTracker.detectEvictedFragments(_,B,O),this.state===c.ENDED&&this.resetLoadingState()}},p.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=c.IDLE},p.resetStartWhenNotLoaded=function(o){if(!this.loadedmetadata){this.startFragRequested=!1;var _=this.levels?this.levels[o].details:null;_!=null&&_.live?(this.startPosition=-1,this.setStartPosition(_,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},p.updateLevelTiming=function(o,_,O,B){var K=this,N=O.details;console.assert(!!N,"level.details must be defined");var W=Object.keys(o.elementaryStreams).reduce(function(H,V){var j=o.elementaryStreams[V];if(j){var z=j.endPTS-j.startPTS;if(z<=0)return K.warn("Could not parse fragment "+o.sn+" "+V+" duration reliably ("+z+")"),H||!1;var $=B?0:(0,L.updateFragPTSDTS)(N,o,j.startPTS,j.endPTS,j.startDTS,j.endDTS);return K.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:N,level:O,drift:$,type:V,frag:o,start:j.startPTS,end:j.endPTS}),!0}return H},!1);W||(this.warn("Found no media in fragment "+o.sn+" of level "+O.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=c.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:o,part:_})},p.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},d(a,[{key:"state",get:function(){return this._state},set:function(o){var _=this._state;_!==o&&(this._state=o,this.log(_+"->"+o))}}]),a}(I.default)},"./src/controller/buffer-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>D});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/utils/logger.ts"),P=u("./src/errors.ts"),F=u("./src/utils/buffer-helper.ts"),R=u("./src/utils/mediasource-helper.ts"),C=u("./src/loader/fragment.ts"),A=u("./src/controller/buffer-operation-queue.ts"),T=(0,R.getMediaSource)(),S=/([ha]vc.)(?:\.[^.,]+)+/,D=function(){function L(l){var n=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=n.hls,h=n.media,d=n.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),h&&(n.updateMediaElementDuration(),r.trigger(I.Events.MEDIA_ATTACHED,{media:h})),d&&d.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var y=L.prototype;return y.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},y.destroy=function(){this.unregisterListeners(),this.details=null},y.registerListeners=function(){var n=this.hls;n.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(I.Events.BUFFER_RESET,this.onBufferReset,this),n.on(I.Events.BUFFER_APPENDING,this.onBufferAppending,this),n.on(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.on(I.Events.BUFFER_EOS,this.onBufferEos,this),n.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),n.on(I.Events.FRAG_PARSED,this.onFragParsed,this),n.on(I.Events.FRAG_CHANGED,this.onFragChanged,this)},y.unregisterListeners=function(){var n=this.hls;n.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),n.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(I.Events.BUFFER_RESET,this.onBufferReset,this),n.off(I.Events.BUFFER_APPENDING,this.onBufferAppending,this),n.off(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),n.off(I.Events.BUFFER_EOS,this.onBufferEos,this),n.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),n.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),n.off(I.Events.FRAG_PARSED,this.onFragParsed,this),n.off(I.Events.FRAG_CHANGED,this.onFragChanged,this)},y._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new A.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},y.onManifestParsed=function(n,r){var h=2;(r.audio&&!r.video||!r.altAudio)&&(h=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=h,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},y.onMediaAttaching=function(n,r){var h=this.media=r.media;if(h&&T){var d=this.mediaSource=new T;d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),h.src=self.URL.createObjectURL(d),this._objectUrl=h.src}},y.onMediaDetaching=function(){var n=this.media,r=this.mediaSource,h=this._objectUrl;if(r){if(b.logger.log("[buffer-controller]: media source detaching"),r.readyState==="open")try{r.endOfStream()}catch(d){b.logger.warn("[buffer-controller]: onMediaDetaching: "+d.message+" while calling endOfStream")}this.onBufferReset(),r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),n&&(h&&self.URL.revokeObjectURL(h),n.src===h?(n.removeAttribute("src"),n.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(I.Events.MEDIA_DETACHED,void 0)},y.onBufferReset=function(){var n=this;this.getSourceBufferTypes().forEach(function(r){var h=n.sourceBuffer[r];try{h&&(n.removeBufferListeners(r),n.mediaSource&&n.mediaSource.removeSourceBuffer(h),n.sourceBuffer[r]=void 0)}catch(d){b.logger.warn("[buffer-controller]: Failed to reset the "+r+" buffer",d)}}),this._initSourceBuffer()},y.onBufferCodecs=function(n,r){var h=this,d=this.getSourceBufferTypes().length;Object.keys(r).forEach(function(e){if(d){var t=h.tracks[e];if(t&&typeof t.buffer.changeType=="function"){var i=r[e],c=i.id,f=i.codec,g=i.levelCodec,a=i.container,p=i.metadata,v=(t.levelCodec||t.codec).replace(S,"$1"),o=(g||f).replace(S,"$1");if(v!==o){var _=a+";codecs="+(g||f);h.appendChangeType(e,_),b.logger.log("[buffer-controller]: switching codec "+v+" to "+o),h.tracks[e]={buffer:t.buffer,codec:f,container:a,levelCodec:g,metadata:p,id:c}}}}else h.pendingTracks[e]=r[e]}),!d&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},y.appendChangeType=function(n,r){var h=this,d=this.operationQueue,e={execute:function(){var i=h.sourceBuffer[n];i&&(b.logger.log("[buffer-controller]: changing "+n+" sourceBuffer type to "+r),i.changeType(r)),d.shiftAndExecuteNext(n)},onStart:function(){},onComplete:function(){},onError:function(i){b.logger.warn("[buffer-controller]: Failed to change "+n+" SourceBuffer type",i)}};d.append(e,n)},y.onBufferAppending=function(n,r){var h=this,d=this.hls,e=this.operationQueue,t=this.tracks,i=r.data,c=r.type,f=r.frag,g=r.part,a=r.chunkMeta,p=a.buffering[c],v=self.performance.now();p.start=v;var o=f.stats.buffering,_=g?g.stats.buffering:null;o.start===0&&(o.start=v),_&&_.start===0&&(_.start=v);var O=t.audio,B=c==="audio"&&a.id===1&&(O==null?void 0:O.container)==="audio/mpeg",K={execute:function(){if(p.executeStart=self.performance.now(),B){var W=h.sourceBuffer[c];if(W){var H=f.start-W.timestampOffset;Math.abs(H)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+H+") sn: "+f.sn+")"),W.timestampOffset=f.start)}}h.appendExecutor(i,c)},onStart:function(){},onComplete:function(){var W=self.performance.now();p.executeEnd=p.end=W,o.first===0&&(o.first=W),_&&_.first===0&&(_.first=W);var H=h.sourceBuffer,V={};for(var j in H)V[j]=F.BufferHelper.getBuffered(H[j]);h.appendError=0,h.hls.trigger(I.Events.BUFFER_APPENDED,{type:c,frag:f,part:g,chunkMeta:a,parent:f.type,timeRanges:V})},onError:function(W){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",W);var H={type:P.ErrorTypes.MEDIA_ERROR,parent:f.type,details:P.ErrorDetails.BUFFER_APPEND_ERROR,err:W,fatal:!1};W.code===DOMException.QUOTA_EXCEEDED_ERR?H.details=P.ErrorDetails.BUFFER_FULL_ERROR:(h.appendError++,H.details=P.ErrorDetails.BUFFER_APPEND_ERROR,h.appendError>d.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+d.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),H.fatal=!0,d.stopLoad())),d.trigger(I.Events.ERROR,H)}};e.append(K,c)},y.onBufferFlushing=function(n,r){var h=this,d=this.operationQueue,e=function(i){return{execute:h.removeExecutor.bind(h,i,r.startOffset,r.endOffset),onStart:function(){},onComplete:function(){h.hls.trigger(I.Events.BUFFER_FLUSHED,{type:i})},onError:function(f){b.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",f)}}};r.type?d.append(e(r.type),r.type):this.getSourceBufferTypes().forEach(function(t){d.append(e(t),t)})},y.onFragParsed=function(n,r){var h=this,d=r.frag,e=r.part,t=[],i=e?e.elementaryStreams:d.elementaryStreams;i[C.ElementaryStreamTypes.AUDIOVIDEO]?t.push("audiovideo"):(i[C.ElementaryStreamTypes.AUDIO]&&t.push("audio"),i[C.ElementaryStreamTypes.VIDEO]&&t.push("video"));var c=function(){var g=self.performance.now();d.stats.buffering.end=g,e&&(e.stats.buffering.end=g);var a=e?e.stats:d.stats;h.hls.trigger(I.Events.FRAG_BUFFERED,{frag:d,part:e,stats:a,id:d.type})};t.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+d.type+" level: "+d.level+" sn: "+d.sn),this.blockBuffers(c,t)},y.onFragChanged=function(n,r){this.flushBackBuffer()},y.onBufferEos=function(n,r){var h=this,d=this.getSourceBufferTypes().reduce(function(e,t){var i=h.sourceBuffer[t];return(!r.type||r.type===t)&&i&&!i.ended&&(i.ended=!0,b.logger.log("[buffer-controller]: "+t+" sourceBuffer now EOS")),e&&!!(!i||i.ended)},!0);d&&this.blockBuffers(function(){var e=h.mediaSource;!e||e.readyState!=="open"||e.endOfStream()})},y.onLevelUpdated=function(n,r){var h=r.details;!h.fragments.length||(this.details=h,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},y.flushBackBuffer=function(){var n=this.hls,r=this.details,h=this.media,d=this.sourceBuffer;if(!(!h||r===null)){var e=this.getSourceBufferTypes();if(!!e.length){var t=r.live&&n.config.liveBackBufferLength!==null?n.config.liveBackBufferLength:n.config.backBufferLength;if(!(!(0,M.isFiniteNumber)(t)||t<0)){var i=h.currentTime,c=r.levelTargetDuration,f=Math.max(t,c),g=Math.floor(i/c)*c-f;e.forEach(function(a){var p=d[a];if(p){var v=F.BufferHelper.getBuffered(p);v.length>0&&g>v.start(0)&&(n.trigger(I.Events.BACK_BUFFER_REACHED,{bufferEnd:g}),r.live&&n.trigger(I.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:g}),n.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:g,type:a}))}})}}}},y.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var n=this.details,r=this.hls,h=this.media,d=this.mediaSource,e=n.fragments[0].start+n.totalduration,t=h.duration,i=(0,M.isFiniteNumber)(d.duration)?d.duration:0;n.live&&r.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),d.duration=1/0,this.updateSeekableRange(n)):(e>i&&e>t||!(0,M.isFiniteNumber)(t))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+e.toFixed(3)),d.duration=e)}},y.updateSeekableRange=function(n){var r=this.mediaSource,h=n.fragments,d=h.length;if(d&&n.live&&r!==null&&r!==void 0&&r.setLiveSeekableRange){var e=Math.max(0,h[0].start),t=Math.max(e,e+n.totalduration);r.setLiveSeekableRange(e,t)}},y.checkPendingTracks=function(){var n=this.bufferCodecEventsExpected,r=this.operationQueue,h=this.pendingTracks,d=Object.keys(h).length;if(d&&!n||d===2){this.createSourceBuffers(h),this.pendingTracks={};var e=this.getSourceBufferTypes();if(e.length===0){this.hls.trigger(I.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}e.forEach(function(t){r.executeNext(t)})}},y.createSourceBuffers=function(n){var r=this.sourceBuffer,h=this.mediaSource;if(!h)throw Error("createSourceBuffers called when mediaSource was null");var d=0;for(var e in n)if(!r[e]){var t=n[e];if(!t)throw Error("source buffer exists for track "+e+", however track does not");var i=t.levelCodec||t.codec,c=t.container+";codecs="+i;b.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var f=r[e]=h.addSourceBuffer(c),g=e;this.addBufferListener(g,"updatestart",this._onSBUpdateStart),this.addBufferListener(g,"updateend",this._onSBUpdateEnd),this.addBufferListener(g,"error",this._onSBUpdateError),this.tracks[e]={buffer:f,codec:i,container:t.container,levelCodec:t.levelCodec,metadata:t.metadata,id:t.id},d++}catch(a){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(I.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:c})}}d&&this.hls.trigger(I.Events.BUFFER_CREATED,{tracks:this.tracks})},y._onSBUpdateStart=function(n){var r=this.operationQueue,h=r.current(n);h.onStart()},y._onSBUpdateEnd=function(n){var r=this.operationQueue,h=r.current(n);h.onComplete(),r.shiftAndExecuteNext(n)},y._onSBUpdateError=function(n,r){b.logger.error("[buffer-controller]: "+n+" SourceBuffer error",r),this.hls.trigger(I.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var h=this.operationQueue.current(n);h&&h.onError(r)},y.removeExecutor=function(n,r,h){var d=this.media,e=this.mediaSource,t=this.operationQueue,i=this.sourceBuffer,c=i[n];if(!d||!e||!c){b.logger.warn("[buffer-controller]: Attempting to remove from the "+n+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(n);return}var f=(0,M.isFiniteNumber)(d.duration)?d.duration:1/0,g=(0,M.isFiniteNumber)(e.duration)?e.duration:1/0,a=Math.max(0,r),p=Math.min(h,f,g);p>a?(b.logger.log("[buffer-controller]: Removing ["+a+","+p+"] from the "+n+" SourceBuffer"),console.assert(!c.updating,n+" sourceBuffer must not be updating"),c.remove(a,p)):t.shiftAndExecuteNext(n)},y.appendExecutor=function(n,r){var h=this.operationQueue,d=this.sourceBuffer,e=d[r];if(!e){b.logger.warn("[buffer-controller]: Attempting to append to the "+r+" SourceBuffer, but it does not exist"),h.shiftAndExecuteNext(r);return}e.ended=!1,console.assert(!e.updating,r+" sourceBuffer must not be updating"),e.appendBuffer(n)},y.blockBuffers=function(n,r){var h=this;if(r===void 0&&(r=this.getSourceBufferTypes()),!r.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(n);return}var d=this.operationQueue,e=r.map(function(t){return d.appendBlocker(t)});Promise.all(e).then(function(){n(),r.forEach(function(t){var i=h.sourceBuffer[t];(!i||!i.updating)&&d.shiftAndExecuteNext(t)})})},y.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},y.addBufferListener=function(n,r,h){var d=this.sourceBuffer[n];if(!!d){var e=h.bind(this,n);this.listeners[n].push({event:r,listener:e}),d.addEventListener(r,e)}},y.removeBufferListeners=function(n){var r=this.sourceBuffer[n];!r||this.listeners[n].forEach(function(h){r.removeEventListener(h.event,h.listener)})},L}()},"./src/controller/buffer-operation-queue.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>I});var M=u("./src/utils/logger.ts"),I=function(){function b(F){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=F}var P=b.prototype;return P.append=function(R,C){var A=this.queues[C];A.push(R),A.length===1&&this.buffers[C]&&this.executeNext(C)},P.insertAbort=function(R,C){var A=this.queues[C];A.unshift(R),this.executeNext(C)},P.appendBlocker=function(R){var C,A=new Promise(function(S){C=S}),T={execute:C,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(T,R),A},P.executeNext=function(R){var C=this.buffers,A=this.queues,T=C[R],S=A[R];if(S.length){var D=S[0];try{D.execute()}catch(L){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),D.onError(L),(!T||!T.updating)&&(S.shift(),this.executeNext(R))}}},P.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},P.current=function(R){return this.queues[R][0]},b}()},"./src/controller/cap-level-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>F});var M=u("./src/events.ts");function I(R,C){for(var A=0;A<C.length;A++){var T=C[A];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function b(R,C,A){return C&&I(R.prototype,C),A&&I(R,A),Object.defineProperty(R,"prototype",{writable:!1}),R}var P=function(){function R(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var C=R.prototype;return C.setStreamController=function(T){this.streamController=T},C.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},C.registerListeners=function(){var T=this.hls;T.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},C.unregisterListener=function(){var T=this.hls;T.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},C.onFpsDropLevelCapping=function(T,S){R.isLevelAllowed(S.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(S.droppedLevel)},C.onMediaAttaching=function(T,S){this.media=S.media instanceof HTMLVideoElement?S.media:null},C.onManifestParsed=function(T,S){var D=this.hls;this.restrictedLevels=[],this.firstLevel=S.firstLevel,D.config.capLevelToPlayerSize&&S.video&&this.startCapping()},C.onBufferCodecs=function(T,S){var D=this.hls;D.config.capLevelToPlayerSize&&S.video&&this.startCapping()},C.onMediaDetaching=function(){this.stopCapping()},C.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var T=this.hls.levels;if(T.length){var S=this.hls;S.autoLevelCapping=this.getMaxLevel(T.length-1),S.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=S.autoLevelCapping}}},C.getMaxLevel=function(T){var S=this,D=this.hls.levels;if(!D.length)return-1;var L=D.filter(function(y,l){return R.isLevelAllowed(l,S.restrictedLevels)&&l<=T});return this.clientRect=null,R.getMaxLevelByMediaSize(L,this.mediaWidth,this.mediaHeight)},C.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},C.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},C.getDimensions=function(){if(this.clientRect)return this.clientRect;var T=this.media,S={width:0,height:0};if(T){var D=T.getBoundingClientRect();S.width=D.width,S.height=D.height,!S.width&&!S.height&&(S.width=D.right-D.left||T.width||0,S.height=D.bottom-D.top||T.height||0)}return this.clientRect=S,S},R.isLevelAllowed=function(T,S){return S===void 0&&(S=[]),S.indexOf(T)===-1},R.getMaxLevelByMediaSize=function(T,S,D){if(!T||!T.length)return-1;for(var L=function(h,d){return d?h.width!==d.width||h.height!==d.height:!0},y=T.length-1,l=0;l<T.length;l+=1){var n=T[l];if((n.width>=S||n.height>=D)&&L(n,T[l+1])){y=l;break}}return y},b(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var T=1;if(!this.hls.config.ignoreDevicePixelRatio)try{T=self.devicePixelRatio}catch{}return T}}]),R}();const F=P},"./src/controller/cmcd-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>D});var M=u("./src/events.ts"),I=u("./src/types/cmcd.ts"),b=u("./src/utils/buffer-helper.ts"),P=u("./src/utils/logger.ts");function F(L,y){for(var l=0;l<y.length;l++){var n=y[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(L,n.key,n)}}function R(L,y,l){return y&&F(L.prototype,y),l&&F(L,l),Object.defineProperty(L,"prototype",{writable:!1}),L}function C(L,y){var l=typeof Symbol<"u"&&L[Symbol.iterator]||L["@@iterator"];if(l)return(l=l.call(L)).next.bind(l);if(Array.isArray(L)||(l=A(L))||y&&L&&typeof L.length=="number"){l&&(L=l);var n=0;return function(){return n>=L.length?{done:!0}:{done:!1,value:L[n++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(L,y){if(!!L){if(typeof L=="string")return T(L,y);var l=Object.prototype.toString.call(L).slice(8,-1);if(l==="Object"&&L.constructor&&(l=L.constructor.name),l==="Map"||l==="Set")return Array.from(L);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return T(L,y)}}function T(L,y){(y==null||y>L.length)&&(y=L.length);for(var l=0,n=new Array(y);l<y;l++)n[l]=L[l];return n}function S(){return S=Object.assign?Object.assign.bind():function(L){for(var y=1;y<arguments.length;y++){var l=arguments[y];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(L[n]=l[n])}return L},S.apply(this,arguments)}var D=function(){function L(l){var n=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){n.initialized&&(n.starved=!0),n.buffering=!0},this.onPlaying=function(){n.initialized||(n.initialized=!0),n.buffering=!1},this.applyPlaylistData=function(d){try{n.apply(d,{ot:I.CMCDObjectType.MANIFEST,su:!n.initialized})}catch(e){P.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=function(d){try{var e=d.frag,t=n.hls.levels[e.level],i=n.getObjectType(e),c={d:e.duration*1e3,ot:i};(i===I.CMCDObjectType.VIDEO||i===I.CMCDObjectType.AUDIO||i==I.CMCDObjectType.MUXED)&&(c.br=t.bitrate/1e3,c.tb=n.getTopBandwidth(i)/1e3,c.bl=n.getBufferLength(i)),n.apply(d,c)}catch(f){P.logger.warn("Could not generate segment CMCD data.",f)}},this.hls=l;var r=this.config=l.config,h=r.cmcd;h!=null&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=h.sessionId||L.uuid(),this.cid=h.contentId,this.useHeaders=h.useHeaders===!0,this.registerListeners())}var y=L.prototype;return y.registerListeners=function(){var n=this.hls;n.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},y.unregisterListeners=function(){var n=this.hls;n.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),n.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},y.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},y.onMediaAttached=function(n,r){this.media=r.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},y.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},y.onBufferCreated=function(n,r){var h,d;this.audioBuffer=(h=r.tracks.audio)===null||h===void 0?void 0:h.buffer,this.videoBuffer=(d=r.tracks.video)===null||d===void 0?void 0:d.buffer},y.createData=function(){var n;return{v:I.CMCDVersion,sf:I.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(n=this.media)===null||n===void 0?void 0:n.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},y.apply=function(n,r){r===void 0&&(r={}),S(r,this.createData());var h=r.ot===I.CMCDObjectType.INIT||r.ot===I.CMCDObjectType.VIDEO||r.ot===I.CMCDObjectType.MUXED;if(this.starved&&h&&(r.bs=!0,r.su=!0,this.starved=!1),r.su==null&&(r.su=this.buffering),this.useHeaders){var d=L.toHeaders(r);if(!Object.keys(d).length)return;n.headers||(n.headers={}),S(n.headers,d)}else{var e=L.toQuery(r);if(!e)return;n.url=L.appendQueryToUri(n.url,e)}},y.getObjectType=function(n){var r=n.type;if(r==="subtitle")return I.CMCDObjectType.TIMED_TEXT;if(n.sn==="initSegment")return I.CMCDObjectType.INIT;if(r==="audio")return I.CMCDObjectType.AUDIO;if(r==="main")return this.hls.audioTracks.length?I.CMCDObjectType.VIDEO:I.CMCDObjectType.MUXED},y.getTopBandwidth=function(n){var r=0,h,d=this.hls;if(n===I.CMCDObjectType.AUDIO)h=d.audioTracks;else{var e=d.maxAutoLevel,t=e>-1?e+1:d.levels.length;h=d.levels.slice(0,t)}for(var i=C(h),c;!(c=i()).done;){var f=c.value;f.bitrate>r&&(r=f.bitrate)}return r>0?r:NaN},y.getBufferLength=function(n){var r=this.hls.media,h=n===I.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!h||!r)return NaN;var d=b.BufferHelper.bufferInfo(h,r.currentTime,this.config.maxBufferHole);return d.len*1e3},y.createPlaylistLoader=function(){var n=this.config.pLoader,r=this.applyPlaylistData,h=n||this.config.loader;return function(){function d(t){this.loader=void 0,this.loader=new h(t)}var e=d.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(i,c,f){r(i),this.loader.load(i,c,f)},R(d,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),d}()},y.createFragmentLoader=function(){var n=this.config.fLoader,r=this.applyFragmentData,h=n||this.config.loader;return function(){function d(t){this.loader=void 0,this.loader=new h(t)}var e=d.prototype;return e.destroy=function(){this.loader.destroy()},e.abort=function(){this.loader.abort()},e.load=function(i,c,f){r(i),this.loader.load(i,c,f)},R(d,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),d}()},L.uuid=function(){var n=URL.createObjectURL(new Blob),r=n.toString();return URL.revokeObjectURL(n),r.slice(r.lastIndexOf("/")+1)},L.serialize=function(n){for(var r=[],h=function(B){return!Number.isNaN(B)&&B!=null&&B!==""&&B!==!1},d=function(B){return Math.round(B)},e=function(B){return d(B/100)*100},t=function(B){return encodeURIComponent(B)},i={br:d,d,bl:e,dl:e,mtp:e,nor:t,rtp:e,tb:d},c=Object.keys(n||{}).sort(),f=C(c),g;!(g=f()).done;){var a=g.value,p=n[a];if(!!h(p)&&!(a==="v"&&p===1)&&!(a=="pr"&&p===1)){var v=i[a];v&&(p=v(p));var o=typeof p,_=void 0;a==="ot"||a==="sf"||a==="st"?_=a+"="+p:o==="boolean"?_=a:o==="number"?_=a+"="+p:_=a+"="+JSON.stringify(p),r.push(_)}}return r.join(",")},L.toHeaders=function(n){for(var r=Object.keys(n),h={},d=["Object","Request","Session","Status"],e=[{},{},{},{}],t={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},i=0,c=r;i<c.length;i++){var f=c[i],g=t[f]!=null?t[f]:1;e[g][f]=n[f]}for(var a=0;a<e.length;a++){var p=L.serialize(e[a]);p&&(h["CMCD-"+d[a]]=p)}return h},L.toQuery=function(n){return"CMCD="+encodeURIComponent(L.serialize(n))},L.appendQueryToUri=function(n,r){if(!r)return n;var h=n.includes("?")?"&":"?";return""+n+h+r},L}()},"./src/controller/eme-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>D});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/utils/logger.ts"),P=u("./src/utils/mediakeys-helper.ts");function F(L,y){for(var l=0;l<y.length;l++){var n=y[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(L,n.key,n)}}function R(L,y,l){return y&&F(L.prototype,y),l&&F(L,l),Object.defineProperty(L,"prototype",{writable:!1}),L}var C=3,A=function(y,l,n){var r={audioCapabilities:[],videoCapabilities:[]};return y.forEach(function(h){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+h+'"',robustness:n.audioRobustness||""})}),l.forEach(function(h){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+h+'"',robustness:n.videoRobustness||""})}),[r]},T=function(y,l,n,r){switch(y){case P.KeySystems.WIDEVINE:return A(l,n,r);default:throw new Error("Unknown key-system: "+y)}},S=function(){function L(l){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=l,this._config=l.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var y=L.prototype;return y.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},y._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},y._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},y.getLicenseServerUrl=function(n){switch(n){case P.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},y._attemptKeySystemAccess=function(n,r,h){var d=this,e=T(n,r,h,this._drmSystemOptions);b.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(n,e);this.mediaKeysPromise=t.then(function(i){return d._onMediaKeySystemAccessObtained(n,i)}),t.catch(function(i){b.logger.error('Failed to obtain key-system "'+n+'" access:',i)})},y._onMediaKeySystemAccessObtained=function(n,r){var h=this;b.logger.log('Access for key-system "'+n+'" obtained');var d={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:r,mediaKeySystemDomain:n};this._mediaKeysList.push(d);var e=Promise.resolve().then(function(){return r.createMediaKeys()}).then(function(t){return d.mediaKeys=t,b.logger.log('Media-keys created for key-system "'+n+'"'),h._onMediaKeysCreated(),t});return e.catch(function(t){b.logger.error("Failed to create media-keys:",t)}),e},y._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(r){r.mediaKeysSession||(r.mediaKeysSession=r.mediaKeys.createSession(),n._onNewMediaKeySession(r.mediaKeysSession))})},y._onNewMediaKeySession=function(n){var r=this;b.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(h){r._onKeySessionMessage(n,h.message)},!1)},y._onKeySessionMessage=function(n,r){b.logger.log("Got EME message event, creating license request"),this._requestLicense(r,function(h){b.logger.log("Received license data (length: "+(h&&h.byteLength)+"), updating key-session"),n.update(h).catch(function(d){b.logger.warn("Updating key-session failed: "+d)})})},y.onMediaEncrypted=function(n){var r=this;if(b.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var h=function(e){!r._media||(r._attemptSetMediaKeys(e),r._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(h).catch(h)},y._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var r=this._mediaKeysList[0];if(!r||!r.mediaKeys){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}b.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(r.mediaKeys),this._hasSetMediaKeys=!0}},y._generateRequestWithPreferredKeySession=function(n,r){var h=this,d=this._mediaKeysList[0];if(!d){b.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(d.mediaKeysSessionInitialized){b.logger.warn("Key-Session already initialized but requested again");return}var e=d.mediaKeysSession;if(!e){b.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!r){b.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}b.logger.log('Generating key-session request for "'+n+'" init data type'),d.mediaKeysSessionInitialized=!0,e.generateRequest(n,r).then(function(){b.logger.debug("Key-session generation succeeded")}).catch(function(t){b.logger.error("Error generating key-session request:",t),h.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},y._createLicenseXhr=function(n,r,h){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,n,r,h);var e=this._licenseXhrSetup;if(e)try{e.call(this.hls,d,n),e=void 0}catch(t){b.logger.error(t)}try{d.readyState||d.open("POST",n,!0),e&&e.call(this.hls,d,n)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return d},y._onLicenseRequestReadyStageChange=function(n,r,h,d){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,b.logger.log("License request succeeded");var e=n.response,t=this._licenseResponseCallback;if(t)try{e=t.call(this.hls,n,r)}catch(c){b.logger.error(c)}d(e)}else{if(b.logger.error("License Request XHR failed ("+r+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>C){this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var i=C-this._requestLicenseFailureCount+1;b.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(h,d)}break}},y._generateLicenseRequestChallenge=function(n,r){switch(n.mediaKeySystemDomain){case P.KeySystems.WIDEVINE:return r}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},y._requestLicense=function(n,r){b.logger.log("Requesting content license for key-system");var h=this._mediaKeysList[0];if(!h){b.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var d=this.getLicenseServerUrl(h.mediaKeySystemDomain),e=this._createLicenseXhr(d,n,r);b.logger.log("Sending license request to URL: "+d);var t=this._generateLicenseRequestChallenge(h,n);e.send(t)}catch(i){b.logger.error("Failure requesting DRM license: "+i),this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.KEY_SYSTEM_ERROR,details:I.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},y.onMediaAttached=function(n,r){if(!!this._emeEnabled){var h=r.media;this._media=h,h.addEventListener("encrypted",this._onMediaEncrypted)}},y.onMediaDetached=function(){var n=this._media,r=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(r.map(function(h){if(h.mediaKeysSession)return h.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},y.onManifestParsed=function(n,r){if(!!this._emeEnabled){var h=r.levels.map(function(e){return e.audioCodec}).filter(function(e){return!!e}),d=r.levels.map(function(e){return e.videoCodec}).filter(function(e){return!!e});this._attemptKeySystemAccess(P.KeySystems.WIDEVINE,h,d)}},R(L,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),L}();const D=S},"./src/controller/fps-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>P});var M=u("./src/events.ts"),I=u("./src/utils/logger.ts"),b=function(){function F(C){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=C,this.registerListeners()}var R=F.prototype;return R.setStreamController=function(A){this.streamController=A},R.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(A,T){var S=this.hls.config;if(S.capLevelOnFPSDrop){var D=T.media instanceof self.HTMLVideoElement?T.media:null;this.media=D,D&&typeof D.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(A,T,S){var D=performance.now();if(T){if(this.lastTime){var L=D-this.lastTime,y=S-this.lastDroppedFrames,l=T-this.lastDecodedFrames,n=1e3*y/L,r=this.hls;if(r.trigger(M.Events.FPS_DROP,{currentDropped:y,currentDecoded:l,totalDroppedFrames:S}),n>0&&y>r.config.fpsDroppedMonitoringThreshold*l){var h=r.currentLevel;I.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(r.autoLevelCapping===-1||r.autoLevelCapping>=h)&&(h=h-1,r.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:r.currentLevel}),r.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=D,this.lastDroppedFrames=S,this.lastDecodedFrames=T}},R.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var T=A.getVideoPlaybackQuality();this.checkFPS(A,T.totalVideoFrames,T.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},F}();const P=b},"./src/controller/fragment-finders.ts":(G,k,u)=>{u.r(k),u.d(k,{findFragWithCC:()=>C,findFragmentByPDT:()=>b,findFragmentByPTS:()=>P,fragmentWithinToleranceTest:()=>F,pdtWithinToleranceTest:()=>R});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/binary-search.ts");function b(A,T,S){if(T===null||!Array.isArray(A)||!A.length||!(0,M.isFiniteNumber)(T))return null;var D=A[0].programDateTime;if(T<(D||0))return null;var L=A[A.length-1].endProgramDateTime;if(T>=(L||0))return null;S=S||0;for(var y=0;y<A.length;++y){var l=A[y];if(R(T,S,l))return l}return null}function P(A,T,S,D){S===void 0&&(S=0),D===void 0&&(D=0);var L=null;if(A?L=T[A.sn-T[0].sn+1]||null:S===0&&T[0].start===0&&(L=T[0]),L&&F(S,D,L)===0)return L;var y=I.default.search(T,F.bind(null,S,D));return y||L}function F(A,T,S){A===void 0&&(A=0),T===void 0&&(T=0);var D=Math.min(T,S.duration+(S.deltaPTS?S.deltaPTS:0));return S.start+S.duration-D<=A?1:S.start-D>A&&S.start?-1:0}function R(A,T,S){var D=Math.min(T,S.duration+(S.deltaPTS?S.deltaPTS:0))*1e3,L=S.endProgramDateTime||0;return L-D>A}function C(A,T){return I.default.search(A,function(S){return S.cc<T?1:S.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":(G,k,u)=>{u.r(k),u.d(k,{FragmentState:()=>b,FragmentTracker:()=>P});var M=u("./src/events.ts"),I=u("./src/types/loader.ts"),b;(function(C){C.NOT_LOADED="NOT_LOADED",C.APPENDING="APPENDING",C.PARTIAL="PARTIAL",C.OK="OK"})(b||(b={}));var P=function(){function C(T){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=T,this._registerListeners()}var A=C.prototype;return A._registerListeners=function(){var S=this.hls;S.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},A._unregisterListeners=function(){var S=this.hls;S.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},A.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},A.getAppendedFrag=function(S,D){if(D===I.PlaylistLevelType.MAIN){var L=this.activeFragment,y=this.activeParts;if(!L)return null;if(y)for(var l=y.length;l--;){var n=y[l],r=n?n.end:L.appendedPTS;if(n.start<=S&&r!==void 0&&S<=r)return l>9&&(this.activeParts=y.slice(l-9)),n}else if(L.start<=S&&L.appendedPTS!==void 0&&S<=L.appendedPTS)return L}return this.getBufferedFrag(S,D)},A.getBufferedFrag=function(S,D){for(var L=this.fragments,y=Object.keys(L),l=y.length;l--;){var n=L[y[l]];if((n==null?void 0:n.body.type)===D&&n.buffered){var r=n.body;if(r.start<=S&&S<=r.end)return r}}return null},A.detectEvictedFragments=function(S,D,L){var y=this;Object.keys(this.fragments).forEach(function(l){var n=y.fragments[l];if(!!n){if(!n.buffered){n.body.type===L&&y.removeFragment(n.body);return}var r=n.range[S];!r||r.time.some(function(h){var d=!y.isTimeBuffered(h.startPTS,h.endPTS,D);return d&&y.removeFragment(n.body),d})}})},A.detectPartialFragments=function(S){var D=this,L=this.timeRanges,y=S.frag,l=S.part;if(!(!L||y.sn==="initSegment")){var n=R(y),r=this.fragments[n];!r||(Object.keys(L).forEach(function(h){var d=y.elementaryStreams[h];if(!!d){var e=L[h],t=l!==null||d.partial===!0;r.range[h]=D.getBufferedTimes(y,l,t,e)}}),r.loaded=null,Object.keys(r.range).length?r.buffered=!0:this.removeFragment(r.body))}},A.fragBuffered=function(S){var D=R(S),L=this.fragments[D];L&&(L.loaded=null,L.buffered=!0)},A.getBufferedTimes=function(S,D,L,y){for(var l={time:[],partial:L},n=D?D.start:S.start,r=D?D.end:S.end,h=S.minEndPTS||r,d=S.maxStartPTS||n,e=0;e<y.length;e++){var t=y.start(e)-this.bufferPadding,i=y.end(e)+this.bufferPadding;if(d>=t&&h<=i){l.time.push({startPTS:Math.max(n,y.start(e)),endPTS:Math.min(r,y.end(e))});break}else if(n<i&&r>t)l.partial=!0,l.time.push({startPTS:Math.max(n,y.start(e)),endPTS:Math.min(r,y.end(e))});else if(r<=t)break}return l},A.getPartialFragment=function(S){var D=null,L,y,l,n=0,r=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(d){var e=h[d];!e||F(e)&&(y=e.body.start-r,l=e.body.end+r,S>=y&&S<=l&&(L=Math.min(S-y,l-S),n<=L&&(D=e.body,n=L)))}),D},A.getState=function(S){var D=R(S),L=this.fragments[D];return L?L.buffered?F(L)?b.PARTIAL:b.OK:b.APPENDING:b.NOT_LOADED},A.isTimeBuffered=function(S,D,L){for(var y,l,n=0;n<L.length;n++){if(y=L.start(n)-this.bufferPadding,l=L.end(n)+this.bufferPadding,S>=y&&D<=l)return!0;if(D<=y)return!1}return!1},A.onFragLoaded=function(S,D){var L=D.frag,y=D.part;if(!(L.sn==="initSegment"||L.bitrateTest||y)){var l=R(L);this.fragments[l]={body:L,loaded:D,buffered:!1,range:Object.create(null)}}},A.onBufferAppended=function(S,D){var L=this,y=D.frag,l=D.part,n=D.timeRanges;if(y.type===I.PlaylistLevelType.MAIN)if(this.activeFragment=y,l){var r=this.activeParts;r||(this.activeParts=r=[]),r.push(l)}else this.activeParts=null;this.timeRanges=n,Object.keys(n).forEach(function(h){var d=n[h];if(L.detectEvictedFragments(h,d),!l)for(var e=0;e<d.length;e++)y.appendedPTS=Math.max(d.end(e),y.appendedPTS||0)})},A.onFragBuffered=function(S,D){this.detectPartialFragments(D)},A.hasFragment=function(S){var D=R(S);return!!this.fragments[D]},A.removeFragmentsInRange=function(S,D,L){var y=this;Object.keys(this.fragments).forEach(function(l){var n=y.fragments[l];if(!!n&&n.buffered){var r=n.body;r.type===L&&r.start<D&&r.end>S&&y.removeFragment(r)}})},A.removeFragment=function(S){var D=R(S);S.stats.loaded=0,S.clearElementaryStreamInfo(),delete this.fragments[D]},A.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},C}();function F(C){var A,T;return C.buffered&&(((A=C.range.video)===null||A===void 0?void 0:A.partial)||((T=C.range.audio)===null||T===void 0?void 0:T.partial))}function R(C){return C.type+"_"+C.level+"_"+C.urlId+"_"+C.sn}},"./src/controller/gap-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{MAX_START_GAP_JUMP:()=>R,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>C,SKIP_BUFFER_RANGE_START:()=>A,STALL_MINIMUM_DURATION_MS:()=>F,default:()=>T});var M=u("./src/utils/buffer-helper.ts"),I=u("./src/errors.ts"),b=u("./src/events.ts"),P=u("./src/utils/logger.ts"),F=250,R=2,C=.1,A=.05,T=function(){function S(L,y,l,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=L,this.media=y,this.fragmentTracker=l,this.hls=n}var D=S.prototype;return D.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},D.poll=function(y,l){var n=this.config,r=this.media,h=this.stalled;if(r!==null){var d=r.currentTime,e=r.seeking,t=this.seeking&&!e,i=!this.seeking&&e;if(this.seeking=e,d!==y){if(this.moved=!0,h!==null){if(this.stallReported){var c=self.performance.now()-h;P.logger.warn("playback not stuck anymore @"+d+", after "+Math.round(c)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((i||t)&&(this.stalled=null),!(r.paused&&!e||r.ended||r.playbackRate===0||!M.BufferHelper.getBuffered(r).length)){var f=M.BufferHelper.bufferInfo(r,d,0),g=f.len>0,a=f.nextStart||0;if(!(!g&&!a)){if(e){var p=f.len>R,v=!a||l&&l.start<=d||a-d>R&&!this.fragmentTracker.getPartialFragment(d);if(p||v)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var o,_=Math.max(a,f.start||0)-d,O=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,B=O==null||(o=O.details)===null||o===void 0?void 0:o.live,K=B?O.details.targetduration*2:R;if(_>0&&_<=K){this._trySkipBufferHole(null);return}}var N=self.performance.now();if(h===null){this.stalled=N;return}var W=N-h;if(!(!e&&W>=F&&(this._reportStall(f),!this.media))){var H=M.BufferHelper.bufferInfo(r,d,n.maxBufferHole);this._tryFixBufferStall(H,W)}}}}},D._tryFixBufferStall=function(y,l){var n=this.config,r=this.fragmentTracker,h=this.media;if(h!==null){var d=h.currentTime,e=r.getPartialFragment(d);if(e){var t=this._trySkipBufferHole(e);if(t||!this.media)return}y.len>n.maxBufferHole&&l>n.highBufferWatchdogPeriod*1e3&&(P.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},D._reportStall=function(y){var l=this.hls,n=this.media,r=this.stallReported;!r&&n&&(this.stallReported=!0,P.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer ("+JSON.stringify(y)+")"),l.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y.len}))},D._trySkipBufferHole=function(y){var l=this.config,n=this.hls,r=this.media;if(r===null)return 0;for(var h=r.currentTime,d=0,e=M.BufferHelper.getBuffered(r),t=0;t<e.length;t++){var i=e.start(t);if(h+l.maxBufferHole>=d&&h<i){var c=Math.max(i+A,r.currentTime+C);return P.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+c),this.moved=!0,this.stalled=null,r.currentTime=c,y&&n.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+c,frag:y}),c}d=e.end(t)}return 0},D._tryNudgeBuffer=function(){var y=this.config,l=this.hls,n=this.media,r=this.nudgeRetry;if(n!==null){var h=n.currentTime;if(this.nudgeRetry++,r<y.nudgeMaxRetry){var d=h+(r+1)*y.nudgeOffset;P.logger.warn("Nudging 'currentTime' from "+h+" to "+d),n.currentTime=d,l.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else P.logger.error("Playhead still not moving while enough data buffered @"+h+" after "+y.nudgeMaxRetry+" nudges"),l.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},S}()},"./src/controller/id3-track-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>y});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/utils/texttrack-utils.ts"),P=u("./src/demux/id3.ts"),F=u("./src/loader/date-range.ts"),R=u("./src/types/demuxer.ts"),C=.25;function A(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var T=function(){var l=A();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function S(l,n){return l.getTime()/1e3-n}function D(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var L=function(){function l(r){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=r,this._registerListeners()}var n=l.prototype;return n.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},n._registerListeners=function(){var h=this.hls;h.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),h.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n._unregisterListeners=function(){var h=this.hls;h.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),h.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.off(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),h.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),h.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},n.onMediaAttached=function(h,d){this.media=d.media},n.onMediaDetaching=function(){!this.id3Track||((0,b.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},n.onManifestLoading=function(){this.dateRangeCuesAppended={}},n.createTrack=function(h){var d=this.getID3Track(h.textTracks);return d.mode="hidden",d},n.getID3Track=function(h){if(!!this.media){for(var d=0;d<h.length;d++){var e=h[d];if(e.kind==="metadata"&&e.label==="id3")return(0,b.sendAddTrackEvent)(e,this.media),e}return this.media.addTextTrack("metadata","id3")}},n.onFragParsingMetadata=function(h,d){if(!!this.media){var e=this.hls.config,t=e.enableEmsgMetadataCues,i=e.enableID3MetadataCues;if(!(!t&&!i)){d.frag;var c=d.samples;d.details,this.id3Track||(this.id3Track=this.createTrack(this.media));for(var f=A(),g=0;g<c.length;g++){var a=c[g].type;if(!(a===R.MetadataSchema.emsg&&!t||!i)){var p=P.getID3Frames(c[g].data);if(p){var v=c[g].pts,o=v+c[g].duration;o>T&&(o=T);var _=o-v;_<=0&&(o=v+C);for(var O=0;O<p.length;O++){var B=p[O];if(!P.isTimeStampFrame(B)){this.updateId3CueEnds(v);var K=new f(v,o,"");K.value=B,a&&(K.type=a),this.id3Track.addCue(K)}}}}}}}},n.updateId3CueEnds=function(h){var d,e=(d=this.id3Track)===null||d===void 0?void 0:d.cues;if(e)for(var t=e.length;t--;){var i=e[t];i.startTime<h&&i.endTime===T&&(i.endTime=h)}},n.onBufferFlushing=function(h,d){var e=d.startOffset,t=d.endOffset,i=d.type,c=this.id3Track,f=this.hls;if(!!f){var g=f.config,a=g.enableEmsgMetadataCues,p=g.enableID3MetadataCues;if(c&&(a||p)){var v;i==="audio"?v=function(_){return _.type===R.MetadataSchema.audioId3&&p}:i==="video"?v=function(_){return _.type===R.MetadataSchema.emsg&&a}:v=function(_){return _.type===R.MetadataSchema.audioId3&&p||_.type===R.MetadataSchema.emsg&&a},(0,b.removeCuesInRange)(c,e,t,v)}}},n.onLevelUpdated=function(h,d){var e=this,t=d.details;if(!(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var i=this.dateRangeCuesAppended,c=this.id3Track,f=t.dateRanges,g=Object.keys(f);if(c)for(var a=Object.keys(i).filter(function(N){return!g.includes(N)}),p=function(W){var H=a[W];Object.keys(i[H].cues).forEach(function(V){c.removeCue(i[H].cues[V])}),delete i[H]},v=a.length;v--;)p(v);var o=t.fragments[t.fragments.length-1];if(!(g.length===0||!(0,M.isFiniteNumber)(o==null?void 0:o.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var _=o.programDateTime/1e3-o.start,O=A(),B=function(W){var H=g[W],V=f[H],j=i[H],z=(j==null?void 0:j.cues)||{},$=(j==null?void 0:j.durationKnown)||!1,Y=S(V.startDate,_),X=T,Q=V.endDate;if(Q)X=S(Q,_),$=!0;else if(V.endOnNext&&!$){var q=g.reduce(function(le,oe){var de=f[oe];return de.class===V.class&&de.id!==oe&&de.startDate>V.startDate&&le.push(de),le},[]).sort(function(le,oe){return le.startDate.getTime()-oe.startDate.getTime()})[0];q&&(X=S(q.startDate,_),$=!0)}for(var J=Object.keys(V.attr),ie=0;ie<J.length;ie++){var se=J[ie];if(!(se===F.DateRangeAttribute.ID||se===F.DateRangeAttribute.CLASS||se===F.DateRangeAttribute.START_DATE||se===F.DateRangeAttribute.DURATION||se===F.DateRangeAttribute.END_DATE||se===F.DateRangeAttribute.END_ON_NEXT)){var Z=z[se];if(Z)$&&!j.durationKnown&&(Z.endTime=X);else{var re=V.attr[se];Z=new O(Y,X,""),(se===F.DateRangeAttribute.SCTE35_OUT||se===F.DateRangeAttribute.SCTE35_IN)&&(re=D(re)),Z.value={key:se,data:re},Z.type=R.MetadataSchema.dateRange,e.id3Track.addCue(Z),z[se]=Z}}}i[H]={cues:z,dateRange:V,durationKnown:$}},K=0;K<g.length;K++)B(K)}}},l}();const y=L},"./src/controller/latency-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>R});var M=u("./src/errors.ts"),I=u("./src/events.ts"),b=u("./src/utils/logger.ts");function P(C,A){for(var T=0;T<A.length;T++){var S=A[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(C,S.key,S)}}function F(C,A,T){return A&&P(C.prototype,A),T&&P(C,T),Object.defineProperty(C,"prototype",{writable:!1}),C}var R=function(){function C(T){var S=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return S.timeupdate()},this.hls=T,this.config=T.config,this.registerListeners()}var A=C.prototype;return A.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},A.registerListeners=function(){this.hls.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(I.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(I.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){this.hls.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(I.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(I.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(I.Events.ERROR,this.onError)},A.onMediaAttached=function(S,D){this.media=D.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},A.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},A.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},A.onLevelUpdated=function(S,D){var L=D.details;this.levelDetails=L,L.advanced&&this.timeupdate(),!L.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},A.onError=function(S,D){D.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},A.timeupdate=function(){var S=this.media,D=this.levelDetails;if(!(!S||!D)){this.currentTime=S.currentTime;var L=this.computeLatency();if(L!==null){this._latency=L;var y=this.config,l=y.lowLatencyMode,n=y.maxLiveSyncPlaybackRate;if(!(!l||n===1)){var r=this.targetLatency;if(r!==null){var h=L-r,d=Math.min(this.maxLatency,r+D.targetduration),e=h<d;if(D.live&&e&&h>.05&&this.forwardBufferLength>1){var t=Math.min(2,Math.max(1,n)),i=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;S.playbackRate=Math.min(t,Math.max(1,i))}else S.playbackRate!==1&&S.playbackRate!==0&&(S.playbackRate=1)}}}}},A.estimateLiveEdge=function(){var S=this.levelDetails;return S===null?null:S.edge+S.age},A.computeLatency=function(){var S=this.estimateLiveEdge();return S===null?null:S-this.currentTime},F(C,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var S=this.config,D=this.levelDetails;return S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:D?S.liveMaxLatencyDurationCount*D.targetduration:0}},{key:"targetLatency",get:function(){var S=this.levelDetails;if(S===null)return null;var D=S.holdBack,L=S.partHoldBack,y=S.targetduration,l=this.config,n=l.liveSyncDuration,r=l.liveSyncDurationCount,h=l.lowLatencyMode,d=this.hls.userConfig,e=h&&L||D;(d.liveSyncDuration||d.liveSyncDurationCount||e===0)&&(e=n!==void 0?n:r*y);var t=y,i=1;return e+Math.min(this.stallCount*i,t)}},{key:"liveSyncPosition",get:function(){var S=this.estimateLiveEdge(),D=this.targetLatency,L=this.levelDetails;if(S===null||D===null||L===null)return null;var y=L.edge,l=S-D-this.edgeStalled,n=y-L.totalduration,r=y-(this.config.lowLatencyMode&&L.partTarget||L.targetduration);return Math.min(Math.max(n,l),r)}},{key:"drift",get:function(){var S=this.levelDetails;return S===null?1:S.drift}},{key:"edgeStalled",get:function(){var S=this.levelDetails;if(S===null)return 0;var D=(this.config.lowLatencyMode&&S.partTarget||S.targetduration)*3;return Math.max(S.age-D,0)}},{key:"forwardBufferLength",get:function(){var S=this.media,D=this.levelDetails;if(!S||!D)return 0;var L=S.buffered.length;return(L?S.buffered.end(L-1):D.edge)-this.currentTime}}]),C}()},"./src/controller/level-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>l});var M=u("./src/types/level.ts"),I=u("./src/events.ts"),b=u("./src/errors.ts"),P=u("./src/utils/codecs.ts"),F=u("./src/controller/level-helper.ts"),R=u("./src/controller/base-playlist-controller.ts"),C=u("./src/types/loader.ts");function A(){return A=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var h=arguments[r];for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(n[d]=h[d])}return n},A.apply(this,arguments)}function T(n,r){for(var h=0;h<r.length;h++){var d=r[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(n,d.key,d)}}function S(n,r,h){return r&&T(n.prototype,r),h&&T(n,h),Object.defineProperty(n,"prototype",{writable:!1}),n}function D(n,r){n.prototype=Object.create(r.prototype),n.prototype.constructor=n,L(n,r)}function L(n,r){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,e){return d.__proto__=e,d},L(n,r)}var y=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),l=function(n){D(r,n);function r(d){var e;return e=n.call(this,d,"[level-controller]")||this,e._levels=[],e._firstLevel=-1,e._startLevel=void 0,e.currentLevelIndex=-1,e.manualLevelIndex=-1,e.onParsedComplete=void 0,e._registerListeners(),e}var h=r.prototype;return h._registerListeners=function(){var e=this.hls;e.on(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(I.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(I.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var e=this.hls;e.off(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(I.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(I.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,n.prototype.destroy.call(this)},h.startLoad=function(){var e=this._levels;e.forEach(function(t){t.loadError=0}),n.prototype.startLoad.call(this)},h.onManifestLoaded=function(e,t){var i=[],c=[],f=[],g,a={},p,v=!1,o=!1,_=!1;if(t.levels.forEach(function(N){var W=N.attrs;v=v||!!(N.width&&N.height),o=o||!!N.videoCodec,_=_||!!N.audioCodec,y&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0);var H=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;p=a[H],p?p.url.push(N.url):(p=new M.Level(N),a[H]=p,i.push(p)),W&&(W.AUDIO&&(0,F.addGroupId)(p,"audio",W.AUDIO),W.SUBTITLES&&(0,F.addGroupId)(p,"text",W.SUBTITLES))}),(v||o)&&_&&(i=i.filter(function(N){var W=N.videoCodec,H=N.width,V=N.height;return!!W||!!(H&&V)})),i=i.filter(function(N){var W=N.audioCodec,H=N.videoCodec;return(!W||(0,P.isCodecSupportedInMp4)(W,"audio"))&&(!H||(0,P.isCodecSupportedInMp4)(H,"video"))}),t.audioTracks&&(c=t.audioTracks.filter(function(N){return!N.audioCodec||(0,P.isCodecSupportedInMp4)(N.audioCodec,"audio")}),(0,F.assignTrackIdsByGroup)(c)),t.subtitles&&(f=t.subtitles,(0,F.assignTrackIdsByGroup)(f)),i.length>0){g=i[0].bitrate,i.sort(function(N,W){return N.bitrate-W.bitrate}),this._levels=i;for(var O=0;O<i.length;O++)if(i[O].bitrate===g){this._firstLevel=O,this.log("manifest loaded, "+i.length+" level(s) found, first bitrate: "+g);break}var B=_&&!o,K={levels:i,audioTracks:c,subtitleTracks:f,firstLevel:this._firstLevel,stats:t.stats,audio:_,video:o,altAudio:!B&&c.some(function(N){return!!N.url})};this.hls.trigger(I.Events.MANIFEST_PARSED,K),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(I.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(e,t){var i;if(n.prototype.onError.call(this,e,t),!t.fatal){var c=t.context,f=this._levels[this.currentLevelIndex];if(c&&(c.type===C.PlaylistContextType.AUDIO_TRACK&&f.audioGroupIds&&c.groupId===f.audioGroupIds[f.urlId]||c.type===C.PlaylistContextType.SUBTITLE_TRACK&&f.textGroupIds&&c.groupId===f.textGroupIds[f.urlId])){this.redundantFailover(this.currentLevelIndex);return}var g=!1,a=!0,p;switch(t.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(t.frag){var v=t.frag.type===C.PlaylistLevelType.MAIN?t.frag.level:this.currentLevelIndex,o=this._levels[v];o?(o.fragmentError++,o.fragmentError>this.hls.config.fragLoadingMaxRetry&&(p=v)):p=v}break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:c&&(c.deliveryDirectives&&(a=!1),p=c.level),g=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:p=(i=t.level)!=null?i:this.currentLevelIndex,g=!0;break}p!==void 0&&this.recoverLevel(t,p,g,a)}},h.recoverLevel=function(e,t,i,c){var f=e.details,g=this._levels[t];if(g.loadError++,i){var a=this.retryLoadingOrFail(e);if(a)e.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(c){var p=g.url.length;if(p>1&&g.loadError<p)e.levelRetry=!0,this.redundantFailover(t);else if(this.manualLevelIndex===-1){for(var v=-1,o=this._levels,_=o.length;_--;){var O=(_+this.currentLevelIndex)%o.length;if(O!==this.currentLevelIndex&&o[O].loadError===0){v=O;break}}v>-1&&this.currentLevelIndex!==v&&(this.warn(f+": switch to "+v),e.levelRetry=!0,this.hls.nextAutoLevel=v)}}},h.redundantFailover=function(e){var t=this._levels[e],i=t.url.length;if(i>1){var c=(t.urlId+1)%i;this.warn("Switching to redundant URL-id "+c),this._levels.forEach(function(f){f.urlId=c}),this.level=e}},h.onFragLoaded=function(e,t){var i=t.frag;if(i!==void 0&&i.type===C.PlaylistLevelType.MAIN){var c=this._levels[i.level];c!==void 0&&(c.fragmentError=0,c.loadError=0)}},h.onLevelLoaded=function(e,t){var i,c=t.level,f=t.details,g=this._levels[c];if(!g){var a;this.warn("Invalid level index "+c),(a=t.deliveryDirectives)!==null&&a!==void 0&&a.skip&&(f.deltaUpdateFailed=!0);return}c===this.currentLevelIndex?(g.fragmentError===0&&(g.loadError=0,this.retryCount=0),this.playlistLoaded(c,t,g.details)):(i=t.deliveryDirectives)!==null&&i!==void 0&&i.skip&&(f.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(e,t){var i=this.hls.levels[this.currentLevelIndex];if(!!i&&i.audioGroupIds){for(var c=-1,f=this.hls.audioTracks[t.id].groupId,g=0;g<i.audioGroupIds.length;g++)if(i.audioGroupIds[g]===f){c=g;break}c!==i.urlId&&(i.urlId=c,this.startLoad())}},h.loadPlaylist=function(e){var t=this.currentLevelIndex,i=this._levels[t];if(this.canLoad&&i&&i.url.length>0){var c=i.urlId,f=i.url[c];if(e)try{f=e.addDirectives(f)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Attempt loading level index "+t+(e?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+c+" "+f),this.clearTimer(),this.hls.trigger(I.Events.LEVEL_LOADING,{url:f,level:t,id:c,deliveryDirectives:e||null})}},h.removeLevel=function(e,t){var i=function(g,a){return a!==t},c=this._levels.filter(function(f,g){return g!==e?!0:f.url.length>1&&t!==void 0?(f.url=f.url.filter(i),f.audioGroupIds&&(f.audioGroupIds=f.audioGroupIds.filter(i)),f.textGroupIds&&(f.textGroupIds=f.textGroupIds.filter(i)),f.urlId=0,!0):!1}).map(function(f,g){var a=f.details;return a!=null&&a.fragments&&a.fragments.forEach(function(p){p.level=g}),f});this._levels=c,this.hls.trigger(I.Events.LEVELS_UPDATED,{levels:c})},S(r,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t,i=this._levels;if(i.length!==0&&!(this.currentLevelIndex===e&&(t=i[e])!==null&&t!==void 0&&t.details)){if(e<0||e>=i.length){var c=e<0;if(this.hls.trigger(I.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:c,reason:"invalid level idx"}),c)return;e=Math.min(e,i.length-1)}this.clearTimer();var f=this.currentLevelIndex,g=i[f],a=i[e];this.log("switching to level "+e+" from "+f),this.currentLevelIndex=e;var p=A({},a,{level:e,maxBitrate:a.maxBitrate,uri:a.uri,urlId:a.urlId});delete p._urlId,this.hls.trigger(I.Events.LEVEL_SWITCHING,p);var v=a.details;if(!v||v.live){var o=this.switchParams(a.uri,g==null?void 0:g.details);this.loadPlaylist(o)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var e=this.hls.config.startLevel;return e!==void 0?e:this._firstLevel}else return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}}]),r}(R.default)},"./src/controller/level-helper.ts":(G,k,u)=>{u.r(k),u.d(k,{addGroupId:()=>F,addSliding:()=>n,adjustSliding:()=>l,assignTrackIdsByGroup:()=>R,computeReloadInterval:()=>r,getFragmentWithSN:()=>h,getPartWith:()=>d,mapFragmentIntersection:()=>y,mapPartIntersection:()=>L,mergeDetails:()=>S,updateFragPTSDTS:()=>T,updatePTS:()=>C});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/logger.ts"),b=u("./src/loader/date-range.ts");function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c])}return e},P.apply(this,arguments)}function F(e,t,i){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(i);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(i);break}}function R(e){var t={};e.forEach(function(i){var c=i.groupId||"";i.id=t[c]=t[c]||0,t[c]++})}function C(e,t,i){var c=e[t],f=e[i];A(c,f)}function A(e,t){var i=t.startPTS;if((0,M.isFiniteNumber)(i)){var c=0,f;t.sn>e.sn?(c=i-e.start,f=e):(c=e.start-i,f=t),f.duration!==c&&(f.duration=c)}else if(t.sn>e.sn){var g=e.cc===t.cc;g&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function T(e,t,i,c,f,g){var a=c-i;a<=0&&(I.logger.warn("Fragment should have a positive duration",t),c=i+t.duration,g=f+t.duration);var p=i,v=c,o=t.startPTS,_=t.endPTS;if((0,M.isFiniteNumber)(o)){var O=Math.abs(o-i);(0,M.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(O,t.deltaPTS):t.deltaPTS=O,p=Math.max(i,o),i=Math.min(i,o),f=Math.min(f,t.startDTS),v=Math.min(c,_),c=Math.max(c,_),g=Math.max(g,t.endDTS)}t.duration=c-i;var B=i-t.start;t.appendedPTS=c,t.start=t.startPTS=i,t.maxStartPTS=p,t.startDTS=f,t.endPTS=c,t.minEndPTS=v,t.endDTS=g;var K=t.sn;if(!e||K<e.startSN||K>e.endSN)return 0;var N,W=K-e.startSN,H=e.fragments;for(H[W]=t,N=W;N>0;N--)A(H[N],H[N-1]);for(N=W;N<H.length-1;N++)A(H[N],H[N+1]);return e.fragmentHint&&A(H[H.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,B}function S(e,t){for(var i=null,c=e.fragments,f=c.length-1;f>=0;f--){var g=c[f].initSegment;if(g){i=g;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var a=0,p;if(y(e,t,function(N,W){N.relurl&&(a=N.cc-W.cc),(0,M.isFiniteNumber)(N.startPTS)&&(0,M.isFiniteNumber)(N.endPTS)&&(W.start=W.startPTS=N.startPTS,W.startDTS=N.startDTS,W.appendedPTS=N.appendedPTS,W.maxStartPTS=N.maxStartPTS,W.endPTS=N.endPTS,W.endDTS=N.endDTS,W.minEndPTS=N.minEndPTS,W.duration=N.endPTS-N.startPTS,W.duration&&(p=W),t.PTSKnown=t.alignedSliding=!0),W.elementaryStreams=N.elementaryStreams,W.loader=N.loader,W.stats=N.stats,W.urlId=N.urlId,N.initSegment&&(W.initSegment=N.initSegment,i=N.initSegment)}),i){var v=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;v.forEach(function(N){var W;(!N.initSegment||N.initSegment.relurl===((W=i)===null||W===void 0?void 0:W.relurl))&&(N.initSegment=i)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(N){return!N}),t.deltaUpdateFailed){I.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var o=t.skippedSegments;o--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=D(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var _=t.fragments;if(a){I.logger.warn("discontinuity sliding from playlist, take drift into account");for(var O=0;O<_.length;O++)_[O].cc+=a}t.skippedSegments&&(t.startCC=t.fragments[0].cc),L(e.partList,t.partList,function(N,W){W.elementaryStreams=N.elementaryStreams,W.stats=N.stats}),p?T(t,p,p.startPTS,p.endPTS,p.startDTS,p.endDTS):l(e,t),_.length&&(t.totalduration=t.edge-_[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var B=t.advancedDateTime;if(t.advanced&&B){var K=t.edge;t.driftStart||(t.driftStartTime=B,t.driftStart=K),t.driftEndTime=B,t.driftEnd=K}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function D(e,t,i){var c=P({},e);return i&&i.forEach(function(f){delete c[f]}),Object.keys(t).forEach(function(f){var g=new b.DateRange(t[f].attr,c[f]);g.isValid?c[f]=g:I.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[f].attr)+'"')}),c}function L(e,t,i){if(e&&t)for(var c=0,f=0,g=e.length;f<=g;f++){var a=e[f],p=t[f+c];a&&p&&a.index===p.index&&a.fragment.sn===p.fragment.sn?i(a,p):c--}}function y(e,t,i){for(var c=t.skippedSegments,f=Math.max(e.startSN,t.startSN)-t.startSN,g=(e.fragmentHint?1:0)+(c?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,a=t.startSN-e.startSN,p=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,v=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,o=f;o<=g;o++){var _=v[a+o],O=p[o];c&&!O&&o<c&&(O=t.fragments[o]=_),_&&O&&i(_,O)}}function l(e,t){var i=t.startSN+t.skippedSegments-e.startSN,c=e.fragments;i<0||i>=c.length||n(t,c[i].start)}function n(e,t){if(t){for(var i=e.fragments,c=e.skippedSegments;c<i.length;c++)i[c].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function r(e,t){var i=1e3*e.levelTargetDuration,c=i/2,f=e.age,g=f>0&&f<i*3,a=t.loading.end-t.loading.start,p,v=e.availabilityDelay;if(e.updated===!1)if(g){var o=333*e.misses;p=Math.max(Math.min(c,a*2),o),e.availabilityDelay=(e.availabilityDelay||0)+p}else p=c;else g?(v=Math.min(v||i/2,f),e.availabilityDelay=v,p=v+i-f):p=i-a;return Math.round(p)}function h(e,t,i){if(!e||!e.details)return null;var c=e.details,f=c.fragments[t-c.startSN];return f||(f=c.fragmentHint,f&&f.sn===t)?f:t<c.startSN&&i&&i.sn===t?i:null}function d(e,t,i){if(!e||!e.details)return null;var c=e.details.partList;if(c)for(var f=c.length;f--;){var g=c[f];if(g.index===i&&g.fragment.sn===t)return g}return null}},"./src/controller/stream-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>d});var M=u("./src/polyfills/number.ts"),I=u("./src/controller/base-stream-controller.ts"),b=u("./src/is-supported.ts"),P=u("./src/events.ts"),F=u("./src/utils/buffer-helper.ts"),R=u("./src/controller/fragment-tracker.ts"),C=u("./src/types/loader.ts"),A=u("./src/loader/fragment.ts"),T=u("./src/demux/transmuxer-interface.ts"),S=u("./src/types/transmuxer.ts"),D=u("./src/controller/gap-controller.ts"),L=u("./src/errors.ts");function y(e,t){for(var i=0;i<t.length;i++){var c=t[i];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function l(e,t,i){return t&&y(e.prototype,t),i&&y(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,f){return c.__proto__=f,c},r(e,t)}var h=100,d=function(e){n(t,e);function t(c,f){var g;return g=e.call(this,c,f,"[stream-controller]")||this,g.audioCodecSwap=!1,g.gapController=null,g.level=-1,g._forceStartLoad=!1,g.altAudio=!1,g.audioOnly=!1,g.fragPlaying=null,g.onvplaying=null,g.onvseeked=null,g.fragLastKbps=0,g.couldBacktrack=!1,g.backtrackFragment=null,g.audioCodecSwitch=!1,g.videoBuffer=null,g._registerListeners(),g}var i=t.prototype;return i._registerListeners=function(){var f=this.hls;f.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),f.on(P.Events.ERROR,this.onError,this),f.on(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.on(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.on(P.Events.BUFFER_CREATED,this.onBufferCreated,this),f.on(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.on(P.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),f.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var f=this.hls;f.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),f.off(P.Events.ERROR,this.onError,this),f.off(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.off(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),f.off(P.Events.BUFFER_CREATED,this.onBufferCreated,this),f.off(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.off(P.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),f.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(f){if(this.levels){var g=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var p=a.startLevel;p===-1&&(a.config.testBandwidth&&this.levels.length>1?(p=0,this.bitrateTest=!0):p=a.nextAutoLevel),this.level=a.nextLoadLevel=p,this.loadedmetadata=!1}g>0&&f===-1&&(this.log("Override startPosition with lastCurrentTime @"+g.toFixed(3)),f=g),this.state=I.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()}else this._forceStartLoad=!0,this.state=I.State.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case I.State.IDLE:this.doTickIdle();break;case I.State.WAITING_LEVEL:{var f,g=this.levels,a=this.level,p=g==null||(f=g[a])===null||f===void 0?void 0:f.details;if(p&&(!p.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(p))break;this.state=I.State.IDLE;break}break}case I.State.FRAG_LOADING_WAITING_RETRY:{var v,o=self.performance.now(),_=this.retryDate;(!_||o>=_||(v=this.media)!==null&&v!==void 0&&v.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=I.State.IDLE)}break}this.onTickEnd()},i.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var f,g,a=this.hls,p=this.levelLastLoaded,v=this.levels,o=this.media,_=a.config,O=a.nextLoadLevel;if(!(p===null||!o&&(this.startFragRequested||!_.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!v||!v[O])){var B=v[O];this.level=a.nextLoadLevel=O;var K=B.details;if(!K||this.state===I.State.WAITING_LEVEL||K.live&&this.levelLastLoaded!==O){this.state=I.State.WAITING_LEVEL;return}var N=this.getMainFwdBufferInfo();if(N!==null){var W=N.len,H=this.getMaxBufferLength(B.maxBitrate);if(!(W>=H)){if(this._streamEnded(N,K)){var V={};this.altAudio&&(V.type="video"),this.hls.trigger(P.Events.BUFFER_EOS,V),this.state=I.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>N.end&&(this.backtrackFragment=null);var j=this.backtrackFragment?this.backtrackFragment.start:N.end,z=this.getNextFragment(j,K);if(this.couldBacktrack&&!this.fragPrevious&&z&&z.sn!=="initSegment"&&this.fragmentTracker.getState(z)!==R.FragmentState.OK){var $,Y=(($=this.backtrackFragment)!=null?$:z).sn,X=Y-K.startSN,Q=K.fragments[X-1];Q&&z.cc===Q.cc&&(z=Q,this.fragmentTracker.removeFragment(Q))}else this.backtrackFragment&&N.len&&(this.backtrackFragment=null);if(z&&this.fragmentTracker.getState(z)===R.FragmentState.OK&&this.nextLoadPosition>j){var q=this.audioOnly&&!this.altAudio?A.ElementaryStreamTypes.AUDIO:A.ElementaryStreamTypes.VIDEO;o&&this.afterBufferFlushed(o,q,C.PlaylistLevelType.MAIN),z=this.getNextFragment(this.nextLoadPosition,K)}!z||(z.initSegment&&!z.initSegment.data&&!this.bitrateTest&&(z=z.initSegment),((f=z.decryptdata)===null||f===void 0?void 0:f.keyFormat)==="identity"&&!((g=z.decryptdata)!==null&&g!==void 0&&g.key)?this.loadKey(z,K):this.loadFragment(z,K,j))}}}},i.loadFragment=function(f,g,a){var p,v=this.fragmentTracker.getState(f);this.fragCurrent=f,v===R.FragmentState.NOT_LOADED?f.sn==="initSegment"?this._loadInitSegment(f):this.bitrateTest?(this.log("Fragment "+f.sn+" of level "+f.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(f)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,f,g,a)):v===R.FragmentState.APPENDING?this.reduceMaxBufferLength(f.duration)&&this.fragmentTracker.removeFragment(f):((p=this.media)===null||p===void 0?void 0:p.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},i.getAppendedFrag=function(f){var g=this.fragmentTracker.getAppendedFrag(f,C.PlaylistLevelType.MAIN);return g&&"fragment"in g?g.fragment:g},i.getBufferedFrag=function(f){return this.fragmentTracker.getBufferedFrag(f,C.PlaylistLevelType.MAIN)},i.followingBufferedFrag=function(f){return f?this.getBufferedFrag(f.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var f=this.levels,g=this.media;if(g!=null&&g.readyState){var a,p=this.getAppendedFrag(g.currentTime);if(p&&p.start>1&&this.flushMainBuffer(0,p.start-1),!g.paused&&f){var v=this.hls.nextLoadLevel,o=f[v],_=this.fragLastKbps;_&&this.fragCurrent?a=this.fragCurrent.duration*o.maxBitrate/(1e3*_)+1:a=0}else a=0;var O=this.getBufferedFrag(g.currentTime+a);if(O){var B=this.followingBufferedFrag(O);if(B){this.abortCurrentFrag();var K=B.maxStartPTS?B.maxStartPTS:B.start,N=B.duration,W=Math.max(O.end,K+Math.min(Math.max(N-this.config.maxFragLookUpTolerance,N*.5),N*.75));this.flushMainBuffer(W,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var f=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,f!=null&&f.loader&&f.loader.abort(),this.state){case I.State.KEY_LOADING:case I.State.FRAG_LOADING:case I.State.FRAG_LOADING_WAITING_RETRY:case I.State.PARSING:case I.State.PARSED:this.state=I.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(f,g){e.prototype.flushMainBuffer.call(this,f,g,this.altAudio?"video":null)},i.onMediaAttached=function(f,g){e.prototype.onMediaAttached.call(this,f,g);var a=g.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),a.addEventListener("playing",this.onvplaying),a.addEventListener("seeked",this.onvseeked),this.gapController=new D.default(this.config,a,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var f=this.media;f&&this.onvplaying&&this.onvseeked&&(f.removeEventListener("playing",this.onvplaying),f.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var f=this.media,g=f?f.currentTime:null;(0,M.isFiniteNumber)(g)&&this.log("Media seeked to "+g.toFixed(3)),this.tick()},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(P.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},i.onManifestParsed=function(f,g){var a=!1,p=!1,v;g.levels.forEach(function(o){v=o.audioCodec,v&&(v.indexOf("mp4a.40.2")!==-1&&(a=!0),v.indexOf("mp4a.40.5")!==-1&&(p=!0))}),this.audioCodecSwitch=a&&p&&!(0,b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=g.levels,this.startFragRequested=!1},i.onLevelLoading=function(f,g){var a=this.levels;if(!(!a||this.state!==I.State.IDLE)){var p=a[g.level];(!p.details||p.details.live&&this.levelLastLoaded!==g.level||this.waitForCdnTuneIn(p.details))&&(this.state=I.State.WAITING_LEVEL)}},i.onLevelLoaded=function(f,g){var a,p=this.levels,v=g.level,o=g.details,_=o.totalduration;if(!p){this.warn("Levels were reset while loading level "+v);return}this.log("Level "+v+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+_);var O=this.fragCurrent;O&&(this.state===I.State.FRAG_LOADING||this.state===I.State.FRAG_LOADING_WAITING_RETRY)&&O.level!==g.level&&O.loader&&(this.state=I.State.IDLE,this.backtrackFragment=null,O.loader.abort());var B=p[v],K=0;if(o.live||(a=B.details)!==null&&a!==void 0&&a.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;K=this.alignPlaylists(o,B.details)}if(B.details=o,this.levelLastLoaded=v,this.hls.trigger(P.Events.LEVEL_UPDATED,{details:o,level:v}),this.state===I.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=I.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,K),this.tick()},i._handleFragmentLoadProgress=function(f){var g,a=f.frag,p=f.part,v=f.payload,o=this.levels;if(!o){this.warn("Levels were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");return}var _=o[a.level],O=_.details;if(!O){this.warn("Dropping fragment "+a.sn+" of level "+a.level+" after level details were reset");return}var B=_.videoCodec,K=O.PTSKnown||!O.live,N=(g=a.initSegment)===null||g===void 0?void 0:g.data,W=this._getAudioCodec(_),H=this.transmuxer=this.transmuxer||new T.default(this.hls,C.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),V=p?p.index:-1,j=V!==-1,z=new S.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,v.byteLength,V,j),$=this.initPTS[a.cc];H.push(v,N,W,B,a,p,O.totalduration,K,z,$)},i.onAudioTrackSwitching=function(f,g){var a=this.altAudio,p=!!g.url,v=g.id;if(!p){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var o=this.fragCurrent;o!=null&&o.loader&&(this.log("Switching to main audio track, cancel main fragment load"),o.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var _=this.hls;a&&_.trigger(P.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),_.trigger(P.Events.AUDIO_TRACK_SWITCHED,{id:v})}},i.onAudioTrackSwitched=function(f,g){var a=g.id,p=!!this.hls.audioTracks[a].url;if(p){var v=this.videoBuffer;v&&this.mediaBuffer!==v&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=v)}this.altAudio=p,this.tick()},i.onBufferCreated=function(f,g){var a=g.tracks,p,v,o=!1;for(var _ in a){var O=a[_];if(O.id==="main"){if(v=_,p=O,_==="video"){var B=a[_];B&&(this.videoBuffer=B.buffer)}}else o=!0}o&&p?(this.log("Alternate track found, use "+v+".buffered to schedule main fragment loading"),this.mediaBuffer=p.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(f,g){var a=g.frag,p=g.part;if(!(a&&a.type!==C.PlaylistLevelType.MAIN)){if(this.fragContextChanged(a)){this.warn("Fragment "+a.sn+(p?" p: "+p.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state),this.state===I.State.PARSED&&(this.state=I.State.IDLE);return}var v=p?p.stats:a.stats;this.fragLastKbps=Math.round(8*v.total/(v.buffering.end-v.loading.first)),a.sn!=="initSegment"&&(this.fragPrevious=a),this.fragBufferedComplete(a,p)}},i.onError=function(f,g){switch(g.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(C.PlaylistLevelType.MAIN,g);break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==I.State.ERROR&&(g.fatal?(this.warn(""+g.details),this.state=I.State.ERROR):!g.levelRetry&&this.state===I.State.WAITING_LEVEL&&(this.state=I.State.IDLE));break;case L.ErrorDetails.BUFFER_FULL_ERROR:if(g.parent==="main"&&(this.state===I.State.PARSING||this.state===I.State.PARSED)){var a=!0,p=this.getFwdBufferInfo(this.media,C.PlaylistLevelType.MAIN);p&&p.len>.5&&(a=!this.reduceMaxBufferLength(p.len)),a&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},i.checkBuffer=function(){var f=this.media,g=this.gapController;if(!(!f||!g||!f.readyState)){if(this.loadedmetadata||!F.BufferHelper.getBuffered(f).length){var a=this.state!==I.State.IDLE?this.fragCurrent:null;g.poll(this.lastCurrentTime,a)}this.lastCurrentTime=f.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=I.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(f,g){var a=g.type;if(a!==A.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var p=(a===A.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(p,a,C.PlaylistLevelType.MAIN)}},i.onLevelsUpdated=function(f,g){this.levels=g.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var f=this.media;if(!!f){var g=f.currentTime,a=this.startPosition;if(a>=0&&g<a){if(f.seeking){this.log("could not seek to "+a+", already seeking at "+g);return}var p=F.BufferHelper.getBuffered(f),v=p.length?p.start(0):0,o=v-a;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+o+" to match buffer start"),a+=o,this.startPosition=a),this.log("seek to target start position "+a+" from current time "+g),f.currentTime=a}}},i._getAudioCodec=function(f){var g=this.config.defaultAudioCodec||f.audioCodec;return this.audioCodecSwap&&g&&(this.log("Swapping audio codec"),g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5"),g},i._loadBitrateTestFrag=function(f){var g=this;f.bitrateTest=!0,this._doFragLoad(f).then(function(a){var p=g.hls;if(!(!a||p.nextLoadLevel||g.fragContextChanged(f))){g.fragLoadError=0,g.state=I.State.IDLE,g.startFragRequested=!1,g.bitrateTest=!1;var v=f.stats;v.parsing.start=v.parsing.end=v.buffering.start=v.buffering.end=self.performance.now(),p.trigger(P.Events.FRAG_LOADED,a),f.bitrateTest=!1}})},i._handleTransmuxComplete=function(f){var g,a="main",p=this.hls,v=f.remuxResult,o=f.chunkMeta,_=this.getCurrentContext(o);if(!_){this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(o.level);return}var O=_.frag,B=_.part,K=_.level,N=v.video,W=v.text,H=v.id3,V=v.initSegment,j=K.details,z=this.altAudio?void 0:v.audio;if(!this.fragContextChanged(O)){if(this.state=I.State.PARSING,V){V.tracks&&(this._bufferInitSegment(K,V.tracks,O,o),p.trigger(P.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:a,tracks:V.tracks}));var $=V.initPTS,Y=V.timescale;(0,M.isFiniteNumber)($)&&(this.initPTS[O.cc]=$,p.trigger(P.Events.INIT_PTS_FOUND,{frag:O,id:a,initPTS:$,timescale:Y}))}if(N&&v.independent!==!1){if(j){var X=N.startPTS,Q=N.endPTS,q=N.startDTS,J=N.endDTS;if(B)B.elementaryStreams[N.type]={startPTS:X,endPTS:Q,startDTS:q,endDTS:J};else if(N.firstKeyFrame&&N.independent&&(this.couldBacktrack=!0),N.dropped&&N.independent){var ie=this.getMainFwdBufferInfo(),se=(ie?ie.end:this.getLoadPosition())+this.config.maxBufferHole,Z=N.firstKeyFramePTS?N.firstKeyFramePTS:X;if(se<Z-this.config.maxBufferHole){this.backtrack(O);return}O.setElementaryStreamInfo(N.type,O.start,Q,O.start,J,!0)}O.setElementaryStreamInfo(N.type,X,Q,q,J),this.backtrackFragment&&(this.backtrackFragment=O),this.bufferFragmentData(N,O,B,o)}}else if(v.independent===!1){this.backtrack(O);return}if(z){var re=z.startPTS,le=z.endPTS,oe=z.startDTS,de=z.endDTS;B&&(B.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:re,endPTS:le,startDTS:oe,endDTS:de}),O.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,re,le,oe,de),this.bufferFragmentData(z,O,B,o)}if(j&&H!==null&&H!==void 0&&(g=H.samples)!==null&&g!==void 0&&g.length){var xe={id:a,frag:O,details:j,samples:H.samples};p.trigger(P.Events.FRAG_PARSING_METADATA,xe)}if(j&&W){var ce={id:a,frag:O,details:j,samples:W.samples};p.trigger(P.Events.FRAG_PARSING_USERDATA,ce)}}},i._bufferInitSegment=function(f,g,a,p){var v=this;if(this.state===I.State.PARSING){this.audioOnly=!!g.audio&&!g.video,this.altAudio&&!this.audioOnly&&delete g.audio;var o=g.audio,_=g.video,O=g.audiovideo;if(o){var B=f.audioCodec,K=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(B&&(B.indexOf("mp4a.40.5")!==-1?B="mp4a.40.2":B="mp4a.40.5"),o.metadata.channelCount!==1&&K.indexOf("firefox")===-1&&(B="mp4a.40.5")),K.indexOf("android")!==-1&&o.container!=="audio/mpeg"&&(B="mp4a.40.2",this.log("Android: force audio codec to "+B)),f.audioCodec&&f.audioCodec!==B&&this.log('Swapping manifest audio codec "'+f.audioCodec+'" for "'+B+'"'),o.levelCodec=B,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(B||"")+"/"+(f.audioCodec||"")+"/"+o.codec+"]")}_&&(_.levelCodec=f.videoCodec,_.id="main",this.log("Init video buffer, container:"+_.container+", codecs[level/parsed]=["+(f.videoCodec||"")+"/"+_.codec+"]")),O&&this.log("Init audiovideo buffer, container:"+O.container+", codecs[level/parsed]=["+(f.attrs.CODECS||"")+"/"+O.codec+"]"),this.hls.trigger(P.Events.BUFFER_CODECS,g),Object.keys(g).forEach(function(N){var W=g[N],H=W.initSegment;H!=null&&H.byteLength&&v.hls.trigger(P.Events.BUFFER_APPENDING,{type:N,data:H,frag:a,part:null,chunkMeta:p,parent:a.type})}),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,C.PlaylistLevelType.MAIN)},i.backtrack=function(f){this.couldBacktrack=!0,this.backtrackFragment=f,this.resetTransmuxer(),this.flushBufferGap(f),this.fragmentTracker.removeFragment(f),this.fragPrevious=null,this.nextLoadPosition=f.start,this.state=I.State.IDLE},i.checkFragmentChanged=function(){var f=this.media,g=null;if(f&&f.readyState>1&&f.seeking===!1){var a=f.currentTime;if(F.BufferHelper.isBuffered(f,a)?g=this.getAppendedFrag(a):F.BufferHelper.isBuffered(f,a+.1)&&(g=this.getAppendedFrag(a+.1)),g){this.backtrackFragment=null;var p=this.fragPlaying,v=g.level;(!p||g.sn!==p.sn||p.level!==v||g.urlId!==p.urlId)&&(this.hls.trigger(P.Events.FRAG_CHANGED,{frag:g}),(!p||p.level!==v)&&this.hls.trigger(P.Events.LEVEL_SWITCHED,{level:v}),this.fragPlaying=g)}}},l(t,[{key:"nextLevel",get:function(){var f=this.nextBufferedFrag;return f?f.level:-1}},{key:"currentFrag",get:function(){var f=this.media;return f?this.fragPlaying||this.getAppendedFrag(f.currentTime):null}},{key:"currentProgramDateTime",get:function(){var f=this.media;if(f){var g=f.currentTime,a=this.currentFrag;if(a&&(0,M.isFiniteNumber)(g)&&(0,M.isFiniteNumber)(a.programDateTime)){var p=a.programDateTime+(g-a.start)*1e3;return new Date(p)}}return null}},{key:"currentLevel",get:function(){var f=this.currentFrag;return f?f.level:-1}},{key:"nextBufferedFrag",get:function(){var f=this.currentFrag;return f?this.followingBufferedFrag(f):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(I.default)},"./src/controller/subtitle-stream-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{SubtitleStreamController:()=>n});var M=u("./src/events.ts"),I=u("./src/utils/buffer-helper.ts"),b=u("./src/controller/fragment-finders.ts"),P=u("./src/utils/discontinuities.ts"),F=u("./src/controller/level-helper.ts"),R=u("./src/controller/fragment-tracker.ts"),C=u("./src/controller/base-stream-controller.ts"),A=u("./src/types/loader.ts"),T=u("./src/types/level.ts");function S(h,d){for(var e=0;e<d.length;e++){var t=d[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(h,t.key,t)}}function D(h,d,e){return d&&S(h.prototype,d),e&&S(h,e),Object.defineProperty(h,"prototype",{writable:!1}),h}function L(h,d){h.prototype=Object.create(d.prototype),h.prototype.constructor=h,y(h,d)}function y(h,d){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,i){return t.__proto__=i,t},y(h,d)}var l=500,n=function(h){L(d,h);function d(t,i){var c;return c=h.call(this,t,i,"[subtitle-stream-controller]")||this,c.levels=[],c.currentTrackId=-1,c.tracksBuffered=[],c.mainDetails=null,c._registerListeners(),c}var e=d.prototype;return e.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},e._registerListeners=function(){var i=this.hls;i.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(M.Events.ERROR,this.onError,this),i.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=function(){var i=this.hls;i.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(M.Events.ERROR,this.onError,this),i.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.startLoad=function(){this.stopLoad(),this.state=C.State.IDLE,this.setInterval(l),this.tick()},e.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},e.onLevelLoaded=function(i,c){this.mainDetails=c.details},e.onSubtitleFragProcessed=function(i,c){var f=c.frag,g=c.success;if(this.fragPrevious=f,this.state=C.State.IDLE,!!g){var a=this.tracksBuffered[this.currentTrackId];if(!!a){for(var p,v=f.start,o=0;o<a.length;o++)if(v>=a[o].start&&v<=a[o].end){p=a[o];break}var _=f.start+f.duration;p?p.end=_:(p={start:v,end:_},a.push(p)),this.fragmentTracker.fragBuffered(f)}}},e.onBufferFlushing=function(i,c){var f=c.startOffset,g=c.endOffset;if(f===0&&g!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,p=this.levels;if(!p.length||!p[a]||!p[a].details)return;var v=p[a].details,o=v.targetduration,_=g-o;if(_<=0)return;c.endOffsetSubtitles=Math.max(0,_),this.tracksBuffered.forEach(function(O){for(var B=0;B<O.length;){if(O[B].end<=_){O.shift();continue}else if(O[B].start<_)O[B].start=_;else break;B++}}),this.fragmentTracker.removeFragmentsInRange(f,_,A.PlaylistLevelType.SUBTITLE)}},e.onError=function(i,c){var f,g=c.frag;!g||g.type!==A.PlaylistLevelType.SUBTITLE||((f=this.fragCurrent)!==null&&f!==void 0&&f.loader&&this.fragCurrent.loader.abort(),this.state=C.State.IDLE)},e.onSubtitleTracksUpdated=function(i,c){var f=this,g=c.subtitleTracks;this.tracksBuffered=[],this.levels=g.map(function(a){return new T.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){f.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},e.onSubtitleTrackSwitch=function(i,c){if(this.currentTrackId=c.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var f=this.levels[this.currentTrackId];f!=null&&f.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,f&&this.setInterval(l)},e.onSubtitleTrackLoaded=function(i,c){var f,g=c.details,a=c.id,p=this.currentTrackId,v=this.levels;if(!!v.length){var o=v[p];if(!(a>=v.length||a!==p||!o)){if(this.mediaBuffer=this.mediaBufferTimeRanges,g.live||(f=o.details)!==null&&f!==void 0&&f.live){var _=this.mainDetails;if(g.deltaUpdateFailed||!_)return;var O=_.fragments[0];if(!o.details)g.hasProgramDateTime&&_.hasProgramDateTime?(0,P.alignMediaPlaylistByPDT)(g,_):O&&(0,F.addSliding)(g,O.start);else{var B=this.alignPlaylists(g,o.details);B===0&&O&&(0,F.addSliding)(g,O.start)}}if(o.details=g,this.levelLastLoaded=a,this.tick(),g.live&&!this.fragCurrent&&this.media&&this.state===C.State.IDLE){var K=(0,b.findFragmentByPTS)(null,g.fragments,this.media.currentTime,0);K||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}}},e._handleFragmentLoadComplete=function(i){var c=i.frag,f=i.payload,g=c.decryptdata,a=this.hls;if(!this.fragContextChanged(c)&&f&&f.byteLength>0&&g&&g.key&&g.iv&&g.method==="AES-128"){var p=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(f),g.key.buffer,g.iv.buffer).then(function(v){var o=performance.now();a.trigger(M.Events.FRAG_DECRYPTED,{frag:c,payload:v,stats:{tstart:p,tdecrypt:o}})})}},e.doTick=function(){if(!this.media){this.state=C.State.IDLE;return}if(this.state===C.State.IDLE){var i=this.currentTrackId,c=this.levels;if(!c.length||!c[i]||!c[i].details)return;var f=c[i].details,g=f.targetduration,a=this.config,p=this.media,v=I.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],p.currentTime-g,a.maxBufferHole),o=v.end,_=v.len,O=this.getMaxBufferLength()+g;if(_>O)return;console.assert(f,"Subtitle track details are defined on idle subtitle stream controller tick");var B=f.fragments,K=B.length,N=f.edge,W,H=this.fragPrevious;if(o<N){var V=a.maxFragLookUpTolerance;W=(0,b.findFragmentByPTS)(H,B,Math.max(B[0].start,o),V),!W&&H&&H.start<B[0].start&&(W=B[0])}else W=B[K-1];if(W=this.mapToInitFragWhenRequired(W),!W||this.fragmentTracker.getState(W)!==R.FragmentState.NOT_LOADED)return;W.encrypted?this.loadKey(W,f):this.loadFragment(W,f,o)}},e.loadFragment=function(i,c,f){this.fragCurrent=i,i.sn==="initSegment"?this._loadInitSegment(i):h.prototype.loadFragment.call(this,i,c,f)},D(d,[{key:"mediaBufferTimeRanges",get:function(){return new r(this.tracksBuffered[this.currentTrackId]||[])}}]),d}(C.default),r=function(d){this.buffered=void 0;var e=function(i,c,f){if(c=c>>>0,c>f-1)throw new DOMException("Failed to execute '"+i+"' on 'TimeRanges': The index provided ("+c+") is greater than the maximum bound ("+f+")");return d[c][i]};this.buffered={get length(){return d.length},end:function(i){return e("end",i,d.length)},start:function(i){return e("start",i,d.length)}}}},"./src/controller/subtitle-track-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>D});var M=u("./src/events.ts"),I=u("./src/utils/texttrack-utils.ts"),b=u("./src/controller/base-playlist-controller.ts"),P=u("./src/types/loader.ts");function F(L,y){for(var l=0;l<y.length;l++){var n=y[l];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(L,n.key,n)}}function R(L,y,l){return y&&F(L.prototype,y),l&&F(L,l),Object.defineProperty(L,"prototype",{writable:!1}),L}function C(L,y){L.prototype=Object.create(y.prototype),L.prototype.constructor=L,A(L,y)}function A(L,y){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,r){return n.__proto__=r,n},A(L,y)}var T=function(L){C(y,L);function y(n){var r;return r=L.call(this,n,"[subtitle-track-controller]")||this,r.media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}var l=y.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,L.prototype.destroy.call(this)},l.registerListeners=function(){var r=this.hls;r.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(M.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var r=this.hls;r.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(M.Events.ERROR,this.onError,this)},l.onMediaAttached=function(r,h){this.media=h.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,r)},l.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var r=S(this.media.textTracks);r.forEach(function(h){(0,I.clearCurrentCues)(h)}),this.subtitleTrack=-1,this.media=null}},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(r,h){this.tracks=h.subtitleTracks},l.onSubtitleTrackLoaded=function(r,h){var d=h.id,e=h.details,t=this.trackId,i=this.tracksInGroup[t];if(!i){this.warn("Invalid subtitle track id "+d);return}var c=i.details;i.details=h.details,this.log("subtitle track "+d+" loaded ["+e.startSN+"-"+e.endSN+"]"),d===this.trackId&&(this.retryCount=0,this.playlistLoaded(d,h,c))},l.onLevelLoading=function(r,h){this.switchLevel(h.level)},l.onLevelSwitching=function(r,h){this.switchLevel(h.level)},l.switchLevel=function(r){var h=this.hls.levels[r];if(!!(h!=null&&h.textGroupIds)){var d=h.textGroupIds[h.urlId];if(this.groupId!==d){var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,t=this.tracks.filter(function(f){return!d||f.groupId===d});this.tracksInGroup=t;var i=this.findTrackId(e==null?void 0:e.name)||this.findTrackId();this.groupId=d;var c={subtitleTracks:t};this.log("Updating subtitle tracks, "+t.length+' track(s) found in "'+d+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,c),i!==-1&&this.setSubtitleTrack(i,e)}}},l.findTrackId=function(r){for(var h=this.tracksInGroup,d=0;d<h.length;d++){var e=h[d];if((!this.selectDefaultTrack||e.default)&&(!r||r===e.name))return e.id}return-1},l.onError=function(r,h){L.prototype.onError.call(this,r,h),!(h.fatal||!h.context)&&h.context.type===P.PlaylistContextType.SUBTITLE_TRACK&&h.context.id===this.trackId&&h.context.groupId===this.groupId&&this.retryLoadingOrFail(h)},l.loadPlaylist=function(r){var h=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(h)){var d=h.id,e=h.groupId,t=h.url;if(r)try{t=r.addDirectives(t)}catch(i){this.warn("Could not construct new URL with HLS Delivery Directives: "+i)}this.log("Loading subtitle playlist for id "+d),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:t,id:d,groupId:e,deliveryDirectives:r||null})}},l.toggleTrackModes=function(r){var h=this,d=this.media,e=this.trackId;if(!!d){var t=S(d.textTracks),i=t.filter(function(g){return g.groupId===h.groupId});if(r===-1)[].slice.call(t).forEach(function(g){g.mode="disabled"});else{var c=i[e];c&&(c.mode="disabled")}var f=i[r];f&&(f.mode=this.subtitleDisplay?"showing":"hidden")}},l.setSubtitleTrack=function(r,h){var d,e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=r;return}if(this.trackId!==r&&this.toggleTrackModes(r),!(this.trackId===r&&(r===-1||(d=e[r])!==null&&d!==void 0&&d.details)||r<-1||r>=e.length)){this.clearTimer();var t=e[r];if(this.log("Switching to subtitle track "+r),this.trackId=r,t){var i=t.id,c=t.groupId,f=c===void 0?"":c,g=t.name,a=t.type,p=t.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:i,groupId:f,name:g,type:a,url:p});var v=this.switchParams(t.url,h==null?void 0:h.details);this.loadPlaylist(v)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:r})}},l.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var r=-1,h=S(this.media.textTracks),d=0;d<h.length;d++)if(h[d].mode==="hidden")r=d;else if(h[d].mode==="showing"){r=d;break}this.subtitleTrack!==r&&(this.subtitleTrack=r)}},R(y,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(r){this.selectDefaultTrack=!1;var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(r,h)}}]),y}(b.default);function S(L){for(var y=[],l=0;l<L.length;l++){var n=L[l];n.kind==="subtitles"&&n.label&&y.push(L[l])}return y}const D=T},"./src/controller/timeline-controller.ts":(G,k,u)=>{u.r(k),u.d(k,{TimelineController:()=>D});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/utils/cea-608-parser.ts"),P=u("./src/utils/output-filter.ts"),F=u("./src/utils/webvtt-parser.ts"),R=u("./src/utils/texttrack-utils.ts"),C=u("./src/utils/imsc1-ttml-parser.ts"),A=u("./src/utils/mp4-tools.ts"),T=u("./src/types/loader.ts"),S=u("./src/utils/logger.ts"),D=function(){function n(h){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=h,this.config=h.config,this.Cues=h.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var d=new P.default(this,"textTrack1"),e=new P.default(this,"textTrack2"),t=new P.default(this,"textTrack3"),i=new P.default(this,"textTrack4");this.cea608Parser1=new b.default(1,d,e),this.cea608Parser2=new b.default(3,t,i)}h.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),h.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),h.on(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),h.on(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),h.on(I.Events.FRAG_LOADING,this.onFragLoading,this),h.on(I.Events.FRAG_LOADED,this.onFragLoaded,this),h.on(I.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),h.on(I.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),h.on(I.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),h.on(I.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),h.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var r=n.prototype;return r.destroy=function(){var d=this.hls;d.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),d.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(I.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),d.off(I.Events.FRAG_LOADING,this.onFragLoading,this),d.off(I.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(I.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),d.off(I.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),d.off(I.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),d.off(I.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),d.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},r.addCues=function(d,e,t,i,c){for(var f=!1,g=c.length;g--;){var a=c[g],p=y(a[0],a[1],e,t);if(p>=0&&(a[0]=Math.min(a[0],e),a[1]=Math.max(a[1],t),f=!0,p/(t-e)>.5))return}if(f||c.push([e,t]),this.config.renderTextTracksNatively){var v=this.captionsTracks[d];this.Cues.newCue(v,e,t,i)}else{var o=this.Cues.newCue(null,e,t,i);this.hls.trigger(I.Events.CUES_PARSED,{type:"captions",cues:o,track:d})}},r.onInitPtsFound=function(d,e){var t=this,i=e.frag,c=e.id,f=e.initPTS,g=e.timescale,a=this.unparsedVttFrags;c==="main"&&(this.initPTS[i.cc]=f,this.timescale[i.cc]=g),a.length&&(this.unparsedVttFrags=[],a.forEach(function(p){t.onFragLoaded(I.Events.FRAG_LOADED,p)}))},r.getExistingTrack=function(d){var e=this.media;if(e)for(var t=0;t<e.textTracks.length;t++){var i=e.textTracks[t];if(i[d])return i}return null},r.createCaptionsTrack=function(d){this.config.renderTextTracksNatively?this.createNativeTrack(d):this.createNonNativeTrack(d)},r.createNativeTrack=function(d){if(!this.captionsTracks[d]){var e=this.captionsProperties,t=this.captionsTracks,i=this.media,c=e[d],f=c.label,g=c.languageCode,a=this.getExistingTrack(d);if(a)t[d]=a,(0,R.clearCurrentCues)(t[d]),(0,R.sendAddTrackEvent)(t[d],i);else{var p=this.createTextTrack("captions",f,g);p&&(p[d]=!0,t[d]=p)}}},r.createNonNativeTrack=function(d){if(!this.nonNativeCaptionsTracks[d]){var e=this.captionsProperties[d];if(!!e){var t=e.label,i={_id:d,label:t,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[d]=i,this.hls.trigger(I.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},r.createTextTrack=function(d,e,t){var i=this.media;if(!!i)return i.addTextTrack(d,e,t)},r.onMediaAttaching=function(d,e){this.media=e.media,this._cleanTracks()},r.onMediaDetaching=function(){var d=this.captionsTracks;Object.keys(d).forEach(function(e){(0,R.clearCurrentCues)(d[e]),delete d[e]}),this.nonNativeCaptionsTracks={}},r.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},r._cleanTracks=function(){var d=this.media;if(!!d){var e=d.textTracks;if(e)for(var t=0;t<e.length;t++)(0,R.clearCurrentCues)(e[t])}},r.onSubtitleTracksUpdated=function(d,e){var t=this;this.textTracks=[];var i=e.subtitleTracks||[],c=i.some(function(p){return p.textCodec===C.IMSC1_CODEC});if(this.config.enableWebVTT||c&&this.config.enableIMSC1){var f=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var g=this.media?this.media.textTracks:[];this.tracks.forEach(function(p,v){var o;if(v<g.length){for(var _=null,O=0;O<g.length;O++)if(L(g[O],p)){_=g[O];break}_&&(o=_)}if(o)(0,R.clearCurrentCues)(o);else{var B=t._captionsOrSubtitlesFromCharacteristics(p);o=t.createTextTrack(B,p.name,p.lang),o&&(o.mode="disabled")}o&&(o.groupId=p.groupId,t.textTracks.push(o))})}else if(!f&&this.tracks&&this.tracks.length){var a=this.tracks.map(function(p){return{label:p.name,kind:p.type.toLowerCase(),default:p.default,subtitleTrack:p}});this.hls.trigger(I.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}},r._captionsOrSubtitlesFromCharacteristics=function(d){var e;if((e=d.attrs)!==null&&e!==void 0&&e.CHARACTERISTICS){var t=/transcribes-spoken-dialog/gi.test(d.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(d.attrs.CHARACTERISTICS);if(t&&i)return"captions"}return"subtitles"},r.onManifestLoaded=function(d,e){var t=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(function(i){var c=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!!c){var f="textTrack"+c[1],g=t.captionsProperties[f];!g||(g.label=i.name,i.lang&&(g.languageCode=i.lang),g.media=i)}})},r.closedCaptionsForLevel=function(d){var e=this.hls.levels[d.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]},r.onFragLoading=function(d,e){var t=this.cea608Parser1,i=this.cea608Parser2,c=this.lastSn,f=this.lastPartIndex;if(!(!this.enabled||!(t&&i))&&e.frag.type===T.PlaylistLevelType.MAIN){var g,a,p=e.frag.sn,v=(g=e==null||(a=e.part)===null||a===void 0?void 0:a.index)!=null?g:-1;p===c+1||p===c&&v===f+1||(t.reset(),i.reset()),this.lastSn=p,this.lastPartIndex=v}},r.onFragLoaded=function(d,e){var t=e.frag,i=e.payload,c=this.initPTS,f=this.unparsedVttFrags;if(t.type===T.PlaylistLevelType.SUBTITLE)if(i.byteLength){if(!(0,M.isFiniteNumber)(c[t.cc])){f.push(e),c.length&&this.hls.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")});return}var g=t.decryptdata,a="stats"in e;if(g==null||g.key==null||g.method!=="AES-128"||a){var p=this.tracks[t.level],v=this.vttCCs;v[t.cc]||(v[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),p&&p.textCodec===C.IMSC1_CODEC?this._parseIMSC1(t,i):this._parseVTTs(t,i,v)}}else this.hls.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},r._parseIMSC1=function(d,e){var t=this,i=this.hls;(0,C.parseIMSC1)(e,this.initPTS[d.cc],this.timescale[d.cc],function(c){t._appendCues(c,d.level),i.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(c){S.logger.log("Failed to parse IMSC1: "+c),i.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:c})})},r._parseVTTs=function(d,e,t){var i,c=this,f=this.hls,g=(i=d.initSegment)!==null&&i!==void 0&&i.data?(0,A.appendUint8Array)(d.initSegment.data,new Uint8Array(e)):e;(0,F.parseWebVTT)(g,this.initPTS[d.cc],this.timescale[d.cc],t,d.cc,d.start,function(a){c._appendCues(a,d.level),f.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(a){c._fallbackToIMSC1(d,e),S.logger.log("Failed to parse VTT cue: "+a),f.trigger(I.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:a})})},r._fallbackToIMSC1=function(d,e){var t=this,i=this.tracks[d.level];i.textCodec||(0,C.parseIMSC1)(e,this.initPTS[d.cc],this.timescale[d.cc],function(){i.textCodec=C.IMSC1_CODEC,t._parseIMSC1(d,e)},function(){i.textCodec="wvtt"})},r._appendCues=function(d,e){var t=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||i.mode==="disabled")return;d.forEach(function(g){return(0,R.addCueToTrack)(i,g)})}else{var c=this.tracks[e];if(!c)return;var f=c.default?"default":"subtitles"+e;t.trigger(I.Events.CUES_PARSED,{type:"subtitles",cues:d,track:f})}},r.onFragDecrypted=function(d,e){var t=e.frag;if(t.type===T.PlaylistLevelType.SUBTITLE){if(!(0,M.isFiniteNumber)(this.initPTS[t.cc])){this.unparsedVttFrags.push(e);return}this.onFragLoaded(I.Events.FRAG_LOADED,e)}},r.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},r.onFragParsingUserdata=function(d,e){var t=this.cea608Parser1,i=this.cea608Parser2;if(!(!this.enabled||!(t&&i))){var c=e.frag,f=e.samples;if(!(c.type===T.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(c)==="NONE"))for(var g=0;g<f.length;g++){var a=f[g].bytes;if(a){var p=this.extractCea608Data(a);t.addData(f[g].pts,p[0]),i.addData(f[g].pts,p[1])}}}},r.onBufferFlushing=function(d,e){var t=e.startOffset,i=e.endOffset,c=e.endOffsetSubtitles,f=e.type,g=this.media;if(!(!g||g.currentTime<i)){if(!f||f==="video"){var a=this.captionsTracks;Object.keys(a).forEach(function(v){return(0,R.removeCuesInRange)(a[v],t,i)})}if(this.config.renderTextTracksNatively&&t===0&&c!==void 0){var p=this.textTracks;Object.keys(p).forEach(function(v){return(0,R.removeCuesInRange)(p[v],t,c)})}}},r.extractCea608Data=function(d){for(var e=[[],[]],t=d[0]&31,i=2,c=0;c<t;c++){var f=d[i++],g=127&d[i++],a=127&d[i++];if(!(g===0&&a===0)){var p=(4&f)!==0;if(p){var v=3&f;(v===0||v===1)&&(e[v].push(g),e[v].push(a))}}}return e},n}();function L(n,r){return n&&n.label===r.name&&!(n.textTrack1||n.textTrack2)}function y(n,r,h,d){return Math.min(r,d)-Math.max(n,h)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>M});var M=function(){function I(P,F){this.subtle=void 0,this.aesIV=void 0,this.subtle=P,this.aesIV=F}var b=I.prototype;return b.decrypt=function(F,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,F)},I}()},"./src/crypt/aes-decryptor.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>b,removePadding:()=>I});var M=u("./src/utils/typed-array.ts");function I(P){var F=P.byteLength,R=F&&new DataView(P.buffer).getUint8(F-1);return R?(0,M.sliceUint8)(P,0,F-R):P}var b=function(){function P(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var F=P.prototype;return F.uint8ArrayToUint32Array_=function(C){for(var A=new DataView(C),T=new Uint32Array(4),S=0;S<4;S++)T[S]=A.getUint32(S*4);return T},F.initTable=function(){var C=this.sBox,A=this.invSBox,T=this.subMix,S=T[0],D=T[1],L=T[2],y=T[3],l=this.invSubMix,n=l[0],r=l[1],h=l[2],d=l[3],e=new Uint32Array(256),t=0,i=0,c=0;for(c=0;c<256;c++)c<128?e[c]=c<<1:e[c]=c<<1^283;for(c=0;c<256;c++){var f=i^i<<1^i<<2^i<<3^i<<4;f=f>>>8^f&255^99,C[t]=f,A[f]=t;var g=e[t],a=e[g],p=e[a],v=e[f]*257^f*16843008;S[t]=v<<24|v>>>8,D[t]=v<<16|v>>>16,L[t]=v<<8|v>>>24,y[t]=v,v=p*16843009^a*65537^g*257^t*16843008,n[f]=v<<24|v>>>8,r[f]=v<<16|v>>>16,h[f]=v<<8|v>>>24,d[f]=v,t?(t=g^e[e[e[p^g]]],i^=e[e[i]]):t=i=1}},F.expandKey=function(C){for(var A=this.uint8ArrayToUint32Array_(C),T=!0,S=0;S<A.length&&T;)T=A[S]===this.key[S],S++;if(!T){this.key=A;var D=this.keySize=A.length;if(D!==4&&D!==6&&D!==8)throw new Error("Invalid aes key size="+D);var L=this.ksRows=(D+6+1)*4,y,l,n=this.keySchedule=new Uint32Array(L),r=this.invKeySchedule=new Uint32Array(L),h=this.sBox,d=this.rcon,e=this.invSubMix,t=e[0],i=e[1],c=e[2],f=e[3],g,a;for(y=0;y<L;y++){if(y<D){g=n[y]=A[y];continue}a=g,y%D===0?(a=a<<8|a>>>24,a=h[a>>>24]<<24|h[a>>>16&255]<<16|h[a>>>8&255]<<8|h[a&255],a^=d[y/D|0]<<24):D>6&&y%D===4&&(a=h[a>>>24]<<24|h[a>>>16&255]<<16|h[a>>>8&255]<<8|h[a&255]),n[y]=g=(n[y-D]^a)>>>0}for(l=0;l<L;l++)y=L-l,l&3?a=n[y]:a=n[y-4],l<4||y<=4?r[l]=a:r[l]=t[h[a>>>24]]^i[h[a>>>16&255]]^c[h[a>>>8&255]]^f[h[a&255]],r[l]=r[l]>>>0}},F.networkToHostOrderSwap=function(C){return C<<24|(C&65280)<<8|(C&16711680)>>8|C>>>24},F.decrypt=function(C,A,T){for(var S=this.keySize+6,D=this.invKeySchedule,L=this.invSBox,y=this.invSubMix,l=y[0],n=y[1],r=y[2],h=y[3],d=this.uint8ArrayToUint32Array_(T),e=d[0],t=d[1],i=d[2],c=d[3],f=new Int32Array(C),g=new Int32Array(f.length),a,p,v,o,_,O,B,K,N,W,H,V,j,z,$=this.networkToHostOrderSwap;A<f.length;){for(N=$(f[A]),W=$(f[A+1]),H=$(f[A+2]),V=$(f[A+3]),_=N^D[0],O=V^D[1],B=H^D[2],K=W^D[3],j=4,z=1;z<S;z++)a=l[_>>>24]^n[O>>16&255]^r[B>>8&255]^h[K&255]^D[j],p=l[O>>>24]^n[B>>16&255]^r[K>>8&255]^h[_&255]^D[j+1],v=l[B>>>24]^n[K>>16&255]^r[_>>8&255]^h[O&255]^D[j+2],o=l[K>>>24]^n[_>>16&255]^r[O>>8&255]^h[B&255]^D[j+3],_=a,O=p,B=v,K=o,j=j+4;a=L[_>>>24]<<24^L[O>>16&255]<<16^L[B>>8&255]<<8^L[K&255]^D[j],p=L[O>>>24]<<24^L[B>>16&255]<<16^L[K>>8&255]<<8^L[_&255]^D[j+1],v=L[B>>>24]<<24^L[K>>16&255]<<16^L[_>>8&255]<<8^L[O&255]^D[j+2],o=L[K>>>24]<<24^L[_>>16&255]<<16^L[O>>8&255]<<8^L[B&255]^D[j+3],g[A]=$(a^e),g[A+1]=$(o^t),g[A+2]=$(v^i),g[A+3]=$(p^c),e=N,t=W,i=H,c=V,A=A+4}return g.buffer},P}()},"./src/crypt/decrypter.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>A});var M=u("./src/crypt/aes-crypto.ts"),I=u("./src/crypt/fast-aes-key.ts"),b=u("./src/crypt/aes-decryptor.ts"),P=u("./src/utils/logger.ts"),F=u("./src/utils/mp4-tools.ts"),R=u("./src/utils/typed-array.ts"),C=16,A=function(){function T(D,L,y){var l=y===void 0?{}:y,n=l.removePKCS7Padding,r=n===void 0?!0:n;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=D,this.config=L,this.removePKCS7Padding=r,r)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var S=T.prototype;return S.destroy=function(){this.observer=null},S.isSync=function(){return this.config.enableSoftwareAES},S.flush=function(){var L=this.currentResult;if(!L){this.reset();return}var y=new Uint8Array(L);return this.reset(),this.removePKCS7Padding?(0,b.removePadding)(y):y},S.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},S.decrypt=function(L,y,l,n){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(L),y,l);var r=this.flush();r&&n(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(L),y,l).then(n)},S.softwareDecrypt=function(L,y,l){var n=this.currentIV,r=this.currentResult,h=this.remainderData;this.logOnce("JS AES decrypt"),h&&(L=(0,F.appendUint8Array)(h,L),this.remainderData=null);var d=this.getValidChunk(L);if(!d.length)return null;n&&(l=n);var e=this.softwareDecrypter;e||(e=this.softwareDecrypter=new b.default),e.expandKey(y);var t=r;return this.currentResult=e.decrypt(d.buffer,0,l),this.currentIV=(0,R.sliceUint8)(d,-16).buffer,t||null},S.webCryptoDecrypt=function(L,y,l){var n=this,r=this.subtle;return(this.key!==y||!this.fastAesKey)&&(this.key=y,this.fastAesKey=new I.default(r,y)),this.fastAesKey.expandKey().then(function(h){if(!r)return Promise.reject(new Error("web crypto not initialized"));var d=new M.default(r,l);return d.decrypt(L.buffer,h)}).catch(function(h){return n.onWebCryptoError(h,L,y,l)})},S.onWebCryptoError=function(L,y,l,n){return P.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",L),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(y,l,n)},S.getValidChunk=function(L){var y=L,l=L.length-L.length%C;return l!==L.length&&(y=(0,R.sliceUint8)(L,0,l),this.remainderData=(0,R.sliceUint8)(L,l)),y},S.logOnce=function(L){!this.logEnabled||(P.logger.log("[decrypter.ts]: "+L),this.logEnabled=!1)},T}()},"./src/crypt/fast-aes-key.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>M});var M=function(){function I(P,F){this.subtle=void 0,this.key=void 0,this.subtle=P,this.key=F}var b=I.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},I}()},"./src/demux/aacdemuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>A});var M=u("./src/demux/base-audio-demuxer.ts"),I=u("./src/demux/adts.ts"),b=u("./src/utils/logger.ts"),P=u("./src/demux/id3.ts");function F(T,S){T.prototype=Object.create(S.prototype),T.prototype.constructor=T,R(T,S)}function R(T,S){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,y){return L.__proto__=y,L},R(T,S)}var C=function(T){F(S,T);function S(L,y){var l;return l=T.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=L,l.config=y,l}var D=S.prototype;return D.resetInitSegment=function(y,l,n,r){T.prototype.resetInitSegment.call(this,y,l,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:r,inputTimeScale:9e4,dropped:0}},S.probe=function(y){if(!y)return!1;for(var l=P.getID3Data(y,0)||[],n=l.length,r=y.length;n<r;n++)if(I.probe(y,n))return b.logger.log("ADTS sync word found !"),!0;return!1},D.canParse=function(y,l){return I.canParse(y,l)},D.appendFrame=function(y,l,n){I.initTrackConfig(y,this.observer,l,n,y.manifestCodec);var r=I.appendFrame(y,l,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r},S}(M.default);const A=C},"./src/demux/adts.ts":(G,k,u)=>{u.r(k),u.d(k,{appendFrame:()=>n,canGetFrameLength:()=>A,canParse:()=>S,getAudioConfig:()=>P,getFrameDuration:()=>y,getFullFrameLength:()=>C,getHeaderLength:()=>R,initTrackConfig:()=>L,isHeader:()=>T,isHeaderPattern:()=>F,parseFrameHeader:()=>l,probe:()=>D});var M=u("./src/utils/logger.ts"),I=u("./src/errors.ts"),b=u("./src/events.ts");function P(r,h,d,e){var t,i,c,f,g=navigator.userAgent.toLowerCase(),a=e,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];t=((h[d+2]&192)>>>6)+1;var v=(h[d+2]&60)>>>2;if(v>p.length-1){r.trigger(b.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v});return}return c=(h[d+2]&1)<<2,c|=(h[d+3]&192)>>>6,M.logger.log("manifest codec:"+e+", ADTS type:"+t+", samplingIndex:"+v),/firefox/i.test(g)?v>=6?(t=5,f=new Array(4),i=v-3):(t=2,f=new Array(2),i=v):g.indexOf("android")!==-1?(t=2,f=new Array(2),i=v):(t=5,f=new Array(4),e&&(e.indexOf("mp4a.40.29")!==-1||e.indexOf("mp4a.40.5")!==-1)||!e&&v>=6?i=v-3:((e&&e.indexOf("mp4a.40.2")!==-1&&(v>=6&&c===1||/vivaldi/i.test(g))||!e&&c===1)&&(t=2,f=new Array(2)),i=v)),f[0]=t<<3,f[0]|=(v&14)>>1,f[1]|=(v&1)<<7,f[1]|=c<<3,t===5&&(f[1]|=(i&14)>>1,f[2]=(i&1)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:p[v],channelCount:c,codec:"mp4a.40."+t,manifestCodec:a}}function F(r,h){return r[h]===255&&(r[h+1]&246)===240}function R(r,h){return r[h+1]&1?7:9}function C(r,h){return(r[h+3]&3)<<11|r[h+4]<<3|(r[h+5]&224)>>>5}function A(r,h){return h+5<r.length}function T(r,h){return h+1<r.length&&F(r,h)}function S(r,h){return A(r,h)&&F(r,h)&&C(r,h)<=r.length-h}function D(r,h){if(T(r,h)){var d=R(r,h);if(h+d>=r.length)return!1;var e=C(r,h);if(e<=d)return!1;var t=h+e;return t===r.length||T(r,t)}return!1}function L(r,h,d,e,t){if(!r.samplerate){var i=P(h,d,e,t);if(!i)return;r.config=i.config,r.samplerate=i.samplerate,r.channelCount=i.channelCount,r.codec=i.codec,r.manifestCodec=i.manifestCodec,M.logger.log("parsed codec:"+r.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function y(r){return 9216e4/r}function l(r,h){var d=R(r,h);if(h+d<=r.length){var e=C(r,h)-d;if(e>0)return{headerLength:d,frameLength:e}}}function n(r,h,d,e,t){var i=y(r.samplerate),c=e+t*i,f=l(h,d),g;if(f){var a=f.frameLength,p=f.headerLength,v=p+a,o=Math.max(0,d+v-h.length);o?(g=new Uint8Array(v-p),g.set(h.subarray(d+p,h.length),0)):g=h.subarray(d+p,d+v);var _={unit:g,pts:c};return o||r.samples.push(_),{sample:_,length:v,missing:o}}var O=h.length-d;g=new Uint8Array(O),g.set(h.subarray(d,h.length),0);var B={unit:g,pts:c};return{sample:B,length:O,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>T,initPTSFn:()=>A});var M=u("./src/polyfills/number.ts"),I=u("./src/demux/id3.ts"),b=u("./src/types/demuxer.ts"),P=u("./src/demux/dummy-demuxed-track.ts"),F=u("./src/utils/mp4-tools.ts"),R=u("./src/utils/typed-array.ts"),C=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var D=S.prototype;return D.resetInitSegment=function(y,l,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},D.resetTimeStamp=function(y){this.initPTS=y,this.resetContiguity()},D.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},D.canParse=function(y,l){return!1},D.appendFrame=function(y,l,n){},D.demux=function(y,l){this.cachedData&&(y=(0,F.appendUint8Array)(this.cachedData,y),this.cachedData=null);var n=I.getID3Data(y,0),r=n?n.length:0,h,d=this._audioTrack,e=this._id3Track,t=n?I.getTimeStamp(n):void 0,i=y.length;for((this.basePTS===null||this.frameIndex===0&&(0,M.isFiniteNumber)(t))&&(this.basePTS=A(t,l,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&e.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});r<i;){if(this.canParse(y,r)){var c=this.appendFrame(d,y,r);c?(this.frameIndex++,this.lastPTS=c.sample.pts,r+=c.length,h=r):r=i}else I.canParse(y,r)?(n=I.getID3Data(y,r),e.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:b.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,h=r):r++;if(r===i&&h!==i){var f=(0,R.sliceUint8)(y,h);this.cachedData?this.cachedData=(0,F.appendUint8Array)(this.cachedData,f):this.cachedData=f}}return{audioTrack:d,videoTrack:(0,P.dummyTrack)(),id3Track:e,textTrack:(0,P.dummyTrack)()}},D.demuxSampleAes=function(y,l,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},D.flush=function(y){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,P.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,P.dummyTrack)()}},D.destroy=function(){},S}(),A=function(D,L,y){return(0,M.isFiniteNumber)(D)?D*90:L*9e4+(y||0)};const T=C},"./src/demux/chunk-cache.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>M});var M=function(){function b(){this.chunks=[],this.dataLength=0}var P=b.prototype;return P.push=function(R){this.chunks.push(R),this.dataLength+=R.length},P.flush=function(){var R=this.chunks,C=this.dataLength,A;if(R.length)R.length===1?A=R[0]:A=I(R,C);else return new Uint8Array(0);return this.reset(),A},P.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function I(b,P){for(var F=new Uint8Array(P),R=0,C=0;C<b.length;C++){var A=b[C];F.set(A,R),R+=A.length}return F}},"./src/demux/dummy-demuxed-track.ts":(G,k,u)=>{u.r(k),u.d(k,{dummyTrack:()=>M});function M(I,b){return I===void 0&&(I=""),b===void 0&&(b=9e4),{type:I,id:-1,pid:-1,inputTimeScale:b,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>b});var M=u("./src/utils/logger.ts"),I=function(){function P(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var F=P.prototype;return F.loadWord=function(){var C=this.data,A=this.bytesAvailable,T=C.byteLength-A,S=new Uint8Array(4),D=Math.min(4,A);if(D===0)throw new Error("no bytes available");S.set(C.subarray(T,T+D)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=D*8,this.bytesAvailable-=D},F.skipBits=function(C){var A;this.bitsAvailable>C?(this.word<<=C,this.bitsAvailable-=C):(C-=this.bitsAvailable,A=C>>3,C-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=C,this.bitsAvailable-=C)},F.readBits=function(C){var A=Math.min(this.bitsAvailable,C),T=this.word>>>32-A;return C>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=C-A,A>0&&this.bitsAvailable?T<<A|this.readBits(A):T},F.skipLZ=function(){var C;for(C=0;C<this.bitsAvailable;++C)if((this.word&2147483648>>>C)!==0)return this.word<<=C,this.bitsAvailable-=C,C;return this.loadWord(),C+this.skipLZ()},F.skipUEG=function(){this.skipBits(1+this.skipLZ())},F.skipEG=function(){this.skipBits(1+this.skipLZ())},F.readUEG=function(){var C=this.skipLZ();return this.readBits(C+1)-1},F.readEG=function(){var C=this.readUEG();return 1&C?1+C>>>1:-1*(C>>>1)},F.readBoolean=function(){return this.readBits(1)===1},F.readUByte=function(){return this.readBits(8)},F.readUShort=function(){return this.readBits(16)},F.readUInt=function(){return this.readBits(32)},F.skipScalingList=function(C){for(var A=8,T=8,S,D=0;D<C;D++)T!==0&&(S=this.readEG(),T=(A+S+256)%256),A=T===0?A:T},F.readSPS=function(){var C=0,A=0,T=0,S=0,D,L,y,l=this.readUByte.bind(this),n=this.readBits.bind(this),r=this.readUEG.bind(this),h=this.readBoolean.bind(this),d=this.skipBits.bind(this),e=this.skipEG.bind(this),t=this.skipUEG.bind(this),i=this.skipScalingList.bind(this);l();var c=l();if(n(5),d(3),l(),t(),c===100||c===110||c===122||c===244||c===44||c===83||c===86||c===118||c===128){var f=r();if(f===3&&d(1),t(),t(),d(1),h())for(L=f!==3?8:12,y=0;y<L;y++)h()&&(y<6?i(16):i(64))}t();var g=r();if(g===0)r();else if(g===1)for(d(1),e(),e(),D=r(),y=0;y<D;y++)e();t(),d(1);var a=r(),p=r(),v=n(1);v===0&&d(1),d(1),h()&&(C=r(),A=r(),T=r(),S=r());var o=[1,1];if(h()&&h()){var _=l();switch(_){case 1:o=[1,1];break;case 2:o=[12,11];break;case 3:o=[10,11];break;case 4:o=[16,11];break;case 5:o=[40,33];break;case 6:o=[24,11];break;case 7:o=[20,11];break;case 8:o=[32,11];break;case 9:o=[80,33];break;case 10:o=[18,11];break;case 11:o=[15,11];break;case 12:o=[64,33];break;case 13:o=[160,99];break;case 14:o=[4,3];break;case 15:o=[3,2];break;case 16:o=[2,1];break;case 255:{o=[l()<<8|l(),l()<<8|l()];break}}}return{width:Math.ceil((a+1)*16-C*2-A*2),height:(2-v)*(p+1)*16-(v?2:4)*(T+S),pixelRatio:o}},F.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},P}();const b=I},"./src/demux/id3.ts":(G,k,u)=>{u.r(k),u.d(k,{canParse:()=>F,decodeFrame:()=>S,getID3Data:()=>b,getID3Frames:()=>T,getTimeStamp:()=>R,isFooter:()=>I,isHeader:()=>M,isTimeStampFrame:()=>C,testables:()=>r,utf8ArrayToStr:()=>n});var M=function(t,i){return i+10<=t.length&&t[i]===73&&t[i+1]===68&&t[i+2]===51&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},I=function(t,i){return i+10<=t.length&&t[i]===51&&t[i+1]===68&&t[i+2]===73&&t[i+3]<255&&t[i+4]<255&&t[i+6]<128&&t[i+7]<128&&t[i+8]<128&&t[i+9]<128},b=function(t,i){for(var c=i,f=0;M(t,i);){f+=10;var g=P(t,i+6);f+=g,I(t,i+10)&&(f+=10),i+=f}if(f>0)return t.subarray(c,c+f)},P=function(t,i){var c=0;return c=(t[i]&127)<<21,c|=(t[i+1]&127)<<14,c|=(t[i+2]&127)<<7,c|=t[i+3]&127,c},F=function(t,i){return M(t,i)&&P(t,i+6)+10<=t.length-i},R=function(t){for(var i=T(t),c=0;c<i.length;c++){var f=i[c];if(C(f))return l(f)}},C=function(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"},A=function(t){var i=String.fromCharCode(t[0],t[1],t[2],t[3]),c=P(t,4),f=10;return{type:i,size:c,data:t.subarray(f,f+c)}},T=function(t){for(var i=0,c=[];M(t,i);){var f=P(t,i+6);i+=10;for(var g=i+f;i+8<g;){var a=A(t.subarray(i)),p=S(a);p&&c.push(p),i+=a.size+10}I(t,i)&&(i+=10)}return c},S=function(t){return t.type==="PRIV"?D(t):t.type[0]==="W"?y(t):L(t)},D=function(t){if(!(t.size<2)){var i=n(t.data,!0),c=new Uint8Array(t.data.subarray(i.length+1));return{key:t.type,info:i,data:c.buffer}}},L=function(t){if(!(t.size<2)){if(t.type==="TXXX"){var i=1,c=n(t.data.subarray(i),!0);i+=c.length+1;var f=n(t.data.subarray(i));return{key:t.type,info:c,data:f}}var g=n(t.data.subarray(1));return{key:t.type,data:g}}},y=function(t){if(t.type==="WXXX"){if(t.size<2)return;var i=1,c=n(t.data.subarray(i),!0);i+=c.length+1;var f=n(t.data.subarray(i));return{key:t.type,info:c,data:f}}var g=n(t.data);return{key:t.type,data:g}},l=function(t){if(t.data.byteLength===8){var i=new Uint8Array(t.data),c=i[3]&1,f=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return f/=45,c&&(f+=4772185884e-2),Math.round(f)}},n=function(t,i){i===void 0&&(i=!1);var c=d();if(c){var f=c.decode(t);if(i){var g=f.indexOf("\0");return g!==-1?f.substring(0,g):f}return f.replace(/\0/g,"")}for(var a=t.length,p,v,o,_="",O=0;O<a;){if(p=t[O++],p===0&&i)return _;if(p===0||p===3)continue;switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:_+=String.fromCharCode(p);break;case 12:case 13:v=t[O++],_+=String.fromCharCode((p&31)<<6|v&63);break;case 14:v=t[O++],o=t[O++],_+=String.fromCharCode((p&15)<<12|(v&63)<<6|(o&63)<<0);break}}return _},r={decodeTextFrame:L},h;function d(){return!h&&typeof self.TextDecoder<"u"&&(h=new self.TextDecoder("utf-8")),h}},"./src/demux/mp3demuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>A});var M=u("./src/demux/base-audio-demuxer.ts"),I=u("./src/demux/id3.ts"),b=u("./src/utils/logger.ts"),P=u("./src/demux/mpegaudio.ts");function F(T,S){T.prototype=Object.create(S.prototype),T.prototype.constructor=T,R(T,S)}function R(T,S){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(L,y){return L.__proto__=y,L},R(T,S)}var C=function(T){F(S,T);function S(){return T.apply(this,arguments)||this}var D=S.prototype;return D.resetInitSegment=function(y,l,n,r){T.prototype.resetInitSegment.call(this,y,l,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:r,inputTimeScale:9e4,dropped:0}},S.probe=function(y){if(!y)return!1;for(var l=I.getID3Data(y,0)||[],n=l.length,r=y.length;n<r;n++)if(P.probe(y,n))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},D.canParse=function(y,l){return P.canParse(y,l)},D.appendFrame=function(y,l,n){if(this.basePTS!==null)return P.appendFrame(y,l,n,this.basePTS,this.frameIndex)},S}(M.default);const A=C},"./src/demux/mp4demuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>C});var M=u("./src/polyfills/number.ts"),I=u("./src/types/demuxer.ts"),b=u("./src/utils/mp4-tools.ts"),P=u("./src/demux/dummy-demuxed-track.ts"),F=/\/emsg[-/]ID3/i,R=function(){function A(S,D){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=D}var T=A.prototype;return T.resetTimeStamp=function(){},T.resetInitSegment=function(D,L,y,l){var n=(0,b.parseInitSegment)(D),r=this.videoTrack=(0,P.dummyTrack)("video",1),h=this.audioTrack=(0,P.dummyTrack)("audio",1),d=this.txtTrack=(0,P.dummyTrack)("text",1);if(this.id3Track=(0,P.dummyTrack)("id3",1),this.timeOffset=0,n.video){var e=n.video,t=e.id,i=e.timescale,c=e.codec;r.id=t,r.timescale=d.timescale=i,r.codec=c}if(n.audio){var f=n.audio,g=f.id,a=f.timescale,p=f.codec;h.id=g,h.timescale=a,h.codec=p}d.id=b.RemuxerTrackIdConfig.text,r.sampleDuration=0,r.duration=h.duration=l},T.resetContiguity=function(){},A.probe=function(D){return D=D.length>16384?D.subarray(0,16384):D,(0,b.findBox)(D,["moof"]).length>0},T.demux=function(D,L){this.timeOffset=L;var y=D,l=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(y=(0,b.appendUint8Array)(this.remainderData,D));var r=(0,b.segmentValidRange)(y);this.remainderData=r.remainder,l.samples=r.valid||new Uint8Array}else l.samples=y;var h=this.extractID3Track(l,L);return n.samples=(0,b.parseSamples)(L,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:h,textTrack:this.txtTrack}},T.flush=function(){var D=this.timeOffset,L=this.videoTrack,y=this.txtTrack;L.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(L,this.timeOffset);return y.samples=(0,b.parseSamples)(D,L),{videoTrack:L,audioTrack:(0,P.dummyTrack)(),id3Track:l,textTrack:(0,P.dummyTrack)()}},T.extractID3Track=function(D,L){var y=this.id3Track;if(D.samples.length){var l=(0,b.findBox)(D.samples,["emsg"]);l&&l.forEach(function(n){var r=(0,b.parseEmsg)(n);if(F.test(r.schemeIdUri)){var h=(0,M.isFiniteNumber)(r.presentationTime)?r.presentationTime/r.timeScale:L+r.presentationTimeDelta/r.timeScale,d=r.eventDuration===4294967295?Number.POSITIVE_INFINITY:r.eventDuration/r.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var e=r.payload;y.samples.push({data:e,len:e.byteLength,dts:h,pts:h,type:I.MetadataSchema.emsg,duration:d})}})}return y},T.demuxSampleAes=function(D,L,y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},T.destroy=function(){},A}();const C=R},"./src/demux/mpegaudio.ts":(G,k,u)=>{u.r(k),u.d(k,{appendFrame:()=>R,canParse:()=>S,isHeader:()=>T,isHeaderPattern:()=>A,parseHeader:()=>C,probe:()=>D});var M=null,I=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],P=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],F=[0,1,1,4];function R(L,y,l,n,r){if(!(l+24>y.length)){var h=C(y,l);if(h&&l+h.frameLength<=y.length){var d=h.samplesPerFrame*9e4/h.sampleRate,e=n+r*d,t={unit:y.subarray(l,l+h.frameLength),pts:e,dts:e};return L.config=[],L.channelCount=h.channelCount,L.samplerate=h.sampleRate,L.samples.push(t),{sample:t,length:h.frameLength,missing:0}}}}function C(L,y){var l=L[y+1]>>3&3,n=L[y+1]>>1&3,r=L[y+2]>>4&15,h=L[y+2]>>2&3;if(l!==1&&r!==0&&r!==15&&h!==3){var d=L[y+2]>>1&1,e=L[y+3]>>6,t=l===3?3-n:n===3?3:4,i=I[t*14+r-1]*1e3,c=l===3?0:l===2?1:2,f=b[c*3+h],g=e===3?1:2,a=P[l][n],p=F[n],v=a*8*p,o=Math.floor(a*i/f+d)*p;if(M===null){var _=navigator.userAgent||"",O=_.match(/Chrome\/(\d+)/i);M=O?parseInt(O[1]):0}var B=!!M&&M<=87;return B&&n===2&&i>=224e3&&e===0&&(L[y+3]=L[y+3]|128),{sampleRate:f,channelCount:g,frameLength:o,samplesPerFrame:v}}}function A(L,y){return L[y]===255&&(L[y+1]&224)===224&&(L[y+1]&6)!==0}function T(L,y){return y+1<L.length&&A(L,y)}function S(L,y){var l=4;return A(L,y)&&l<=L.length-y}function D(L,y){if(y+1<L.length&&A(L,y)){var l=4,n=C(L,y),r=l;n!=null&&n.frameLength&&(r=n.frameLength);var h=y+r;return h===L.length||T(L,h)}return!1}},"./src/demux/sample-aes.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>P});var M=u("./src/crypt/decrypter.ts"),I=u("./src/utils/mp4-tools.ts"),b=function(){function F(C,A,T){this.keyData=void 0,this.decrypter=void 0,this.keyData=T,this.decrypter=new M.default(C,A,{removePKCS7Padding:!1})}var R=F.prototype;return R.decryptBuffer=function(A,T){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,T)},R.decryptAacSample=function(A,T,S,D){var L=A[T].unit;if(!(L.length<=16)){var y=L.subarray(16,L.length-L.length%16),l=y.buffer.slice(y.byteOffset,y.byteOffset+y.length),n=this;this.decryptBuffer(l,function(r){var h=new Uint8Array(r);L.set(h,16),D||n.decryptAacSamples(A,T+1,S)})}},R.decryptAacSamples=function(A,T,S){for(;;T++){if(T>=A.length){S();return}if(!(A[T].unit.length<32)){var D=this.decrypter.isSync();if(this.decryptAacSample(A,T,S,D),!D)return}}},R.getAvcEncryptedData=function(A){for(var T=Math.floor((A.length-48)/160)*16+16,S=new Int8Array(T),D=0,L=32;L<A.length-16;L+=160,D+=16)S.set(A.subarray(L,L+16),D);return S},R.getAvcDecryptedUnit=function(A,T){for(var S=new Uint8Array(T),D=0,L=32;L<A.length-16;L+=160,D+=16)A.set(S.subarray(D,D+16),L);return A},R.decryptAvcSample=function(A,T,S,D,L,y){var l=(0,I.discardEPB)(L.data),n=this.getAvcEncryptedData(l),r=this;this.decryptBuffer(n.buffer,function(h){L.data=r.getAvcDecryptedUnit(l,h),y||r.decryptAvcSamples(A,T,S+1,D)})},R.decryptAvcSamples=function(A,T,S,D){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,S=0){if(T>=A.length){D();return}for(var L=A[T].units;!(S>=L.length);S++){var y=L[S];if(!(y.data.length<=48||y.type!==1&&y.type!==5)){var l=this.decrypter.isSync();if(this.decryptAvcSample(A,T,S,D,y,l),!l)return}}}},F}();const P=b},"./src/demux/transmuxer-interface.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>T});var M=u("./src/demux/webworkify-webpack.js"),I=u("./src/events.ts"),b=u("./src/demux/transmuxer.ts"),P=u("./src/utils/logger.ts"),F=u("./src/errors.ts"),R=u("./src/utils/mediasource-helper.ts"),C=u("./node_modules/eventemitter3/index.js"),A=(0,R.getMediaSource)()||{isTypeSupported:function(){return!1}},T=function(){function S(L,y,l,n){var r=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var h=L.config;this.hls=L,this.id=y,this.useWorker=!!h.enableWorker,this.onTransmuxComplete=l,this.onFlush=n;var d=function(f,g){g=g||{},g.frag=r.frag,g.id=r.id,r.hls.trigger(f,g)};this.observer=new C.EventEmitter,this.observer.on(I.Events.FRAG_DECRYPTED,d),this.observer.on(I.Events.ERROR,d);var e={mp4:A.isTypeSupported("video/mp4"),mpeg:A.isTypeSupported("audio/mpeg"),mp3:A.isTypeSupported('audio/mp4; codecs="mp3"')},t=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){P.logger.log("demuxing in webworker");var i;try{i=this.worker=(0,M.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),i.addEventListener("message",this.onwmsg),i.onerror=function(c){r.useWorker=!1,P.logger.warn("Exception in webworker, fallback to inline"),r.hls.trigger(I.Events.ERROR,{type:F.ErrorTypes.OTHER_ERROR,details:F.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(c.message+"  ("+c.filename+":"+c.lineno+")")})},i.postMessage({cmd:"init",typeSupported:e,vendor:t,id:y,config:JSON.stringify(h)})}catch(c){P.logger.warn("Error in worker:",c),P.logger.error("Error while initializing DemuxerWorker, fallback to inline"),i&&self.URL.revokeObjectURL(i.objectURL),this.transmuxer=new b.default(this.observer,e,h,t,y),this.worker=null}}else this.transmuxer=new b.default(this.observer,e,h,t,y)}var D=S.prototype;return D.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},D.push=function(y,l,n,r,h,d,e,t,i,c){var f,g,a=this;i.transmuxing.start=self.performance.now();var p=this.transmuxer,v=this.worker,o=d?d.start:h.start,_=h.decryptdata,O=this.frag,B=!(O&&h.cc===O.cc),K=!(O&&i.level===O.level),N=O?i.sn-O.sn:-1,W=this.part?i.part-this.part.index:-1,H=N===0&&i.id>1&&i.id===(O==null?void 0:O.stats.chunkCount),V=!K&&(N===1||N===0&&(W===1||H&&W<=0)),j=self.performance.now();(K||N||h.stats.parsing.start===0)&&(h.stats.parsing.start=j),d&&(W||!V)&&(d.stats.parsing.start=j);var z=!(O&&((f=h.initSegment)===null||f===void 0?void 0:f.url)===((g=O.initSegment)===null||g===void 0?void 0:g.url)),$=new b.TransmuxState(B,V,t,K,o,z);if(!V||B||z){P.logger.log("[transmuxer-interface, "+h.type+"]: Starting new transmux session for sn: "+i.sn+" p: "+i.part+" level: "+i.level+" id: "+i.id+`
        discontinuity: `+B+`
        trackSwitch: `+K+`
        contiguous: `+V+`
        accurateTimeOffset: `+t+`
        timeOffset: `+o+`
        initSegmentChange: `+z);var Y=new b.TransmuxConfig(n,r,l,e,c);this.configureTransmuxer(Y)}if(this.frag=h,this.part=d,v)v.postMessage({cmd:"demux",data:y,decryptdata:_,chunkMeta:i,state:$},y instanceof ArrayBuffer?[y]:[]);else if(p){var X=p.push(y,_,i,$);(0,b.isPromise)(X)?X.then(function(Q){a.handleTransmuxComplete(Q)}):this.handleTransmuxComplete(X)}},D.flush=function(y){var l=this;y.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:y});else if(n){var h=n.flush(y);(0,b.isPromise)(h)?h.then(function(d){l.handleFlushResult(d,y)}):this.handleFlushResult(h,y)}},D.handleFlushResult=function(y,l){var n=this;y.forEach(function(r){n.handleTransmuxComplete(r)}),this.onFlush(l)},D.onWorkerMessage=function(y){var l=y.data,n=this.hls;switch(l.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":P.logger[l.data.logType]&&P.logger[l.data.logType](l.data.message);break;default:{l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,n.trigger(l.event,l.data);break}}},D.configureTransmuxer=function(y){var l=this.worker,n=this.transmuxer;l?l.postMessage({cmd:"configure",config:y}):n&&n.configure(y)},D.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},S}()},"./src/demux/transmuxer-worker.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>F});var M=u("./src/demux/transmuxer.ts"),I=u("./src/events.ts"),b=u("./src/utils/logger.ts"),P=u("./node_modules/eventemitter3/index.js");function F(S){var D=new P.EventEmitter,L=function(n,r){S.postMessage({event:n,data:r})};D.on(I.Events.FRAG_DECRYPTED,L),D.on(I.Events.ERROR,L);var y=function(){var n=function(d){var e=function(i){L("workerLog",{logType:d,message:i})};b.logger[d]=e};for(var r in b.logger)n(r)};S.addEventListener("message",function(l){var n=l.data;switch(n.cmd){case"init":{var r=JSON.parse(n.config);S.transmuxer=new M.default(D,n.typeSupported,r,n.vendor,n.id),(0,b.enableLogs)(r.debug,n.id),y(),L("init",null);break}case"configure":{S.transmuxer.configure(n.config);break}case"demux":{var h=S.transmuxer.push(n.data,n.decryptdata,n.chunkMeta,n.state);(0,M.isPromise)(h)?h.then(function(t){R(S,t)}):R(S,h);break}case"flush":{var d=n.chunkMeta,e=S.transmuxer.flush(d);(0,M.isPromise)(e)?e.then(function(t){A(S,t,d)}):A(S,e,d);break}}})}function R(S,D){if(T(D.remuxResult))return!1;var L=[],y=D.remuxResult,l=y.audio,n=y.video;return l&&C(L,l),n&&C(L,n),S.postMessage({event:"transmuxComplete",data:D},L),!0}function C(S,D){D.data1&&S.push(D.data1.buffer),D.data2&&S.push(D.data2.buffer)}function A(S,D,L){var y=D.reduce(function(l,n){return R(S,n)||l},!1);y||S.postMessage({event:"transmuxComplete",data:D[0]}),S.postMessage({event:"flush",data:L})}function T(S){return!S.audio&&!S.video&&!S.text&&!S.id3&&!S.initSegment}},"./src/demux/transmuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{TransmuxConfig:()=>h,TransmuxState:()=>d,default:()=>y,isPromise:()=>r});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/crypt/decrypter.ts"),P=u("./src/demux/aacdemuxer.ts"),F=u("./src/demux/mp4demuxer.ts"),R=u("./src/demux/tsdemuxer.ts"),C=u("./src/demux/mp3demuxer.ts"),A=u("./src/remux/mp4-remuxer.ts"),T=u("./src/remux/passthrough-remuxer.ts"),S=u("./src/utils/logger.ts"),D;try{D=self.performance.now.bind(self.performance)}catch{S.logger.debug("Unable to use Performance API on this environment"),D=self.Date.now}var L=[{demux:R.default,remux:A.default},{demux:F.default,remux:T.default},{demux:P.default,remux:A.default},{demux:C.default,remux:A.default}],y=function(){function e(i,c,f,g,a){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=i,this.typeSupported=c,this.config=f,this.vendor=g,this.id=a}var t=e.prototype;return t.configure=function(c){this.transmuxConfig=c,this.decrypter&&this.decrypter.reset()},t.push=function(c,f,g,a){var p=this,v=g.transmuxing;v.executeStart=D();var o=new Uint8Array(c),_=this.config,O=this.currentTransmuxState,B=this.transmuxConfig;a&&(this.currentTransmuxState=a);var K=a||O,N=K.contiguous,W=K.discontinuity,H=K.trackSwitch,V=K.accurateTimeOffset,j=K.timeOffset,z=K.initSegmentChange,$=B.audioCodec,Y=B.videoCodec,X=B.defaultInitPts,Q=B.duration,q=B.initSegmentData;(W||H||z)&&this.resetInitSegment(q,$,Y,Q),(W||z)&&this.resetInitialTimestamp(X),N||this.resetContiguity();var J=l(o,f);if(J&&J.method==="AES-128"){var ie=this.getDecrypter();if(_.enableSoftwareAES){var se=ie.softwareDecrypt(o,J.key.buffer,J.iv.buffer);if(!se)return v.executeEnd=D(),n(g);o=new Uint8Array(se)}else return this.decryptionPromise=ie.webCryptoDecrypt(o,J.key.buffer,J.iv.buffer).then(function(le){var oe=p.push(le,null,g);return p.decryptionPromise=null,oe}),this.decryptionPromise}this.needsProbing(o,W,H)&&this.configureTransmuxer(o,B);var Z=this.transmux(o,J,j,V,g),re=this.currentTransmuxState;return re.contiguous=!0,re.discontinuity=!1,re.trackSwitch=!1,v.executeEnd=D(),Z},t.flush=function(c){var f=this,g=c.transmuxing;g.executeStart=D();var a=this.decrypter,p=this.currentTransmuxState,v=this.decryptionPromise;if(v)return v.then(function(){return f.flush(c)});var o=[],_=p.timeOffset;if(a){var O=a.flush();O&&o.push(this.push(O,null,c))}var B=this.demuxer,K=this.remuxer;if(!B||!K)return this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),g.executeEnd=D(),[n(c)];var N=B.flush(_);return r(N)?N.then(function(W){return f.flushRemux(o,W,c),o}):(this.flushRemux(o,N,c),o)},t.flushRemux=function(c,f,g){var a=f.audioTrack,p=f.videoTrack,v=f.id3Track,o=f.textTrack,_=this.currentTransmuxState,O=_.accurateTimeOffset,B=_.timeOffset;S.logger.log("[transmuxer.ts]: Flushed fragment "+g.sn+(g.part>-1?" p: "+g.part:"")+" of level "+g.level);var K=this.remuxer.remux(a,p,v,o,B,O,!0,this.id);c.push({remuxResult:K,chunkMeta:g}),g.transmuxing.executeEnd=D()},t.resetInitialTimestamp=function(c){var f=this.demuxer,g=this.remuxer;!f||!g||(f.resetTimeStamp(c),g.resetTimeStamp(c))},t.resetContiguity=function(){var c=this.demuxer,f=this.remuxer;!c||!f||(c.resetContiguity(),f.resetNextTimestamp())},t.resetInitSegment=function(c,f,g,a){var p=this.demuxer,v=this.remuxer;!p||!v||(p.resetInitSegment(c,f,g,a),v.resetInitSegment(c,f,g))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(c,f,g,a,p){var v;return f&&f.method==="SAMPLE-AES"?v=this.transmuxSampleAes(c,f,g,a,p):v=this.transmuxUnencrypted(c,g,a,p),v},t.transmuxUnencrypted=function(c,f,g,a){var p=this.demuxer.demux(c,f,!1,!this.config.progressive),v=p.audioTrack,o=p.videoTrack,_=p.id3Track,O=p.textTrack,B=this.remuxer.remux(v,o,_,O,f,g,!1,this.id);return{remuxResult:B,chunkMeta:a}},t.transmuxSampleAes=function(c,f,g,a,p){var v=this;return this.demuxer.demuxSampleAes(c,f,g).then(function(o){var _=v.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,g,a,!1,v.id);return{remuxResult:_,chunkMeta:p}})},t.configureTransmuxer=function(c,f){for(var g=this.config,a=this.observer,p=this.typeSupported,v=this.vendor,o=f.audioCodec,_=f.defaultInitPts,O=f.duration,B=f.initSegmentData,K=f.videoCodec,N,W=0,H=L.length;W<H;W++)if(L[W].demux.probe(c)){N=L[W];break}N||(S.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:F.default,remux:T.default});var V=this.demuxer,j=this.remuxer,z=N.remux,$=N.demux;(!j||!(j instanceof z))&&(this.remuxer=new z(a,g,p,v)),(!V||!(V instanceof $))&&(this.demuxer=new $(a,g,p),this.probe=$.probe),this.resetInitSegment(B,o,K,O),this.resetInitialTimestamp(_)},t.needsProbing=function(c,f,g){return!this.demuxer||!this.remuxer||f||g},t.getDecrypter=function(){var c=this.decrypter;return c||(c=this.decrypter=new b.default(this.observer,this.config)),c},e}();function l(e,t){var i=null;return e.byteLength>0&&t!=null&&t.key!=null&&t.iv!==null&&t.method!=null&&(i=t),i}var n=function(t){return{remuxResult:{},chunkMeta:t}};function r(e){return"then"in e&&e.then instanceof Function}var h=function(t,i,c,f,g){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=i,this.initSegmentData=c,this.duration=f,this.defaultInitPts=g},d=function(t,i,c,f,g,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=i,this.accurateTimeOffset=c,this.trackSwitch=f,this.timeOffset=g,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>d});var M=u("./src/demux/adts.ts"),I=u("./src/demux/mpegaudio.ts"),b=u("./src/demux/exp-golomb.ts"),P=u("./src/demux/sample-aes.ts"),F=u("./src/events.ts"),R=u("./src/utils/mp4-tools.ts"),C=u("./src/utils/logger.ts"),A=u("./src/errors.ts"),T=u("./src/types/demuxer.ts");function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c])}return e},S.apply(this,arguments)}var D=188,L=function(){function e(i,c,f){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=i,this.config=c,this.typeSupported=f}e.probe=function(c){var f=e.syncOffset(c);return f>0&&C.logger.warn("MPEG2-TS detected but first sync word found @ offset "+f),f!==-1},e.syncOffset=function(c){for(var f=Math.min(D*5,c.length-D*2)+1,g=0;g<f;){if(c[g]===71&&c[g+D]===71)return g;g++}return-1},e.createTrack=function(c,f){return{container:c==="video"||c==="audio"?"video/mp2t":void 0,type:c,id:R.RemuxerTrackIdConfig[c],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:c==="audio"?f:void 0}};var t=e.prototype;return t.resetInitSegment=function(c,f,g,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",a),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=f,this.videoCodec=g,this._duration=a},t.resetTimeStamp=function(){},t.resetContiguity=function(){var c=this._audioTrack,f=this._avcTrack,g=this._id3Track;c&&(c.pesData=null),f&&(f.pesData=null),g&&(g.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(c,f,g,a){g===void 0&&(g=!1),a===void 0&&(a=!1),g||(this.sampleAes=null);var p,v=this._avcTrack,o=this._audioTrack,_=this._id3Track,O=this._txtTrack,B=v.pid,K=v.pesData,N=o.pid,W=_.pid,H=o.pesData,V=_.pesData,j=null,z=this.pmtParsed,$=this._pmtId,Y=c.length;if(this.remainderData&&(c=(0,R.appendUint8Array)(this.remainderData,c),Y=c.length,this.remainderData=null),Y<D&&!a)return this.remainderData=c,{audioTrack:o,videoTrack:v,id3Track:_,textTrack:O};var X=Math.max(0,e.syncOffset(c));Y-=(Y-X)%D,Y<c.byteLength&&!a&&(this.remainderData=new Uint8Array(c.buffer,Y,c.buffer.byteLength-Y));for(var Q=0,q=X;q<Y;q+=D)if(c[q]===71){var J=!!(c[q+1]&64),ie=((c[q+1]&31)<<8)+c[q+2],se=(c[q+3]&48)>>4,Z=void 0;if(se>1){if(Z=q+5+c[q+4],Z===q+D)continue}else Z=q+4;switch(ie){case B:J&&(K&&(p=r(K))&&this.parseAVCPES(v,O,p,!1),K={data:[],size:0}),K&&(K.data.push(c.subarray(Z,q+D)),K.size+=q+D-Z);break;case N:if(J){if(H&&(p=r(H)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,p);break;case"mp3":this.parseMPEGPES(o,p);break}H={data:[],size:0}}H&&(H.data.push(c.subarray(Z,q+D)),H.size+=q+D-Z);break;case W:J&&(V&&(p=r(V))&&this.parseID3PES(_,p),V={data:[],size:0}),V&&(V.data.push(c.subarray(Z,q+D)),V.size+=q+D-Z);break;case 0:J&&(Z+=c[Z]+1),$=this._pmtId=l(c,Z);break;case $:{J&&(Z+=c[Z]+1);var re=n(c,Z,this.typeSupported,g);B=re.avc,B>0&&(v.pid=B),N=re.audio,N>0&&(o.pid=N,o.segmentCodec=re.segmentCodec),W=re.id3,W>0&&(_.pid=W),j!==null&&!z&&(C.logger.log("unknown PID '"+j+"' in TS found"),j=null,q=X-188),z=this.pmtParsed=!0;break}case 17:case 8191:break;default:j=ie;break}}else Q++;Q>0&&this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+Q+" TS packet/s that do not start with 0x47"}),v.pesData=K,o.pesData=H,_.pesData=V;var le={audioTrack:o,videoTrack:v,id3Track:_,textTrack:O};return a&&this.extractRemainingSamples(le),le},t.flush=function(){var c=this.remainderData;this.remainderData=null;var f;return c?f=this.demux(c,-1,!1,!0):f={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(f),this.sampleAes?this.decrypt(f,this.sampleAes):f},t.extractRemainingSamples=function(c){var f=c.audioTrack,g=c.videoTrack,a=c.id3Track,p=c.textTrack,v=g.pesData,o=f.pesData,_=a.pesData,O;if(v&&(O=r(v))?(this.parseAVCPES(g,p,O,!0),g.pesData=null):g.pesData=v,o&&(O=r(o))){switch(f.segmentCodec){case"aac":this.parseAACPES(f,O);break;case"mp3":this.parseMPEGPES(f,O);break}f.pesData=null}else o!=null&&o.size&&C.logger.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=o;_&&(O=r(_))?(this.parseID3PES(a,O),a.pesData=null):a.pesData=_},t.demuxSampleAes=function(c,f,g){var a=this.demux(c,g,!0,!this.config.progressive),p=this.sampleAes=new P.default(this.observer,this.config,f);return this.decrypt(a,p)},t.decrypt=function(c,f){return new Promise(function(g){var a=c.audioTrack,p=c.videoTrack;a.samples&&a.segmentCodec==="aac"?f.decryptAacSamples(a.samples,0,function(){p.samples?f.decryptAvcSamples(p.samples,0,0,function(){g(c)}):g(c)}):p.samples&&f.decryptAvcSamples(p.samples,0,0,function(){g(c)})})},t.destroy=function(){this._duration=0},t.parseAVCPES=function(c,f,g,a){var p=this,v=this.parseAVCNALu(c,g.data),o=this.avcSample,_,O=!1;g.data=null,o&&v.length&&!c.audFound&&(h(o,c),o=this.avcSample=y(!1,g.pts,g.dts,"")),v.forEach(function(B){switch(B.type){case 1:{_=!0,o||(o=p.avcSample=y(!0,g.pts,g.dts,"")),o.frame=!0;var K=B.data;if(O&&K.length>4){var N=new b.default(K).readSliceType();(N===2||N===4||N===7||N===9)&&(o.key=!0)}break}case 5:_=!0,o||(o=p.avcSample=y(!0,g.pts,g.dts,"")),o.key=!0,o.frame=!0;break;case 6:{_=!0,(0,R.parseSEIMessageFromNALu)(B.data,1,g.pts,f.samples);break}case 7:if(_=!0,O=!0,!c.sps){var W=new b.default(B.data),H=W.readSPS();c.width=H.width,c.height=H.height,c.pixelRatio=H.pixelRatio,c.sps=[B.data],c.duration=p._duration;for(var V=B.data.subarray(1,4),j="avc1.",z=0;z<3;z++){var $=V[z].toString(16);$.length<2&&($="0"+$),j+=$}c.codec=j}break;case 8:_=!0,c.pps||(c.pps=[B.data]);break;case 9:_=!1,c.audFound=!0,o&&h(o,c),o=p.avcSample=y(!1,g.pts,g.dts,"");break;case 12:_=!0;break;default:_=!1,o&&(o.debug+="unknown NAL "+B.type+" ");break}if(o&&_){var Y=o.units;Y.push(B)}}),a&&o&&(h(o,c),this.avcSample=null)},t.getLastNalUnit=function(c){var f,g=this.avcSample,a;if((!g||g.units.length===0)&&(g=c[c.length-1]),(f=g)!==null&&f!==void 0&&f.units){var p=g.units;a=p[p.length-1]}return a},t.parseAVCNALu=function(c,f){var g=f.byteLength,a=c.naluState||0,p=a,v=[],o=0,_,O,B,K=-1,N=0;for(a===-1&&(K=0,N=f[0]&31,a=0,o=1);o<g;){if(_=f[o++],!a){a=_?0:1;continue}if(a===1){a=_?0:2;continue}if(!_)a=3;else if(_===1){if(K>=0){var W={data:f.subarray(K,o-a-1),type:N};v.push(W)}else{var H=this.getLastNalUnit(c.samples);if(H&&(p&&o<=4-p&&H.state&&(H.data=H.data.subarray(0,H.data.byteLength-p)),O=o-a-1,O>0)){var V=new Uint8Array(H.data.byteLength+O);V.set(H.data,0),V.set(f.subarray(0,O),H.data.byteLength),H.data=V,H.state=0}}o<g?(B=f[o]&31,K=o,N=B,a=0):a=-1}else a=0}if(K>=0&&a>=0){var j={data:f.subarray(K,g),type:N,state:a};v.push(j)}if(v.length===0){var z=this.getLastNalUnit(c.samples);if(z){var $=new Uint8Array(z.data.byteLength+f.byteLength);$.set(z.data,0),$.set(f,z.data.byteLength),z.data=$}}return c.naluState=a,v},t.parseAACPES=function(c,f){var g=0,a=this.aacOverFlow,p=f.data;if(a){this.aacOverFlow=null;var v=a.missing,o=a.sample.unit.byteLength;if(v===-1){var _=new Uint8Array(o+p.byteLength);_.set(a.sample.unit,0),_.set(p,o),p=_}else{var O=o-v;a.sample.unit.set(p.subarray(0,v),O),c.samples.push(a.sample),g=a.missing}}var B,K;for(B=g,K=p.length;B<K-1&&!M.isHeader(p,B);B++);if(B!==g){var N,W;if(B<K-1?(N="AAC PES did not start with ADTS header,offset:"+B,W=!1):(N="no ADTS header found in AAC PES",W=!0),C.logger.warn("parsing error:"+N),this.observer.emit(F.Events.ERROR,F.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.FRAG_PARSING_ERROR,fatal:W,reason:N}),W)return}M.initTrackConfig(c,this.observer,p,B,this.audioCodec);var H;if(f.pts!==void 0)H=f.pts;else if(a){var V=M.getFrameDuration(c.samplerate);H=a.sample.pts+V}else{C.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var j=0,z;B<K;)if(z=M.appendFrame(c,p,B,H,j),B+=z.length,z.missing){this.aacOverFlow=z;break}else for(j++;B<K-1&&!M.isHeader(p,B);B++);},t.parseMPEGPES=function(c,f){var g=f.data,a=g.length,p=0,v=0,o=f.pts;if(o===void 0){C.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;v<a;)if(I.isHeader(g,v)){var _=I.appendFrame(c,g,v,o,p);if(_)v+=_.length,p++;else break}else v++},t.parseID3PES=function(c,f){if(f.pts===void 0){C.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var g=S({},f,{type:this._avcTrack?T.MetadataSchema.emsg:T.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});c.samples.push(g)},e}();function y(e,t,i,c){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:c,length:0}}function l(e,t){return(e[t+10]&31)<<8|e[t+11]}function n(e,t,i,c){var f={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},g=(e[t+1]&15)<<8|e[t+2],a=t+3+g-4,p=(e[t+10]&15)<<8|e[t+11];for(t+=12+p;t<a;){var v=(e[t+1]&31)<<8|e[t+2];switch(e[t]){case 207:if(!c){C.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:f.audio===-1&&(f.audio=v);break;case 21:f.id3===-1&&(f.id3=v);break;case 219:if(!c){C.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:f.avc===-1&&(f.avc=v);break;case 3:case 4:i.mpeg!==!0&&i.mp3!==!0?C.logger.log("MPEG audio found, not supported in this browser"):f.audio===-1&&(f.audio=v,f.segmentCodec="mp3");break;case 36:C.logger.warn("Unsupported HEVC stream type found");break}t+=((e[t+3]&15)<<8|e[t+4])+5}return f}function r(e){var t=0,i,c,f,g,a,p=e.data;if(!e||e.size===0)return null;for(;p[0].length<19&&p.length>1;){var v=new Uint8Array(p[0].length+p[1].length);v.set(p[0]),v.set(p[1],p[0].length),p[0]=v,p.splice(1,1)}i=p[0];var o=(i[0]<<16)+(i[1]<<8)+i[2];if(o===1){if(c=(i[4]<<8)+i[5],c&&c>e.size-6)return null;var _=i[7];_&192&&(g=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,_&64?(a=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,g-a>54e5&&(C.logger.warn(Math.round((g-a)/9e4)+"s delta between PTS and DTS, align them"),g=a)):a=g),f=i[8];var O=f+9;if(e.size<=O)return null;e.size-=O;for(var B=new Uint8Array(e.size),K=0,N=p.length;K<N;K++){i=p[K];var W=i.byteLength;if(O)if(O>W){O-=W;continue}else i=i.subarray(O),W-=O,O=0;B.set(i,t),t+=W}return c&&(c-=f+3),{data:B,pts:g,dts:a,len:c}}return null}function h(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){var i=t.samples,c=i.length;if(c){var f=i[c-1];e.pts=f.pts,e.dts=f.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&C.logger.log(e.pts+"/"+e.dts+":"+e.debug)}const d=L},"./src/demux/webworkify-webpack.js":(G,k,u)=>{u.r(k),u.d(k,{default:()=>D});var M=function(){var y=ENTRY_MODULE,l={},n=function h(d){var e=l[d];if(e!==void 0)return e.exports;var t=l[d]={exports:{}};return y[d].call(t.exports,t,t.exports,h),t.exports};n.m=y,function(){n.n=function(h){var d=h&&h.__esModule?function(){return h.default}:function(){return h};return n.d(d,{a:d}),d}}(),function(){n.d=function(h,d){for(var e in d)n.o(d,e)&&!n.o(h,e)&&Object.defineProperty(h,e,{enumerable:!0,get:d[e]})}}(),function(){n.o=function(h,d){return Object.prototype.hasOwnProperty.call(h,d)}}(),function(){n.r=function(h){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})}}();var r=n(ENTRY_MODULE);return r.default||r},I=M.toString().split("ENTRY_MODULE"),b="[\\.|\\-|\\+|\\w|/|@]+",P="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+b+").*?\\)";function F(L){return(L+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(L){return!isNaN(1*L)}function C(L,y,l){var n={};n[l]=[];var r=y.toString().replace(/^"[^"]+"/,"function"),h=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||r.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!h)return n;for(var d=h[1],e=new RegExp("(\\\\n|\\W)"+F(d)+P,"g"),t;t=e.exec(r);)t[3]!=="dll-reference"&&n[l].push(t[3]);for(e=new RegExp("\\("+F(d)+'\\("(dll-reference\\s('+b+'))"\\)\\)'+P,"g");t=e.exec(r);)L[t[2]]||(n[l].push(t[1]),L[t[2]]=u(t[1]).m),n[t[2]]=n[t[2]]||[],n[t[2]].push(t[4]);for(var i=Object.keys(n),c=0;c<i.length;c++)for(var f=0;f<n[i[c]].length;f++)R(n[i[c]][f])&&(n[i[c]][f]=1*n[i[c]][f]);return n}function A(L){var y=Object.keys(L);return y.reduce(function(l,n){return l||L[n].length>0},!1)}function T(L,y){for(var l={main:[y]},n={main:[]},r={main:{}};A(l);)for(var h=Object.keys(l),d=0;d<h.length;d++){var e=h[d],t=l[e],i=t.pop();if(r[e]=r[e]||{},!(r[e][i]||!L[e][i])){r[e][i]=!0,n[e]=n[e]||[],n[e].push(i);for(var c=C(L,L[e][i],e),f=Object.keys(c),g=0;g<f.length;g++)l[f[g]]=l[f[g]]||[],l[f[g]]=l[f[g]].concat(c[f[g]])}}return n}function S(L,y,l,n){var r=L[n].map(function(h){return'"'+h+'": '+y[n][h].toString().replace(/^"[^"]+"/,"function")}).join(",");return I[0]+"{"+r+"}"+I[1]+'"'+l+'"'+I[2]}function D(L,y){y=y||{};var l={main:u.m},n=y.all?{main:Object.keys(l.main)}:T(l,L),r="";Object.keys(n).filter(function(i){return i!=="main"}).forEach(function(i){for(var c=0;n[i][c];)c++;n[i].push(c),l[i][c]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+("var "+i+" = ("+S(n,l,c,modules)+`)();
`)}),r=r+("new (("+S(n,l,L,"main")+")())(self);");var h=new window.Blob([r],{type:"text/javascript"}),d=window.URL||window.webkitURL||window.mozURL||window.msURL,e=d.createObjectURL(h),t=new window.Worker(e);return t.objectURL=e,t}},"./src/errors.ts":(G,k,u)=>{u.r(k),u.d(k,{ErrorDetails:()=>I,ErrorTypes:()=>M});var M;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(M||(M={}));var I;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(I||(I={}))},"./src/events.ts":(G,k,u)=>{u.r(k),u.d(k,{Events:()=>M});var M;(function(I){I.MEDIA_ATTACHING="hlsMediaAttaching",I.MEDIA_ATTACHED="hlsMediaAttached",I.MEDIA_DETACHING="hlsMediaDetaching",I.MEDIA_DETACHED="hlsMediaDetached",I.BUFFER_RESET="hlsBufferReset",I.BUFFER_CODECS="hlsBufferCodecs",I.BUFFER_CREATED="hlsBufferCreated",I.BUFFER_APPENDING="hlsBufferAppending",I.BUFFER_APPENDED="hlsBufferAppended",I.BUFFER_EOS="hlsBufferEos",I.BUFFER_FLUSHING="hlsBufferFlushing",I.BUFFER_FLUSHED="hlsBufferFlushed",I.MANIFEST_LOADING="hlsManifestLoading",I.MANIFEST_LOADED="hlsManifestLoaded",I.MANIFEST_PARSED="hlsManifestParsed",I.LEVEL_SWITCHING="hlsLevelSwitching",I.LEVEL_SWITCHED="hlsLevelSwitched",I.LEVEL_LOADING="hlsLevelLoading",I.LEVEL_LOADED="hlsLevelLoaded",I.LEVEL_UPDATED="hlsLevelUpdated",I.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",I.LEVELS_UPDATED="hlsLevelsUpdated",I.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",I.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",I.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",I.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",I.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",I.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",I.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",I.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",I.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",I.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",I.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",I.CUES_PARSED="hlsCuesParsed",I.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",I.INIT_PTS_FOUND="hlsInitPtsFound",I.FRAG_LOADING="hlsFragLoading",I.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",I.FRAG_LOADED="hlsFragLoaded",I.FRAG_DECRYPTED="hlsFragDecrypted",I.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",I.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",I.FRAG_PARSING_METADATA="hlsFragParsingMetadata",I.FRAG_PARSED="hlsFragParsed",I.FRAG_BUFFERED="hlsFragBuffered",I.FRAG_CHANGED="hlsFragChanged",I.FPS_DROP="hlsFpsDrop",I.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",I.ERROR="hlsError",I.DESTROYING="hlsDestroying",I.KEY_LOADING="hlsKeyLoading",I.KEY_LOADED="hlsKeyLoaded",I.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",I.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>h});var M=u("./node_modules/url-toolkit/src/url-toolkit.js"),I=u("./src/loader/playlist-loader.ts"),b=u("./src/loader/key-loader.ts"),P=u("./src/controller/id3-track-controller.ts"),F=u("./src/controller/latency-controller.ts"),R=u("./src/controller/level-controller.ts"),C=u("./src/controller/fragment-tracker.ts"),A=u("./src/controller/stream-controller.ts"),T=u("./src/is-supported.ts"),S=u("./src/utils/logger.ts"),D=u("./src/config.ts"),L=u("./node_modules/eventemitter3/index.js"),y=u("./src/events.ts"),l=u("./src/errors.ts");function n(d,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(d,i.key,i)}}function r(d,e,t){return e&&n(d.prototype,e),t&&n(d,t),Object.defineProperty(d,"prototype",{writable:!1}),d}var h=function(){d.isSupported=function(){return(0,T.isSupported)()};function d(t){t===void 0&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new L.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=(0,D.mergeConfig)(d.DefaultConfig,t);this.userConfig=t,(0,S.enableLogs)(i.debug,"Hls instance"),this._autoLevelCapping=-1,i.progressive&&(0,D.enableStreamingMode)(i);var c=i.abrController,f=i.bufferController,g=i.capLevelController,a=i.fpsController,p=this.abrController=new c(this),v=this.bufferController=new f(this),o=this.capLevelController=new g(this),_=new a(this),O=new I.default(this),B=new b.default(this),K=new P.default(this),N=this.levelController=new R.default(this),W=new C.FragmentTracker(this),H=this.streamController=new A.default(this,W);o.setStreamController(H),_.setStreamController(H);var V=[O,B,N,H];this.networkControllers=V;var j=[p,v,o,_,K,W];this.audioTrackController=this.createController(i.audioTrackController,null,V),this.createController(i.audioStreamController,W,V),this.subtitleTrackController=this.createController(i.subtitleTrackController,null,V),this.createController(i.subtitleStreamController,W,V),this.createController(i.timelineController,null,j),this.emeController=this.createController(i.emeController,null,j),this.cmcdController=this.createController(i.cmcdController,null,j),this.latencyController=this.createController(F.default,null,j),this.coreComponents=j}var e=d.prototype;return e.createController=function(i,c,f){if(i){var g=c?new i(this,c):new i(this);return f&&f.push(g),g}return null},e.on=function(i,c,f){f===void 0&&(f=this),this._emitter.on(i,c,f)},e.once=function(i,c,f){f===void 0&&(f=this),this._emitter.once(i,c,f)},e.removeAllListeners=function(i){this._emitter.removeAllListeners(i)},e.off=function(i,c,f,g){f===void 0&&(f=this),this._emitter.off(i,c,f,g)},e.listeners=function(i){return this._emitter.listeners(i)},e.emit=function(i,c,f){return this._emitter.emit(i,c,f)},e.trigger=function(i,c){if(this.config.debug)return this.emit(i,i,c);try{return this.emit(i,i,c)}catch(f){S.logger.error("An internal error happened while handling event "+i+'. Error message: "'+f.message+'". Here is a stacktrace:',f),this.trigger(y.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:i,error:f})}return!1},e.listenerCount=function(i){return this._emitter.listenerCount(i)},e.destroy=function(){S.logger.log("destroy"),this.trigger(y.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(i){return i.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(i){return i.destroy()}),this.coreComponents.length=0},e.attachMedia=function(i){S.logger.log("attachMedia"),this._media=i,this.trigger(y.Events.MEDIA_ATTACHING,{media:i})},e.detachMedia=function(){S.logger.log("detachMedia"),this.trigger(y.Events.MEDIA_DETACHING,void 0),this._media=null},e.loadSource=function(i){this.stopLoad();var c=this.media,f=this.url,g=this.url=M.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});S.logger.log("loadSource:"+g),c&&f&&f!==g&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(c)),this.trigger(y.Events.MANIFEST_LOADING,{url:i})},e.startLoad=function(i){i===void 0&&(i=-1),S.logger.log("startLoad("+i+")"),this.networkControllers.forEach(function(c){c.startLoad(i)})},e.stopLoad=function(){S.logger.log("stopLoad"),this.networkControllers.forEach(function(i){i.stopLoad()})},e.swapAudioCodec=function(){S.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},e.recoverMediaError=function(){S.logger.log("recoverMediaError");var i=this._media;this.detachMedia(),i&&this.attachMedia(i)},e.removeLevel=function(i,c){c===void 0&&(c=0),this.levelController.removeLevel(i,c)},r(d,[{key:"levels",get:function(){var i=this.levelController.levels;return i||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(i){S.logger.log("set currentLevel:"+i),this.loadLevel=i,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(i){S.logger.log("set nextLevel:"+i),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(i){S.logger.log("set loadLevel:"+i),this.levelController.manualLevel=i}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(i){this.levelController.nextLoadLevel=i}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(i){S.logger.log("set firstLevel:"+i),this.levelController.firstLevel=i}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(i){S.logger.log("set startLevel:"+i),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(i){var c=!!i;c!==this.config.capLevelToPlayerSize&&(c?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=c)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(i){this._autoLevelCapping!==i&&(S.logger.log("set autoLevelCapping:"+i),this._autoLevelCapping=i)}},{key:"bandwidthEstimate",get:function(){var i=this.abrController.bwEstimator;return i?i.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var i=this.levels,c=this.config.minAutoBitrate;if(!i)return 0;for(var f=i.length,g=0;g<f;g++)if(i[g].maxBitrate>=c)return g;return 0}},{key:"maxAutoLevel",get:function(){var i=this.levels,c=this.autoLevelCapping,f;return c===-1&&i&&i.length?f=i.length-1:f=c,f}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(i){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,i)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var i=this.audioTrackController;return i?i.audioTracks:[]}},{key:"audioTrack",get:function(){var i=this.audioTrackController;return i?i.audioTrack:-1},set:function(i){var c=this.audioTrackController;c&&(c.audioTrack=i)}},{key:"subtitleTracks",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var i=this.subtitleTrackController;return i?i.subtitleTrack:-1},set:function(i){var c=this.subtitleTrackController;c&&(c.subtitleTrack=i)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var i=this.subtitleTrackController;return i?i.subtitleDisplay:!1},set:function(i){var c=this.subtitleTrackController;c&&(c.subtitleDisplay=i)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(i){this.config.lowLatencyMode=i}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.8"}},{key:"Events",get:function(){return y.Events}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:D.hlsDefaultConfig},set:function(i){d.defaultConfig=i}}]),d}();h.defaultConfig=void 0},"./src/is-supported.ts":(G,k,u)=>{u.r(k),u.d(k,{changeTypeSupported:()=>P,isSupported:()=>b});var M=u("./src/utils/mediasource-helper.ts");function I(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var F=(0,M.getMediaSource)();if(!F)return!1;var R=I(),C=F&&typeof F.isTypeSupported=="function"&&F.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),A=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!C&&!!A}function P(){var F,R=I();return typeof(R==null||(F=R.prototype)===null||F===void 0?void 0:F.changeType)=="function"}},"./src/loader/date-range.ts":(G,k,u)=>{u.r(k),u.d(k,{DateRange:()=>A,DateRangeAttribute:()=>C});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/attr-list.ts"),b=u("./src/utils/logger.ts");function P(){return P=Object.assign?Object.assign.bind():function(T){for(var S=1;S<arguments.length;S++){var D=arguments[S];for(var L in D)Object.prototype.hasOwnProperty.call(D,L)&&(T[L]=D[L])}return T},P.apply(this,arguments)}function F(T,S){for(var D=0;D<S.length;D++){var L=S[D];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(T,L.key,L)}}function R(T,S,D){return S&&F(T.prototype,S),D&&F(T,D),Object.defineProperty(T,"prototype",{writable:!1}),T}var C;(function(T){T.ID="ID",T.CLASS="CLASS",T.START_DATE="START-DATE",T.DURATION="DURATION",T.END_DATE="END-DATE",T.END_ON_NEXT="END-ON-NEXT",T.PLANNED_DURATION="PLANNED-DURATION",T.SCTE35_OUT="SCTE35-OUT",T.SCTE35_IN="SCTE35-IN"})(C||(C={}));var A=function(){function T(S,D){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,D){var L=D.attr;for(var y in L)if(Object.prototype.hasOwnProperty.call(S,y)&&S[y]!==L[y]){b.logger.warn('DATERANGE tag attribute: "'+y+'" does not match for tags with ID: "'+S.ID+'"'),this._badValueForSameId=y;break}S=P(new I.AttrList({}),L,S)}if(this.attr=S,this._startDate=new Date(S[C.START_DATE]),C.END_DATE in this.attr){var l=new Date(this.attr[C.END_DATE]);(0,M.isFiniteNumber)(l.getTime())&&(this._endDate=l)}}return R(T,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var D=this.duration;return D!==null?new Date(this._startDate.getTime()+D*1e3):null}},{key:"duration",get:function(){if(C.DURATION in this.attr){var D=this.attr.decimalFloatingPoint(C.DURATION);if((0,M.isFiniteNumber)(D))return D}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return C.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(C.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(C.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,M.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),T}()},"./src/loader/fragment-loader.ts":(G,k,u)=>{u.r(k),u.d(k,{LoadError:()=>y,default:()=>D});var M=u("./src/polyfills/number.ts"),I=u("./src/errors.ts");function b(l,n){l.prototype=Object.create(n.prototype),l.prototype.constructor=l,A(l,n)}function P(l){var n=typeof Map=="function"?new Map:void 0;return P=function(h){if(h===null||!C(h))return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(h))return n.get(h);n.set(h,d)}function d(){return F(h,arguments,T(this).constructor)}return d.prototype=Object.create(h.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),A(d,h)},P(l)}function F(l,n,r){return R()?F=Reflect.construct.bind():F=function(d,e,t){var i=[null];i.push.apply(i,e);var c=Function.bind.apply(d,i),f=new c;return t&&A(f,t.prototype),f},F.apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function A(l,n){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,d){return h.__proto__=d,h},A(l,n)}function T(l){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},T(l)}var S=Math.pow(2,17),D=function(){function l(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}var n=l.prototype;return n.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},n.abort=function(){this.loader&&this.loader.abort()},n.load=function(h,d){var e=this,t=h.url;if(!t)return Promise.reject(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var i=this.config,c=i.fLoader,f=i.loader;return new Promise(function(g,a){e.loader&&e.loader.destroy();var p=e.loader=h.loader=c?new c(i):new f(i),v=L(h),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:h.sn==="initSegment"?1/0:S};h.stats=p.stats,p.load(v,o,{onSuccess:function(O,B,K,N){e.resetLoader(h,p),g({frag:h,part:null,payload:O.data,networkDetails:N})},onError:function(O,B,K){e.resetLoader(h,p),a(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,response:O,networkDetails:K}))},onAbort:function(O,B,K){e.resetLoader(h,p),a(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,networkDetails:K}))},onTimeout:function(O,B,K){e.resetLoader(h,p),a(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,networkDetails:K}))},onProgress:function(O,B,K,N){d&&d({frag:h,part:null,payload:K,networkDetails:N})}})})},n.loadPart=function(h,d,e){var t=this;this.abort();var i=this.config,c=i.fLoader,f=i.loader;return new Promise(function(g,a){t.loader&&t.loader.destroy();var p=t.loader=h.loader=c?new c(i):new f(i),v=L(h,d),o={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:S};d.stats=p.stats,p.load(v,o,{onSuccess:function(O,B,K,N){t.resetLoader(h,p),t.updateStatsFromPart(h,d);var W={frag:h,part:d,payload:O.data,networkDetails:N};e(W),g(W)},onError:function(O,B,K){t.resetLoader(h,p),a(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:h,part:d,response:O,networkDetails:K}))},onAbort:function(O,B,K){h.stats.aborted=d.stats.aborted,t.resetLoader(h,p),a(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:h,part:d,networkDetails:K}))},onTimeout:function(O,B,K){t.resetLoader(h,p),a(new y({type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:h,part:d,networkDetails:K}))}})})},n.updateStatsFromPart=function(h,d){var e=h.stats,t=d.stats,i=t.total;if(e.loaded+=t.loaded,i){var c=Math.round(h.duration/d.duration),f=Math.min(Math.round(e.loaded/i),c),g=c-f,a=g*Math.round(e.loaded/f);e.total=e.loaded+a}else e.total=Math.max(e.loaded,e.total);var p=e.loading,v=t.loading;p.start?p.first+=v.first-v.start:(p.start=v.start,p.first=v.first),p.end=v.end},n.resetLoader=function(h,d){h.loader=null,this.loader===d&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),d.destroy()},l}();function L(l,n){n===void 0&&(n=null);var r=n||l,h={frag:l,part:n,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},d=r.byteRangeStartOffset,e=r.byteRangeEndOffset;return(0,M.isFiniteNumber)(d)&&(0,M.isFiniteNumber)(e)&&(h.rangeStart=d,h.rangeEnd=e),h}var y=function(l){b(n,l);function n(r){for(var h,d=arguments.length,e=new Array(d>1?d-1:0),t=1;t<d;t++)e[t-1]=arguments[t];return h=l.call.apply(l,[this].concat(e))||this,h.data=void 0,h.data=r,h}return n}(P(Error))},"./src/loader/fragment.ts":(G,k,u)=>{u.r(k),u.d(k,{BaseSegment:()=>D,ElementaryStreamTypes:()=>S,Fragment:()=>L,Part:()=>y});var M=u("./src/polyfills/number.ts"),I=u("./node_modules/url-toolkit/src/url-toolkit.js"),b=u("./src/utils/logger.ts"),P=u("./src/loader/level-key.ts"),F=u("./src/loader/load-stats.ts");function R(l,n){l.prototype=Object.create(n.prototype),l.prototype.constructor=l,C(l,n)}function C(l,n){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,d){return h.__proto__=d,h},C(l,n)}function A(l,n){for(var r=0;r<n.length;r++){var h=n[r];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(l,h.key,h)}}function T(l,n,r){return n&&A(l.prototype,n),r&&A(l,r),Object.defineProperty(l,"prototype",{writable:!1}),l}var S;(function(l){l.AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo"})(S||(S={}));var D=function(){function l(r){var h;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(h={},h[S.AUDIO]=null,h[S.VIDEO]=null,h[S.AUDIOVIDEO]=null,h),this.baseurl=r}var n=l.prototype;return n.setByteRange=function(h,d){var e=h.split("@",2),t=[];e.length===1?t[0]=d?d.byteRangeEndOffset:0:t[0]=parseInt(e[1]),t[1]=parseInt(e[0])+t[0],this._byteRange=t},T(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,I.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(h){this._url=h}}]),l}(),L=function(l){R(n,l);function n(h,d){var e;return e=l.call(this,d)||this,e._decryptdata=null,e.rawProgramDateTime=null,e.programDateTime=null,e.tagList=[],e.duration=0,e.sn=0,e.levelkey=void 0,e.type=void 0,e.loader=null,e.level=-1,e.cc=0,e.startPTS=void 0,e.endPTS=void 0,e.appendedPTS=void 0,e.startDTS=void 0,e.endDTS=void 0,e.start=0,e.deltaPTS=void 0,e.maxStartPTS=void 0,e.minEndPTS=void 0,e.stats=new F.LoadStats,e.urlId=0,e.data=void 0,e.bitrateTest=!1,e.title=null,e.initSegment=null,e.type=h,e}var r=n.prototype;return r.createInitializationVector=function(d){for(var e=new Uint8Array(16),t=12;t<16;t++)e[t]=d>>8*(15-t)&255;return e},r.setDecryptDataFromLevelKey=function(d,e){var t=d;return(d==null?void 0:d.method)==="AES-128"&&d.uri&&!d.iv&&(t=P.LevelKey.fromURI(d.uri),t.method=d.method,t.iv=this.createInitializationVector(e),t.keyFormat="identity"),t},r.setElementaryStreamInfo=function(d,e,t,i,c,f){f===void 0&&(f=!1);var g=this.elementaryStreams,a=g[d];if(!a){g[d]={startPTS:e,endPTS:t,startDTS:i,endDTS:c,partial:f};return}a.startPTS=Math.min(a.startPTS,e),a.endPTS=Math.max(a.endPTS,t),a.startDTS=Math.min(a.startDTS,i),a.endDTS=Math.max(a.endDTS,c)},r.clearElementaryStreamInfo=function(){var d=this.elementaryStreams;d[S.AUDIO]=null,d[S.VIDEO]=null,d[S.AUDIOVIDEO]=null},T(n,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var d=this.sn;typeof d!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&b.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),d=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,d)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,M.isFiniteNumber)(this.programDateTime))return null;var d=(0,M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+d*1e3}},{key:"encrypted",get:function(){var d;return!!((d=this.decryptdata)!==null&&d!==void 0&&d.keyFormat&&this.decryptdata.uri)}}]),n}(D),y=function(l){R(n,l);function n(r,h,d,e,t){var i;i=l.call(this,d)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new F.LoadStats,i.duration=r.decimalFloatingPoint("DURATION"),i.gap=r.bool("GAP"),i.independent=r.bool("INDEPENDENT"),i.relurl=r.enumeratedString("URI"),i.fragment=h,i.index=e;var c=r.enumeratedString("BYTERANGE");return c&&i.setByteRange(c,t),t&&(i.fragOffset=t.fragOffset+t.duration),i}return T(n,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var h=this.elementaryStreams;return!!(h.audio||h.video||h.audiovideo)}}]),n}(D)},"./src/loader/key-loader.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>P});var M=u("./src/events.ts"),I=u("./src/errors.ts"),b=u("./src/utils/logger.ts"),P=function(){function F(C){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=C,this.registerListeners()}var R=F.prototype;return R.startLoad=function(A){},R.stopLoad=function(){this.destroyInternalLoaders()},R.registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},R.unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},R.destroyInternalLoaders=function(){for(var A in this.loaders){var T=this.loaders[A];T&&T.destroy()}this.loaders={}},R.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},R.onKeyLoading=function(A,T){var S=T.frag,D=S.type,L=this.loaders[D];if(!S.decryptdata){b.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var y=S.decryptdata.uri;if(y!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(L&&(b.logger.warn("abort previous key loader for type:"+D),L.abort()),!y){b.logger.warn("key uri is falsy");return}var n=l.loader,r=S.loader=this.loaders[D]=new n(l);this.decrypturl=y,this.decryptkey=null;var h={url:y,frag:S,responseType:"arraybuffer"},d={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},e={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};r.load(h,d,e)}else this.decryptkey&&(S.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:S}))},R.loadsuccess=function(A,T,S){var D=S.frag;if(!D.decryptdata){b.logger.error("after key load, decryptdata unset");return}this.decryptkey=D.decryptdata.key=new Uint8Array(A.data),D.loader=null,delete this.loaders[D.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:D})},R.loaderror=function(A,T){var S=T.frag,D=S.loader;D&&D.abort(),delete this.loaders[S.type],this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:S,response:A})},R.loadtimeout=function(A,T){var S=T.frag,D=S.loader;D&&D.abort(),delete this.loaders[S.type],this.hls.trigger(M.Events.ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:S})},F}()},"./src/loader/level-details.ts":(G,k,u)=>{u.r(k),u.d(k,{LevelDetails:()=>F});var M=u("./src/polyfills/number.ts");function I(R,C){for(var A=0;A<C.length;A++){var T=C[A];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function b(R,C,A){return C&&I(R.prototype,C),A&&I(R,A),Object.defineProperty(R,"prototype",{writable:!1}),R}var P=10,F=function(){function R(A){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=A}var C=R.prototype;return C.reloaded=function(T){if(!T){this.advanced=!0,this.updated=!0;return}var S=this.lastPartSn-T.lastPartSn,D=this.lastPartIndex-T.lastPartIndex;this.updated=this.endSN!==T.endSN||!!D||!!S,this.advanced=this.endSN>T.endSN||S>0||S===0&&D>0,this.updated||this.advanced?this.misses=Math.floor(T.misses*.6):this.misses=T.misses+1,this.availabilityDelay=T.availabilityDelay},b(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||P}},{key:"drift",get:function(){var T=this.driftEndTime-this.driftStartTime;if(T>0){var S=this.driftEnd-this.driftStart;return S*1e3/T}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var T;return(T=this.fragments)!==null&&T!==void 0&&T.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":(G,k,u)=>{u.r(k),u.d(k,{LevelKey:()=>P});var M=u("./node_modules/url-toolkit/src/url-toolkit.js");function I(F,R){for(var C=0;C<R.length;C++){var A=R[C];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(F,A.key,A)}}function b(F,R,C){return R&&I(F.prototype,R),C&&I(F,C),Object.defineProperty(F,"prototype",{writable:!1}),F}var P=function(){F.fromURL=function(C,A){return new F(C,A)},F.fromURI=function(C){return new F(C)};function F(R,C){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,C?this._uri=(0,M.buildAbsoluteURL)(R,C,{alwaysNormalize:!0}):this._uri=R}return b(F,[{key:"uri",get:function(){return this._uri}}]),F}()},"./src/loader/load-stats.ts":(G,k,u)=>{u.r(k),u.d(k,{LoadStats:()=>M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>r});var M=u("./src/polyfills/number.ts"),I=u("./node_modules/url-toolkit/src/url-toolkit.js"),b=u("./src/loader/date-range.ts"),P=u("./src/loader/fragment.ts"),F=u("./src/loader/level-details.ts"),R=u("./src/loader/level-key.ts"),C=u("./src/utils/attr-list.ts"),A=u("./src/utils/logger.ts"),T=u("./src/utils/codecs.ts"),S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,D=/#EXT-X-MEDIA:(.*)/g,L=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),y=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=/\.(mp4|m4s|m4v|m4a)$/i;function n(c){var f,g;return l.test((f=(g=I.parseURL(c))===null||g===void 0?void 0:g.path)!=null?f:"")}var r=function(){function c(){}return c.findGroup=function(g,a){for(var p=0;p<g.length;p++){var v=g[p];if(v.id===a)return v}},c.convertAVC1ToAVCOTI=function(g){var a=g.split(".");if(a.length>2){var p=a.shift()+".";return p+=parseInt(a.shift()).toString(16),p+=("000"+parseInt(a.shift()).toString(16)).slice(-4),p}return g},c.resolve=function(g,a){return I.buildAbsoluteURL(a,g,{alwaysNormalize:!0})},c.parseMasterPlaylist=function(g,a){var p=[],v=[],o={},_=!1;S.lastIndex=0;for(var O;(O=S.exec(g))!=null;)if(O[1]){var B,K=new C.AttrList(O[1]),N={attrs:K,bitrate:K.decimalInteger("AVERAGE-BANDWIDTH")||K.decimalInteger("BANDWIDTH"),name:K.NAME,url:c.resolve(O[2],a)},W=K.decimalResolution("RESOLUTION");W&&(N.width=W.width,N.height=W.height),h((K.CODECS||"").split(/[ ,]+/).filter(function(j){return j}),N),N.videoCodec&&N.videoCodec.indexOf("avc1")!==-1&&(N.videoCodec=c.convertAVC1ToAVCOTI(N.videoCodec)),(B=N.unknownCodecs)!==null&&B!==void 0&&B.length||v.push(N),p.push(N)}else if(O[3]){var H=new C.AttrList(O[3]);H["DATA-ID"]&&(_=!0,o[H["DATA-ID"]]=H)}var V=v.length>0&&v.length<p.length;return{levels:V?v:p,sessionData:_?o:null}},c.parseMasterPlaylistMedia=function(g,a,p,v){v===void 0&&(v=[]);var o,_=[],O=0;for(D.lastIndex=0;(o=D.exec(g))!==null;){var B=new C.AttrList(o[1]);if(B.TYPE===p){var K={attrs:B,bitrate:0,id:O++,groupId:B["GROUP-ID"],instreamId:B["INSTREAM-ID"],name:B.NAME||B.LANGUAGE||"",type:p,default:B.bool("DEFAULT"),autoselect:B.bool("AUTOSELECT"),forced:B.bool("FORCED"),lang:B.LANGUAGE,url:B.URI?c.resolve(B.URI,a):""};if(v.length){var N=c.findGroup(v,K.groupId)||v[0];d(K,N,"audioCodec"),d(K,N,"textCodec")}_.push(K)}}return _},c.parseLevelPlaylist=function(g,a,p,v,o){var _=new F.LevelDetails(a),O=_.fragments,B=null,K=0,N=0,W=0,H=0,V=null,j=new P.Fragment(v,a),z,$,Y,X=-1,Q=!1;for(L.lastIndex=0,_.m3u8=g;(z=L.exec(g))!==null;){Q&&(Q=!1,j=new P.Fragment(v,a),j.start=W,j.sn=K,j.cc=H,j.level=p,B&&(j.initSegment=B,j.rawProgramDateTime=B.rawProgramDateTime,B.rawProgramDateTime=null));var q=z[1];if(q){j.duration=parseFloat(q);var J=(" "+z[2]).slice(1);j.title=J||null,j.tagList.push(J?["INF",q,J]:["INF",q])}else if(z[3])(0,M.isFiniteNumber)(j.duration)&&(j.start=W,Y&&(j.levelkey=Y),j.sn=K,j.level=p,j.cc=H,j.urlId=o,O.push(j),j.relurl=(" "+z[3]).slice(1),t(j,V),V=j,W+=j.duration,K++,N=0,Q=!0);else if(z[4]){var ie=(" "+z[4]).slice(1);V?j.setByteRange(ie,V):j.setByteRange(ie)}else if(z[5])j.rawProgramDateTime=(" "+z[5]).slice(1),j.tagList.push(["PROGRAM-DATE-TIME",j.rawProgramDateTime]),X===-1&&(X=O.length);else{if(z=z[0].match(y),!z){A.logger.warn("No matches on slow regex match for level playlist!");continue}for($=1;$<z.length&&!(typeof z[$]<"u");$++);var se=(" "+z[$]).slice(1),Z=(" "+z[$+1]).slice(1),re=z[$+2]?(" "+z[$+2]).slice(1):"";switch(se){case"PLAYLIST-TYPE":_.type=Z.toUpperCase();break;case"MEDIA-SEQUENCE":K=_.startSN=parseInt(Z);break;case"SKIP":{var le=new C.AttrList(Z),oe=le.decimalInteger("SKIPPED-SEGMENTS");if((0,M.isFiniteNumber)(oe)){_.skippedSegments=oe;for(var de=oe;de--;)O.unshift(null);K+=oe}var xe=le.enumeratedString("RECENTLY-REMOVED-DATERANGES");xe&&(_.recentlyRemovedDateranges=xe.split("	"));break}case"TARGETDURATION":_.targetduration=parseFloat(Z);break;case"VERSION":_.version=parseInt(Z);break;case"EXTM3U":break;case"ENDLIST":_.live=!1;break;case"#":(Z||re)&&j.tagList.push(re?[Z,re]:[Z]);break;case"DISCONTINUITY":H++,j.tagList.push(["DIS"]);break;case"GAP":j.tagList.push([se]);break;case"BITRATE":j.tagList.push([se,Z]);break;case"DATERANGE":{var ce=new C.AttrList(Z),Pe=new b.DateRange(ce,_.dateRanges[ce.ID]);Pe.isValid||_.skippedSegments?_.dateRanges[Pe.id]=Pe:A.logger.warn('Ignoring invalid DATERANGE tag: "'+Z+'"'),j.tagList.push(["EXT-X-DATERANGE",Z]);break}case"DISCONTINUITY-SEQUENCE":H=parseInt(Z);break;case"KEY":{var Le,_e=new C.AttrList(Z),Ie=_e.enumeratedString("METHOD"),be=_e.URI,Be=_e.hexadecimalInteger("IV"),Me=_e.enumeratedString("KEYFORMATVERSIONS"),Oe=_e.enumeratedString("KEYID"),Ue=(Le=_e.enumeratedString("KEYFORMAT"))!=null?Le:"identity",we=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(we.indexOf(Ue)>-1){A.logger.warn("Keyformat "+Ue+" is not supported from the manifest");continue}else if(Ue!=="identity")continue;Ie&&(Y=R.LevelKey.fromURL(a,be),be&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(Ie)>=0&&(Y.method=Ie,Y.keyFormat=Ue,Oe&&(Y.keyID=Oe),Me&&(Y.keyFormatVersions=Me),Y.iv=Be));break}case"START":{var We=new C.AttrList(Z),pe=We.decimalFloatingPoint("TIME-OFFSET");(0,M.isFiniteNumber)(pe)&&(_.startTimeOffset=pe);break}case"MAP":{var De=new C.AttrList(Z);if(j.duration){var Ne=new P.Fragment(v,a);i(Ne,De,p,Y),B=Ne,j.initSegment=B,B.rawProgramDateTime&&!j.rawProgramDateTime&&(j.rawProgramDateTime=B.rawProgramDateTime)}else i(j,De,p,Y),B=j,Q=!0;break}case"SERVER-CONTROL":{var ve=new C.AttrList(Z);_.canBlockReload=ve.bool("CAN-BLOCK-RELOAD"),_.canSkipUntil=ve.optionalFloat("CAN-SKIP-UNTIL",0),_.canSkipDateRanges=_.canSkipUntil>0&&ve.bool("CAN-SKIP-DATERANGES"),_.partHoldBack=ve.optionalFloat("PART-HOLD-BACK",0),_.holdBack=ve.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ae=new C.AttrList(Z);_.partTarget=Ae.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Fe=_.partList;Fe||(Fe=_.partList=[]);var Xe=N>0?Fe[Fe.length-1]:void 0,Qe=N++,ut=new P.Part(new C.AttrList(Z),j,a,Qe,Xe);Fe.push(ut),j.duration+=ut.duration;break}case"PRELOAD-HINT":{var Ge=new C.AttrList(Z);_.preloadHint=Ge;break}case"RENDITION-REPORT":{var Dt=new C.AttrList(Z);_.renditionReports=_.renditionReports||[],_.renditionReports.push(Dt);break}default:A.logger.warn("line parsed but not handled: "+z);break}}}V&&!V.relurl?(O.pop(),W-=V.duration,_.partList&&(_.fragmentHint=V)):_.partList&&(t(j,V),j.cc=H,_.fragmentHint=j);var Ze=O.length,He=O[0],ft=O[Ze-1];if(W+=_.skippedSegments*_.targetduration,W>0&&Ze&&ft){_.averagetargetduration=W/Ze;var Je=ft.sn;_.endSN=Je!=="initSegment"?Je:0,He&&(_.startCC=He.cc,He.initSegment||_.fragments.every(function(mt){return mt.relurl&&n(mt.relurl)})&&(A.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),j=new P.Fragment(v,a),j.relurl=ft.relurl,j.level=p,j.sn="initSegment",He.initSegment=j,_.needSidxRanges=!0))}else _.endSN=0,_.startCC=0;return _.fragmentHint&&(W+=_.fragmentHint.duration),_.totalduration=W,_.endCC=H,X>0&&e(O,X),_},c}();function h(c,f){["video","audio","text"].forEach(function(g){var a=c.filter(function(v){return(0,T.isCodecType)(v,g)});if(a.length){var p=a.filter(function(v){return v.lastIndexOf("avc1",0)===0||v.lastIndexOf("mp4a",0)===0});f[g+"Codec"]=p.length>0?p[0]:a[0],c=c.filter(function(v){return a.indexOf(v)===-1})}}),f.unknownCodecs=c}function d(c,f,g){var a=f[g];a&&(c[g]=a)}function e(c,f){for(var g=c[f],a=f;a--;){var p=c[a];if(!p)return;p.programDateTime=g.programDateTime-p.duration*1e3,g=p}}function t(c,f){c.rawProgramDateTime?c.programDateTime=Date.parse(c.rawProgramDateTime):f!=null&&f.programDateTime&&(c.programDateTime=f.endProgramDateTime),(0,M.isFiniteNumber)(c.programDateTime)||(c.programDateTime=null,c.rawProgramDateTime=null)}function i(c,f,g,a){c.relurl=f.URI,f.BYTERANGE&&c.setByteRange(f.BYTERANGE),c.level=g,c.sn="initSegment",a&&(c.levelkey=a),c.initSegment=null}},"./src/loader/playlist-loader.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>L});var M=u("./src/polyfills/number.ts"),I=u("./src/events.ts"),b=u("./src/errors.ts"),P=u("./src/utils/logger.ts"),F=u("./src/utils/mp4-tools.ts"),R=u("./src/loader/m3u8-parser.ts"),C=u("./src/types/loader.ts"),A=u("./src/utils/attr-list.ts");function T(y){var l=y.type;switch(l){case C.PlaylistContextType.AUDIO_TRACK:return C.PlaylistLevelType.AUDIO;case C.PlaylistContextType.SUBTITLE_TRACK:return C.PlaylistLevelType.SUBTITLE;default:return C.PlaylistLevelType.MAIN}}function S(y,l){var n=y.url;return(n===void 0||n.indexOf("data:")===0)&&(n=l.url),n}var D=function(){function y(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var l=y.prototype;return l.startLoad=function(r){},l.stopLoad=function(){this.destroyInternalLoaders()},l.registerListeners=function(){var r=this.hls;r.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(I.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(I.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var r=this.hls;r.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(I.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(I.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(I.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(r){var h=this.hls.config,d=h.pLoader,e=h.loader,t=d||e,i=new t(h);return r.loader=i,this.loaders[r.type]=i,i},l.getInternalLoader=function(r){return this.loaders[r.type]},l.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},l.destroyInternalLoaders=function(){for(var r in this.loaders){var h=this.loaders[r];h&&h.destroy(),this.resetInternalLoader(r)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(r,h){var d=h.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:C.PlaylistContextType.MANIFEST,url:d,deliveryDirectives:null})},l.onLevelLoading=function(r,h){var d=h.id,e=h.level,t=h.url,i=h.deliveryDirectives;this.load({id:d,groupId:null,level:e,responseType:"text",type:C.PlaylistContextType.LEVEL,url:t,deliveryDirectives:i})},l.onAudioTrackLoading=function(r,h){var d=h.id,e=h.groupId,t=h.url,i=h.deliveryDirectives;this.load({id:d,groupId:e,level:null,responseType:"text",type:C.PlaylistContextType.AUDIO_TRACK,url:t,deliveryDirectives:i})},l.onSubtitleTrackLoading=function(r,h){var d=h.id,e=h.groupId,t=h.url,i=h.deliveryDirectives;this.load({id:d,groupId:e,level:null,responseType:"text",type:C.PlaylistContextType.SUBTITLE_TRACK,url:t,deliveryDirectives:i})},l.load=function(r){var h,d=this.hls.config,e=this.getInternalLoader(r);if(e){var t=e.context;if(t&&t.url===r.url){P.logger.trace("[playlist-loader]: playlist request ongoing");return}P.logger.log("[playlist-loader]: aborting previous loader for type: "+r.type),e.abort()}var i,c,f,g;switch(r.type){case C.PlaylistContextType.MANIFEST:i=d.manifestLoadingMaxRetry,c=d.manifestLoadingTimeOut,f=d.manifestLoadingRetryDelay,g=d.manifestLoadingMaxRetryTimeout;break;case C.PlaylistContextType.LEVEL:case C.PlaylistContextType.AUDIO_TRACK:case C.PlaylistContextType.SUBTITLE_TRACK:i=0,c=d.levelLoadingTimeOut;break;default:i=d.levelLoadingMaxRetry,c=d.levelLoadingTimeOut,f=d.levelLoadingRetryDelay,g=d.levelLoadingMaxRetryTimeout;break}if(e=this.createInternalLoader(r),(h=r.deliveryDirectives)!==null&&h!==void 0&&h.part){var a;if(r.type===C.PlaylistContextType.LEVEL&&r.level!==null?a=this.hls.levels[r.level].details:r.type===C.PlaylistContextType.AUDIO_TRACK&&r.id!==null?a=this.hls.audioTracks[r.id].details:r.type===C.PlaylistContextType.SUBTITLE_TRACK&&r.id!==null&&(a=this.hls.subtitleTracks[r.id].details),a){var p=a.partTarget,v=a.targetduration;p&&v&&(c=Math.min(Math.max(p*3,v*.8)*1e3,c))}}var o={timeout:c,maxRetry:i,retryDelay:f,maxRetryDelay:g,highWaterMark:0},_={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.load(r,o,_)},l.loadsuccess=function(r,h,d,e){if(e===void 0&&(e=null),d.isSidxRequest){this.handleSidxRequest(r,d),this.handlePlaylistLoaded(r,h,d,e);return}this.resetInternalLoader(d.type);var t=r.data;if(t.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(r,d,"no EXTM3U delimiter",e);return}h.parsing.start=performance.now(),t.indexOf("#EXTINF:")>0||t.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(r,h,d,e):this.handleMasterPlaylist(r,h,d,e)},l.loaderror=function(r,h,d){d===void 0&&(d=null),this.handleNetworkError(h,d,!1,r)},l.loadtimeout=function(r,h,d){d===void 0&&(d=null),this.handleNetworkError(h,d,!0)},l.handleMasterPlaylist=function(r,h,d,e){var t=this.hls,i=r.data,c=S(r,d),f=R.default.parseMasterPlaylist(i,c),g=f.levels,a=f.sessionData;if(!g.length){this.handleManifestParsingError(r,d,"no level found in manifest",e);return}var p=g.map(function(K){return{id:K.attrs.AUDIO,audioCodec:K.audioCodec}}),v=g.map(function(K){return{id:K.attrs.SUBTITLES,textCodec:K.textCodec}}),o=R.default.parseMasterPlaylistMedia(i,c,"AUDIO",p),_=R.default.parseMasterPlaylistMedia(i,c,"SUBTITLES",v),O=R.default.parseMasterPlaylistMedia(i,c,"CLOSED-CAPTIONS");if(o.length){var B=o.some(function(K){return!K.url});!B&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(P.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),o.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))}t.trigger(I.Events.MANIFEST_LOADED,{levels:g,audioTracks:o,subtitles:_,captions:O,url:c,stats:h,networkDetails:e,sessionData:a})},l.handleTrackOrLevelPlaylist=function(r,h,d,e){var t=this.hls,i=d.id,c=d.level,f=d.type,g=S(r,d),a=(0,M.isFiniteNumber)(i)?i:0,p=(0,M.isFiniteNumber)(c)?c:a,v=T(d),o=R.default.parseLevelPlaylist(r.data,g,p,v,a);if(!o.fragments.length){t.trigger(I.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:g,reason:"no fragments found in level",level:typeof d.level=="number"?d.level:void 0});return}if(f===C.PlaylistContextType.MANIFEST){var _={attrs:new A.AttrList({}),bitrate:0,details:o,name:"",url:g};t.trigger(I.Events.MANIFEST_LOADED,{levels:[_],audioTracks:[],url:g,stats:h,networkDetails:e,sessionData:null})}if(h.parsing.end=performance.now(),o.needSidxRanges){var O,B=(O=o.fragments[0].initSegment)===null||O===void 0?void 0:O.url;this.load({url:B,isSidxRequest:!0,type:f,level:c,levelDetails:o,id:i,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}d.levelDetails=o,this.handlePlaylistLoaded(r,h,d,e)},l.handleSidxRequest=function(r,h){var d=new Uint8Array(r.data),e=(0,F.findBox)(d,["sidx"])[0];if(!!e){var t=(0,F.parseSegmentIndex)(e);if(!!t){var i=t.references,c=h.levelDetails;i.forEach(function(f,g){var a=f.info,p=c.fragments[g];if(p.byteRange.length===0&&p.setByteRange(String(1+a.end-a.start)+"@"+String(a.start)),p.initSegment){var v=(0,F.findBox)(d,["moov"])[0],o=v?v.length:null;p.initSegment.setByteRange(String(o)+"@0")}})}}},l.handleManifestParsingError=function(r,h,d,e){this.hls.trigger(I.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:h.type===C.PlaylistContextType.MANIFEST,url:r.url,reason:d,response:r,context:h,networkDetails:e})},l.handleNetworkError=function(r,h,d,e){d===void 0&&(d=!1),P.logger.warn("[playlist-loader]: A network "+(d?"timeout":"error")+" occurred while loading "+r.type+" level: "+r.level+" id: "+r.id+' group-id: "'+r.groupId+'"');var t=b.ErrorDetails.UNKNOWN,i=!1,c=this.getInternalLoader(r);switch(r.type){case C.PlaylistContextType.MANIFEST:t=d?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case C.PlaylistContextType.LEVEL:t=d?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case C.PlaylistContextType.AUDIO_TRACK:t=d?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case C.PlaylistContextType.SUBTITLE_TRACK:t=d?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1;break}c&&this.resetInternalLoader(r.type);var f={type:b.ErrorTypes.NETWORK_ERROR,details:t,fatal:i,url:r.url,loader:c,context:r,networkDetails:h};e&&(f.response=e),this.hls.trigger(I.Events.ERROR,f)},l.handlePlaylistLoaded=function(r,h,d,e){var t=d.type,i=d.level,c=d.id,f=d.groupId,g=d.loader,a=d.levelDetails,p=d.deliveryDirectives;if(!(a!=null&&a.targetduration)){this.handleManifestParsingError(r,d,"invalid target duration",e);return}if(!!g)switch(a.live&&(g.getCacheAge&&(a.ageHeader=g.getCacheAge()||0),(!g.getCacheAge||isNaN(a.ageHeader))&&(a.ageHeader=0)),t){case C.PlaylistContextType.MANIFEST:case C.PlaylistContextType.LEVEL:this.hls.trigger(I.Events.LEVEL_LOADED,{details:a,level:i||0,id:c||0,stats:h,networkDetails:e,deliveryDirectives:p});break;case C.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(I.Events.AUDIO_TRACK_LOADED,{details:a,id:c||0,groupId:f||"",stats:h,networkDetails:e,deliveryDirectives:p});break;case C.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(I.Events.SUBTITLE_TRACK_LOADED,{details:a,id:c||0,groupId:f||"",stats:h,networkDetails:e,deliveryDirectives:p});break}},y}();const L=D},"./src/polyfills/number.ts":(G,k,u)=>{u.r(k),u.d(k,{MAX_SAFE_INTEGER:()=>I,isFiniteNumber:()=>M});var M=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},I=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>I});var M=function(){function b(){}return b.getSilentFrame=function(F,R){switch(F){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},b}();const I=M},"./src/remux/mp4-generator.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>b});var M=Math.pow(2,32)-1,I=function(){function P(){}return P.init=function(){P.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var R;for(R in P.types)P.types.hasOwnProperty(R)&&(P.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);P.HDLR_TYPES={video:C,audio:A};var T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);P.STTS=P.STSC=P.STCO=S,P.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),P.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),P.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),P.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var D=new Uint8Array([105,115,111,109]),L=new Uint8Array([97,118,99,49]),y=new Uint8Array([0,0,0,1]);P.FTYP=P.box(P.types.ftyp,D,y,D,L),P.DINF=P.box(P.types.dinf,P.box(P.types.dref,T))},P.box=function(R){for(var C=8,A=arguments.length,T=new Array(A>1?A-1:0),S=1;S<A;S++)T[S-1]=arguments[S];for(var D=T.length,L=D;D--;)C+=T[D].byteLength;var y=new Uint8Array(C);for(y[0]=C>>24&255,y[1]=C>>16&255,y[2]=C>>8&255,y[3]=C&255,y.set(R,4),D=0,C=8;D<L;D++)y.set(T[D],C),C+=T[D].byteLength;return y},P.hdlr=function(R){return P.box(P.types.hdlr,P.HDLR_TYPES[R])},P.mdat=function(R){return P.box(P.types.mdat,R)},P.mdhd=function(R,C){C*=R;var A=Math.floor(C/(M+1)),T=Math.floor(C%(M+1));return P.box(P.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,T>>24,T>>16&255,T>>8&255,T&255,85,196,0,0]))},P.mdia=function(R){return P.box(P.types.mdia,P.mdhd(R.timescale,R.duration),P.hdlr(R.type),P.minf(R))},P.mfhd=function(R){return P.box(P.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255]))},P.minf=function(R){return R.type==="audio"?P.box(P.types.minf,P.box(P.types.smhd,P.SMHD),P.DINF,P.stbl(R)):P.box(P.types.minf,P.box(P.types.vmhd,P.VMHD),P.DINF,P.stbl(R))},P.moof=function(R,C,A){return P.box(P.types.moof,P.mfhd(R),P.traf(A,C))},P.moov=function(R){for(var C=R.length,A=[];C--;)A[C]=P.trak(R[C]);return P.box.apply(null,[P.types.moov,P.mvhd(R[0].timescale,R[0].duration)].concat(A).concat(P.mvex(R)))},P.mvex=function(R){for(var C=R.length,A=[];C--;)A[C]=P.trex(R[C]);return P.box.apply(null,[P.types.mvex].concat(A))},P.mvhd=function(R,C){C*=R;var A=Math.floor(C/(M+1)),T=Math.floor(C%(M+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,T>>24,T>>16&255,T>>8&255,T&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return P.box(P.types.mvhd,S)},P.sdtp=function(R){var C=R.samples||[],A=new Uint8Array(4+C.length),T,S;for(T=0;T<C.length;T++)S=C[T].flags,A[T+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return P.box(P.types.sdtp,A)},P.stbl=function(R){return P.box(P.types.stbl,P.stsd(R),P.box(P.types.stts,P.STTS),P.box(P.types.stsc,P.STSC),P.box(P.types.stsz,P.STSZ),P.box(P.types.stco,P.STCO))},P.avc1=function(R){var C=[],A=[],T,S,D;for(T=0;T<R.sps.length;T++)S=R.sps[T],D=S.byteLength,C.push(D>>>8&255),C.push(D&255),C=C.concat(Array.prototype.slice.call(S));for(T=0;T<R.pps.length;T++)S=R.pps[T],D=S.byteLength,A.push(D>>>8&255),A.push(D&255),A=A.concat(Array.prototype.slice.call(S));var L=P.box(P.types.avcC,new Uint8Array([1,C[3],C[4],C[5],255,224|R.sps.length].concat(C).concat([R.pps.length]).concat(A))),y=R.width,l=R.height,n=R.pixelRatio[0],r=R.pixelRatio[1];return P.box(P.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>8&255,y&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),L,P.box(P.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),P.box(P.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255])))},P.esds=function(R){var C=R.config.length;return new Uint8Array([0,0,0,0,3,23+C,0,1,0,4,15+C,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([C]).concat(R.config).concat([6,1,2]))},P.mp4a=function(R){var C=R.samplerate;return P.box(P.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,C&255,0,0]),P.box(P.types.esds,P.esds(R)))},P.mp3=function(R){var C=R.samplerate;return P.box(P.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,C>>8&255,C&255,0,0]))},P.stsd=function(R){return R.type==="audio"?R.segmentCodec==="mp3"&&R.codec==="mp3"?P.box(P.types.stsd,P.STSD,P.mp3(R)):P.box(P.types.stsd,P.STSD,P.mp4a(R)):P.box(P.types.stsd,P.STSD,P.avc1(R))},P.tkhd=function(R){var C=R.id,A=R.duration*R.timescale,T=R.width,S=R.height,D=Math.floor(A/(M+1)),L=Math.floor(A%(M+1));return P.box(P.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,C>>24&255,C>>16&255,C>>8&255,C&255,0,0,0,0,D>>24,D>>16&255,D>>8&255,D&255,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,T>>8&255,T&255,0,0,S>>8&255,S&255,0,0]))},P.traf=function(R,C){var A=P.sdtp(R),T=R.id,S=Math.floor(C/(M+1)),D=Math.floor(C%(M+1));return P.box(P.types.traf,P.box(P.types.tfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,T&255])),P.box(P.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,D>>24,D>>16&255,D>>8&255,D&255])),P.trun(R,A.length+16+20+8+16+8+8),A)},P.trak=function(R){return R.duration=R.duration||4294967295,P.box(P.types.trak,P.tkhd(R),P.mdia(R))},P.trex=function(R){var C=R.id;return P.box(P.types.trex,new Uint8Array([0,0,0,0,C>>24,C>>16&255,C>>8&255,C&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},P.trun=function(R,C){var A=R.samples||[],T=A.length,S=12+16*T,D=new Uint8Array(S),L,y,l,n,r,h;for(C+=8+S,D.set([R.type==="video"?1:0,0,15,1,T>>>24&255,T>>>16&255,T>>>8&255,T&255,C>>>24&255,C>>>16&255,C>>>8&255,C&255],0),L=0;L<T;L++)y=A[L],l=y.duration,n=y.size,r=y.flags,h=y.cts,D.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r.isLeading<<2|r.dependsOn,r.isDependedOn<<6|r.hasRedundancy<<4|r.paddingValue<<1|r.isNonSync,r.degradPrio&240<<8,r.degradPrio&15,h>>>24&255,h>>>16&255,h>>>8&255,h&255],12+16*L);return P.box(P.types.trun,D)},P.initSegment=function(R){P.types||P.init();var C=P.moov(R),A=new Uint8Array(P.FTYP.byteLength+C.byteLength);return A.set(P.FTYP),A.set(C,P.FTYP.byteLength),A},P}();I.types=void 0,I.HDLR_TYPES=void 0,I.STTS=void 0,I.STSC=void 0,I.STCO=void 0,I.STSZ=void 0,I.VMHD=void 0,I.SMHD=void 0,I.STSD=void 0,I.FTYP=void 0,I.DINF=void 0;const b=I},"./src/remux/mp4-remuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>n,flushTextTrackMetadataCueSamples:()=>d,flushTextTrackUserdataCueSamples:()=>e,normalizePts:()=>r});var M=u("./src/polyfills/number.ts"),I=u("./src/remux/aac-helper.ts"),b=u("./src/remux/mp4-generator.ts"),P=u("./src/events.ts"),F=u("./src/errors.ts"),R=u("./src/utils/logger.ts"),C=u("./src/types/loader.ts"),A=u("./src/utils/timescale-conversion.ts");function T(){return T=Object.assign?Object.assign.bind():function(c){for(var f=1;f<arguments.length;f++){var g=arguments[f];for(var a in g)Object.prototype.hasOwnProperty.call(g,a)&&(c[a]=g[a])}return c},T.apply(this,arguments)}var S=10*1e3,D=1024,L=1152,y=null,l=null,n=function(){function c(g,a,p,v){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=g,this.config=a,this.typeSupported=p,this.ISGenerated=!1,y===null){var o=navigator.userAgent||"",_=o.match(/Chrome\/(\d+)/i);y=_?parseInt(_[1]):0}if(l===null){var O=navigator.userAgent.match(/Safari\/(\d+)/i);l=O?parseInt(O[1]):0}}var f=c.prototype;return f.destroy=function(){},f.resetTimeStamp=function(a){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},f.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(a){var p=!1,v=a.reduce(function(o,_){var O=_.pts-o;return O<-4294967296?(p=!0,r(o,_.pts)):O>0?o:_.pts},a[0].pts);return p&&R.logger.debug("PTS rollover detected"),v},f.remux=function(a,p,v,o,_,O,B,K){var N,W,H,V,j,z,$=_,Y=_,X=a.pid>-1,Q=p.pid>-1,q=p.samples.length,J=a.samples.length>0,ie=B&&q>0||q>1,se=(!X||J)&&(!Q||ie)||this.ISGenerated||B;if(se){this.ISGenerated||(H=this.generateIS(a,p,_));var Z=this.isVideoContiguous,re=-1,le;if(ie&&(re=h(p.samples),!Z&&this.config.forceKeyFrameOnDiscontinuity))if(z=!0,re>0){R.logger.warn("[mp4-remuxer]: Dropped "+re+" out of "+q+" video samples due to a missing keyframe");var oe=this.getVideoStartPts(p.samples);p.samples=p.samples.slice(re),p.dropped+=re,Y+=(p.samples[0].pts-oe)/p.inputTimeScale,le=Y}else re===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+q+" video samples"),z=!1);if(this.ISGenerated){if(J&&ie){var de=this.getVideoStartPts(p.samples),xe=r(a.samples[0].pts,de)-de,ce=xe/p.inputTimeScale;$+=Math.max(0,ce),Y+=Math.max(0,-ce)}if(J){if(a.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),H=this.generateIS(a,p,_)),W=this.remuxAudio(a,$,this.isAudioContiguous,O,Q||ie||K===C.PlaylistLevelType.AUDIO?Y:void 0),ie){var Pe=W?W.endPTS-W.startPTS:0;p.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),H=this.generateIS(a,p,_)),N=this.remuxVideo(p,Y,Z,Pe)}}else ie&&(N=this.remuxVideo(p,Y,Z,0));N&&(N.firstKeyFrame=re,N.independent=re!==-1,N.firstKeyFramePTS=le)}}return this.ISGenerated&&(v.samples.length&&(j=d(v,_,this._initPTS,this._initDTS)),o.samples.length&&(V=e(o,_,this._initPTS))),{audio:W,video:N,initSegment:H,independent:z,text:V,id3:j}},f.generateIS=function(a,p,v){var o=a.samples,_=p.samples,O=this.typeSupported,B={},K=!(0,M.isFiniteNumber)(this._initPTS),N="audio/mp4",W,H,V;if(K&&(W=H=1/0),a.config&&o.length){switch(a.timescale=a.samplerate,a.segmentCodec){case"mp3":O.mpeg?(N="audio/mpeg",a.codec=""):O.mp3&&(a.codec="mp3");break}B.audio={id:"audio",container:N,codec:a.codec,initSegment:a.segmentCodec==="mp3"&&O.mpeg?new Uint8Array(0):b.default.initSegment([a]),metadata:{channelCount:a.channelCount}},K&&(V=a.inputTimeScale,W=H=o[0].pts-Math.round(V*v))}if(p.sps&&p.pps&&_.length&&(p.timescale=p.inputTimeScale,B.video={id:"main",container:"video/mp4",codec:p.codec,initSegment:b.default.initSegment([p]),metadata:{width:p.width,height:p.height}},K)){V=p.inputTimeScale;var j=this.getVideoStartPts(_),z=Math.round(V*v);H=Math.min(H,r(_[0].dts,j)-z),W=Math.min(W,j-z)}if(Object.keys(B).length)return this.ISGenerated=!0,K&&(this._initPTS=W,this._initDTS=H),{tracks:B,initPTS:W,timescale:V}},f.remuxVideo=function(a,p,v,o){var _=a.inputTimeScale,O=a.samples,B=[],K=O.length,N=this._initPTS,W=this.nextAvcDts,H=8,V=this.videoSampleDuration,j,z,$=Number.POSITIVE_INFINITY,Y=Number.NEGATIVE_INFINITY,X=!1;if(!v||W===null){var Q=p*_,q=O[0].pts-r(O[0].dts,O[0].pts);W=Q-q}for(var J=0;J<K;J++){var ie=O[J];ie.pts=r(ie.pts-N,W),ie.dts=r(ie.dts-N,W),ie.dts<O[J>0?J-1:J].dts&&(X=!0)}X&&O.sort(function(Ct,zt){var Rr=Ct.dts-zt.dts,br=Ct.pts-zt.pts;return Rr||br}),j=O[0].dts,z=O[O.length-1].dts;var se=z-j,Z=se?Math.round(se/(K-1)):V||a.inputTimeScale/30;if(v){var re=j-W,le=re>Z,oe=re<-1;if((le||oe)&&(le?R.logger.warn("AVC: "+(0,A.toMsFromMpegTsClock)(re,!0)+" ms ("+re+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+(0,A.toMsFromMpegTsClock)(-re,!0)+" ms ("+re+"dts) overlapping between fragments detected"),!oe||W>O[0].pts)){j=W;var de=O[0].pts-re;O[0].dts=j,O[0].pts=de,R.logger.log("Video: First PTS/DTS adjusted: "+(0,A.toMsFromMpegTsClock)(de,!0)+"/"+(0,A.toMsFromMpegTsClock)(j,!0)+", delta: "+(0,A.toMsFromMpegTsClock)(re,!0)+" ms")}}j=Math.max(0,j);for(var xe=0,ce=0,Pe=0;Pe<K;Pe++){for(var Le=O[Pe],_e=Le.units,Ie=_e.length,be=0,Be=0;Be<Ie;Be++)be+=_e[Be].data.length;ce+=be,xe+=Ie,Le.length=be,Le.dts=Math.max(Le.dts,j),$=Math.min(Le.pts,$),Y=Math.max(Le.pts,Y)}z=O[K-1].dts;var Me=ce+4*xe+8,Oe;try{Oe=new Uint8Array(Me)}catch{this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:F.ErrorTypes.MUX_ERROR,details:F.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Me,reason:"fail allocating video mdat "+Me});return}var Ue=new DataView(Oe.buffer);Ue.setUint32(0,Me),Oe.set(b.default.types.mdat,4);for(var we=!1,We=Number.POSITIVE_INFINITY,pe=Number.POSITIVE_INFINITY,De=Number.NEGATIVE_INFINITY,Ne=Number.NEGATIVE_INFINITY,ve=0;ve<K;ve++){for(var Ae=O[ve],Fe=Ae.units,Xe=0,Qe=0,ut=Fe.length;Qe<ut;Qe++){var Ge=Fe[Qe],Dt=Ge.data,Ze=Ge.data.byteLength;Ue.setUint32(H,Ze),H+=4,Oe.set(Dt,H),H+=Ze,Xe+=4+Ze}var He=void 0;if(ve<K-1)V=O[ve+1].dts-Ae.dts,He=O[ve+1].pts-Ae.pts;else{var ft=this.config,Je=ve>0?Ae.dts-O[ve-1].dts:Z;if(He=ve>0?Ae.pts-O[ve-1].pts:Z,ft.stretchShortVideoTrack&&this.nextAudioPts!==null){var mt=Math.floor(ft.maxBufferHole*_),At=(o?$+o*_:this.nextAudioPts)-Ae.pts;At>mt?(V=At-Je,V<0?V=Je:we=!0,R.logger.log("[mp4-remuxer]: It is approximately "+At/90+" ms to the next segment; using duration "+V/90+" ms for the last video frame.")):V=Je}else V=Je}var Dr=Math.round(Ae.pts-Ae.dts);We=Math.min(We,V),De=Math.max(De,V),pe=Math.min(pe,He),Ne=Math.max(Ne,He),B.push(new t(Ae.key,V,Xe,Dr))}if(B.length){if(y){if(y<70){var Ht=B[0].flags;Ht.dependsOn=2,Ht.isNonSync=0}}else if(l&&Ne-pe<De-We&&Z/De<.025&&B[0].cts===0){R.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var It=j,Ke=0,Vt=B.length;Ke<Vt;Ke++){var jt=It+B[Ke].duration,Ar=It+B[Ke].cts;if(Ke<Vt-1){var Ir=jt+B[Ke+1].cts;B[Ke].duration=Ir-Ar}else B[Ke].duration=Ke?B[Ke-1].duration:Z;B[Ke].cts=0,It=jt}}}console.assert(V!==null,"mp4SampleDuration must be computed"),V=we||!V?Z:V,this.nextAvcDts=W=z+V,this.videoSampleDuration=V,this.isVideoContiguous=!0;var Cr=b.default.moof(a.sequenceNumber++,j,T({},a,{samples:B})),Pr="video",Or={data1:Cr,data2:Oe,startPTS:$/_,endPTS:(Y+V)/_,startDTS:j/_,endDTS:W/_,type:Pr,hasAudio:!1,hasVideo:!0,nb:B.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(Oe.length,"MDAT length must not be zero"),Or},f.remuxAudio=function(a,p,v,o,_){var O=a.inputTimeScale,B=a.samplerate?a.samplerate:O,K=O/B,N=a.segmentCodec==="aac"?D:L,W=N*K,H=this._initPTS,V=a.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],z=_!==void 0,$=a.samples,Y=V?0:8,X=this.nextAudioPts||-1,Q=p*O;if(this.isAudioContiguous=v=v||$.length&&X>0&&(o&&Math.abs(Q-X)<9e3||Math.abs(r($[0].pts-H,Q)-X)<20*W),$.forEach(function(Ge){Ge.pts=r(Ge.pts-H,Q)}),!v||X<0){if($=$.filter(function(Ge){return Ge.pts>=0}),!$.length)return;_===0?X=0:o&&!z?X=Math.max(0,Q):X=$[0].pts}if(a.segmentCodec==="aac")for(var q=this.config.maxAudioFramesDrift,J=0,ie=X;J<$.length;J++){var se=$[J],Z=se.pts,re=Z-ie,le=Math.abs(1e3*re/O);if(re<=-q*W&&z)J===0&&(R.logger.warn("Audio frame @ "+(Z/O).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*re/O)+" ms."),this.nextAudioPts=X=ie=Z);else if(re>=q*W&&le<S&&z){var oe=Math.round(re/W);ie=Z-oe*W,ie<0&&(oe--,ie+=W),J===0&&(this.nextAudioPts=X=ie),R.logger.warn("[mp4-remuxer]: Injecting "+oe+" audio frame @ "+(ie/O).toFixed(3)+"s due to "+Math.round(1e3*re/O)+" ms gap.");for(var de=0;de<oe;de++){var xe=Math.max(ie,0),ce=I.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);ce||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=se.unit.subarray()),$.splice(J,0,{unit:ce,pts:xe}),ie+=W,J++}}se.pts=ie,ie+=W}for(var Pe=null,Le=null,_e,Ie=0,be=$.length;be--;)Ie+=$[be].unit.byteLength;for(var Be=0,Me=$.length;Be<Me;Be++){var Oe=$[Be],Ue=Oe.unit,we=Oe.pts;if(Le!==null){var We=j[Be-1];We.duration=Math.round((we-Le)/K)}else if(v&&a.segmentCodec==="aac"&&(we=X),Pe=we,Ie>0){Ie+=Y;try{_e=new Uint8Array(Ie)}catch{this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:F.ErrorTypes.MUX_ERROR,details:F.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ie,reason:"fail allocating audio mdat "+Ie});return}if(!V){var pe=new DataView(_e.buffer);pe.setUint32(0,Ie),_e.set(b.default.types.mdat,4)}}else return;_e.set(Ue,Y);var De=Ue.byteLength;Y+=De,j.push(new t(!0,N,De,0)),Le=we}var Ne=j.length;if(!!Ne){var ve=j[j.length-1];this.nextAudioPts=X=Le+K*ve.duration;var Ae=V?new Uint8Array(0):b.default.moof(a.sequenceNumber++,Pe/K,T({},a,{samples:j}));a.samples=[];var Fe=Pe/O,Xe=X/O,Qe="audio",ut={data1:Ae,data2:_e,startPTS:Fe,endPTS:Xe,startDTS:Fe,endDTS:Xe,type:Qe,hasAudio:!0,hasVideo:!1,nb:Ne};return this.isAudioContiguous=!0,console.assert(_e.length,"MDAT length must not be zero"),ut}},f.remuxEmptyAudio=function(a,p,v,o){var _=a.inputTimeScale,O=a.samplerate?a.samplerate:_,B=_/O,K=this.nextAudioPts,N=(K!==null?K:o.startDTS*_)+this._initDTS,W=o.endDTS*_+this._initDTS,H=B*D,V=Math.ceil((W-N)/H),j=I.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!j){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var z=[],$=0;$<V;$++){var Y=N+$*H;z.push({unit:j,pts:Y,dts:Y})}return a.samples=z,this.remuxAudio(a,p,v,!1)},c}();function r(c,f){var g;if(f===null)return c;for(f<c?g=-8589934592:g=8589934592;Math.abs(c-f)>4294967296;)c+=g;return c}function h(c){for(var f=0;f<c.length;f++)if(c[f].key)return f;return-1}function d(c,f,g,a){var p=c.samples.length;if(!!p){for(var v=c.inputTimeScale,o=0;o<p;o++){var _=c.samples[o];_.pts=r(_.pts-g,f*v)/v,_.dts=r(_.dts-a,f*v)/v}var O=c.samples;return c.samples=[],{samples:O}}}function e(c,f,g){var a=c.samples.length;if(!!a){for(var p=c.inputTimeScale,v=0;v<a;v++){var o=c.samples[v];o.pts=r(o.pts-g,f*p)/p}c.samples.sort(function(O,B){return O.pts-B.pts});var _=c.samples;return c.samples=[],{samples:_}}}var t=function(f,g,a,p){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=g,this.size=a,this.cts=p,this.flags=new i(f)},i=function(f){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=f?2:1,this.isNonSync=f?0:1}},"./src/remux/passthrough-remuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>A});var M=u("./src/polyfills/number.ts"),I=u("./src/remux/mp4-remuxer.ts"),b=u("./src/utils/mp4-tools.ts"),P=u("./src/loader/fragment.ts"),F=u("./src/utils/logger.ts"),R=function(){function T(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var S=T.prototype;return S.destroy=function(){},S.resetTimeStamp=function(L){this.initPTS=L,this.lastEndTime=null},S.resetNextTimestamp=function(){this.lastEndTime=null},S.resetInitSegment=function(L,y,l){this.audioCodec=y,this.videoCodec=l,this.generateInitSegment(L),this.emitInitSegment=!0},S.generateInitSegment=function(L){var y=this.audioCodec,l=this.videoCodec;if(!L||!L.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=(0,b.parseInitSegment)(L);y||(y=C(n.audio,P.ElementaryStreamTypes.AUDIO)),l||(l=C(n.video,P.ElementaryStreamTypes.VIDEO));var r={};n.audio&&n.video?r.audiovideo={container:"video/mp4",codec:y+","+l,initSegment:L,id:"main"}:n.audio?r.audio={container:"audio/mp4",codec:y,initSegment:L,id:"audio"}:n.video?r.video={container:"video/mp4",codec:l,initSegment:L,id:"main"}:F.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},S.remux=function(L,y,l,n,r){var h,d=this.initPTS,e=this.lastEndTime,t={audio:void 0,video:void 0,text:n,id3:l,initSegment:void 0};(0,M.isFiniteNumber)(e)||(e=this.lastEndTime=r||0);var i=y.samples;if(!i||!i.length)return t;var c={initPTS:void 0,timescale:1},f=this.initData;if((!f||!f.length)&&(this.generateInitSegment(i),f=this.initData),!f||!f.length)return F.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),t;this.emitInitSegment&&(c.tracks=this.initTracks,this.emitInitSegment=!1);var g=(0,b.getStartDTS)(f,i);(0,M.isFiniteNumber)(d)||(this.initPTS=c.initPTS=d=g-r);var a=(0,b.getDuration)(i,f),p=L?g-d:e,v=p+a;(0,b.offsetStartDTS)(f,i,d),a>0?this.lastEndTime=v:(F.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var o=!!f.audio,_=!!f.video,O="";o&&(O+="audio"),_&&(O+="video");var B={data1:i,startPTS:p,startDTS:p,endPTS:v,endDTS:v,type:O,hasAudio:o,hasVideo:_,nb:1,dropped:0};t.audio=B.type==="audio"?B:void 0,t.video=B.type!=="audio"?B:void 0,t.initSegment=c;var K=(h=this.initPTS)!=null?h:0;return t.id3=(0,I.flushTextTrackMetadataCueSamples)(l,r,K,K),n.samples.length&&(t.text=(0,I.flushTextTrackUserdataCueSamples)(n,r,K)),t},T}();function C(T,S){var D=T==null?void 0:T.codec;return D&&D.length>4?D:D==="hvc1"||D==="hev1"?"hvc1.1.c.L120.90":D==="av01"?"av01.0.04M.08":D==="avc1"||S===P.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const A=R},"./src/task-loop.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>M});var M=function(){function I(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=I.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(F){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,F),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},I}()},"./src/types/cmcd.ts":(G,k,u)=>{u.r(k),u.d(k,{CMCDObjectType:()=>I,CMCDStreamType:()=>P,CMCDStreamingFormat:()=>b,CMCDVersion:()=>M});var M=1,I;(function(F){F.MANIFEST="m",F.AUDIO="a",F.VIDEO="v",F.MUXED="av",F.INIT="i",F.CAPTION="c",F.TIMED_TEXT="tt",F.KEY="k",F.OTHER="o"})(I||(I={}));var b;(function(F){F.DASH="d",F.HLS="h",F.SMOOTH="s",F.OTHER="o"})(b||(b={}));var P;(function(F){F.VOD="v",F.LIVE="l"})(P||(P={}))},"./src/types/demuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{MetadataSchema:()=>M});var M;(function(I){I.audioId3="org.id3",I.dateRange="com.apple.quicktime.HLS",I.emsg="https://aomedia.org/emsg/ID3"})(M||(M={}))},"./src/types/level.ts":(G,k,u)=>{u.r(k),u.d(k,{HlsSkip:()=>b,HlsUrlParameters:()=>F,Level:()=>R,getSkipValue:()=>P});function M(C,A){for(var T=0;T<A.length;T++){var S=A[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(C,S.key,S)}}function I(C,A,T){return A&&M(C.prototype,A),T&&M(C,T),Object.defineProperty(C,"prototype",{writable:!1}),C}var b;(function(C){C.No="",C.Yes="YES",C.v2="v2"})(b||(b={}));function P(C,A){var T=C.canSkipUntil,S=C.canSkipDateRanges,D=C.endSN,L=A!==void 0?A-D:0;return T&&L<T?S?b.v2:b.Yes:b.No}var F=function(){function C(T,S,D){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=T,this.part=S,this.skip=D}var A=C.prototype;return A.addDirectives=function(S){var D=new self.URL(S);return this.msn!==void 0&&D.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&D.searchParams.set("_HLS_part",this.part.toString()),this.skip&&D.searchParams.set("_HLS_skip",this.skip),D.toString()},C}(),R=function(){function C(A){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[A.url],this.attrs=A.attrs,this.bitrate=A.bitrate,A.details&&(this.details=A.details),this.id=A.id||0,this.name=A.name,this.width=A.width||0,this.height=A.height||0,this.audioCodec=A.audioCodec,this.videoCodec=A.videoCodec,this.unknownCodecs=A.unknownCodecs,this.codecSet=[A.videoCodec,A.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}return I(C,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(T){var S=T%this.url.length;this._urlId!==S&&(this.details=void 0,this._urlId=S)}}]),C}()},"./src/types/loader.ts":(G,k,u)=>{u.r(k),u.d(k,{PlaylistContextType:()=>M,PlaylistLevelType:()=>I});var M;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var I;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(I||(I={}))},"./src/types/transmuxer.ts":(G,k,u)=>{u.r(k),u.d(k,{ChunkMetadata:()=>M});var M=function(P,F,R,C,A,T){C===void 0&&(C=0),A===void 0&&(A=-1),T===void 0&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=I(),this.buffering={audio:I(),video:I(),audiovideo:I()},this.level=P,this.sn=F,this.id=R,this.size=C,this.part=A,this.partial=T};function I(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(G,k,u)=>{u.r(k),u.d(k,{AttrList:()=>b});var M=/^(\d+)x(\d+)$/,I=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function P(R){typeof R=="string"&&(R=P.parseAttrList(R));for(var C in R)R.hasOwnProperty(C)&&(this[C]=R[C])}var F=P.prototype;return F.decimalInteger=function(C){var A=parseInt(this[C],10);return A>Number.MAX_SAFE_INTEGER?1/0:A},F.hexadecimalInteger=function(C){if(this[C]){var A=(this[C]||"0x").slice(2);A=(A.length&1?"0":"")+A;for(var T=new Uint8Array(A.length/2),S=0;S<A.length/2;S++)T[S]=parseInt(A.slice(S*2,S*2+2),16);return T}else return null},F.hexadecimalIntegerAsNumber=function(C){var A=parseInt(this[C],16);return A>Number.MAX_SAFE_INTEGER?1/0:A},F.decimalFloatingPoint=function(C){return parseFloat(this[C])},F.optionalFloat=function(C,A){var T=this[C];return T?parseFloat(T):A},F.enumeratedString=function(C){return this[C]},F.bool=function(C){return this[C]==="YES"},F.decimalResolution=function(C){var A=M.exec(this[C]);if(A!==null)return{width:parseInt(A[1],10),height:parseInt(A[2],10)}},P.parseAttrList=function(C){var A,T={},S='"';for(I.lastIndex=0;(A=I.exec(C))!==null;){var D=A[2];D.indexOf(S)===0&&D.lastIndexOf(S)===D.length-1&&(D=D.slice(1,-1)),T[A[1]]=D}return T},P}()},"./src/utils/binary-search.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>I});var M={search:function(P,F){for(var R=0,C=P.length-1,A=null,T=null;R<=C;){A=(R+C)/2|0,T=P[A];var S=F(T);if(S>0)R=A+1;else if(S<0)C=A-1;else return T}return null}};const I=M},"./src/utils/buffer-helper.ts":(G,k,u)=>{u.r(k),u.d(k,{BufferHelper:()=>b});var M=u("./src/utils/logger.ts"),I={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function P(){}return P.isBuffered=function(R,C){try{if(R){for(var A=P.getBuffered(R),T=0;T<A.length;T++)if(C>=A.start(T)&&C<=A.end(T))return!0}}catch{}return!1},P.bufferInfo=function(R,C,A){try{if(R){var T=P.getBuffered(R),S=[],D;for(D=0;D<T.length;D++)S.push({start:T.start(D),end:T.end(D)});return this.bufferedInfo(S,C,A)}}catch{}return{len:0,start:C,end:C,nextStart:void 0}},P.bufferedInfo=function(R,C,A){C=Math.max(0,C),R.sort(function(t,i){var c=t.start-i.start;return c||i.end-t.end});var T=[];if(A)for(var S=0;S<R.length;S++){var D=T.length;if(D){var L=T[D-1].end;R[S].start-L<A?R[S].end>L&&(T[D-1].end=R[S].end):T.push(R[S])}else T.push(R[S])}else T=R;for(var y=0,l,n=C,r=C,h=0;h<T.length;h++){var d=T[h].start,e=T[h].end;if(C+A>=d&&C<e)n=d,r=e,y=r-C;else if(C+A<d){l=d;break}}return{len:y,start:n||0,end:r||0,nextStart:l}},P.getBuffered=function(R){try{return R.buffered}catch(C){return M.logger.log("failed to get media.buffered",C),I}},P}()},"./src/utils/cea-608-parser.ts":(G,k,u)=>{u.r(k),u.d(k,{CaptionScreen:()=>h,Row:()=>r,default:()=>f});var M=u("./src/utils/logger.ts"),I={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(a){var p=a;return I.hasOwnProperty(a)&&(p=I[a]),String.fromCharCode(p)},P=15,F=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},C={17:2,18:4,21:6,22:8,23:10,19:13,20:15},A={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},S=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],D;(function(g){g[g.ERROR=0]="ERROR",g[g.TEXT=1]="TEXT",g[g.WARNING=2]="WARNING",g[g.INFO=2]="INFO",g[g.DEBUG=3]="DEBUG",g[g.DATA=3]="DATA"})(D||(D={}));var L=function(){function g(){this.time=null,this.verboseLevel=D.ERROR}var a=g.prototype;return a.log=function(v,o){this.verboseLevel>=v&&M.logger.log(this.time+" ["+v+"] "+o)},g}(),y=function(a){for(var p=[],v=0;v<a.length;v++)p.push(a[v].toString(16));return p},l=function(){function g(p,v,o,_,O){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=p||"white",this.underline=v||!1,this.italics=o||!1,this.background=_||"black",this.flash=O||!1}var a=g.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(v){for(var o=["foreground","underline","italics","background","flash"],_=0;_<o.length;_++){var O=o[_];v.hasOwnProperty(O)&&(this[O]=v[O])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(v){return this.foreground===v.foreground&&this.underline===v.underline&&this.italics===v.italics&&this.background===v.background&&this.flash===v.flash},a.copy=function(v){this.foreground=v.foreground,this.underline=v.underline,this.italics=v.italics,this.background=v.background,this.flash=v.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},g}(),n=function(){function g(p,v,o,_,O,B){this.uchar=void 0,this.penState=void 0,this.uchar=p||" ",this.penState=new l(v,o,_,O,B)}var a=g.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(v,o){this.uchar=v,this.penState.copy(o)},a.setPenState=function(v){this.penState.copy(v)},a.equals=function(v){return this.uchar===v.uchar&&this.penState.equals(v.penState)},a.copy=function(v){this.uchar=v.uchar,this.penState.copy(v.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},g}(),r=function(){function g(p){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var v=0;v<F;v++)this.chars.push(new n);this.logger=p,this.pos=0,this.currPenState=new l}var a=g.prototype;return a.equals=function(v){for(var o=!0,_=0;_<F;_++)if(!this.chars[_].equals(v.chars[_])){o=!1;break}return o},a.copy=function(v){for(var o=0;o<F;o++)this.chars[o].copy(v.chars[o])},a.isEmpty=function(){for(var v=!0,o=0;o<F;o++)if(!this.chars[o].isEmpty()){v=!1;break}return v},a.setCursor=function(v){this.pos!==v&&(this.pos=v),this.pos<0?(this.logger.log(D.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>F&&(this.logger.log(D.DEBUG,"Too large cursor position "+this.pos),this.pos=F)},a.moveCursor=function(v){var o=this.pos+v;if(v>1)for(var _=this.pos+1;_<o+1;_++)this.chars[_].setPenState(this.currPenState);this.setCursor(o)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(v){v>=144&&this.backSpace();var o=b(v);if(this.pos>=F){this.logger.log(D.ERROR,"Cannot insert "+v.toString(16)+" ("+o+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(o,this.currPenState),this.moveCursor(1)},a.clearFromPos=function(v){var o;for(o=v;o<F;o++)this.chars[o].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var v=[],o=!0,_=0;_<F;_++){var O=this.chars[_].uchar;O!==" "&&(o=!1),v.push(O)}return o?"":v.join("")},a.setPenStyles=function(v){this.currPenState.setStyles(v);var o=this.chars[this.pos];o.setPenState(this.currPenState)},g}(),h=function(){function g(p){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var v=0;v<P;v++)this.rows.push(new r(p));this.logger=p,this.currRow=P-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=g.prototype;return a.reset=function(){for(var v=0;v<P;v++)this.rows[v].clear();this.currRow=P-1},a.equals=function(v){for(var o=!0,_=0;_<P;_++)if(!this.rows[_].equals(v.rows[_])){o=!1;break}return o},a.copy=function(v){for(var o=0;o<P;o++)this.rows[o].copy(v.rows[o])},a.isEmpty=function(){for(var v=!0,o=0;o<P;o++)if(!this.rows[o].isEmpty()){v=!1;break}return v},a.backSpace=function(){var v=this.rows[this.currRow];v.backSpace()},a.clearToEndOfRow=function(){var v=this.rows[this.currRow];v.clearToEndOfRow()},a.insertChar=function(v){var o=this.rows[this.currRow];o.insertChar(v)},a.setPen=function(v){var o=this.rows[this.currRow];o.setPenStyles(v)},a.moveCursor=function(v){var o=this.rows[this.currRow];o.moveCursor(v)},a.setCursor=function(v){this.logger.log(D.INFO,"setCursor: "+v);var o=this.rows[this.currRow];o.setCursor(v)},a.setPAC=function(v){this.logger.log(D.INFO,"pacData = "+JSON.stringify(v));var o=v.row-1;if(this.nrRollUpRows&&o<this.nrRollUpRows-1&&(o=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==o){for(var _=0;_<P;_++)this.rows[_].clear();var O=this.currRow+1-this.nrRollUpRows,B=this.lastOutputScreen;if(B){var K=B.rows[O].cueStartTime,N=this.logger.time;if(K&&N!==null&&K<N)for(var W=0;W<this.nrRollUpRows;W++)this.rows[o-this.nrRollUpRows+W+1].copy(B.rows[O+W])}}this.currRow=o;var H=this.rows[this.currRow];if(v.indent!==null){var V=v.indent,j=Math.max(V-1,0);H.setCursor(v.indent),v.color=H.chars[j].penState.foreground}var z={foreground:v.color,underline:v.underline,italics:v.italics,background:"black",flash:!1};this.setPen(z)},a.setBkgData=function(v){this.logger.log(D.INFO,"bkgData = "+JSON.stringify(v)),this.backSpace(),this.setPen(v),this.insertChar(32)},a.setRollUpRows=function(v){this.nrRollUpRows=v},a.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(D.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(D.TEXT,this.getDisplayText());var v=this.currRow+1-this.nrRollUpRows,o=this.rows.splice(v,1)[0];o.clear(),this.rows.splice(this.currRow,0,o),this.logger.log(D.INFO,"Rolling up")},a.getDisplayText=function(v){v=v||!1;for(var o=[],_="",O=-1,B=0;B<P;B++){var K=this.rows[B].getTextString();K&&(O=B+1,v?o.push("Row "+O+": '"+K+"'"):o.push(K.trim()))}return o.length>0&&(v?_="["+o.join(" | ")+"]":_=o.join(`
`)),_},a.getTextAndFormat=function(){return this.rows},g}(),d=function(){function g(p,v,o){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=p,this.outputFilter=v,this.mode=null,this.verbose=0,this.displayedMemory=new h(o),this.nonDisplayedMemory=new h(o),this.lastOutputScreen=new h(o),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=o}var a=g.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(v){this.outputFilter=v},a.setPAC=function(v){this.writeScreen.setPAC(v)},a.setBkgData=function(v){this.writeScreen.setBkgData(v)},a.setMode=function(v){v!==this.mode&&(this.mode=v,this.logger.log(D.INFO,"MODE="+v),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=v)},a.insertChars=function(v){for(var o=0;o<v.length;o++)this.writeScreen.insertChar(v[o]);var _=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(D.INFO,_+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(D.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(D.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(D.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(D.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(v){this.logger.log(D.INFO,"RU("+v+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(v)},a.ccFON=function(){this.logger.log(D.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(D.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(D.INFO,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(D.INFO,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(D.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(D.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(D.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){if(this.logger.log(D.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var v=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=v,this.writeScreen=this.nonDisplayedMemory,this.logger.log(D.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.ccTO=function(v){this.logger.log(D.INFO,"TO("+v+") - Tab Offset"),this.writeScreen.moveCursor(v)},a.ccMIDROW=function(v){var o={flash:!1};if(o.underline=v%2===1,o.italics=v>=46,o.italics)o.foreground="white";else{var _=Math.floor(v/2)-16,O=["white","green","blue","cyan","red","yellow","magenta"];o.foreground=O[_]}this.logger.log(D.INFO,"MIDROW: "+JSON.stringify(o)),this.writeScreen.setPen(o)},a.outputDataUpdate=function(v){v===void 0&&(v=!1);var o=this.logger.time;o!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=o:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,o,this.lastOutputScreen),v&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:o),this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(v){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,v,this.displayedMemory),this.cueStartTime=v))},g}(),e=function(){function g(p,v,o){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var _=new L;this.channels=[null,new d(p,v,_),new d(p+1,o,_)],this.cmdHistory=c(),this.logger=_}var a=g.prototype;return a.getHandler=function(v){return this.channels[v].getHandler()},a.setHandler=function(v,o){this.channels[v].setHandler(o)},a.addData=function(v,o){var _,O,B,K=!1;this.logger.time=v;for(var N=0;N<o.length;N+=2)if(O=o[N]&127,B=o[N+1]&127,!(O===0&&B===0)){if(this.logger.log(D.DATA,"["+y([o[N],o[N+1]])+"] -> ("+y([O,B])+")"),_=this.parseCmd(O,B),_||(_=this.parseMidrow(O,B)),_||(_=this.parsePAC(O,B)),_||(_=this.parseBackgroundAttributes(O,B)),!_&&(K=this.parseChars(O,B),K)){var W=this.currentChannel;if(W&&W>0){var H=this.channels[W];H.insertChars(K)}else this.logger.log(D.WARNING,"No channel found yet. TEXT-MODE?")}!_&&!K&&this.logger.log(D.WARNING,"Couldn't parse cleaned data "+y([O,B])+" orig: "+y([o[N],o[N+1]]))}},a.parseCmd=function(v,o){var _=this.cmdHistory,O=(v===20||v===28||v===21||v===29)&&o>=32&&o<=47,B=(v===23||v===31)&&o>=33&&o<=35;if(!(O||B))return!1;if(i(v,o,_))return t(null,null,_),this.logger.log(D.DEBUG,"Repeated command ("+y([v,o])+") is dropped"),!0;var K=v===20||v===21||v===23?1:2,N=this.channels[K];return v===20||v===21||v===28||v===29?o===32?N.ccRCL():o===33?N.ccBS():o===34?N.ccAOF():o===35?N.ccAON():o===36?N.ccDER():o===37?N.ccRU(2):o===38?N.ccRU(3):o===39?N.ccRU(4):o===40?N.ccFON():o===41?N.ccRDC():o===42?N.ccTR():o===43?N.ccRTD():o===44?N.ccEDM():o===45?N.ccCR():o===46?N.ccENM():o===47&&N.ccEOC():N.ccTO(o-32),t(v,o,_),this.currentChannel=K,!0},a.parseMidrow=function(v,o){var _=0;if((v===17||v===25)&&o>=32&&o<=47){if(v===17?_=1:_=2,_!==this.currentChannel)return this.logger.log(D.ERROR,"Mismatch channel in midrow parsing"),!1;var O=this.channels[_];return O?(O.ccMIDROW(o),this.logger.log(D.DEBUG,"MIDROW ("+y([v,o])+")"),!0):!1}return!1},a.parsePAC=function(v,o){var _,O=this.cmdHistory,B=(v>=17&&v<=23||v>=25&&v<=31)&&o>=64&&o<=127,K=(v===16||v===24)&&o>=64&&o<=95;if(!(B||K))return!1;if(i(v,o,O))return t(null,null,O),!0;var N=v<=23?1:2;o>=64&&o<=95?_=N===1?R[v]:A[v]:_=N===1?C[v]:T[v];var W=this.channels[N];return W?(W.setPAC(this.interpretPAC(_,o)),t(v,o,O),this.currentChannel=N,!0):!1},a.interpretPAC=function(v,o){var _,O={color:null,italics:!1,indent:null,underline:!1,row:v};return o>95?_=o-96:_=o-64,O.underline=(_&1)===1,_<=13?O.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(_/2)]:_<=15?(O.italics=!0,O.color="white"):O.indent=Math.floor((_-16)/2)*4,O},a.parseChars=function(v,o){var _,O=null,B=null;if(v>=25?(_=2,B=v-8):(_=1,B=v),B>=17&&B<=19){var K;B===17?K=o+80:B===18?K=o+112:K=o+144,this.logger.log(D.INFO,"Special char '"+b(K)+"' in channel "+_),O=[K]}else v>=32&&v<=127&&(O=o===0?[v]:[v,o]);if(O){var N=y(O);this.logger.log(D.DEBUG,"Char codes =  "+N.join(",")),t(v,o,this.cmdHistory)}return O},a.parseBackgroundAttributes=function(v,o){var _=(v===16||v===24)&&o>=32&&o<=47,O=(v===23||v===31)&&o>=45&&o<=47;if(!(_||O))return!1;var B,K={};v===16||v===24?(B=Math.floor((o-32)/2),K.background=S[B],o%2===1&&(K.background=K.background+"_semi")):o===45?K.background="transparent":(K.foreground="black",o===47&&(K.underline=!0));var N=v<=23?1:2,W=this.channels[N];return W.setBkgData(K),t(v,o,this.cmdHistory),!0},a.reset=function(){for(var v=0;v<Object.keys(this.channels).length;v++){var o=this.channels[v];o&&o.reset()}this.cmdHistory=c()},a.cueSplitAtTime=function(v){for(var o=0;o<this.channels.length;o++){var _=this.channels[o];_&&_.cueSplitAtTime(v)}},g}();function t(g,a,p){p.a=g,p.b=a}function i(g,a,p){return p.a===g&&p.b===a}function c(){return{a:null,b:null}}const f=e},"./src/utils/codecs.ts":(G,k,u)=>{u.r(k),u.d(k,{isCodecSupportedInMp4:()=>b,isCodecType:()=>I});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function I(P,F){var R=M[F];return!!R&&R[P.slice(0,4)]===!0}function b(P,F){return MediaSource.isTypeSupported((F||"video")+'/mp4;codecs="'+P+'"')}},"./src/utils/cues.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>R});var M=u("./src/utils/vttparser.ts"),I=u("./src/utils/webvtt-parser.ts"),b=u("./src/utils/texttrack-utils.ts"),P=/\s/,F={newCue:function(A,T,S,D){for(var L=[],y,l,n,r,h,d=self.VTTCue||self.TextTrackCue,e=0;e<D.rows.length;e++)if(y=D.rows[e],n=!0,r=0,h="",!y.isEmpty()){for(var t=0;t<y.chars.length;t++)P.test(y.chars[t].uchar)&&n?r++:(h+=y.chars[t].uchar,n=!1);y.cueStartTime=T,T===S&&(S+=1e-4),r>=16?r--:r++;var i=(0,M.fixLineBreaks)(h.trim()),c=(0,I.generateCueId)(T,S,i);(!A||!A.cues||!A.cues.getCueById(c))&&(l=new d(T,S,i),l.id=c,l.line=e+1,l.align="left",l.position=10+Math.min(80,Math.floor(r*8/32)*10),L.push(l))}return A&&L.length&&(L.sort(function(f,g){return f.line==="auto"||g.line==="auto"?0:f.line>8&&g.line>8?g.line-f.line:f.line-g.line}),L.forEach(function(f){return(0,b.addCueToTrack)(A,f)})),L}};const R=F},"./src/utils/discontinuities.ts":(G,k,u)=>{u.r(k),u.d(k,{adjustSlidingStart:()=>A,alignMediaPlaylistByPDT:()=>L,alignPDT:()=>D,alignStream:()=>T,findDiscontinuousReferenceFrag:()=>R,findFirstFragWithCC:()=>P,shouldAlignOnDiscontinuities:()=>F});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/logger.ts"),b=u("./src/controller/level-helper.ts");function P(y,l){for(var n=null,r=0,h=y.length;r<h;r++){var d=y[r];if(d&&d.cc===l){n=d;break}}return n}function F(y,l,n){return!!(l.details&&(n.endCC>n.startCC||y&&y.cc<n.startCC))}function R(y,l,n){var r=y.fragments,h=l.fragments;if(!h.length||!r.length){I.logger.log("No fragments to align");return}var d=P(r,h[0].cc);if(!d||d&&!d.startPTS){I.logger.log("No frag in previous level to align on");return}return d}function C(y,l){if(y){var n=y.start+l;y.start=y.startPTS=n,y.endPTS=n+y.duration}}function A(y,l){for(var n=l.fragments,r=0,h=n.length;r<h;r++)C(n[r],y);l.fragmentHint&&C(l.fragmentHint,y),l.alignedSliding=!0}function T(y,l,n){!l||(S(y,n,l),!n.alignedSliding&&l.details&&D(n,l.details),!n.alignedSliding&&l.details&&!n.skippedSegments&&(0,b.adjustSliding)(l.details,n))}function S(y,l,n){if(F(y,n,l)){var r=R(n.details,l);r&&(0,M.isFiniteNumber)(r.start)&&(I.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),A(r.start,l))}}function D(y,l){if(!(!l.fragments.length||!y.hasProgramDateTime||!l.hasProgramDateTime)){var n=l.fragments[0].programDateTime,r=y.fragments[0].programDateTime,h=(r-n)/1e3+l.fragments[0].start;h&&(0,M.isFiniteNumber)(h)&&(I.logger.log("Adjusting PTS using programDateTime delta "+(r-n)+"ms, sliding:"+h.toFixed(3)+" "+y.url+" "),A(h,y))}}function L(y,l){if(!(!y.hasProgramDateTime||!l.hasProgramDateTime)){var n=y.fragments,r=l.fragments;if(!(!n.length||!r.length)){var h=Math.round(r.length/2)-1,d=r[h],e=P(n,d.cc)||n[Math.round(n.length/2)-1],t=d.programDateTime,i=e.programDateTime;if(!(t===null||i===null)){var c=(i-t)/1e3-(e.start-d.start);A(c,y)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>b});var M=u("./src/utils/ewma.ts"),I=function(){function P(R,C,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(R),this.fast_=new M.default(C)}var F=P.prototype;return F.update=function(C,A){var T=this.slow_,S=this.fast_;this.slow_.halfLife!==C&&(this.slow_=new M.default(C,T.getEstimate(),T.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new M.default(A,S.getEstimate(),S.getTotalWeight()))},F.sample=function(C,A){C=Math.max(C,this.minDelayMs_);var T=8*A,S=C/1e3,D=T/S;this.fast_.sample(S,D),this.slow_.sample(S,D)},F.canEstimate=function(){var C=this.fast_;return C&&C.getTotalWeight()>=this.minWeight_},F.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},F.destroy=function(){},P}();const b=I},"./src/utils/ewma.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>I});var M=function(){function b(F,R,C){R===void 0&&(R=0),C===void 0&&(C=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=F,this.alpha_=F?Math.exp(Math.log(.5)/F):0,this.estimate_=R,this.totalWeight_=C}var P=b.prototype;return P.sample=function(R,C){var A=Math.pow(this.alpha_,R);this.estimate_=C*(1-A)+A*this.estimate_,this.totalWeight_+=R},P.getTotalWeight=function(){return this.totalWeight_},P.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},b}();const I=M},"./src/utils/fetch-loader.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>h,fetchSupported:()=>L});var M=u("./src/polyfills/number.ts"),I=u("./src/loader/load-stats.ts"),b=u("./src/demux/chunk-cache.ts");function P(d,e){d.prototype=Object.create(e.prototype),d.prototype.constructor=d,T(d,e)}function F(d){var e=typeof Map=="function"?new Map:void 0;return F=function(i){if(i===null||!A(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(i))return e.get(i);e.set(i,c)}function c(){return R(i,arguments,S(this).constructor)}return c.prototype=Object.create(i.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),T(c,i)},F(d)}function R(d,e,t){return C()?R=Reflect.construct.bind():R=function(c,f,g){var a=[null];a.push.apply(a,f);var p=Function.bind.apply(c,a),v=new p;return g&&T(v,g.prototype),v},R.apply(null,arguments)}function C(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(d){return Function.toString.call(d).indexOf("[native code]")!==-1}function T(d,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},T(d,e)}function S(d){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},S(d)}function D(){return D=Object.assign?Object.assign.bind():function(d){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(d[i]=t[i])}return d},D.apply(this,arguments)}function L(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var y=function(){function d(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||n,this.controller=new self.AbortController,this.stats=new I.LoadStats}var e=d.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;(!i||!i.ok)&&(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,c,f){var g=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var p=l(i,this.controller.signal),v=f.onProgress,o=i.responseType==="arraybuffer",_=o?"byteLength":"length";this.context=i,this.config=c,this.callbacks=f,this.request=this.fetchSetup(i,p),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){g.abortInternal(),f.onTimeout(a,i,g.response)},c.timeout),self.fetch(this.request).then(function(O){if(g.response=g.loader=O,!O.ok){var B=O.status,K=O.statusText;throw new r(K||"fetch, bad network response",B,O)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(O.headers.get("Content-Length")||"0"),v&&(0,M.isFiniteNumber)(c.highWaterMark)?g.loadProgressively(O,a,i,c.highWaterMark,v):o?O.arrayBuffer():O.text()}).then(function(O){var B=g.response;self.clearTimeout(g.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);var K=O[_];K&&(a.loaded=a.total=K);var N={url:B.url,data:O};v&&!(0,M.isFiniteNumber)(c.highWaterMark)&&v(a,i,O,B),f.onSuccess(N,a,i,B)}).catch(function(O){if(self.clearTimeout(g.requestTimeout),!a.aborted){var B=O&&O.code||0,K=O?O.message:null;f.onError({code:B,text:K},i,O?O.details:null)}})},e.getCacheAge=function(){var i=null;if(this.response){var c=this.response.headers.get("age");i=c?parseFloat(c):null}return i},e.loadProgressively=function(i,c,f,g,a){g===void 0&&(g=0);var p=new b.default,v=i.body.getReader(),o=function _(){return v.read().then(function(O){if(O.done)return p.dataLength&&a(c,f,p.flush(),i),Promise.resolve(new ArrayBuffer(0));var B=O.value,K=B.length;return c.loaded+=K,K<g||p.dataLength?(p.push(B),p.dataLength>=g&&a(c,f,p.flush(),i)):a(c,f,B,i),_()}).catch(function(){return Promise.reject()})};return o()},d}();function l(d,e){var t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(D({},d.headers))};return d.rangeEnd&&t.headers.set("Range","bytes="+d.rangeStart+"-"+String(d.rangeEnd-1)),t}function n(d,e){return new self.Request(d.url,e)}var r=function(d){P(e,d);function e(t,i,c){var f;return f=d.call(this,t)||this,f.code=void 0,f.details=void 0,f.code=i,f.details=c,f}return e}(F(Error));const h=y},"./src/utils/imsc1-ttml-parser.ts":(G,k,u)=>{u.r(k),u.d(k,{IMSC1_CODEC:()=>A,parseIMSC1:()=>L});var M=u("./src/utils/mp4-tools.ts"),I=u("./src/utils/vttparser.ts"),b=u("./src/utils/vttcue.ts"),P=u("./src/demux/id3.ts"),F=u("./src/utils/timescale-conversion.ts"),R=u("./src/utils/webvtt-parser.ts");function C(){return C=Object.assign?Object.assign.bind():function(f){for(var g=1;g<arguments.length;g++){var a=arguments[g];for(var p in a)Object.prototype.hasOwnProperty.call(a,p)&&(f[p]=a[p])}return f},C.apply(this,arguments)}var A="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,S=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,D={left:"start",center:"center",right:"end",start:"start",end:"end"};function L(f,g,a,p,v){var o=(0,M.findBox)(new Uint8Array(f),["mdat"]);if(o.length===0){v(new Error("Could not parse IMSC1 mdat"));return}var _=o.map(function(B){return(0,P.utf8ArrayToStr)(B)}),O=(0,F.toTimescaleFromScale)(g,1,a);try{_.forEach(function(B){return p(y(B,O))})}catch(B){v(B)}}function y(f,g){var a=new DOMParser,p=a.parseFromString(f,"text/xml"),v=p.getElementsByTagName("tt")[0];if(!v)throw new Error("Invalid ttml");var o={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},_=Object.keys(o).reduce(function(W,H){return W[H]=v.getAttribute("ttp:"+H)||o[H],W},{}),O=v.getAttribute("xml:space")!=="preserve",B=n(l(v,"styling","style")),K=n(l(v,"layout","region")),N=l(v,"body","[begin]");return[].map.call(N,function(W){var H=r(W,O);if(!H||!W.hasAttribute("begin"))return null;var V=t(W.getAttribute("begin"),_),j=t(W.getAttribute("dur"),_),z=t(W.getAttribute("end"),_);if(V===null)throw e(W);if(z===null){if(j===null)throw e(W);z=V+j}var $=new b.default(V-g,z-g,H);$.id=(0,R.generateCueId)($.startTime,$.endTime,$.text);var Y=K[W.getAttribute("region")],X=B[W.getAttribute("style")];$.position=10,$.size=80;var Q=h(Y,X,B),q=Q.textAlign;if(q){var J=D[q];J&&($.lineAlign=J),$.align=q}return C($,Q),$}).filter(function(W){return W!==null})}function l(f,g,a){var p=f.getElementsByTagName(g)[0];return p?[].slice.call(p.querySelectorAll(a)):[]}function n(f){return f.reduce(function(g,a){var p=a.getAttribute("xml:id");return p&&(g[p]=a),g},{})}function r(f,g){return[].slice.call(f.childNodes).reduce(function(a,p,v){var o;return p.nodeName==="br"&&v?a+`
`:(o=p.childNodes)!==null&&o!==void 0&&o.length?r(p,g):g?a+p.textContent.trim().replace(/\s+/g," "):a+p.textContent},"")}function h(f,g,a){var p="http://www.w3.org/ns/ttml#styling",v=null,o=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],_=f!=null&&f.hasAttribute("style")?f.getAttribute("style"):null;return _&&a.hasOwnProperty(_)&&(v=a[_]),o.reduce(function(O,B){var K=d(g,p,B)||d(f,p,B)||d(v,p,B);return K&&(O[B]=K),O},{})}function d(f,g,a){return f&&f.hasAttributeNS(g,a)?f.getAttributeNS(g,a):null}function e(f){return new Error("Could not parse ttml timestamp "+f)}function t(f,g){if(!f)return null;var a=(0,I.parseTimeStamp)(f);return a===null&&(T.test(f)?a=i(f,g):S.test(f)&&(a=c(f,g))),a}function i(f,g){var a=T.exec(f),p=(a[4]|0)+(a[5]|0)/g.subFrameRate;return(a[1]|0)*3600+(a[2]|0)*60+(a[3]|0)+p/g.frameRate}function c(f,g){var a=S.exec(f),p=Number(a[1]),v=a[2];switch(v){case"h":return p*3600;case"m":return p*60;case"ms":return p*1e3;case"f":return p/g.frameRate;case"t":return p/g.tickRate}return p}},"./src/utils/logger.ts":(G,k,u)=>{u.r(k),u.d(k,{enableLogs:()=>R,logger:()=>C});var M=function(){},I={trace:M,debug:M,log:M,warn:M,info:M,error:M},b=I;function P(A){var T=self.console[A];return T?T.bind(self.console,"["+A+"] >"):M}function F(A){for(var T=arguments.length,S=new Array(T>1?T-1:0),D=1;D<T;D++)S[D-1]=arguments[D];S.forEach(function(L){b[L]=A[L]?A[L].bind(A):P(L)})}function R(A,T){if(self.console&&A===!0||typeof A=="object"){F(A,"debug","log","info","warn","error");try{b.log('Debug logs enabled for "'+T+'"')}catch{b=I}}else b=I}var C=b},"./src/utils/mediakeys-helper.ts":(G,k,u)=>{u.r(k),u.d(k,{KeySystems:()=>M,requestMediaKeySystemAccess:()=>I});var M;(function(b){b.WIDEVINE="com.widevine.alpha",b.PLAYREADY="com.microsoft.playready"})(M||(M={}));var I=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":(G,k,u)=>{u.r(k),u.d(k,{getMediaSource:()=>M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(G,k,u)=>{u.r(k),u.d(k,{RemuxerTrackIdConfig:()=>R,appendUint8Array:()=>t,bin2str:()=>C,computeRawDurationFromSamples:()=>h,discardEPB:()=>a,findBox:()=>L,getDuration:()=>r,getStartDTS:()=>n,offsetStartDTS:()=>d,parseEmsg:()=>p,parseInitSegment:()=>l,parseSEIMessageFromNALu:()=>g,parseSamples:()=>i,parseSegmentIndex:()=>y,readSint32:()=>S,readUint16:()=>A,readUint32:()=>T,segmentValidRange:()=>e,writeUint32:()=>D});var M=u("./src/utils/typed-array.ts"),I=u("./src/loader/fragment.ts"),b=u("./src/demux/id3.ts"),P=Math.pow(2,32)-1,F=[].push,R={video:1,audio:2,id3:3,text:4};function C(v){return String.fromCharCode.apply(null,v)}function A(v,o){var _=v[o]<<8|v[o+1];return _<0?65536+_:_}function T(v,o){var _=S(v,o);return _<0?4294967296+_:_}function S(v,o){return v[o]<<24|v[o+1]<<16|v[o+2]<<8|v[o+3]}function D(v,o,_){v[o]=_>>24,v[o+1]=_>>16&255,v[o+2]=_>>8&255,v[o+3]=_&255}function L(v,o){var _=[];if(!o.length)return _;for(var O=v.byteLength,B=0;B<O;){var K=T(v,B),N=C(v.subarray(B+4,B+8)),W=K>1?B+K:O;if(N===o[0])if(o.length===1)_.push(v.subarray(B+8,W));else{var H=L(v.subarray(B+8,W),o.slice(1));H.length&&F.apply(_,H)}B=W}return _}function y(v){var o=[],_=v[0],O=8,B=T(v,O);O+=4;var K=0,N=0;_===0?O+=8:O+=16,O+=2;var W=v.length+N,H=A(v,O);O+=2;for(var V=0;V<H;V++){var j=O,z=T(v,j);j+=4;var $=z&2147483647,Y=(z&2147483648)>>>31;if(Y===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var X=T(v,j);j+=4,o.push({referenceSize:$,subsegmentDuration:X,info:{duration:X/B,start:W,end:W+$-1}}),W+=$,j+=4,O=j}return{earliestPresentationTime:K,timescale:B,version:_,referencesCount:H,references:o}}function l(v){for(var o=[],_=L(v,["moov","trak"]),O=0;O<_.length;O++){var B=_[O],K=L(B,["tkhd"])[0];if(K){var N=K[0],W=N===0?12:20,H=T(K,W),V=L(B,["mdia","mdhd"])[0];if(V){N=V[0],W=N===0?12:20;var j=T(V,W),z=L(B,["mdia","hdlr"])[0];if(z){var $=C(z.subarray(8,12)),Y={soun:I.ElementaryStreamTypes.AUDIO,vide:I.ElementaryStreamTypes.VIDEO}[$];if(Y){var X=L(B,["mdia","minf","stbl","stsd"])[0],Q=void 0;X&&(Q=C(X.subarray(12,16))),o[H]={timescale:j,type:Y},o[Y]={timescale:j,id:H,codec:Q}}}}}}var q=L(v,["moov","mvex","trex"]);return q.forEach(function(J){var ie=T(J,4),se=o[ie];se&&(se.default={duration:T(J,12),flags:T(J,20)})}),o}function n(v,o){return L(o,["moof","traf"]).reduce(function(_,O){var B=L(O,["tfdt"])[0],K=B[0],N=L(O,["tfhd"]).reduce(function(W,H){var V=T(H,4),j=v[V];if(j){var z=T(B,4);K===1&&(z*=Math.pow(2,32),z+=T(B,8));var $=j.timescale||9e4,Y=z/$;if(isFinite(Y)&&(W===null||Y<W))return Y}return W},null);return N!==null&&isFinite(N)&&(_===null||N<_)?N:_},null)||0}function r(v,o){for(var _=0,O=0,B=0,K=L(v,["moof","traf"]),N=0;N<K.length;N++){var W=K[N],H=L(W,["tfhd"])[0],V=T(H,4),j=o[V];if(!!j){var z=j.default,$=T(H,0)|(z==null?void 0:z.flags),Y=z==null?void 0:z.duration;$&8&&($&2?Y=T(H,12):Y=T(H,8));for(var X=j.timescale||9e4,Q=L(W,["trun"]),q=0;q<Q.length;q++){if(_=h(Q[q]),!_&&Y){var J=T(Q[q],4);_=Y*J}j.type===I.ElementaryStreamTypes.VIDEO?O+=_/X:j.type===I.ElementaryStreamTypes.AUDIO&&(B+=_/X)}}}if(O===0&&B===0){for(var ie=0,se=L(v,["sidx"]),Z=0;Z<se.length;Z++){var re=y(se[Z]);re!=null&&re.references&&(ie+=re.references.reduce(function(le,oe){return le+oe.info.duration||0},0))}return ie}return O||B}function h(v){var o=T(v,0),_=8;o&1&&(_+=4),o&4&&(_+=4);for(var O=0,B=T(v,4),K=0;K<B;K++){if(o&256){var N=T(v,_);O+=N,_+=4}o&512&&(_+=4),o&1024&&(_+=4),o&2048&&(_+=4)}return O}function d(v,o,_){L(o,["moof","traf"]).forEach(function(O){L(O,["tfhd"]).forEach(function(B){var K=T(B,4),N=v[K];if(!!N){var W=N.timescale||9e4;L(O,["tfdt"]).forEach(function(H){var V=H[0],j=T(H,4);if(V===0)j-=_*W,j=Math.max(j,0),D(H,4,j);else{j*=Math.pow(2,32),j+=T(H,8),j-=_*W,j=Math.max(j,0);var z=Math.floor(j/(P+1)),$=Math.floor(j%(P+1));D(H,4,z),D(H,8,$)}})}})})}function e(v){var o={valid:null,remainder:null},_=L(v,["moof"]);if(_){if(_.length<2)return o.remainder=v,o}else return o;var O=_[_.length-1];return o.valid=(0,M.sliceUint8)(v,0,O.byteOffset-8),o.remainder=(0,M.sliceUint8)(v,O.byteOffset-8),o}function t(v,o){var _=new Uint8Array(v.length+o.length);return _.set(v),_.set(o,v.length),_}function i(v,o){var _=[],O=o.samples,B=o.timescale,K=o.id,N=!1,W=L(O,["moof"]);return W.map(function(H){var V=H.byteOffset-8,j=L(H,["traf"]);j.map(function(z){var $=L(z,["tfdt"]).map(function(Y){var X=Y[0],Q=T(Y,4);return X===1&&(Q*=Math.pow(2,32),Q+=T(Y,8)),Q/B})[0];return $!==void 0&&(v=$),L(z,["tfhd"]).map(function(Y){var X=T(Y,4),Q=T(Y,0)&16777215,q=(Q&1)!==0,J=(Q&2)!==0,ie=(Q&8)!==0,se=0,Z=(Q&16)!==0,re=0,le=(Q&32)!==0,oe=8;X===K&&(q&&(oe+=8),J&&(oe+=4),ie&&(se=T(Y,oe),oe+=4),Z&&(re=T(Y,oe),oe+=4),le&&(oe+=4),o.type==="video"&&(N=c(o.codec)),L(z,["trun"]).map(function(de){var xe=de[0],ce=T(de,0)&16777215,Pe=(ce&1)!==0,Le=0,_e=(ce&4)!==0,Ie=(ce&256)!==0,be=0,Be=(ce&512)!==0,Me=0,Oe=(ce&1024)!==0,Ue=(ce&2048)!==0,we=0,We=T(de,4),pe=8;Pe&&(Le=T(de,pe),pe+=4),_e&&(pe+=4);for(var De=Le+V,Ne=0;Ne<We;Ne++){if(Ie?(be=T(de,pe),pe+=4):be=se,Be?(Me=T(de,pe),pe+=4):Me=re,Oe&&(pe+=4),Ue&&(xe===0?we=T(de,pe):we=S(de,pe),pe+=4),o.type===I.ElementaryStreamTypes.VIDEO)for(var ve=0;ve<Me;){var Ae=T(O,De);if(De+=4,f(N,O[De])){var Fe=O.subarray(De,De+Ae);g(Fe,N?2:1,v+we/B,_)}De+=Ae,ve+=Ae+4}v+=be/B}}))})})}),_}function c(v){if(!v)return!1;var o=v.indexOf("."),_=o<0?v:v.substring(0,o);return _==="hvc1"||_==="hev1"||_==="dvh1"||_==="dvhe"}function f(v,o){if(v){var _=o>>1&63;return _===39||_===40}else{var O=o&31;return O===6}}function g(v,o,_,O){var B=a(v),K=0;K+=o;for(var N=0,W=0,H=!1,V=0;K<B.length;){N=0;do{if(K>=B.length)break;V=B[K++],N+=V}while(V===255);W=0;do{if(K>=B.length)break;V=B[K++],W+=V}while(V===255);var j=B.length-K;if(!H&&N===4&&K<B.length){H=!0;var z=B[K++];if(z===181){var $=A(B,K);if(K+=2,$===49){var Y=T(B,K);if(K+=4,Y===1195456820){var X=B[K++];if(X===3){var Q=B[K++],q=31&Q,J=64&Q,ie=J?2+q*3:0,se=new Uint8Array(ie);if(J){se[0]=Q;for(var Z=1;Z<ie;Z++)se[Z]=B[K++]}O.push({type:X,payloadType:N,pts:_,bytes:se})}}}}}else if(N===5&&W<j){if(H=!0,W>16){for(var re=[],le=0;le<16;le++){var oe=B[K++].toString(16);re.push(oe.length==1?"0"+oe:oe),(le===3||le===5||le===7||le===9)&&re.push("-")}for(var de=W-16,xe=new Uint8Array(de),ce=0;ce<de;ce++)xe[ce]=B[K++];O.push({payloadType:N,pts:_,uuid:re.join(""),userData:(0,b.utf8ArrayToStr)(xe),userDataBytes:xe})}}else if(W<j)K+=W;else if(W>j)break}}function a(v){for(var o=v.byteLength,_=[],O=1;O<o-2;)v[O]===0&&v[O+1]===0&&v[O+2]===3?(_.push(O+2),O+=2):O++;if(_.length===0)return v;var B=o-_.length,K=new Uint8Array(B),N=0;for(O=0;O<B;N++,O++)N===_[0]&&(N++,_.shift()),K[O]=v[N];return K}function p(v){var o=v[0],_="",O="",B=0,K=0,N=0,W=0,H=0,V=0;if(o===0){for(;C(v.subarray(V,V+1))!=="\0";)_+=C(v.subarray(V,V+1)),V+=1;for(_+=C(v.subarray(V,V+1)),V+=1;C(v.subarray(V,V+1))!=="\0";)O+=C(v.subarray(V,V+1)),V+=1;O+=C(v.subarray(V,V+1)),V+=1,B=T(v,12),K=T(v,16),W=T(v,20),H=T(v,24),V=28}else if(o===1){V+=4,B=T(v,V),V+=4;var j=T(v,V);V+=4;var z=T(v,V);for(V+=4,N=Math.pow(2,32)*j+z,Number.isSafeInteger(N)||(N=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),W=T(v,V),V+=4,H=T(v,V),V+=4;C(v.subarray(V,V+1))!=="\0";)_+=C(v.subarray(V,V+1)),V+=1;for(_+=C(v.subarray(V,V+1)),V+=1;C(v.subarray(V,V+1))!=="\0";)O+=C(v.subarray(V,V+1)),V+=1;O+=C(v.subarray(V,V+1)),V+=1}var $=v.subarray(V,v.byteLength);return{schemeIdUri:_,value:O,timeScale:B,presentationTime:N,presentationTimeDelta:K,eventDuration:W,id:H,payload:$}}},"./src/utils/output-filter.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>M});var M=function(){function I(P,F){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=P,this.trackName=F}var b=I.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(F,R,C){(this.startTime===null||this.startTime>F)&&(this.startTime=F),this.endTime=R,this.screen=C,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[],this.startTime=null},I}()},"./src/utils/texttrack-utils.ts":(G,k,u)=>{u.r(k),u.d(k,{addCueToTrack:()=>b,clearCurrentCues:()=>P,getCuesInRange:()=>C,removeCuesInRange:()=>F,sendAddTrackEvent:()=>I});var M=u("./src/utils/logger.ts");function I(A,T){var S;try{S=new Event("addtrack")}catch{S=document.createEvent("Event"),S.initEvent("addtrack",!1,!1)}S.track=A,T.dispatchEvent(S)}function b(A,T){var S=A.mode;if(S==="disabled"&&(A.mode="hidden"),A.cues&&!A.cues.getCueById(T.id))try{if(A.addCue(T),!A.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(L){M.logger.debug("[texttrack-utils]: "+L);var D=new self.TextTrackCue(T.startTime,T.endTime,T.text);D.id=T.id,A.addCue(D)}S==="disabled"&&(A.mode=S)}function P(A){var T=A.mode;if(T==="disabled"&&(A.mode="hidden"),A.cues)for(var S=A.cues.length;S--;)A.removeCue(A.cues[S]);T==="disabled"&&(A.mode=T)}function F(A,T,S,D){var L=A.mode;if(L==="disabled"&&(A.mode="hidden"),A.cues&&A.cues.length>0)for(var y=C(A.cues,T,S),l=0;l<y.length;l++)(!D||D(y[l]))&&A.removeCue(y[l]);L==="disabled"&&(A.mode=L)}function R(A,T){if(T<A[0].startTime)return 0;var S=A.length-1;if(T>A[S].endTime)return-1;for(var D=0,L=S;D<=L;){var y=Math.floor((L+D)/2);if(T<A[y].startTime)L=y-1;else if(T>A[y].startTime&&D<S)D=y+1;else return y}return A[D].startTime-T<T-A[L].startTime?D:L}function C(A,T,S){var D=[],L=R(A,T);if(L>-1)for(var y=L,l=A.length;y<l;y++){var n=A[y];if(n.startTime>=T&&n.endTime<=S)D.push(n);else if(n.startTime>S)return D}return D}},"./src/utils/time-ranges.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>I});var M={toString:function(P){for(var F="",R=P.length,C=0;C<R;C++)F+="["+P.start(C).toFixed(3)+","+P.end(C).toFixed(3)+"]";return F}};const I=M},"./src/utils/timescale-conversion.ts":(G,k,u)=>{u.r(k),u.d(k,{toMpegTsClockFromTimescale:()=>F,toMsFromMpegTsClock:()=>P,toTimescaleFromBase:()=>I,toTimescaleFromScale:()=>b});var M=9e4;function I(R,C,A,T){A===void 0&&(A=1),T===void 0&&(T=!1);var S=R*C*A;return T?Math.round(S):S}function b(R,C,A,T){return A===void 0&&(A=1),T===void 0&&(T=!1),I(R,C,1/A,T)}function P(R,C){return C===void 0&&(C=!1),I(R,1e3,1/M,C)}function F(R,C){return C===void 0&&(C=1),I(R,M,1/C)}},"./src/utils/typed-array.ts":(G,k,u)=>{u.r(k),u.d(k,{sliceUint8:()=>M});function M(I,b,P){return Uint8Array.prototype.slice?I.slice(b,P):new Uint8Array(Array.prototype.slice.call(I,b,P))}},"./src/utils/vttcue.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>M});const M=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var I=["","lr","rl"],b=["start","middle","end","left","right"];function P(T,S){if(typeof S!="string"||!Array.isArray(T))return!1;var D=S.toLowerCase();return~T.indexOf(D)?D:!1}function F(T){return P(I,T)}function R(T){return P(b,T)}function C(T){for(var S=arguments.length,D=new Array(S>1?S-1:0),L=1;L<S;L++)D[L-1]=arguments[L];for(var y=1;y<arguments.length;y++){var l=arguments[y];for(var n in l)T[n]=l[n]}return T}function A(T,S,D){var L=this,y={enumerable:!0};L.hasBeenReset=!1;var l="",n=!1,r=T,h=S,d=D,e=null,t="",i=!0,c="auto",f="start",g=50,a="middle",p=50,v="middle";Object.defineProperty(L,"id",C({},y,{get:function(){return l},set:function(_){l=""+_}})),Object.defineProperty(L,"pauseOnExit",C({},y,{get:function(){return n},set:function(_){n=!!_}})),Object.defineProperty(L,"startTime",C({},y,{get:function(){return r},set:function(_){if(typeof _!="number")throw new TypeError("Start time must be set to a number.");r=_,this.hasBeenReset=!0}})),Object.defineProperty(L,"endTime",C({},y,{get:function(){return h},set:function(_){if(typeof _!="number")throw new TypeError("End time must be set to a number.");h=_,this.hasBeenReset=!0}})),Object.defineProperty(L,"text",C({},y,{get:function(){return d},set:function(_){d=""+_,this.hasBeenReset=!0}})),Object.defineProperty(L,"region",C({},y,{get:function(){return e},set:function(_){e=_,this.hasBeenReset=!0}})),Object.defineProperty(L,"vertical",C({},y,{get:function(){return t},set:function(_){var O=F(_);if(O===!1)throw new SyntaxError("An invalid or illegal string was specified.");t=O,this.hasBeenReset=!0}})),Object.defineProperty(L,"snapToLines",C({},y,{get:function(){return i},set:function(_){i=!!_,this.hasBeenReset=!0}})),Object.defineProperty(L,"line",C({},y,{get:function(){return c},set:function(_){if(typeof _!="number"&&_!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");c=_,this.hasBeenReset=!0}})),Object.defineProperty(L,"lineAlign",C({},y,{get:function(){return f},set:function(_){var O=R(_);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");f=O,this.hasBeenReset=!0}})),Object.defineProperty(L,"position",C({},y,{get:function(){return g},set:function(_){if(_<0||_>100)throw new Error("Position must be between 0 and 100.");g=_,this.hasBeenReset=!0}})),Object.defineProperty(L,"positionAlign",C({},y,{get:function(){return a},set:function(_){var O=R(_);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");a=O,this.hasBeenReset=!0}})),Object.defineProperty(L,"size",C({},y,{get:function(){return p},set:function(_){if(_<0||_>100)throw new Error("Size must be between 0 and 100.");p=_,this.hasBeenReset=!0}})),Object.defineProperty(L,"align",C({},y,{get:function(){return v},set:function(_){var O=R(_);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");v=O,this.hasBeenReset=!0}})),L.displayState=void 0}return A.prototype.getCueAsHTML=function(){var T=self.WebVTT;return T.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":(G,k,u)=>{u.r(k),u.d(k,{VTTParser:()=>S,fixLineBreaks:()=>T,parseTimeStamp:()=>b});var M=u("./src/utils/vttcue.ts"),I=function(){function D(){}var L=D.prototype;return L.decode=function(l,n){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},D}();function b(D){function L(l,n,r,h){return(l|0)*3600+(n|0)*60+(r|0)+parseFloat(h||0)}var y=D.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return y?parseFloat(y[2])>59?L(y[2],y[3],0,y[4]):L(y[1],y[2],y[3],y[4]):null}var P=function(){function D(){this.values=Object.create(null)}var L=D.prototype;return L.set=function(l,n){!this.get(l)&&n!==""&&(this.values[l]=n)},L.get=function(l,n,r){return r?this.has(l)?this.values[l]:n[r]:this.has(l)?this.values[l]:n},L.has=function(l){return l in this.values},L.alt=function(l,n,r){for(var h=0;h<r.length;++h)if(n===r[h]){this.set(l,n);break}},L.integer=function(l,n){/^-?\d+$/.test(n)&&this.set(l,parseInt(n,10))},L.percent=function(l,n){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(n)){var r=parseFloat(n);if(r>=0&&r<=100)return this.set(l,r),!0}return!1},D}();function F(D,L,y,l){var n=l?D.split(l):[D];for(var r in n)if(typeof n[r]=="string"){var h=n[r].split(y);if(h.length===2){var d=h[0],e=h[1];L(d,e)}}}var R=new M.default(0,0,""),C=R.align==="middle"?"middle":"center";function A(D,L,y){var l=D;function n(){var d=b(D);if(d===null)throw new Error("Malformed timestamp: "+l);return D=D.replace(/^[^\sa-zA-Z-]+/,""),d}function r(d,e){var t=new P;F(d,function(f,g){var a;switch(f){case"region":for(var p=y.length-1;p>=0;p--)if(y[p].id===g){t.set(f,y[p].region);break}break;case"vertical":t.alt(f,g,["rl","lr"]);break;case"line":a=g.split(","),t.integer(f,a[0]),t.percent(f,a[0])&&t.set("snapToLines",!1),t.alt(f,a[0],["auto"]),a.length===2&&t.alt("lineAlign",a[1],["start",C,"end"]);break;case"position":a=g.split(","),t.percent(f,a[0]),a.length===2&&t.alt("positionAlign",a[1],["start",C,"end","line-left","line-right","auto"]);break;case"size":t.percent(f,g);break;case"align":t.alt(f,g,["start",C,"end","left","right"]);break}},/:/,/\s/),e.region=t.get("region",null),e.vertical=t.get("vertical","");var i=t.get("line","auto");i==="auto"&&R.line===-1&&(i=-1),e.line=i,e.lineAlign=t.get("lineAlign","start"),e.snapToLines=t.get("snapToLines",!0),e.size=t.get("size",100),e.align=t.get("align",C);var c=t.get("position","auto");c==="auto"&&R.position===50&&(c=e.align==="start"||e.align==="left"?0:e.align==="end"||e.align==="right"?100:50),e.position=c}function h(){D=D.replace(/^\s+/,"")}if(h(),L.startTime=n(),h(),D.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);D=D.slice(3),h(),L.endTime=n(),h(),r(D,L)}function T(D){return D.replace(/<br(?: \/)?>/gi,`
`)}var S=function(){function D(){this.state="INITIAL",this.buffer="",this.decoder=new I,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var L=D.prototype;return L.parse=function(l){var n=this;l&&(n.buffer+=n.decoder.decode(l,{stream:!0}));function r(){var c=n.buffer,f=0;for(c=T(c);f<c.length&&c[f]!=="\r"&&c[f]!==`
`;)++f;var g=c.slice(0,f);return c[f]==="\r"&&++f,c[f]===`
`&&++f,n.buffer=c.slice(f),g}function h(c){F(c,function(f,g){},/:/)}try{var d="";if(n.state==="INITIAL"){if(!/\r\n|\n/.test(n.buffer))return this;d=r();var e=d.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!e||!e[0])throw new Error("Malformed WebVTT signature.");n.state="HEADER"}for(var t=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(t?t=!1:d=r(),n.state){case"HEADER":/:/.test(d)?h(d):d||(n.state="ID");continue;case"NOTE":d||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){n.state="NOTE";break}if(!d)continue;if(n.cue=new M.default(0,0,""),n.state="CUE",d.indexOf("-->")===-1){n.cue.id=d;continue}case"CUE":if(!n.cue){n.state="BADCUE";continue}try{A(d,n.cue,n.regionList)}catch{n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":{var i=d.indexOf("-->")!==-1;if(!d||i&&(t=!0)){n.oncue&&n.cue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}if(n.cue===null)continue;n.cue.text&&(n.cue.text+=`
`),n.cue.text+=d}continue;case"BADCUE":d||(n.state="ID")}}}catch{n.state==="CUETEXT"&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state=n.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},L.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(n){l.onparsingerror&&l.onparsingerror(n)}return l.onflush&&l.onflush(),this},D}()},"./src/utils/webvtt-parser.ts":(G,k,u)=>{u.r(k),u.d(k,{generateCueId:()=>S,parseWebVTT:()=>L});var M=u("./src/polyfills/number.ts"),I=u("./src/utils/vttparser.ts"),b=u("./src/demux/id3.ts"),P=u("./src/utils/timescale-conversion.ts"),F=u("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,C=function(l,n,r){return r===void 0&&(r=0),l.slice(r,r+n.length)===n},A=function(l){var n=parseInt(l.slice(-3)),r=parseInt(l.slice(-6,-4)),h=parseInt(l.slice(-9,-7)),d=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!(0,M.isFiniteNumber)(n)||!(0,M.isFiniteNumber)(r)||!(0,M.isFiniteNumber)(h)||!(0,M.isFiniteNumber)(d))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return n+=1e3*r,n+=60*1e3*h,n+=60*60*1e3*d,n},T=function(l){for(var n=5381,r=l.length;r;)n=n*33^l.charCodeAt(--r);return(n>>>0).toString()};function S(y,l,n){return T(y.toString())+T(l.toString())+T(n)}var D=function(l,n,r){var h=l[n],d=l[h.prevCC];if(!d||!d.new&&h.new){l.ccOffset=l.presentationOffset=h.start,h.new=!1;return}for(;(e=d)!==null&&e!==void 0&&e.new;){var e;l.ccOffset+=h.start-d.start,h.new=!1,h=d,d=l[h.prevCC]}l.presentationOffset=r};function L(y,l,n,r,h,d,e,t){var i=new I.VTTParser,c=(0,b.utf8ArrayToStr)(new Uint8Array(y)).trim().replace(R,`
`).split(`
`),f=[],g=(0,P.toMpegTsClockFromTimescale)(l,n),a="00:00.000",p=0,v=0,o,_=!0;i.oncue=function(O){var B=r[h],K=r.ccOffset,N=(p-g)/9e4;B!=null&&B.new&&(v!==void 0?K=r.ccOffset=B.start:D(r,h,N)),N&&(K=N-r.presentationOffset);var W=O.endTime-O.startTime,H=(0,F.normalizePts)((O.startTime+K-v)*9e4,d*9e4)/9e4;O.startTime=Math.max(H,0),O.endTime=Math.max(H+W,0);var V=O.text.trim();O.text=decodeURIComponent(encodeURIComponent(V)),O.id||(O.id=S(O.startTime,O.endTime,V)),O.endTime>0&&f.push(O)},i.onparsingerror=function(O){o=O},i.onflush=function(){if(o){t(o);return}e(f)},c.forEach(function(O){if(_)if(C(O,"X-TIMESTAMP-MAP=")){_=!1,O.slice(16).split(",").forEach(function(B){C(B,"LOCAL:")?a=B.slice(6):C(B,"MPEGTS:")&&(p=parseInt(B.slice(7)))});try{v=A(a)/1e3}catch(B){o=B}return}else O===""&&(_=!1);i.parse(O+`
`)}),i.flush()}},"./src/utils/xhr-loader.ts":(G,k,u)=>{u.r(k),u.d(k,{default:()=>F});var M=u("./src/utils/logger.ts"),I=u("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,P=function(){function R(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new I.LoadStats,this.retryDelay=0}var C=R.prototype;return C.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},C.abortInternal=function(){var T=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),T&&(T.onreadystatechange=null,T.onprogress=null,T.readyState!==4&&(this.stats.aborted=!0,T.abort()))},C.abort=function(){var T;this.abortInternal(),(T=this.callbacks)!==null&&T!==void 0&&T.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},C.load=function(T,S,D){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=T,this.config=S,this.callbacks=D,this.retryDelay=S.retryDelay,this.loadInternal()},C.loadInternal=function(){var T=this.config,S=this.context;if(!!T){var D=this.loader=new self.XMLHttpRequest,L=this.stats;L.loading.first=0,L.loaded=0;var y=this.xhrSetup;try{if(y)try{y(D,S.url)}catch{D.open("GET",S.url,!0),y(D,S.url)}D.readyState||D.open("GET",S.url,!0);var l=this.context.headers;if(l)for(var n in l)D.setRequestHeader(n,l[n])}catch(r){this.callbacks.onError({code:D.status,text:r.message},S,D);return}S.rangeEnd&&D.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),D.onreadystatechange=this.readystatechange.bind(this),D.onprogress=this.loadprogress.bind(this),D.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout),D.send()}},C.readystatechange=function(){var T=this.context,S=this.loader,D=this.stats;if(!(!T||!S)){var L=S.readyState,y=this.config;if(!D.aborted&&L>=2)if(self.clearTimeout(this.requestTimeout),D.loading.first===0&&(D.loading.first=Math.max(self.performance.now(),D.loading.start)),L===4){S.onreadystatechange=null,S.onprogress=null;var l=S.status,n=S.responseType==="arraybuffer";if(l>=200&&l<300&&(n&&S.response||S.responseText!==null)){D.loading.end=Math.max(self.performance.now(),D.loading.first);var r,h;if(n?(r=S.response,h=r.byteLength):(r=S.responseText,h=r.length),D.loaded=D.total=h,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(D,T,r,S),!this.callbacks)return;var e={url:S.responseURL,data:r};this.callbacks.onSuccess(e,D,T,S)}else D.retry>=y.maxRetry||l>=400&&l<499?(M.logger.error(l+" while loading "+T.url),this.callbacks.onError({code:l,text:S.statusText},T,S)):(M.logger.warn(l+" while loading "+T.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,y.maxRetryDelay),D.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),y.timeout)}},C.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var T=this.callbacks;T&&(this.abortInternal(),T.onTimeout(this.stats,this.context,this.loader))},C.loadprogress=function(T){var S=this.stats;S.loaded=T.loaded,T.lengthComputable&&(S.total=T.total)},C.getCacheAge=function(){var T=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");T=S?parseFloat(S):null}return T},R}();const F=P},"./node_modules/eventemitter3/index.js":G=>{var k=Object.prototype.hasOwnProperty,u="~";function M(){}Object.create&&(M.prototype=Object.create(null),new M().__proto__||(u=!1));function I(R,C,A){this.fn=R,this.context=C,this.once=A||!1}function b(R,C,A,T,S){if(typeof A!="function")throw new TypeError("The listener must be a function");var D=new I(A,T||R,S),L=u?u+C:C;return R._events[L]?R._events[L].fn?R._events[L]=[R._events[L],D]:R._events[L].push(D):(R._events[L]=D,R._eventsCount++),R}function P(R,C){--R._eventsCount===0?R._events=new M:delete R._events[C]}function F(){this._events=new M,this._eventsCount=0}F.prototype.eventNames=function(){var C=[],A,T;if(this._eventsCount===0)return C;for(T in A=this._events)k.call(A,T)&&C.push(u?T.slice(1):T);return Object.getOwnPropertySymbols?C.concat(Object.getOwnPropertySymbols(A)):C},F.prototype.listeners=function(C){var A=u?u+C:C,T=this._events[A];if(!T)return[];if(T.fn)return[T.fn];for(var S=0,D=T.length,L=new Array(D);S<D;S++)L[S]=T[S].fn;return L},F.prototype.listenerCount=function(C){var A=u?u+C:C,T=this._events[A];return T?T.fn?1:T.length:0},F.prototype.emit=function(C,A,T,S,D,L){var y=u?u+C:C;if(!this._events[y])return!1;var l=this._events[y],n=arguments.length,r,h;if(l.fn){switch(l.once&&this.removeListener(C,l.fn,void 0,!0),n){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,A),!0;case 3:return l.fn.call(l.context,A,T),!0;case 4:return l.fn.call(l.context,A,T,S),!0;case 5:return l.fn.call(l.context,A,T,S,D),!0;case 6:return l.fn.call(l.context,A,T,S,D,L),!0}for(h=1,r=new Array(n-1);h<n;h++)r[h-1]=arguments[h];l.fn.apply(l.context,r)}else{var d=l.length,e;for(h=0;h<d;h++)switch(l[h].once&&this.removeListener(C,l[h].fn,void 0,!0),n){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,A);break;case 3:l[h].fn.call(l[h].context,A,T);break;case 4:l[h].fn.call(l[h].context,A,T,S);break;default:if(!r)for(e=1,r=new Array(n-1);e<n;e++)r[e-1]=arguments[e];l[h].fn.apply(l[h].context,r)}}return!0},F.prototype.on=function(C,A,T){return b(this,C,A,T,!1)},F.prototype.once=function(C,A,T){return b(this,C,A,T,!0)},F.prototype.removeListener=function(C,A,T,S){var D=u?u+C:C;if(!this._events[D])return this;if(!A)return P(this,D),this;var L=this._events[D];if(L.fn)L.fn===A&&(!S||L.once)&&(!T||L.context===T)&&P(this,D);else{for(var y=0,l=[],n=L.length;y<n;y++)(L[y].fn!==A||S&&!L[y].once||T&&L[y].context!==T)&&l.push(L[y]);l.length?this._events[D]=l.length===1?l[0]:l:P(this,D)}return this},F.prototype.removeAllListeners=function(C){var A;return C?(A=u?u+C:C,this._events[A]&&P(this,A)):(this._events=new M,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=u,F.EventEmitter=F,G.exports=F},"./node_modules/url-toolkit/src/url-toolkit.js":function(G){(function(k){var u=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,M=/^(?=([^\/?#]*))\1([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,b=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,P={buildAbsoluteURL:function(F,R,C){if(C=C||{},F=F.trim(),R=R.trim(),!R){if(!C.alwaysNormalize)return F;var A=P.parseURL(F);if(!A)throw new Error("Error trying to parse base URL.");return A.path=P.normalizePath(A.path),P.buildURLFromParts(A)}var T=P.parseURL(R);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return C.alwaysNormalize?(T.path=P.normalizePath(T.path),P.buildURLFromParts(T)):R;var S=P.parseURL(F);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var D=M.exec(S.path);S.netLoc=D[1],S.path=D[2]}S.netLoc&&!S.path&&(S.path="/");var L={scheme:S.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(L.netLoc=S.netLoc,T.path[0]!=="/"))if(!T.path)L.path=S.path,T.params||(L.params=S.params,T.query||(L.query=S.query));else{var y=S.path,l=y.substring(0,y.lastIndexOf("/")+1)+T.path;L.path=P.normalizePath(l)}return L.path===null&&(L.path=C.alwaysNormalize?P.normalizePath(T.path):T.path),P.buildURLFromParts(L)},parseURL:function(F){var R=u.exec(F);return R?{scheme:R[1]||"",netLoc:R[2]||"",path:R[3]||"",params:R[4]||"",query:R[5]||"",fragment:R[6]||""}:null},normalizePath:function(F){for(F=F.split("").reverse().join("").replace(I,"");F.length!==(F=F.replace(b,"")).length;);return F.split("").reverse().join("")},buildURLFromParts:function(F){return F.scheme+F.netLoc+F.path+F.params+F.query+F.fragment}};G.exports=P})()}},x={};function w(G){var k=x[G];if(k!==void 0)return k.exports;var u=x[G]={exports:{}};return E[G].call(u.exports,u,u.exports,w),u.exports}w.m=E,w.n=G=>{var k=G&&G.__esModule?()=>G.default:()=>G;return w.d(k,{a:k}),k},w.d=(G,k)=>{for(var u in k)w.o(k,u)&&!w.o(G,u)&&Object.defineProperty(G,u,{enumerable:!0,get:k[u]})},w.o=(G,k)=>Object.prototype.hasOwnProperty.call(G,k),w.r=G=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(G,"__esModule",{value:!0})};var U=w("./src/hls.ts");return U=U.default,U})())})(Lr);function dr(s){let m,E;return m=new es({props:{slidesPerView:s[0],autoplay:{delay:1e3,disableOnInteraction:!1},spaceBetween:30,class:"slides",loop:!0,modules:[Wn],style:"width: 60%;",$$slots:{default:[hs]},$$scope:{ctx:s}}}),{c(){qe(m.$$.fragment)},l(x){et(m.$$.fragment,x)},m(x,w){tt(m,x,w),E=!0},p(x,w){const U={};w&1&&(U.slidesPerView=x[0]),w&2&&(U.$$scope={dirty:w,ctx:x}),m.$set(U)},i(x){E||(me(m.$$.fragment,x),E=!0)},o(x){ye(m.$$.fragment,x),E=!1},d(x){rt(m,x)}}}function os(s){let m,E,x;return{c(){m=ue("a"),E=ue("img"),this.h()},l(w){m=fe(w,"A",{href:!0,target:!0,class:!0});var U=he(m);E=fe(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){vt(E.src,x="/images/clients-icons/nzxt-icon.png")||te(E,"src",x),te(E,"alt","NZXT"),te(E,"class","svelte-zh1v7o"),te(m,"href","https://nzxt.com/"),te(m,"target","_blank"),te(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function ls(s){let m,E,x;return{c(){m=ue("a"),E=ue("img"),this.h()},l(w){m=fe(w,"A",{href:!0,target:!0,class:!0});var U=he(m);E=fe(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){vt(E.src,x="/images/clients-icons/cushion-icon.png")||te(E,"src",x),te(E,"alt","Cushion"),te(E,"class","svelte-zh1v7o"),te(m,"href","https://cushion.ai/"),te(m,"target","_blank"),te(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function us(s){let m,E,x;return{c(){m=ue("a"),E=ue("img"),this.h()},l(w){m=fe(w,"A",{href:!0,target:!0,class:!0});var U=he(m);E=fe(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){vt(E.src,x="/images/clients-icons/irl-icon.png")||te(E,"src",x),te(E,"alt","IRL"),te(E,"class","svelte-zh1v7o"),te(m,"href","https://www.irl.com/"),te(m,"target","_blank"),te(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function fs(s){let m,E,x;return{c(){m=ue("a"),E=ue("img"),this.h()},l(w){m=fe(w,"A",{href:!0,target:!0,class:!0});var U=he(m);E=fe(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){vt(E.src,x="/images/clients-icons/kyla.png")||te(E,"src",x),te(E,"alt","Kyla"),te(E,"class","svelte-zh1v7o"),te(m,"href","https://kyla.com/p/"),te(m,"target","_blank"),te(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function ds(s){let m,E,x;return{c(){m=ue("a"),E=ue("img"),this.h()},l(w){m=fe(w,"A",{href:!0,target:!0,class:!0});var U=he(m);E=fe(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){vt(E.src,x="/images/clients-icons/outco-icon.png")||te(E,"src",x),te(E,"alt","Outco"),te(E,"class","svelte-zh1v7o"),te(m,"href","#"),te(m,"target","_blank"),te(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function cs(s){let m,E,x;return{c(){m=ue("a"),E=ue("img"),this.h()},l(w){m=fe(w,"A",{href:!0,target:!0,class:!0});var U=he(m);E=fe(U,"IMG",{src:!0,alt:!0,class:!0}),U.forEach(ne),this.h()},h(){vt(E.src,x="/images/clients-icons/ficon.png")||te(E,"src",x),te(E,"alt","Fellow"),te(E,"class","svelte-zh1v7o"),te(m,"href","https://fellowproducts.com/"),te(m,"target","_blank"),te(m,"class","svelte-zh1v7o")},m(w,U){ge(w,m,U),ae(m,E)},p:Ve,d(w){w&&ne(m)}}}function hs(s){let m,E,x,w,U,G,k,u,M,I,b,P;return m=new dt({props:{$$slots:{default:[os]},$$scope:{ctx:s}}}),x=new dt({props:{$$slots:{default:[ls]},$$scope:{ctx:s}}}),U=new dt({props:{$$slots:{default:[us]},$$scope:{ctx:s}}}),k=new dt({props:{$$slots:{default:[fs]},$$scope:{ctx:s}}}),M=new dt({props:{$$slots:{default:[ds]},$$scope:{ctx:s}}}),b=new dt({props:{$$slots:{default:[cs]},$$scope:{ctx:s}}}),{c(){qe(m.$$.fragment),E=Ee(),qe(x.$$.fragment),w=Ee(),qe(U.$$.fragment),G=Ee(),qe(k.$$.fragment),u=Ee(),qe(M.$$.fragment),I=Ee(),qe(b.$$.fragment)},l(F){et(m.$$.fragment,F),E=Te(F),et(x.$$.fragment,F),w=Te(F),et(U.$$.fragment,F),G=Te(F),et(k.$$.fragment,F),u=Te(F),et(M.$$.fragment,F),I=Te(F),et(b.$$.fragment,F)},m(F,R){tt(m,F,R),ge(F,E,R),tt(x,F,R),ge(F,w,R),tt(U,F,R),ge(F,G,R),tt(k,F,R),ge(F,u,R),tt(M,F,R),ge(F,I,R),tt(b,F,R),P=!0},p(F,R){const C={};R&2&&(C.$$scope={dirty:R,ctx:F}),m.$set(C);const A={};R&2&&(A.$$scope={dirty:R,ctx:F}),x.$set(A);const T={};R&2&&(T.$$scope={dirty:R,ctx:F}),U.$set(T);const S={};R&2&&(S.$$scope={dirty:R,ctx:F}),k.$set(S);const D={};R&2&&(D.$$scope={dirty:R,ctx:F}),M.$set(D);const L={};R&2&&(L.$$scope={dirty:R,ctx:F}),b.$set(L)},i(F){P||(me(m.$$.fragment,F),me(x.$$.fragment,F),me(U.$$.fragment,F),me(k.$$.fragment,F),me(M.$$.fragment,F),me(b.$$.fragment,F),P=!0)},o(F){ye(m.$$.fragment,F),ye(x.$$.fragment,F),ye(U.$$.fragment,F),ye(k.$$.fragment,F),ye(M.$$.fragment,F),ye(b.$$.fragment,F),P=!1},d(F){rt(m,F),F&&ne(E),rt(x,F),F&&ne(w),rt(U,F),F&&ne(G),rt(k,F),F&&ne(u),rt(M,F),F&&ne(I),rt(b,F)}}}function vs(s){let m,E,x,w,U,G,k,u,M,I,b,P,F,R,C,A,T,S,D,L,y,l,n,r,h,d,e,t,i,c=s[0]>0&&dr(s);return{c(){m=ue("div"),E=ue("section"),x=ue("video"),w=Ee(),U=ue("script"),G=je(`if (Hls.isSupported()) {
				const video = document.getElementById('video');
				const hls = new Hls();
				hls.attachMedia(video);
				hls.on(Hls.Events.MEDIA_ATTACHED, () => {
					hls.loadSource(
						'https://customer-si5cxun7zm99ttrb.cloudflarestream.com/38201dc5c5d26f789caf61e77babb163/manifest/video.m3u8'
					);
				});
			}
			video.play();`),k=Ee(),u=ue("div"),M=ue("h1"),I=je("We Tackle Your "),b=ue("br"),P=je("Growth Problems"),F=Ee(),R=ue("p"),C=je("Scalewhale is a Paid Media agency"),A=ue("br"),T=je(" with expertise in Analytics, and MarOps"),S=Ee(),D=ue("a"),L=je("Get in Touch"),y=Ee(),l=ue("section"),n=ue("div"),r=ue("h2"),h=je("We've had the pleasure"),d=ue("br"),e=je(" of working with:"),t=Ee(),c&&c.c(),this.h()},l(f){m=fe(f,"DIV",{class:!0});var g=he(m);E=fe(g,"SECTION",{class:!0});var a=he(E);x=fe(a,"VIDEO",{id:!0,style:!0,class:!0}),he(x).forEach(ne),w=Te(a),U=fe(a,"SCRIPT",{class:!0});var p=he(U);G=ze(p,`if (Hls.isSupported()) {
				const video = document.getElementById('video');
				const hls = new Hls();
				hls.attachMedia(video);
				hls.on(Hls.Events.MEDIA_ATTACHED, () => {
					hls.loadSource(
						'https://customer-si5cxun7zm99ttrb.cloudflarestream.com/38201dc5c5d26f789caf61e77babb163/manifest/video.m3u8'
					);
				});
			}
			video.play();`),p.forEach(ne),k=Te(a),u=fe(a,"DIV",{class:!0});var v=he(u);M=fe(v,"H1",{class:!0});var o=he(M);I=ze(o,"We Tackle Your "),b=fe(o,"BR",{class:!0}),P=ze(o,"Growth Problems"),o.forEach(ne),F=Te(v),R=fe(v,"P",{class:!0});var _=he(R);C=ze(_,"Scalewhale is a Paid Media agency"),A=fe(_,"BR",{class:!0}),T=ze(_," with expertise in Analytics, and MarOps"),_.forEach(ne),S=Te(v),D=fe(v,"A",{style:!0,id:!0,href:!0,class:!0});var O=he(D);L=ze(O,"Get in Touch"),O.forEach(ne),v.forEach(ne),a.forEach(ne),y=Te(g),l=fe(g,"SECTION",{class:!0});var B=he(l);n=fe(B,"DIV",{class:!0});var K=he(n);r=fe(K,"H2",{class:!0});var N=he(r);h=ze(N,"We've had the pleasure"),d=fe(N,"BR",{class:!0}),e=ze(N," of working with:"),N.forEach(ne),t=Te(K),c&&c.l(K),K.forEach(ne),B.forEach(ne),g.forEach(ne),this.h()},h(){te(x,"id","video"),x.autoplay="autoplay",x.muted=!0,x.loop=!0,x.playsInline=!0,Yt(x,"point-events","none"),te(x,"class","svelte-zh1v7o"),te(U,"class","svelte-zh1v7o"),te(b,"class","svelte-zh1v7o"),te(M,"class","svelte-zh1v7o"),te(A,"class","svelte-zh1v7o"),te(R,"class","svelte-zh1v7o"),Yt(D,"color","black"),te(D,"id","get-in-touch"),te(D,"href","/contact"),te(D,"class","svelte-zh1v7o"),te(u,"class","hero-content svelte-zh1v7o"),te(E,"class","hero svelte-zh1v7o"),te(d,"class","svelte-zh1v7o"),te(r,"class","svelte-zh1v7o"),te(n,"class","clients svelte-zh1v7o"),te(l,"class","container svelte-zh1v7o"),te(m,"class","main-page svelte-zh1v7o")},m(f,g){ge(f,m,g),ae(m,E),ae(E,x),ae(E,w),ae(E,U),ae(U,G),ae(E,k),ae(E,u),ae(u,M),ae(M,I),ae(M,b),ae(M,P),ae(u,F),ae(u,R),ae(R,C),ae(R,A),ae(R,T),ae(u,S),ae(u,D),ae(D,L),ae(m,y),ae(m,l),ae(l,n),ae(n,r),ae(r,h),ae(r,d),ae(r,e),ae(n,t),c&&c.m(n,null),i=!0},p(f,[g]){f[0]>0?c?(c.p(f,g),g&1&&me(c,1)):(c=dr(f),c.c(),me(c,1),c.m(n,null)):c&&(gr(),ye(c,1,1,()=>{c=null}),pr())},i(f){i||(me(c),i=!0)},o(f){ye(c),i=!1},d(f){f&&ne(m),c&&c.d()}}}function gs(s,m,E){globalThis.Hls=Lr.exports.Hls;let x=0;return Gt(()=>{E(0,x=window.innerWidth>1200?3:window.innerWidth>500?2:1)}),[x]}class Es extends Nt{constructor(m){super(),Kt(this,m,gs,vs,Lt,{})}}export{Es as default};
